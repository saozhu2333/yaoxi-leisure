(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pageB-VideoContent-content"],{"143c":function(e,t,r){var i=r("74e8");i("Int32",(function(e){return function(t,r,i){return e(this,t,r,i)}}))},"1aeb":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD8AAAA/CAYAAAEgWCBJAAAAAXNSR0IArs4c6QAABbpJREFUaAXtm01oHVUUx5uqAS0pgoKpCylFrAEtLdkkiG4EIQurQRduRSkIEcSFC104LuzChatAIejeRa1fi64EUTDZPCtRiBWR4qKt25YoRGz8/6Y9w5n75r6Zee/Ne+ZND5x3zz333PNx586999xJ9u3LwyFV3/asKVdJHG1kYgJFjanQfv2iNoXd3d13IayERuBliBggcDrWCL/UBxNAOOEngOSOgPG66vcJfzO+aUiM4crLotdwMnFMTz5IBYEM1tfXl/0YqCHJCWSSjigVwMl7hG+5Tp5Mw/xHnH+FR3yL6IS6hQltkBgRKT8Q/y9r8woSY1Ysv5bcd6agqzND1ul0/lhZWelAo3RxcfEzSgc7d6rC4+uChYWFY7eYHUeHCqYZ5uy5d2mpwIiGUKEvImdsNn6jyiPCGWFVSCS4bR6EnXi1p0Om6meEf3p+TAEyS8ITwuvCs8Irwi4IFfSaltY5MYLSKzilevoOeYEInRjf3pYnxajamb4JP4ApePpmtdZvgjQKGPEcMHVt+tLg6ZygKkzlrscVTt1b9XAao+uQhUClH3hxUAUzgyq4MKiC80ykB4Sv9TMA6pOuy7mXo4Yi1sZsIiU1OiJ6WZgurP5doCHhpwTSxdRkQgXwY2Oyo7bT1tHKIgXW5kuUviLsmrVeyNEY+1hYOr69HOAN7+cldX5kZG7YMq6IIgdOiV9nafH6ymge/poX8g5UWU1930HobHu3XYln/MYgGmv2fULyW8JsV0uqKPCnq42NjU1/VPBtU1NT71XRJ5l0JWD3GxcssRiy9Y4LTuAA+/644DoOcOgYF5zFAU48rFyjBmxe8etAMmIPUnveAewPc/mNxZNblkMHrFMTy3HXMoyxmAPmyDCW52zZNaW+LHPAyxpNDn5c+LDQEgpeZVKdH4WFx3jxC6GuA7w188KjwlnhAeG28KrworAjvCGsBFWNPydtdVbLC5L/osyDMuPPSgGR9guMxFexzr2MJ7FOffALdRUZPyjlb/ZhoKzLhxK45oWYQB7uUqUJw9hAL/ozCI2/k7U0Q+T0e+Oxi51hu5HZMeOcclnVRgHYwV6WN7GujxJSe4W5d8wLn8T7g+bq6uq84CHr59uMV1BOY3y5oKGQ5S4EaM8uAjAcaytUdJO5zDOf6yHQZNOcTbgmjUR13zYeHZomG24Pe5OjG9XNsJNXjwO2MH5uHJaxayeZZAwOpJcI2F0bsfHUnr1qpDXZN5uGHcEO9rL9HJr0ZhSQ2bHIzej7RjRU5vTb1ZnZItX5QbhojCGWHJ3/9vpstnue0YkRQygLdfUyjs2xpUs+4OdVITWuCqTLn5cJl0Ue9meCjjxFDp3oVScl4lwIHhbeLewXmKCXhOw/IB+lhwZ1R77IMAnIU8JHixob4v0ivd8K08WyXxv9Bk+gJ4WjyvJ6xceO8aWQAakFdYJnOhPw47UsjFb4J5ljICq9HlWCPyhlrwop9wpck6MfCSmjUBb8C+r5f37S0cBuNTATPo0JxYLnnX4p1mkP8j+Rz11rQni2Ii5OFc9ATBA8plhmhL/6mMLgedrHvMAE0WzJs8KfLSYfPEc4RmiS4X4Fd68wfQW4IgR42sdTakg//uO4Vxl+RPdt3H8GV41Zc40P7FmfCEGcvws3OSuDS8I2AfHut0RhkPP3Xhw04p0neD4ithGOEjwrYBthluD5bNxGOEDwfC9vI2wT/NU2Rk7cBM9fSLQRLhJ8R5i7z2zBSBBvh+C5KD7fgoB9iMR7w463m6ocEQ7tiMsx1lszmn8tMTose7WFsgPU+fuj1LcwnyerI5efVCChIbdPwWd1MEj3yHtJ/yYNWNvO+aDC4Gkj4Wf7m6T0lqf9vTAH4bTPNarSyjs8Pwjc2rby9tYPQivv7f0AGM2OcFLYmi82FnhYsjO06ltdOAC+Pq0KM2NOeFg4yC0Rx9BLwi0he/SOcGjwH3EbEPF8TEPUAAAAAElFTkSuQmCC"},"1bcf":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAAsCAYAAAAwwXuTAAAAAXNSR0IArs4c6QAAANVJREFUaAXtllEOgCAMQ8V4BL3/AeUOmvi5BEYmTUZT/whQt74GKHetz0b87cS9fa2pwdUJi6AIJndAEU0OyC2PnuDhWXCdZ/HW9Oa9lxJan56gGuzFb4U5EVyBUq9G9xRtbban49/T0P5nlj59RMMEPcft/N+xJTqqR09QDY5GIes6EcxKZrQuERx1Kuu6afdg6yUTvb+sYVF9+oiGCbYctc5Hx7P06QmqwWjEsuwTwSwkonWUWfdUtAD0PkUU7TBaXwTRDqP1RRDtMFpfBNEOo/XpCb7+ZiflzAikegAAAABJRU5ErkJggg=="},"1de5":function(e,t,r){"use strict";e.exports=function(e,t){return t||(t={}),e=e&&e.__esModule?e.default:e,"string"!==typeof e?e:(/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e)}},"1e1b":function(e,t,r){e.exports=r.p+"static/img/bigplay.682d4265.png"},"20bf":function(e,t,r){"use strict";var i=r("8aa7"),n=r("ebb5").exportTypedArrayStaticMethod,a=r("a078");n("from",a,i)},2349:function(e,t,r){var i=r("24fb");t=i(!1),t.push([e.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* @import url('../../node_modules/aliyun-aliplayer/dist/skins/default/aliplayer-min.css'); */.video-box[data-v-c7cf92a8]{width:100%;max-height:%?500?%}.app-video-css[data-v-c7cf92a8]{margin-top:%?100?%}[data-v-c7cf92a8] .dplayer-menu,\n.dplayer-mask[data-v-c7cf92a8]{display:none!important}",""]),e.exports=t},"257e":function(e,t,r){"use strict";r("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},r("d9e2"),r("d401")},"262e":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&(0,i.default)(e,t)},r("d9e2"),r("d401"),r("7a82");var i=function(e){return e&&e.__esModule?e:{default:e}}(r("b380"))},"2caf":function(e,t,r){"use strict";r("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=(0,n.default)();return function(){var r,n=(0,i.default)(e);if(t){var o=(0,i.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}},r("4ae1"),r("d3b7"),r("f8c9");var i=o(r("7e84")),n=o(r("d967")),a=o(r("99de"));function o(e){return e&&e.__esModule?e:{default:e}}},4057:function(e,t,r){var i=r("23e7"),n=Math.hypot,a=Math.abs,o=Math.sqrt,s=!!n&&n(1/0,NaN)!==1/0;i({target:"Math",stat:!0,arity:2,forced:s},{hypot:function(e,t){var r,i,n=0,s=0,l=arguments.length,u=0;while(s<l)r=a(arguments[s++]),u<r?(i=u/r,n=n*i*i+1,u=r):r>0?(i=r/u,n+=i*i):n+=r;return u===1/0?1/0:u*o(n)}})},4467:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAAHdbkFIAAAAAXNSR0IArs4c6QAABNNJREFUeAHtWs2LFEcUfz07yO5BkkB2RQ+yuxAESRD8QoLuSo7JLezm7N1LICdD9qSgeBPRP0Fh/4A96CHs6IKQkFPMJTBr9pBE96IomQS3p1O/6nndr6qrZ7tnu8eZtfpSr169z199dHV1EVX/rLcjabSZVKwGzVe8RiJgE1BYnA9MNpguS4bUrgKGdPWV1l/TttEYBw4s6qA90Jn0UnTjgEZWSkyCkWEmrWNNWL0tcpEJZ0ZFKpeON/CkUiqTUo+3TlO485NmHJmbpE+C/9z9kKqYFJSh2GyepT83/0VjfgqP2svUpVVtoU8KpgdfqwkBxySVnsyBJFtAY2DxJLbbenW3AXiNOi9ydAx2akAO49irIUitP5YoiE7QhdkVam0+JZq8SAuHt9ORKA2YqpQssZAJaJsimmZeubkQBL9p5UbjGvsobgBhR9Fx7bnb/YFaz76HkTQFNiknEfP6TKasAVaSmPQxkJ8ClBr0DdvzpUdglBFotVd3fR/2iT9djfoIZZrgNKJlzTf2hRnJXRn5E9FW5Uwxw9m5LSPrG1ufympCW28INwJyGWHNMpliC7KjdhHrbSKsnLyGYzHEWv97pLclMO1ey1wBcCB5pWu9k3sh6PX2Q9JE8S6QWkVoLP+8EWse+FyrYD/16NlVqe7uAikxKA24zYwDAiLd8IEyucJm3V3ArXbZar/Qb0Sbj7qrC1xyFq9cAFLZDmbAAKTJwWkE4x+PgEfAI/B+I4DNyoDP3t6G/CVaZrNiBTr4fkDvC4t9Bls+jWp5BCrIWkZQDoGKspYBFEOgqqyfPD9E5w49lwG4NyR73ZSut98qJ01jl7Tx9wzt/APnvyr+ZxxEuS5grV3L4I0W4URS54odbEn1egJYnPtIOXqZBBFnDudrtDj3Vf0BwEMcxKvUWdY52upBAJYBO0UfgIyf6EumZFlPAGafrxndIb0ruvoAHm8f7I12Zb4Huz0mRBDVB3B++jUFwc3EOTvjIILGKWahdK8DUgK0/RFit6M+4IdJMQQW5mfqOrQrhoDMOA+NWhGQAVSMRnkEZDASjaEhIAOoGA1p2tMeAY+AR8Aj4BHwCHgEPALDQgD3BbCz5A/5YflVfoqdzdQREJKO6I7++dStw0Exm8MFYESSltDUD8AIJl0/ACOedD0ADCNp+OjSPXUR4Ya+iCAzsWmcjoWdH9WtrS4FU1/gwpktgnrxM4FhrdCuswWctoWv1RUM+thIgm9kSGaa+HHJVqneUgem35q8cQGAo9a3QMKH6tD1Q2bpEkA0Jm/3etxOfI2OzH6N27OGTq8yHiPAjjwPCENOncv2SZxFi51MsvSolOeP/kzNqWPqDBjTIvtMTFzXPyJyel0qjB8AmOO4k4S/LlE0L5LBf6n4CcMreldp3VHiZlmODwBm4mKeY6iri+6L8wdoonlGLWvxrylkifu6WLz7ADE+AISd7/RF5KT7OHH1z42HOqYGfoPYQETRZXVx+WSiKojxWwRbm5fo8Oz9JGmRTIbc2DpDYTekhdlfMm09RnEA8ixIvr6a2bmrPnCWJLsU7doHlDJQTrhaAKTvQcHYNwAMCsa+BCALBs4B4ivYsg30vgdAJhxPExOMIQMgw3m3NMDYw9Wzdxu89+4R8Ah4BDwC44nA/waj6T5+FH+zAAAAAElFTkSuQmCC"},4478:function(e,t,r){"use strict";r("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=o,r("4ae1"),r("d3b7"),r("f8c9"),r("14d9");var i=a(r("b380")),n=a(r("d967"));function a(e){return e&&e.__esModule?e:{default:e}}function o(e,r,a){return(0,n.default)()?t.default=o=Reflect.construct.bind():t.default=o=function(e,t,r){var n=[null];n.push.apply(n,t);var a=Function.bind.apply(e,n),o=new a;return r&&(0,i.default)(o,r.prototype),o},o.apply(null,arguments)}},"45eb":function(e,t,r){"use strict";r("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=n,r("d3b7"),r("f8c9"),r("5d41"),r("e439");var i=function(e){return e&&e.__esModule?e:{default:e}}(r("5d34"));function n(){return"undefined"!==typeof Reflect&&Reflect.get?t.default=n=Reflect.get.bind():t.default=n=function(e,t,r){var n=(0,i.default)(e,t);if(n){var a=Object.getOwnPropertyDescriptor(n,t);return a.get?a.get.call(arguments.length<3?e:r):a.value}},n.apply(this,arguments)}},"532a":function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return n})),r.d(t,"a",(function(){}));var i=function(){var e=this.$createElement,t=this._self._c||e;return t("v-uni-view",{},[t("Wnavbar",{attrs:{title:this.searchData.title}}),t("v-uni-view",{staticClass:"video-box-class moo-css"},[t("div",{ref:"player",staticClass:"dplayer video-box",attrs:{id:"dplayer"}})])],1)},n=[]},5377:function(e,t,r){var i=r("da84"),n=r("83ab"),a=r("edd0"),o=r("ad6d"),s=r("d039"),l=i.RegExp,u=l.prototype,c=n&&s((function(){var e=!0;try{l(".","d")}catch(c){e=!1}var t={},r="",i=e?"dgimsy":"gimsy",n=function(e,i){Object.defineProperty(t,e,{get:function(){return r+=i,!0}})},a={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var o in e&&(a.hasIndices="d"),a)n(o,a[o]);var s=Object.getOwnPropertyDescriptor(u,"flags").get.call(t);return s!==i||r!==i}));c&&a(u,"flags",{configurable:!0,get:o})},"583b":function(e,t,r){var i=r("23e7"),n=r("eac5"),a=Math.abs;i({target:"Number",stat:!0},{isSafeInteger:function(e){return n(e)&&a(e)<=9007199254740991}})},"5cd5":function(e,t,r){"use strict";var i=r("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r("2909")),a=i(r("b85c")),o=i(r("3835")),s=i(r("257e")),l=i(r("9072")),u=i(r("45eb")),c=i(r("7e84")),d=i(r("262e")),h=i(r("2caf")),f=i(r("ade3")),p=i(r("d4ec")),g=i(r("bee2")),v=i(r("53ca"));function y(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}r("498a"),r("d9e2"),r("d401"),r("ac1f"),r("baa5"),r("5319"),r("26e9"),r("b64b"),r("a4d3"),r("4de4"),r("d3b7"),r("e439"),r("14d9"),r("159b"),r("dbb4"),r("1d1c"),r("7a82"),r("8172"),r("efec"),r("e01a"),r("a9e3"),r("e25e"),r("aff5"),r("fb6a"),r("ace4"),r("5cc6"),r("907a"),r("9a8c"),r("a975"),r("735e"),r("c1ac"),r("d139"),r("3a7b"),r("986a"),r("1d02"),r("d5d6"),r("82f8"),r("e91f"),r("60bd"),r("5f96"),r("3280"),r("3fcc"),r("ca91"),r("25a1"),r("cd26"),r("3c5d"),r("2954"),r("649e"),r("219c"),r("b39a"),r("72f7"),r("acd8"),r("c975"),r("99af"),r("20bf"),r("81b2"),r("0eb6"),r("b7ef"),r("8bd4"),r("a434"),r("d81d"),r("25f0"),r("13d5"),r("5377"),r("583b"),r("c19f"),r("84c3"),r("a630"),r("3ca3"),r("00b4"),r("ddb0"),r("2b3d"),r("9861"),r("4d63"),r("c607"),r("2c3e"),r("1276"),r("466d"),r("3c65"),r("caad"),r("2532"),r("4e82"),r("e9c4"),r("841c"),r("2ca0"),r("fb2c"),r("143c"),r("fd87");var m={exports:{}};(function(e,t){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),t=t.trim(),!t){if(!r.alwaysNormalize)return e;var n=o.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=o.normalizePath(n.path),o.buildURLFromParts(n)}var a=o.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return r.alwaysNormalize?(a.path=o.normalizePath(a.path),o.buildURLFromParts(a)):t;var s=o.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var l=i.exec(s.path);s.netLoc=l[1],s.path=l[2]}s.netLoc&&!s.path&&(s.path="/");var u={scheme:s.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(u.netLoc=s.netLoc,"/"!==a.path[0]))if(a.path){var c=s.path,d=c.substring(0,c.lastIndexOf("/")+1)+a.path;u.path=o.normalizePath(d)}else u.path=s.path,a.params||(u.params=s.params,a.query||(u.query=s.query));return null===u.path&&(u.path=r.alwaysNormalize?o.normalizePath(a.path):a.path),o.buildURLFromParts(u)},parseURL:function(e){var t=r.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){e=e.split("").reverse().join("").replace(n,"");while(e.length!==(e=e.replace(a,"")).length);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=o})()})(m);var _=m.exports;function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){S(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function S(e,t,r){return t=function(e){var t=function(e,t){if("object"!==(0,v.default)(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==(0,v.default)(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===(0,v.default)(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function E(){return E=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},E.apply(this,arguments)}var k=Number.isFinite||function(e){return"number"===typeof e&&isFinite(e)},A=function(e){return e["MEDIA_ATTACHING"]="hlsMediaAttaching",e["MEDIA_ATTACHED"]="hlsMediaAttached",e["MEDIA_DETACHING"]="hlsMediaDetaching",e["MEDIA_DETACHED"]="hlsMediaDetached",e["BUFFER_RESET"]="hlsBufferReset",e["BUFFER_CODECS"]="hlsBufferCodecs",e["BUFFER_CREATED"]="hlsBufferCreated",e["BUFFER_APPENDING"]="hlsBufferAppending",e["BUFFER_APPENDED"]="hlsBufferAppended",e["BUFFER_EOS"]="hlsBufferEos",e["BUFFER_FLUSHING"]="hlsBufferFlushing",e["BUFFER_FLUSHED"]="hlsBufferFlushed",e["MANIFEST_LOADING"]="hlsManifestLoading",e["MANIFEST_LOADED"]="hlsManifestLoaded",e["MANIFEST_PARSED"]="hlsManifestParsed",e["LEVEL_SWITCHING"]="hlsLevelSwitching",e["LEVEL_SWITCHED"]="hlsLevelSwitched",e["LEVEL_LOADING"]="hlsLevelLoading",e["LEVEL_LOADED"]="hlsLevelLoaded",e["LEVEL_UPDATED"]="hlsLevelUpdated",e["LEVEL_PTS_UPDATED"]="hlsLevelPtsUpdated",e["LEVELS_UPDATED"]="hlsLevelsUpdated",e["AUDIO_TRACKS_UPDATED"]="hlsAudioTracksUpdated",e["AUDIO_TRACK_SWITCHING"]="hlsAudioTrackSwitching",e["AUDIO_TRACK_SWITCHED"]="hlsAudioTrackSwitched",e["AUDIO_TRACK_LOADING"]="hlsAudioTrackLoading",e["AUDIO_TRACK_LOADED"]="hlsAudioTrackLoaded",e["SUBTITLE_TRACKS_UPDATED"]="hlsSubtitleTracksUpdated",e["SUBTITLE_TRACKS_CLEARED"]="hlsSubtitleTracksCleared",e["SUBTITLE_TRACK_SWITCH"]="hlsSubtitleTrackSwitch",e["SUBTITLE_TRACK_LOADING"]="hlsSubtitleTrackLoading",e["SUBTITLE_TRACK_LOADED"]="hlsSubtitleTrackLoaded",e["SUBTITLE_FRAG_PROCESSED"]="hlsSubtitleFragProcessed",e["CUES_PARSED"]="hlsCuesParsed",e["NON_NATIVE_TEXT_TRACKS_FOUND"]="hlsNonNativeTextTracksFound",e["INIT_PTS_FOUND"]="hlsInitPtsFound",e["FRAG_LOADING"]="hlsFragLoading",e["FRAG_LOAD_EMERGENCY_ABORTED"]="hlsFragLoadEmergencyAborted",e["FRAG_LOADED"]="hlsFragLoaded",e["FRAG_DECRYPTED"]="hlsFragDecrypted",e["FRAG_PARSING_INIT_SEGMENT"]="hlsFragParsingInitSegment",e["FRAG_PARSING_USERDATA"]="hlsFragParsingUserdata",e["FRAG_PARSING_METADATA"]="hlsFragParsingMetadata",e["FRAG_PARSED"]="hlsFragParsed",e["FRAG_BUFFERED"]="hlsFragBuffered",e["FRAG_CHANGED"]="hlsFragChanged",e["FPS_DROP"]="hlsFpsDrop",e["FPS_DROP_LEVEL_CAPPING"]="hlsFpsDropLevelCapping",e["ERROR"]="hlsError",e["DESTROYING"]="hlsDestroying",e["KEY_LOADING"]="hlsKeyLoading",e["KEY_LOADED"]="hlsKeyLoaded",e["LIVE_BACK_BUFFER_REACHED"]="hlsLiveBackBufferReached",e["BACK_BUFFER_REACHED"]="hlsBackBufferReached",e}({}),w=function(e){return e["NETWORK_ERROR"]="networkError",e["MEDIA_ERROR"]="mediaError",e["KEY_SYSTEM_ERROR"]="keySystemError",e["MUX_ERROR"]="muxError",e["OTHER_ERROR"]="otherError",e}({}),x=function(e){return e["KEY_SYSTEM_NO_KEYS"]="keySystemNoKeys",e["KEY_SYSTEM_NO_ACCESS"]="keySystemNoAccess",e["KEY_SYSTEM_NO_SESSION"]="keySystemNoSession",e["KEY_SYSTEM_NO_CONFIGURED_LICENSE"]="keySystemNoConfiguredLicense",e["KEY_SYSTEM_LICENSE_REQUEST_FAILED"]="keySystemLicenseRequestFailed",e["KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED"]="keySystemServerCertificateRequestFailed",e["KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED"]="keySystemServerCertificateUpdateFailed",e["KEY_SYSTEM_SESSION_UPDATE_FAILED"]="keySystemSessionUpdateFailed",e["KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED"]="keySystemStatusOutputRestricted",e["KEY_SYSTEM_STATUS_INTERNAL_ERROR"]="keySystemStatusInternalError",e["MANIFEST_LOAD_ERROR"]="manifestLoadError",e["MANIFEST_LOAD_TIMEOUT"]="manifestLoadTimeOut",e["MANIFEST_PARSING_ERROR"]="manifestParsingError",e["MANIFEST_INCOMPATIBLE_CODECS_ERROR"]="manifestIncompatibleCodecsError",e["LEVEL_EMPTY_ERROR"]="levelEmptyError",e["LEVEL_LOAD_ERROR"]="levelLoadError",e["LEVEL_LOAD_TIMEOUT"]="levelLoadTimeOut",e["LEVEL_PARSING_ERROR"]="levelParsingError",e["LEVEL_SWITCH_ERROR"]="levelSwitchError",e["AUDIO_TRACK_LOAD_ERROR"]="audioTrackLoadError",e["AUDIO_TRACK_LOAD_TIMEOUT"]="audioTrackLoadTimeOut",e["SUBTITLE_LOAD_ERROR"]="subtitleTrackLoadError",e["SUBTITLE_TRACK_LOAD_TIMEOUT"]="subtitleTrackLoadTimeOut",e["FRAG_LOAD_ERROR"]="fragLoadError",e["FRAG_LOAD_TIMEOUT"]="fragLoadTimeOut",e["FRAG_DECRYPT_ERROR"]="fragDecryptError",e["FRAG_PARSING_ERROR"]="fragParsingError",e["FRAG_GAP"]="fragGap",e["REMUX_ALLOC_ERROR"]="remuxAllocError",e["KEY_LOAD_ERROR"]="keyLoadError",e["KEY_LOAD_TIMEOUT"]="keyLoadTimeOut",e["BUFFER_ADD_CODEC_ERROR"]="bufferAddCodecError",e["BUFFER_INCOMPATIBLE_CODECS_ERROR"]="bufferIncompatibleCodecsError",e["BUFFER_APPEND_ERROR"]="bufferAppendError",e["BUFFER_APPENDING_ERROR"]="bufferAppendingError",e["BUFFER_STALLED_ERROR"]="bufferStalledError",e["BUFFER_FULL_ERROR"]="bufferFullError",e["BUFFER_SEEK_OVER_HOLE"]="bufferSeekOverHole",e["BUFFER_NUDGE_ON_STALL"]="bufferNudgeOnStall",e["INTERNAL_EXCEPTION"]="internalException",e["INTERNAL_ABORTED"]="aborted",e["UNKNOWN"]="unknown",e}({}),R=function(){},L={trace:R,debug:R,log:R,warn:R,info:R,error:R},I=L;function C(e){var t=self.console[e];return t?t.bind(self.console,"[".concat(e,"] >")):R}function D(e,t){if(self.console&&!0===e||"object"===(0,v.default)(e)){(function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];r.forEach((function(t){I[t]=e[t]?e[t].bind(e):C(t)}))})(e,"debug","log","info","warn","error");try{I.log('Debug logs enabled for "'.concat(t,'" in hls.js version ',"1.4.3"))}catch(r){I=L}}else I=L}var P=I,O=/^(\d+)x(\d+)$/,M=/(.+?)=(".*?"|.*?)(?:,|$)/g,N=function(){function e(t){for(var r in(0,p.default)(this,e),"string"===typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(r)&&("X-"===r.substring(0,2)&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(r)),this[r]=t[r])}return(0,g.default)(e,[{key:"decimalInteger",value:function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"hexadecimalInteger",value:function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(2*i,2*i+2),16);return r}return null}},{key:"hexadecimalIntegerAsNumber",value:function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"decimalFloatingPoint",value:function(e){return parseFloat(this[e])}},{key:"optionalFloat",value:function(e,t){var r=this[e];return r?parseFloat(r):t}},{key:"enumeratedString",value:function(e){return this[e]}},{key:"bool",value:function(e){return"YES"===this[e]}},{key:"decimalResolution",value:function(e){var t=O.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}}],[{key:"parseAttrList",value:function(e){var t,r={};M.lastIndex=0;while(null!==(t=M.exec(e))){var i=t[2];0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1));var n=t[1].trim();r[n]=i}return r}}]),e}();function F(e){return"ID"!==e&&"CLASS"!==e&&"START-DATE"!==e&&"DURATION"!==e&&"END-DATE"!==e&&"END-ON-NEXT"!==e}function U(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e}var B=function(){function e(t,r){if((0,p.default)(this,e),this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,r){var i=r.attr;for(var n in i)if(Object.prototype.hasOwnProperty.call(t,n)&&t[n]!==i[n]){P.warn('DATERANGE tag attribute: "'.concat(n,'" does not match for tags with ID: "').concat(t.ID,'"')),this._badValueForSameId=n;break}t=E(new N({}),i,t)}if(this.attr=t,this._startDate=new Date(t["START-DATE"]),"END-DATE"in this.attr){var a=new Date(this.attr["END-DATE"]);k(a.getTime())&&(this._endDate=a)}}return(0,g.default)(e,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var e=this.attr.decimalFloatingPoint("DURATION");if(k(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&k(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),e}(),H=(0,g.default)((function e(){(0,p.default)(this,e),this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}})),V={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"},j=function(){function e(t){var r;(0,p.default)(this,e),this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(r={},(0,f.default)(r,V.AUDIO,null),(0,f.default)(r,V.VIDEO,null),(0,f.default)(r,V.AUDIOVIDEO,null),r),this.baseurl=t}return(0,g.default)(e,[{key:"setByteRange",value:function(e,t){var r=e.split("@",2),i=[];1===r.length?i[0]=t?t.byteRangeEndOffset:0:i[0]=parseInt(r[1]),i[1]=parseInt(r[0])+i[0],this._byteRange=i}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=_.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}]),e}(),G=function(e){(0,d.default)(r,e);var t=(0,h.default)(r);function r(e,i){var n;return(0,p.default)(this,r),n=t.call(this,i),n._decryptdata=null,n.rawProgramDateTime=null,n.programDateTime=null,n.tagList=[],n.duration=0,n.sn=0,n.levelkeys=void 0,n.type=void 0,n.loader=null,n.keyLoader=null,n.level=-1,n.cc=0,n.startPTS=void 0,n.endPTS=void 0,n.startDTS=void 0,n.endDTS=void 0,n.start=0,n.deltaPTS=void 0,n.maxStartPTS=void 0,n.minEndPTS=void 0,n.stats=new H,n.urlId=0,n.data=void 0,n.bitrateTest=!1,n.title=null,n.initSegment=null,n.endList=void 0,n.gap=void 0,n.type=e,n}return(0,g.default)(r,[{key:"decryptdata",get:function(){var e=this.levelkeys;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{var r=Object.keys(this.levelkeys);if(1===r.length)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!k(this.programDateTime))return null;var e=k(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){var t=Object.keys(this.levelkeys),r=t.length;if(r>1||1===r&&this.levelkeys[t[0]].encrypted)return!0}return!1}},{key:"setKeyFormat",value:function(e){if(this.levelkeys){var t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}},{key:"abortRequests",value:function(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}},{key:"setElementaryStreamInfo",value:function(e,t,r,i,n){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=this.elementaryStreams,s=o[e];s?(s.startPTS=Math.min(s.startPTS,t),s.endPTS=Math.max(s.endPTS,r),s.startDTS=Math.min(s.startDTS,i),s.endDTS=Math.max(s.endDTS,n)):o[e]={startPTS:t,endPTS:r,startDTS:i,endDTS:n,partial:a}}},{key:"clearElementaryStreamInfo",value:function(){var e=this.elementaryStreams;e[V.AUDIO]=null,e[V.VIDEO]=null,e[V.AUDIOVIDEO]=null}}]),r}(j),K=function(e){(0,d.default)(r,e);var t=(0,h.default)(r);function r(e,i,n,a,o){var s;(0,p.default)(this,r),s=t.call(this,n),s.fragOffset=0,s.duration=0,s.gap=!1,s.independent=!1,s.relurl=void 0,s.fragment=void 0,s.index=void 0,s.stats=new H,s.duration=e.decimalFloatingPoint("DURATION"),s.gap=e.bool("GAP"),s.independent=e.bool("INDEPENDENT"),s.relurl=e.enumeratedString("URI"),s.fragment=i,s.index=a;var l=e.enumeratedString("BYTERANGE");return l&&s.setByteRange(l,o),o&&(s.fragOffset=o.fragOffset+o.duration),s}return(0,g.default)(r,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}]),r}(j),q=function(){function e(t){(0,p.default)(this,e),this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}return(0,g.default)(e,[{key:"reloaded",value:function(e){if(!e)return this.advanced=!0,void(this.updated=!0);var t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t,this.advanced=this.endSN>e.endSN||t>0||0===t&&r>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}},{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&k(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var e=this.driftEndTime-this.driftStartTime;if(e>0){var t=this.driftEnd-this.driftStart;return 1e3*t/e}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),e}();function W(e){return Uint8Array.from(atob(e),(function(e){return e.charCodeAt(0)}))}function Y(e){var t=e.split(":"),r=null;if("data"===t[0]&&2===t.length){var i=t[1].split(";"),n=i[i.length-1].split(",");if(2===n.length){var a="base64"===n[0],o=n[1];a?(i.splice(-1,1),r=W(o)):r=function(e){var t=z(e).subarray(0,16),r=new Uint8Array(16);return r.set(t,16-t.length),r}(o)}}return r}function z(e){return Uint8Array.from(unescape(encodeURIComponent(e)),(function(e){return e.charCodeAt(0)}))}var X={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Q={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function J(e){switch(e){case Q.FAIRPLAY:return X.FAIRPLAY;case Q.PLAYREADY:return X.PLAYREADY;case Q.WIDEVINE:return X.WIDEVINE;case Q.CLEARKEY:return X.CLEARKEY}}var Z={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function $(e){switch(e){case X.FAIRPLAY:return Q.FAIRPLAY;case X.PLAYREADY:return Q.PLAYREADY;case X.WIDEVINE:return Q.WIDEVINE;case X.CLEARKEY:return Q.CLEARKEY}}function ee(e){var t=e.drmSystems,r=e.widevineLicenseUrl,i=t?[X.FAIRPLAY,X.WIDEVINE,X.PLAYREADY,X.CLEARKEY].filter((function(e){return!!t[e]})):[];return!i[X.WIDEVINE]&&r&&i.push(X.WIDEVINE),i}var te=function(){return"undefined"!==typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function re(e,t,r){return Uint8Array.prototype.slice?e.slice(t,r):new Uint8Array(Array.prototype.slice.call(e,t,r))}var ie,ne=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},ae=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},oe=function(e,t){var r=t,i=0;while(ne(e,t)){i+=10;var n=se(e,t+6);i+=n,ae(e,t+10)&&(i+=10),t+=i}if(i>0)return e.subarray(r,r+i)},se=function(e,t){var r=0;return r=(127&e[t])<<21,r|=(127&e[t+1])<<14,r|=(127&e[t+2])<<7,r|=127&e[t+3],r},le=function(e,t){return ne(e,t)&&se(e,t+6)+10<=e.length-t},ue=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},ce=function(e){var t=String.fromCharCode(e[0],e[1],e[2],e[3]),r=se(e,4);return{type:t,size:r,data:e.subarray(10,10+r)}},de=function(e){var t=0,r=[];while(ne(e,t)){var i=se(e,t+6);t+=10;var n=t+i;while(t+8<n){var a=ce(e.subarray(t)),o=he(a);o&&r.push(o),t+=a.size+10}ae(e,t)&&(t+=10)}return r},he=function(e){return"PRIV"===e.type?fe(e):"W"===e.type[0]?ge(e):pe(e)},fe=function(e){if(!(e.size<2)){var t=ye(e.data,!0),r=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:r.buffer}}},pe=function(e){if(!(e.size<2)){if("TXXX"===e.type){var t=1,r=ye(e.data.subarray(t),!0);t+=r.length+1;var i=ye(e.data.subarray(t));return{key:e.type,info:r,data:i}}var n=ye(e.data.subarray(1));return{key:e.type,data:n}}},ge=function(e){if("WXXX"===e.type){if(e.size<2)return;var t=1,r=ye(e.data.subarray(t),!0);t+=r.length+1;var i=ye(e.data.subarray(t));return{key:e.type,info:r,data:i}}var n=ye(e.data);return{key:e.type,data:n}},ve=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),r=1&t[3],i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,r&&(i+=47721858.84),Math.round(i)}},ye=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=me();if(r){var i=r.decode(e);if(t){var n=i.indexOf("\0");return-1!==n?i.substring(0,n):i}return i.replace(/\0/g,"")}var a,o,s,l=e.length,u="",c=0;while(c<l){if(a=e[c++],0===a&&t)return u;if(0!==a&&3!==a)switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(a);break;case 12:case 13:o=e[c++],u+=String.fromCharCode((31&a)<<6|63&o);break;case 14:o=e[c++],s=e[c++],u+=String.fromCharCode((15&a)<<12|(63&o)<<6|(63&s)<<0);break}}return u};function me(){return ie||"undefined"===typeof self.TextDecoder||(ie=new self.TextDecoder("utf-8")),ie}var _e={hexDump:function(e){for(var t="",r=0;r<e.length;r++){var i=e[r].toString(16);i.length<2&&(i="0"+i),t+=i}return t}},be=Math.pow(2,32)-1,Te=[].push,Se={video:1,audio:2,id3:3,text:4};function Ee(e){return String.fromCharCode.apply(null,e)}function ke(e,t){var r=e[t]<<8|e[t+1];return r<0?65536+r:r}function Ae(e,t){var r=we(e,t);return r<0?4294967296+r:r}function we(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function xe(e,t,r){e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r}function Re(e,t){var r=[];if(!t.length)return r;for(var i=e.byteLength,n=0;n<i;){var a=Ae(e,n),o=Ee(e.subarray(n+4,n+8)),s=a>1?n+a:i;if(o===t[0])if(1===t.length)r.push(e.subarray(n+8,s));else{var l=Re(e.subarray(n+8,s),t.slice(1));l.length&&Te.apply(r,l)}n=s}return r}function Le(e){var t=[],r=e[0],i=8,n=Ae(e,i);i+=4;i+=0===r?8:16,i+=2;var a=e.length+0,o=ke(e,i);i+=2;for(var s=0;s<o;s++){var l=i,u=Ae(e,l);l+=4;var c=2147483647&u,d=(2147483648&u)>>>31;if(1===d)return P.warn("SIDX has hierarchical references (not supported)"),null;var h=Ae(e,l);l+=4,t.push({referenceSize:c,subsegmentDuration:h,info:{duration:h/n,start:a,end:a+c-1}}),a+=c,l+=4,i=l}return{earliestPresentationTime:0,timescale:n,version:r,referencesCount:o,references:t}}function Ie(e){for(var t=[],r=Re(e,["moov","trak"]),i=0;i<r.length;i++){var n=r[i],a=Re(n,["tkhd"])[0];if(a){var o=a[0],s=0===o?12:20,l=Ae(a,s),u=Re(n,["mdia","mdhd"])[0];if(u){o=u[0],s=0===o?12:20;var c=Ae(u,s),d=Re(n,["mdia","hdlr"])[0];if(d){var h=Ee(d.subarray(8,12)),f={soun:V.AUDIO,vide:V.VIDEO}[h];if(f){var p=Re(n,["mdia","minf","stbl","stsd"])[0],g=void 0;p&&(g=Ee(p.subarray(12,16))),t[l]={timescale:c,type:f},t[f]={timescale:c,id:l,codec:g}}}}}}var v=Re(e,["moov","mvex","trex"]);return v.forEach((function(e){var r=Ae(e,4),i=t[r];i&&(i.default={duration:Ae(e,12),flags:Ae(e,20)})})),t}function Ce(e){var t=Re(e,["schm"])[0];if(t){var r=Ee(t.subarray(4,8));if("cbcs"===r||"cenc"===r)return Re(e,["schi","tenc"])[0]}return P.error("[eme] missing 'schm' box"),null}function De(e){var t=Ae(e,0),r=8;1&t&&(r+=4),4&t&&(r+=4);for(var i=0,n=Ae(e,4),a=0;a<n;a++){if(256&t){var o=Ae(e,r);i+=o,r+=4}512&t&&(r+=4),1024&t&&(r+=4),2048&t&&(r+=4)}return i}function Pe(e,t){var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function Oe(e,t){var r=[],i=t.samples,n=t.timescale,a=t.id,o=!1,s=Re(i,["moof"]);return s.map((function(s){var l=s.byteOffset-8,u=Re(s,["traf"]);u.map((function(s){var u=Re(s,["tfdt"]).map((function(e){var t=e[0],r=Ae(e,4);return 1===t&&(r*=Math.pow(2,32),r+=Ae(e,8)),r/n}))[0];return void 0!==u&&(e=u),Re(s,["tfhd"]).map((function(u){var c=Ae(u,4),d=16777215&Ae(u,0),h=0!==(1&d),f=0!==(2&d),p=0!==(8&d),g=0,v=0!==(16&d),y=0,m=0!==(32&d),_=8;c===a&&(h&&(_+=8),f&&(_+=4),p&&(g=Ae(u,_),_+=4),v&&(y=Ae(u,_),_+=4),m&&(_+=4),"video"===t.type&&(o=function(e){if(!e)return!1;var t=e.indexOf("."),r=t<0?e:e.substring(0,t);return"hvc1"===r||"hev1"===r||"dvh1"===r||"dvhe"===r}(t.codec)),Re(s,["trun"]).map((function(a){var s=a[0],u=16777215&Ae(a,0),c=0!==(1&u),d=0,h=0!==(4&u),f=0!==(256&u),p=0,v=0!==(512&u),m=0,_=0!==(1024&u),b=0!==(2048&u),T=0,S=Ae(a,4),E=8;c&&(d=Ae(a,E),E+=4),h&&(E+=4);for(var k=d+l,A=0;A<S;A++){if(f?(p=Ae(a,E),E+=4):p=g,v?(m=Ae(a,E),E+=4):m=y,_&&(E+=4),b&&(T=0===s?Ae(a,E):we(a,E),E+=4),t.type===V.VIDEO){var w=0;while(w<m){var x=Ae(i,k);if(k+=4,Me(o,i[k])){var R=i.subarray(k,k+x);Ne(R,o?2:1,e+T/n,r)}k+=x,w+=x+4}}e+=p/n}})))}))}))})),r}function Me(e,t){if(e){var r=t>>1&63;return 39===r||40===r}var i=31&t;return 6===i}function Ne(e,t,r,i){var n=Fe(e),a=0;a+=t;var o=0,s=0,l=!1,u=0;while(a<n.length){o=0;do{if(a>=n.length)break;u=n[a++],o+=u}while(255===u);s=0;do{if(a>=n.length)break;u=n[a++],s+=u}while(255===u);var c=n.length-a;if(!l&&4===o&&a<n.length){l=!0;var d=n[a++];if(181===d){var h=ke(n,a);if(a+=2,49===h){var f=Ae(n,a);if(a+=4,1195456820===f){var p=n[a++];if(3===p){var g=n[a++],v=31&g,y=64&g,m=y?2+3*v:0,_=new Uint8Array(m);if(y){_[0]=g;for(var b=1;b<m;b++)_[b]=n[a++]}i.push({type:p,payloadType:o,pts:r,bytes:_})}}}}}else if(5===o&&s<c){if(l=!0,s>16){for(var T=[],S=0;S<16;S++){var E=n[a++].toString(16);T.push(1==E.length?"0"+E:E),3!==S&&5!==S&&7!==S&&9!==S||T.push("-")}for(var k=s-16,A=new Uint8Array(k),w=0;w<k;w++)A[w]=n[a++];i.push({payloadType:o,pts:r,uuid:T.join(""),userData:ye(A),userDataBytes:A})}}else if(s<c)a+=s;else if(s>c)break}}function Fe(e){var t=e.byteLength,r=[],i=1;while(i<t-2)0===e[i]&&0===e[i+1]&&3===e[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return e;var n=t-r.length,a=new Uint8Array(n),o=0;for(i=0;i<n;o++,i++)o===r[0]&&(o++,r.shift()),a[i]=e[o];return a}function Ue(e,t,r){if(16!==e.byteLength)throw new RangeError("Invalid system id");var i,n,a;if(t){i=1,n=new Uint8Array(16*t.length);for(var o=0;o<t.length;o++){var s=t[o];if(16!==s.byteLength)throw new RangeError("Invalid key");n.set(s,16*o)}}else i=0,n=new Uint8Array;i>0?(a=new Uint8Array(4),t.length>0&&new DataView(a.buffer).setUint32(0,t.length,!1)):a=new Uint8Array;var l=new Uint8Array(4);return r&&r.byteLength>0&&new DataView(l.buffer).setUint32(0,r.byteLength,!1),function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];var n=r.length,a=8,o=n;while(o--)a+=r[o].byteLength;var s=new Uint8Array(a);for(s[0]=a>>24&255,s[1]=a>>16&255,s[2]=a>>8&255,s[3]=255&a,s.set(e,4),o=0,a=8;o<n;o++)s.set(r[o],a),a+=r[o].byteLength;return s}([112,115,115,104],new Uint8Array([i,0,0,0]),e,a,n,l,r||new Uint8Array)}var Be={},He=function(){function e(t,r,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;(0,p.default)(this,e),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=r,this.keyFormat=i,this.keyFormatVersions=n,this.iv=a,this.encrypted=!!t&&"NONE"!==t,this.isCommonEncryption=this.encrypted&&"AES-128"!==t}return(0,g.default)(e,[{key:"isSupported",value:function(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case Q.FAIRPLAY:case Q.WIDEVINE:case Q.PLAYREADY:case Q.CLEARKEY:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}},{key:"getDecryptData",value:function(t){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!==typeof t&&("AES-128"!==this.method||this.iv||P.warn('missing IV for initialization segment with method="'.concat(this.method,'" - compliance issue')),t=0);var r=function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t}(t),i=new e(this.method,this.uri,"identity",this.keyFormatVersions,r);return i}var n=Y(this.uri);if(n)switch(this.keyFormat){case Q.WIDEVINE:this.pssh=n,n.length>=22&&(this.keyId=n.subarray(n.length-22,n.length-6));break;case Q.PLAYREADY:var a=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Ue(a,null,n);var o=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),s=String.fromCharCode.apply(null,Array.from(o)),l=s.substring(s.indexOf("<"),s.length),u=new DOMParser,c=u.parseFromString(l,"text/xml"),d=c.getElementsByTagName("KID")[0];if(d){var h=d.childNodes[0]?d.childNodes[0].nodeValue:d.getAttribute("VALUE");if(h){var f=W(h).subarray(0,16);(function(e){var t=function(e,t,r){var i=e[t];e[t]=e[r],e[r]=i};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)})(f),this.keyId=f}}break;default:var p=n.subarray(0,16);if(16!==p.length){var g=new Uint8Array(16);g.set(p,16-p.length),p=g}this.keyId=p;break}if(!this.keyId||16!==this.keyId.byteLength){var v=Be[this.uri];if(!v){var y=Object.keys(Be).length%Number.MAX_SAFE_INTEGER;v=new Uint8Array(16);var m=new DataView(v.buffer,12,4);m.setUint32(0,y),Be[this.uri]=v}this.keyId=v}return this}}],[{key:"clearKeyUriToKeyIdMap",value:function(){Be={}}}]),e}();var Ve=/\{\$([a-zA-Z0-9-_]+)\}/g;function je(e){return Ve.test(e)}function Ge(e,t,r){if(null!==e.variableList||e.hasVariableRefs)for(var i=r.length;i--;){var n=r[i],a=t[n];a&&(t[n]=Ke(e,a))}}function Ke(e,t){if(null!==e.variableList||e.hasVariableRefs){var r=e.variableList;return t.replace(Ve,(function(t){var i=t.substring(2,t.length-1),n=null==r?void 0:r[i];return void 0===n?(e.playlistParsingError||(e.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'.concat(i,'"'))),t):n}))}return t}function qe(e,t,r){var i,n,a=e.variableList;if(a||(e.variableList=a={}),"QUERYPARAM"in t){i=t.QUERYPARAM;try{var o=new self.URL(r).searchParams;if(!o.has(i))throw new Error('"'.concat(i,'" does not match any query parameter in URI: "').concat(r,'"'));n=o.get(i)}catch(s){e.playlistParsingError||(e.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: ".concat(s.message)))}}else i=t.NAME,n=t.VALUE;i in a?e.playlistParsingError||(e.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'.concat(i,'"'))):a[i]=n||""}function We(e,t,r){var i=t.IMPORT;if(r&&i in r){var n=e.variableList;n||(e.variableList=n={}),n[i]=r[i]}else e.playlistParsingError||(e.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'.concat(i,'"')))}function Ye(){if("undefined"!==typeof self)return self.MediaSource||self.WebKitMediaSource}var ze={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},Xe=Ye();function Qe(e,t){var r;return null!=(r=null==Xe?void 0:Xe.isTypeSupported("".concat(t||"video",'/mp4;codecs="').concat(e,'"')))&&r}var Je=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Ze=/#EXT-X-MEDIA:(.*)/g,$e=/^#EXT(?:INF|-X-TARGETDURATION):/m,et=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),tt=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),rt=function(){function e(){(0,p.default)(this,e)}return(0,g.default)(e,null,[{key:"findGroup",value:function(e,t){for(var r=0;r<e.length;r++){var i=e[r];if(i.id===t)return i}}},{key:"convertAVC1ToAVCOTI",value:function(e){var t=e.split(".");if(t.length>2){var r=t.shift()+".";return r+=parseInt(t.shift()).toString(16),r+=("000"+parseInt(t.shift()).toString(16)).slice(-4),r}return e}},{key:"resolve",value:function(e,t){return _.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}},{key:"isMediaPlaylist",value:function(e){return $e.test(e)}},{key:"parseMasterPlaylist",value:function(t,r){var i,n=je(t),a={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},o=[];Je.lastIndex=0;while(null!=(i=Je.exec(t)))if(i[1]){var s,l=new N(i[1]);Ge(a,l,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);var u=Ke(a,i[2]),c={attrs:l,bitrate:l.decimalInteger("AVERAGE-BANDWIDTH")||l.decimalInteger("BANDWIDTH"),name:l.NAME,url:e.resolve(u,r)},d=l.decimalResolution("RESOLUTION");d&&(c.width=d.width,c.height=d.height),at((l.CODECS||"").split(/[ ,]+/).filter((function(e){return e})),c),c.videoCodec&&-1!==c.videoCodec.indexOf("avc1")&&(c.videoCodec=e.convertAVC1ToAVCOTI(c.videoCodec)),null!=(s=c.unknownCodecs)&&s.length||o.push(c),a.levels.push(c)}else if(i[3]){var h=i[3],f=i[4];switch(h){case"SESSION-DATA":var p=new N(f);Ge(a,p,["DATA-ID","LANGUAGE","VALUE","URI"]);var g=p["DATA-ID"];g&&(null===a.sessionData&&(a.sessionData={}),a.sessionData[g]=p);break;case"SESSION-KEY":var v=it(f,r,a);v.encrypted&&v.isSupported()?(null===a.sessionKeys&&(a.sessionKeys=[]),a.sessionKeys.push(v)):P.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'.concat(f,'"'));break;case"DEFINE":var y=new N(f);Ge(a,y,["NAME","VALUE","QUERYPARAM"]),qe(a,y,r);break;case"CONTENT-STEERING":var m=new N(f);Ge(a,m,["SERVER-URI","PATHWAY-ID"]),a.contentSteering={uri:e.resolve(m["SERVER-URI"],r),pathwayId:m["PATHWAY-ID"]||"."};break;case"START":a.startTimeOffset=nt(f);break}}var _=o.length>0&&o.length<a.levels.length;return a.levels=_?o:a.levels,0===a.levels.length&&(a.playlistParsingError=new Error("no levels found in manifest")),a}},{key:"parseMasterPlaylistMedia",value:function(t,r,i){var n,a={},o=i.levels,s={AUDIO:o.map((function(e){return{id:e.attrs.AUDIO,audioCodec:e.audioCodec}})),SUBTITLES:o.map((function(e){return{id:e.attrs.SUBTITLES,textCodec:e.textCodec}})),"CLOSED-CAPTIONS":[]},l=0;Ze.lastIndex=0;while(null!==(n=Ze.exec(t))){var u=new N(n[1]),c=u.TYPE;if(c){var d=s[c],h=a[c]||[];a[c]=h,Ge(i,u,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);var f={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",instreamId:u["INSTREAM-ID"],name:u.NAME||u.LANGUAGE||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:u.LANGUAGE,url:u.URI?e.resolve(u.URI,r):""};if(null!=d&&d.length){var p=e.findGroup(d,f.groupId)||d[0];ot(f,p,"audioCodec"),ot(f,p,"textCodec")}h.push(f)}}return a}},{key:"parseLevelPlaylist",value:function(e,t,r,i,n,a){var o,s,l,u=new q(t),c=u.fragments,d=null,h=0,f=0,p=0,g=0,v=null,y=new G(i,t),m=-1,_=!1;et.lastIndex=0,u.m3u8=e,u.hasVariableRefs=je(e);while(null!==(o=et.exec(e))){_&&(_=!1,y=new G(i,t),y.start=p,y.sn=h,y.cc=g,y.level=r,d&&(y.initSegment=d,y.rawProgramDateTime=d.rawProgramDateTime,d.rawProgramDateTime=null));var b=o[1];if(b){y.duration=parseFloat(b);var T=(" "+o[2]).slice(1);y.title=T||null,y.tagList.push(T?["INF",b,T]:["INF",b])}else if(o[3]){if(k(y.duration)){y.start=p,l&&ut(y,l,u),y.sn=h,y.level=r,y.cc=g,y.urlId=n,c.push(y);var S=(" "+o[3]).slice(1);y.relurl=Ke(u,S),st(y,v),v=y,p+=y.duration,h++,f=0,_=!0}}else if(o[4]){var A=(" "+o[4]).slice(1);v?y.setByteRange(A,v):y.setByteRange(A)}else if(o[5])y.rawProgramDateTime=(" "+o[5]).slice(1),y.tagList.push(["PROGRAM-DATE-TIME",y.rawProgramDateTime]),-1===m&&(m=c.length);else{if(o=o[0].match(tt),!o){P.warn("No matches on slow regex match for level playlist!");continue}for(s=1;s<o.length;s++)if("undefined"!==typeof o[s])break;var w=(" "+o[s]).slice(1),x=(" "+o[s+1]).slice(1),R=o[s+2]?(" "+o[s+2]).slice(1):"";switch(w){case"PLAYLIST-TYPE":u.type=x.toUpperCase();break;case"MEDIA-SEQUENCE":h=u.startSN=parseInt(x);break;case"SKIP":var L=new N(x);Ge(u,L,["RECENTLY-REMOVED-DATERANGES"]);var I=L.decimalInteger("SKIPPED-SEGMENTS");if(k(I)){u.skippedSegments=I;for(var C=I;C--;)c.unshift(null);h+=I}var D=L.enumeratedString("RECENTLY-REMOVED-DATERANGES");D&&(u.recentlyRemovedDateranges=D.split("\t"));break;case"TARGETDURATION":u.targetduration=Math.max(parseInt(x),1);break;case"VERSION":u.version=parseInt(x);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"#":(x||R)&&y.tagList.push(R?[x,R]:[x]);break;case"DISCONTINUITY":g++,y.tagList.push(["DIS"]);break;case"GAP":y.gap=!0,y.tagList.push([w]);break;case"BITRATE":y.tagList.push([w,x]);break;case"DATERANGE":var O=new N(x);Ge(u,O,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),Ge(u,O,O.clientAttrs);var M=new B(O,u.dateRanges[O.ID]);M.isValid||u.skippedSegments?u.dateRanges[M.id]=M:P.warn('Ignoring invalid DATERANGE tag: "'.concat(x,'"')),y.tagList.push(["EXT-X-DATERANGE",x]);break;case"DEFINE":var F=new N(x);Ge(u,F,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in F?We(u,F,a):qe(u,F,t);break;case"DISCONTINUITY-SEQUENCE":g=parseInt(x);break;case"KEY":var U=it(x,t,u);if(U.isSupported()){if("NONE"===U.method){l=void 0;break}l||(l={}),l[U.keyFormat]&&(l=E({},l)),l[U.keyFormat]=U}else P.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'.concat(x,'"'));break;case"START":u.startTimeOffset=nt(x);break;case"MAP":var H=new N(x);if(Ge(u,H,["BYTERANGE","URI"]),y.duration){var V=new G(i,t);lt(V,H,r,l),d=V,y.initSegment=d,d.rawProgramDateTime&&!y.rawProgramDateTime&&(y.rawProgramDateTime=d.rawProgramDateTime)}else lt(y,H,r,l),d=y,_=!0;break;case"SERVER-CONTROL":var j=new N(x);u.canBlockReload=j.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=j.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&j.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=j.optionalFloat("PART-HOLD-BACK",0),u.holdBack=j.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var W=new N(x);u.partTarget=W.decimalFloatingPoint("PART-TARGET");break;case"PART":var Y=u.partList;Y||(Y=u.partList=[]);var z=f>0?Y[Y.length-1]:void 0,X=f++,Q=new N(x);Ge(u,Q,["BYTERANGE","URI"]);var J=new K(Q,y,t,X,z);Y.push(J),y.duration+=J.duration;break;case"PRELOAD-HINT":var Z=new N(x);Ge(u,Z,["URI"]),u.preloadHint=Z;break;case"RENDITION-REPORT":var $=new N(x);Ge(u,$,["URI"]),u.renditionReports=u.renditionReports||[],u.renditionReports.push($);break;default:P.warn("line parsed but not handled: ".concat(o));break}}}v&&!v.relurl?(c.pop(),p-=v.duration,u.partList&&(u.fragmentHint=v)):u.partList&&(st(y,v),y.cc=g,u.fragmentHint=y,l&&ut(y,l,u));var ee=c.length,te=c[0],re=c[ee-1];if(p+=u.skippedSegments*u.targetduration,p>0&&ee&&re){u.averagetargetduration=p/ee;var ie=re.sn;u.endSN="initSegment"!==ie?ie:0,u.live||(re.endList=!0),te&&(u.startCC=te.cc)}else u.endSN=0,u.startCC=0;return u.fragmentHint&&(p+=u.fragmentHint.duration),u.totalduration=p,u.endCC=g,m>0&&function(e,t){for(var r=e[t],i=t;i--;){var n=e[i];if(!n)return;n.programDateTime=r.programDateTime-1e3*n.duration,r=n}}(c,m),u}}]),e}();function it(e,t,r){var i,n,a=new N(e);Ge(r,a,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);var o=null!=(i=a.METHOD)?i:"",s=a.URI,l=a.hexadecimalInteger("IV"),u=a.KEYFORMATVERSIONS,c=null!=(n=a.KEYFORMAT)?n:"identity";s&&a.IV&&!l&&P.error("Invalid IV: ".concat(a.IV));var d=s?rt.resolve(s,t):"",h=(u||"1").split("/").map(Number).filter(Number.isFinite);return new He(o,d,c,h,l)}function nt(e){var t=new N(e),r=t.decimalFloatingPoint("TIME-OFFSET");return k(r)?r:null}function at(e,t){["video","audio","text"].forEach((function(r){var i=e.filter((function(e){return function(e,t){var r=ze[t];return!!r&&!0===r[e.slice(0,4)]}(e,r)}));if(i.length){var n=i.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}));t["".concat(r,"Codec")]=n.length>0?n[0]:i[0],e=e.filter((function(e){return-1===i.indexOf(e)}))}})),t.unknownCodecs=e}function ot(e,t,r){var i=t[r];i&&(e[r]=i)}function st(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),k(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function lt(e,t,r,i){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=r,e.sn="initSegment",i&&(e.levelkeys=i),e.initSegment=null}function ut(e,t,r){e.levelkeys=t;var i=r.encryptedFragments;i.length&&i[i.length-1].levelkeys===t||!Object.keys(t).some((function(e){return t[e].isCommonEncryption}))||i.push(e)}var ct={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},dt={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function ht(e){var t=e.type;switch(t){case ct.AUDIO_TRACK:return dt.AUDIO;case ct.SUBTITLE_TRACK:return dt.SUBTITLE;default:return dt.MAIN}}function ft(e,t){var r=e.url;return void 0!==r&&0!==r.indexOf("data:")||(r=t.url),r}var pt=function(){function e(t){(0,p.default)(this,e),this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=t,this.registerListeners()}return(0,g.default)(e,[{key:"startLoad",value:function(e){}},{key:"stopLoad",value:function(){this.destroyInternalLoaders()}},{key:"registerListeners",value:function(){var e=this.hls;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(A.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(A.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}},{key:"createInternalLoader",value:function(e){var t=this.hls.config,r=t.pLoader,i=t.loader,n=r||i,a=new n(t);return this.loaders[e.type]=a,a}},{key:"getInternalLoader",value:function(e){return this.loaders[e.type]}},{key:"resetInternalLoader",value:function(e){this.loaders[e]&&delete this.loaders[e]}},{key:"destroyInternalLoaders",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}},{key:"destroy",value:function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}},{key:"onManifestLoading",value:function(e,t){var r=t.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ct.MANIFEST,url:r,deliveryDirectives:null})}},{key:"onLevelLoading",value:function(e,t){var r=t.id,i=t.level,n=t.url,a=t.deliveryDirectives;this.load({id:r,level:i,responseType:"text",type:ct.LEVEL,url:n,deliveryDirectives:a})}},{key:"onAudioTrackLoading",value:function(e,t){var r=t.id,i=t.groupId,n=t.url,a=t.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:ct.AUDIO_TRACK,url:n,deliveryDirectives:a})}},{key:"onSubtitleTrackLoading",value:function(e,t){var r=t.id,i=t.groupId,n=t.url,a=t.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:ct.SUBTITLE_TRACK,url:n,deliveryDirectives:a})}},{key:"load",value:function(e){var t,r,i,n=this,a=this.hls.config,o=this.getInternalLoader(e);if(o){var s=o.context;if(s&&s.url===e.url)return void P.trace("[playlist-loader]: playlist request ongoing");P.log("[playlist-loader]: aborting previous loader for type: ".concat(e.type)),o.abort()}if((r=e.type===ct.MANIFEST?a.manifestLoadPolicy.default:E({},a.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),o=this.createInternalLoader(e),null!=(t=e.deliveryDirectives)&&t.part)&&(e.type===ct.LEVEL&&null!==e.level?i=this.hls.levels[e.level].details:e.type===ct.AUDIO_TRACK&&null!==e.id?i=this.hls.audioTracks[e.id].details:e.type===ct.SUBTITLE_TRACK&&null!==e.id&&(i=this.hls.subtitleTracks[e.id].details),i)){var l=i.partTarget,u=i.targetduration;if(l&&u){var c=1e3*Math.max(3*l,.8*u);r=E({},r,{maxTimeToFirstByteMs:Math.min(c,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(c,r.maxTimeToFirstByteMs)})}}var d=r.errorRetry||r.timeoutRetry||{},h={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:d.maxNumRetry||0,retryDelay:d.retryDelayMs||0,maxRetryDelay:d.maxRetryDelayMs||0},f={onSuccess:function(e,t,r,i){var a=n.getInternalLoader(r);n.resetInternalLoader(r.type);var o=e.data;0===o.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),rt.isMediaPlaylist(o)?n.handleTrackOrLevelPlaylist(e,t,r,i||null,a):n.handleMasterPlaylist(e,t,r,i)):n.handleManifestParsingError(e,r,new Error("no EXTM3U delimiter"),i||null,t)},onError:function(e,t,r,i){n.handleNetworkError(t,r,!1,e,i)},onTimeout:function(e,t,r){n.handleNetworkError(t,r,!0,void 0,e)}};o.load(e,h,f)}},{key:"handleMasterPlaylist",value:function(e,t,r,i){var n=this.hls,a=e.data,o=ft(e,r),s=rt.parseMasterPlaylist(a,o);if(s.playlistParsingError)this.handleManifestParsingError(e,r,s.playlistParsingError,i,t);else{var l=s.contentSteering,u=s.levels,c=s.sessionData,d=s.sessionKeys,h=s.startTimeOffset,f=s.variableList;this.variableList=f;var p=rt.parseMasterPlaylistMedia(a,o,s),g=p.AUDIO,v=void 0===g?[]:g,y=p.SUBTITLES,m=p["CLOSED-CAPTIONS"];if(v.length){var _=v.some((function(e){return!e.url}));_||!u[0].audioCodec||u[0].attrs.AUDIO||(P.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),v.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new N({}),bitrate:0,url:""}))}n.trigger(A.MANIFEST_LOADED,{levels:u,audioTracks:v,subtitles:y,captions:m,contentSteering:l,url:o,stats:t,networkDetails:i,sessionData:c,sessionKeys:d,startTimeOffset:h,variableList:f})}}},{key:"handleTrackOrLevelPlaylist",value:function(e,t,r,i,n){var a=this.hls,o=r.id,s=r.level,l=r.type,u=ft(e,r),c=k(o)?o:0,d=k(s)?s:c,h=ht(r),f=rt.parseLevelPlaylist(e.data,u,d,h,c,this.variableList);if(l===ct.MANIFEST){var p={attrs:new N({}),bitrate:0,details:f,name:"",url:u};a.trigger(A.MANIFEST_LOADED,{levels:[p],audioTracks:[],url:u,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=f,this.handlePlaylistLoaded(f,e,t,r,i,n)}},{key:"handleManifestParsingError",value:function(e,t,r,i,n){this.hls.trigger(A.ERROR,{type:w.NETWORK_ERROR,details:x.MANIFEST_PARSING_ERROR,fatal:t.type===ct.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:i,stats:n})}},{key:"handleNetworkError",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0,a="A network ".concat(r?"timeout":"error"+(i?" (status "+i.code+")":"")," occurred while loading ").concat(e.type);e.type===ct.LEVEL?a+=": ".concat(e.level," id: ").concat(e.id):e.type!==ct.AUDIO_TRACK&&e.type!==ct.SUBTITLE_TRACK||(a+=" id: ".concat(e.id,' group-id: "').concat(e.groupId,'"'));var o=new Error(a);P.warn("[playlist-loader]: ".concat(a));var s=x.UNKNOWN,l=!1,u=this.getInternalLoader(e);switch(e.type){case ct.MANIFEST:s=r?x.MANIFEST_LOAD_TIMEOUT:x.MANIFEST_LOAD_ERROR,l=!0;break;case ct.LEVEL:s=r?x.LEVEL_LOAD_TIMEOUT:x.LEVEL_LOAD_ERROR,l=!1;break;case ct.AUDIO_TRACK:s=r?x.AUDIO_TRACK_LOAD_TIMEOUT:x.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case ct.SUBTITLE_TRACK:s=r?x.SUBTITLE_TRACK_LOAD_TIMEOUT:x.SUBTITLE_LOAD_ERROR,l=!1;break}u&&this.resetInternalLoader(e.type);var c={type:w.NETWORK_ERROR,details:s,fatal:l,url:e.url,loader:u,context:e,error:o,networkDetails:t,stats:n};if(i){var d=(null==t?void 0:t.url)||e.url;c.response=T({url:d,data:void 0},i)}this.hls.trigger(A.ERROR,c)}},{key:"handlePlaylistLoaded",value:function(e,t,r,i,n,a){var o=this.hls,s=i.type,l=i.level,u=i.id,c=i.groupId,d=i.deliveryDirectives,h=ft(t,i),f=ht(i),p="number"===typeof i.level&&f===dt.MAIN?l:void 0;if(e.fragments.length){e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));var g=e.playlistParsingError;if(g)o.trigger(A.ERROR,{type:w.NETWORK_ERROR,details:x.LEVEL_PARSING_ERROR,fatal:!1,url:h,error:g,reason:g.message,response:t,context:i,level:p,parent:f,networkDetails:n,stats:r});else switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),a.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),s){case ct.MANIFEST:case ct.LEVEL:o.trigger(A.LEVEL_LOADED,{details:e,level:p||0,id:u||0,stats:r,networkDetails:n,deliveryDirectives:d});break;case ct.AUDIO_TRACK:o.trigger(A.AUDIO_TRACK_LOADED,{details:e,id:u||0,groupId:c||"",stats:r,networkDetails:n,deliveryDirectives:d});break;case ct.SUBTITLE_TRACK:o.trigger(A.SUBTITLE_TRACK_LOADED,{details:e,id:u||0,groupId:c||"",stats:r,networkDetails:n,deliveryDirectives:d});break}}else{var v=new Error("No Segments found in Playlist");o.trigger(A.ERROR,{type:w.NETWORK_ERROR,details:x.LEVEL_EMPTY_ERROR,fatal:!1,url:h,error:v,reason:v.message,response:t,context:i,level:p,parent:f,networkDetails:n,stats:r})}}}]),e}();function gt(e,t){var r;try{r=new Event("addtrack")}catch(i){r=document.createEvent("Event"),r.initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}function vt(e,t){var r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error("addCue is failed for: ".concat(t))}catch(n){P.debug("[texttrack-utils]: ".concat(n));var i=new self.TextTrackCue(t.startTime,t.endTime,t.text);i.id=t.id,e.addCue(i)}"disabled"===r&&(e.mode=r)}function yt(e){var t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(var r=e.cues.length;r--;)e.removeCue(e.cues[r]);"disabled"===t&&(e.mode=t)}function mt(e,t,r,i){var n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues&&e.cues.length>0)for(var a=function(e,t,r){var i=[],n=function(e,t){if(t<e[0].startTime)return 0;var r=e.length-1;if(t>e[r].endTime)return-1;var i=0,n=r;while(i<=n){var a=Math.floor((n+i)/2);if(t<e[a].startTime)n=a-1;else{if(!(t>e[a].startTime&&i<r))return a;i=a+1}}return e[i].startTime-t<t-e[n].startTime?i:n}(e,t);if(n>-1)for(var a=n,o=e.length;a<o;a++){var s=e[a];if(s.startTime>=t&&s.endTime<=r)i.push(s);else if(s.startTime>r)return i}return i}(e.cues,t,r),o=0;o<a.length;o++)i&&!i(a[o])||e.removeCue(a[o]);"disabled"===n&&(e.mode=n)}var _t={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};function bt(){if("undefined"!==typeof self)return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var Tt=function(){var e=bt();try{new e(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function St(e,t){return e.getTime()/1e3-t}function Et(e){return Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var kt=function(){function e(t){(0,p.default)(this,e),this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}return(0,g.default)(e,[{key:"destroy",value:function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}},{key:"_registerListeners",value:function(){var e=this.hls;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this)}},{key:"_unregisterListeners",value:function(){var e=this.hls;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this)}},{key:"onMediaAttached",value:function(e,t){this.media=t.media}},{key:"onMediaDetaching",value:function(){this.id3Track&&(yt(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}},{key:"onManifestLoading",value:function(){this.dateRangeCuesAppended={}}},{key:"createTrack",value:function(e){var t=this.getID3Track(e.textTracks);return t.mode="hidden",t}},{key:"getID3Track",value:function(e){if(this.media){for(var t=0;t<e.length;t++){var r=e[t];if("metadata"===r.kind&&"id3"===r.label)return gt(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}},{key:"onFragParsingMetadata",value:function(e,t){if(this.media){var r=this.hls.config,i=r.enableEmsgMetadataCues,n=r.enableID3MetadataCues;if(i||n){var a=t.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var o=bt(),s=0;s<a.length;s++){var l=a[s].type;if((l!==_t.emsg||i)&&n){var u=de(a[s].data);if(u){var c=a[s].pts,d=c+a[s].duration;d>Tt&&(d=Tt);var h=d-c;h<=0&&(d=c+.25);for(var f=0;f<u.length;f++){var p=u[f];if(!ue(p)){this.updateId3CueEnds(c);var g=new o(c,d,"");g.value=p,l&&(g.type=l),this.id3Track.addCue(g)}}}}}}}}},{key:"updateId3CueEnds",value:function(e){var t,r=null==(t=this.id3Track)?void 0:t.cues;if(r)for(var i=r.length;i--;){var n=r[i];n.startTime<e&&n.endTime===Tt&&(n.endTime=e)}}},{key:"onBufferFlushing",value:function(e,t){var r=t.startOffset,i=t.endOffset,n=t.type,a=this.id3Track,o=this.hls;if(o){var s,l=o.config,u=l.enableEmsgMetadataCues,c=l.enableID3MetadataCues;if(a&&(u||c))s="audio"===n?function(e){return e.type===_t.audioId3&&c}:"video"===n?function(e){return e.type===_t.emsg&&u}:function(e){return e.type===_t.audioId3&&c||e.type===_t.emsg&&u},mt(a,r,i,s)}}},{key:"onLevelUpdated",value:function(e,t){var r=this,i=t.details;if(this.media&&i.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var n=this.dateRangeCuesAppended,a=this.id3Track,o=i.dateRanges,s=Object.keys(o);if(a)for(var l=Object.keys(n).filter((function(e){return!s.includes(e)})),u=function(e){var t=l[e];Object.keys(n[t].cues).forEach((function(e){a.removeCue(n[t].cues[e])})),delete n[t]},c=l.length;c--;)u(c);var d=i.fragments[i.fragments.length-1];if(0!==s.length&&k(null==d?void 0:d.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var h=d.programDateTime/1e3-d.start,f=bt(),p=function(e){var t=s[e],i=o[t],a=n[t],l=(null==a?void 0:a.cues)||{},u=(null==a?void 0:a.durationKnown)||!1,c=St(i.startDate,h),d=Tt,p=i.endDate;if(p)d=St(p,h),u=!0;else if(i.endOnNext&&!u){var g=s.reduce((function(e,t){var r=o[t];return r.class===i.class&&r.id!==t&&r.startDate>i.startDate&&e.push(r),e}),[]).sort((function(e,t){return e.startDate.getTime()-t.startDate.getTime()}))[0];g&&(d=St(g.startDate,h),u=!0)}for(var v=Object.keys(i.attr),y=0;y<v.length;y++){var m=v[y];if(F(m)){var _=l[m];if(_)u&&!a.durationKnown&&(_.endTime=d);else{var b=i.attr[m];_=new f(c,d,""),U(m)&&(b=Et(b)),_.value={key:m,data:b},_.type=_t.dateRange,_.id=t,r.id3Track.addCue(_),l[m]=_}}}n[t]={cues:l,dateRange:i,durationKnown:u}},g=0;g<s.length;g++)p(g)}}}}]),e}(),At=function(){function e(t){var r=this;(0,p.default)(this,e),this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return r.timeupdate()},this.hls=t,this.config=t.config,this.registerListeners()}return(0,g.default)(e,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var e=this.config,t=this.levelDetails;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var e=this.levelDetails;if(null===e)return null;var t=e.holdBack,r=e.partHoldBack,i=e.targetduration,n=this.config,a=n.liveSyncDuration,o=n.liveSyncDurationCount,s=n.lowLatencyMode,l=this.hls.userConfig,u=s&&r||t;(l.liveSyncDuration||l.liveSyncDurationCount||0===u)&&(u=void 0!==a?a:o*i);var c=i;return u+Math.min(1*this.stallCount,c)}},{key:"liveSyncPosition",get:function(){var e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(null===e||null===t||null===r)return null;var i=r.edge,n=e-t-this.edgeStalled,a=i-r.totalduration,o=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(a,n),o)}},{key:"drift",get:function(){var e=this.levelDetails;return null===e?1:e.drift}},{key:"edgeStalled",get:function(){var e=this.levelDetails;if(null===e)return 0;var t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}},{key:"forwardBufferLength",get:function(){var e=this.media,t=this.levelDetails;if(!e||!t)return 0;var r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}},{key:"destroy",value:function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}},{key:"registerListeners",value:function(){this.hls.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(A.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(A.ERROR,this.onError,this)}},{key:"unregisterListeners",value:function(){this.hls.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(A.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(A.ERROR,this.onError,this)}},{key:"onMediaAttached",value:function(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}},{key:"onMediaDetaching",value:function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}},{key:"onManifestLoading",value:function(){this.levelDetails=null,this._latency=null,this.stallCount=0}},{key:"onLevelUpdated",value:function(e,t){var r=t.details;this.levelDetails=r,r.advanced&&this.timeupdate(),!r.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}},{key:"onError",value:function(e,t){var r;t.details===x.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(r=this.levelDetails)&&r.live&&P.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}},{key:"timeupdate",value:function(){var e=this.media,t=this.levelDetails;if(e&&t){this.currentTime=e.currentTime;var r=this.computeLatency();if(null!==r){this._latency=r;var i=this.config,n=i.lowLatencyMode,a=i.maxLiveSyncPlaybackRate;if(n&&1!==a){var o=this.targetLatency;if(null!==o){var s=r-o,l=Math.min(this.maxLatency,o+t.targetduration),u=s<l;if(t.live&&u&&s>.05&&this.forwardBufferLength>1){var c=Math.min(2,Math.max(1,a)),d=Math.round(2/(1+Math.exp(-.75*s-this.edgeStalled))*20)/20;e.playbackRate=Math.min(c,Math.max(1,d))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}}}}}},{key:"estimateLiveEdge",value:function(){var e=this.levelDetails;return null===e?null:e.edge+e.age}},{key:"computeLatency",value:function(){var e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}]),e}(),wt=["NONE","TYPE-0","TYPE-1",null],xt={No:"",Yes:"YES",v2:"v2"};var Rt=function(){function e(t,r,i){(0,p.default)(this,e),this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=r,this.skip=i}return(0,g.default)(e,[{key:"addDirectives",value:function(e){var t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}]),e}(),Lt=function(){function e(t){(0,p.default)(this,e),this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this._attrs=[t.attrs],this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter((function(e){return e})).join(",").replace(/\.[^.,]+/g,"")}return(0,g.default)(e,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"attrs",get:function(){return this._attrs[this._urlId]}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(e){var t=e%this.url.length;this._urlId!==t&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=t)}},{key:"audioGroupId",get:function(){var e;return null==(e=this.audioGroupIds)?void 0:e[this.urlId]}},{key:"textGroupId",get:function(){var e;return null==(e=this.textGroupIds)?void 0:e[this.urlId]}},{key:"addFallback",value:function(e){this.url.push(e.url),this._attrs.push(e.attrs)}}]),e}();function It(e,t){var r=t.startPTS;if(k(r)){var i,n=0;t.sn>e.sn?(n=r-e.start,i=e):(n=e.start-r,i=t),i.duration!==n&&(i.duration=n)}else if(t.sn>e.sn){var a=e.cc===t.cc;a&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration}else t.start=Math.max(e.start-t.duration,0)}function Ct(e,t,r,i,n,a){var o=i-r;o<=0&&(P.warn("Fragment should have a positive duration",t),i=r+t.duration,a=n+t.duration);var s=r,l=i,u=t.startPTS,c=t.endPTS;if(k(u)){var d=Math.abs(u-r);k(t.deltaPTS)?t.deltaPTS=Math.max(d,t.deltaPTS):t.deltaPTS=d,s=Math.max(r,u),r=Math.min(r,u),n=Math.min(n,t.startDTS),l=Math.min(i,c),i=Math.max(i,c),a=Math.max(a,t.endDTS)}var h=r-t.start;0!==t.start&&(t.start=r),t.duration=i-t.start,t.startPTS=r,t.maxStartPTS=s,t.startDTS=n,t.endPTS=i,t.minEndPTS=l,t.endDTS=a;var f,p=t.sn;if(!e||p<e.startSN||p>e.endSN)return 0;var g=p-e.startSN,v=e.fragments;for(v[g]=t,f=g;f>0;f--)It(v[f],v[f-1]);for(f=g;f<v.length-1;f++)It(v[f],v[f+1]);return e.fragmentHint&&It(v[v.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,h}function Dt(e,t){for(var r=null,i=e.fragments,n=i.length-1;n>=0;n--){var a=i[n].initSegment;if(a){r=a;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;var o,s=0;if(function(e,t,r){for(var i=t.skippedSegments,n=Math.max(e.startSN,t.startSN)-t.startSN,a=(e.fragmentHint?1:0)+(i?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,o=t.startSN-e.startSN,s=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,u=n;u<=a;u++){var c=l[o+u],d=s[u];i&&!d&&u<i&&(d=t.fragments[u]=c),c&&d&&r(c,d)}}(e,t,(function(e,i){e.relurl&&(s=e.cc-i.cc),k(e.startPTS)&&k(e.endPTS)&&(i.start=i.startPTS=e.startPTS,i.startDTS=e.startDTS,i.maxStartPTS=e.maxStartPTS,i.endPTS=e.endPTS,i.endDTS=e.endDTS,i.minEndPTS=e.minEndPTS,i.duration=e.endPTS-e.startPTS,i.duration&&(o=i),t.PTSKnown=t.alignedSliding=!0),i.elementaryStreams=e.elementaryStreams,i.loader=e.loader,i.stats=e.stats,i.urlId=e.urlId,e.initSegment&&(i.initSegment=e.initSegment,r=e.initSegment)})),r){var l=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;l.forEach((function(e){var t;e.initSegment&&e.initSegment.relurl!==(null==(t=r)?void 0:t.relurl)||(e.initSegment=r)}))}if(t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some((function(e){return!e})),t.deltaUpdateFailed){P.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var u=t.skippedSegments;u--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=function(e,t,r){var i=E({},e);r&&r.forEach((function(e){delete i[e]}));return Object.keys(t).forEach((function(e){var r=new B(t[e].attr,i[e]);r.isValid?i[e]=r:P.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'.concat(JSON.stringify(t[e].attr),'"'))})),i}(e.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));var c=t.fragments;if(s){P.warn("discontinuity sliding from playlist, take drift into account");for(var d=0;d<c.length;d++)c[d].cc+=s}t.skippedSegments&&(t.startCC=t.fragments[0].cc),function(e,t,r){if(e&&t)for(var i=0,n=0,a=e.length;n<=a;n++){var o=e[n],s=t[n+i];o&&s&&o.index===s.index&&o.fragment.sn===s.fragment.sn?r(o,s):i--}}(e.partList,t.partList,(function(e,t){t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),o?Ct(t,o,o.startPTS,o.endPTS,o.startDTS,o.endDTS):Pt(e,t),c.length&&(t.totalduration=t.edge-c[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;var h=t.advancedDateTime;if(t.advanced&&h){var f=t.edge;t.driftStart||(t.driftStartTime=h,t.driftStart=f),t.driftEndTime=h,t.driftEnd=f}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function Pt(e,t){var r=t.startSN+t.skippedSegments-e.startSN,i=e.fragments;r<0||r>=i.length||Ot(t,i[r].start)}function Ot(e,t){if(t){for(var r=e.fragments,i=e.skippedSegments;i<r.length;i++)r[i].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function Mt(e,t,r){var i;return null!=e&&e.details?Nt(null==(i=e.details)?void 0:i.partList,t,r):null}function Nt(e,t,r){if(e)for(var i=e.length;i--;){var n=e[i];if(n.index===r&&n.fragment.sn===t)return n}return null}function Ft(e){switch(e.details){case x.FRAG_LOAD_TIMEOUT:case x.KEY_LOAD_TIMEOUT:case x.LEVEL_LOAD_TIMEOUT:case x.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Ut(e,t){var r=Ft(t);return e.default["".concat(r?"timeout":"error","Retry")]}function Bt(e,t){var r="linear"===e.backoff?1:Math.pow(2,t);return Math.min(r*e.retryDelayMs,e.maxRetryDelayMs)}function Ht(e){return T(T({},e),{errorRetry:null,timeoutRetry:null})}function Vt(e,t,r,i){return!!e&&t<e.maxNumRetry&&(function(e){return 0===e&&!1===navigator.onLine||!!e&&(e<400||e>499)}(i)||!!r)}var jt={search:function(e,t){var r=0,i=e.length-1,n=null,a=null;while(r<=i){n=(r+i)/2|0,a=e[n];var o=t(a);if(o>0)r=n+1;else{if(!(o<0))return a;i=n-1}}return null}};function Gt(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=null;if(e?n=t[e.sn-t[0].sn+1]||null:0===r&&0===t[0].start&&(n=t[0]),n&&0===Kt(r,i,n))return n;var a=jt.search(t,Kt.bind(null,r,i));return!a||a===e&&n?n:a}function Kt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(r.start<=e&&r.start+r.duration>e)return 0;var i=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-i<=e?1:r.start-i>e&&r.start?-1:0}function qt(e,t,r){var i=1e3*Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0)),n=r.endProgramDateTime||0;return n-i>e}var Wt={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},Yt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4},zt=function(){function e(t){(0,p.default)(this,e),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=t,this.log=P.log.bind(P,"[info]:"),this.warn=P.warn.bind(P,"[warning]:"),this.error=P.error.bind(P,"[error]:"),this.registerListeners()}return(0,g.default)(e,[{key:"registerListeners",value:function(){var e=this.hls;e.on(A.ERROR,this.onError,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e&&(e.off(A.ERROR,this.onError,this),e.off(A.ERROR,this.onErrorOut,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this))}},{key:"destroy",value:function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}},{key:"startLoad",value:function(e){this.playlistError=0}},{key:"stopLoad",value:function(){}},{key:"getVariantLevelIndex",value:function(e){return(null==e?void 0:e.type)===dt.MAIN?e.level:this.hls.loadLevel}},{key:"onManifestLoading",value:function(){this.playlistError=0,this.penalizedRenditions={}}},{key:"onError",value:function(e,t){var r;if(!t.fatal){var i=this.hls,n=t.context;switch(t.details){case x.FRAG_LOAD_ERROR:case x.FRAG_LOAD_TIMEOUT:case x.KEY_LOAD_ERROR:case x.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case x.FRAG_GAP:case x.FRAG_PARSING_ERROR:case x.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=Wt.SendAlternateToPenaltyBox);case x.LEVEL_EMPTY_ERROR:case x.LEVEL_PARSING_ERROR:var a,o,s=t.parent===dt.MAIN?t.level:i.loadLevel;return void(t.details===x.LEVEL_EMPTY_ERROR&&null!=(a=t.context)&&null!=(o=a.levelDetails)&&o.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,s)));case x.LEVEL_LOAD_ERROR:case x.LEVEL_LOAD_TIMEOUT:return void("number"===typeof(null==n?void 0:n.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.level)));case x.AUDIO_TRACK_LOAD_ERROR:case x.AUDIO_TRACK_LOAD_TIMEOUT:case x.SUBTITLE_LOAD_ERROR:case x.SUBTITLE_TRACK_LOAD_TIMEOUT:if(n){var l=i.levels[i.loadLevel];if(l&&(n.type===ct.AUDIO_TRACK&&n.groupId===l.audioGroupId||n.type===ct.SUBTITLE_TRACK&&n.groupId===l.textGroupId))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=Wt.SendAlternateToPenaltyBox,void(t.errorAction.flags=Yt.MoveAllAlternatesMatchingHost)}return;case x.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var u=i.levels[i.loadLevel],c=null==u?void 0:u.attrs["HDCP-LEVEL"];return void(c&&(t.errorAction={action:Wt.SendAlternateToPenaltyBox,flags:Yt.MoveAllAlternatesMatchingHDCP,hdcpLevel:c}));case x.BUFFER_ADD_CODEC_ERROR:case x.REMUX_ALLOC_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,null!=(r=t.level)?r:i.loadLevel));case x.INTERNAL_EXCEPTION:case x.BUFFER_APPENDING_ERROR:case x.BUFFER_APPEND_ERROR:case x.BUFFER_FULL_ERROR:case x.LEVEL_SWITCH_ERROR:case x.BUFFER_STALLED_ERROR:case x.BUFFER_SEEK_OVER_HOLE:case x.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:Wt.DoNothing,flags:Yt.None})}if(t.type===w.KEY_SYSTEM_ERROR){var d=this.getVariantLevelIndex(t.frag);return t.levelRetry=!1,void(t.errorAction=this.getLevelSwitchAction(t,d))}}}},{key:"getPlaylistRetryOrSwitchAction",value:function(e,t){var r,i=this.hls,n=Ut(i.config.playlistLoadPolicy,e),a=this.playlistError++,o=null==(r=e.response)?void 0:r.code,s=Vt(n,a,Ft(e),o);if(s)return{action:Wt.RetryRequest,flags:Yt.None,retryConfig:n,retryCount:a};var l=this.getLevelSwitchAction(e,t);return n&&(l.retryConfig=n,l.retryCount=a),l}},{key:"getFragRetryOrSwitchAction",value:function(e){var t=this.hls,r=this.getVariantLevelIndex(e.frag),i=t.levels[r],n=t.config,a=n.fragLoadPolicy,o=n.keyLoadPolicy,s=Ut(e.details.startsWith("key")?o:a,e),l=t.levels.reduce((function(e,t){return e+t.fragmentError}),0);if(i){var u;e.details!==x.FRAG_GAP&&i.fragmentError++;var c=null==(u=e.response)?void 0:u.code,d=Vt(s,l,Ft(e),c);if(d)return{action:Wt.RetryRequest,flags:Yt.None,retryConfig:s,retryCount:l}}var h=this.getLevelSwitchAction(e,r);return s&&(h.retryConfig=s,h.retryCount=l),h}},{key:"getLevelSwitchAction",value:function(e,t){var r=this.hls;null!==t&&void 0!==t||(t=r.loadLevel);var i=this.hls.levels[t];if(i&&(i.loadError++,r.autoLevelEnabled)){for(var n,a,o=-1,s=r.levels,l=null==(n=e.frag)?void 0:n.type,u=null!=(a=e.context)?a:{},c=u.type,d=u.groupId,h=s.length;h--;){var f=(h+r.loadLevel)%s.length;if(f!==r.loadLevel&&0===s[f].loadError){var p=s[f];if(e.details===x.FRAG_GAP&&e.frag){var g=s[f].details;if(g){var v=Gt(e.frag,g.fragments,e.frag.start);if(null!=v&&v.gap)continue}}else{if(c===ct.AUDIO_TRACK&&d===p.audioGroupId||c===ct.SUBTITLE_TRACK&&d===p.textGroupId)continue;if(l===dt.AUDIO&&i.audioGroupId===p.audioGroupId||l===dt.SUBTITLE&&i.textGroupId===p.textGroupId)continue}o=f;break}}if(o>-1&&r.loadLevel!==o)return e.levelRetry=!0,{action:Wt.SendAlternateToPenaltyBox,flags:Yt.None,nextAutoLevel:o}}return{action:Wt.SendAlternateToPenaltyBox,flags:Yt.MoveAllAlternatesMatchingHost}}},{key:"onErrorOut",value:function(e,t){var r;switch(null==(r=t.errorAction)?void 0:r.action){case Wt.DoNothing:break;case Wt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===x.FRAG_GAP||(t.fatal=!0);break}t.fatal&&this.hls.stopLoad()}},{key:"sendAlternateToPenaltyBox",value:function(e){var t=this.hls,r=e.errorAction;if(r){var i=r.flags,n=r.hdcpLevel,a=r.nextAutoLevel;switch(i){case Yt.None:this.switchLevel(e,a);break;case Yt.MoveAllAlternatesMatchingHost:r.resolved||(r.resolved=this.redundantFailover(e));break;case Yt.MoveAllAlternatesMatchingHDCP:n&&(t.maxHdcpLevel=wt[wt.indexOf(n)-1],r.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'.concat(t.maxHdcpLevel,'" or lower'));break}r.resolved||this.switchLevel(e,a)}}},{key:"switchLevel",value:function(e,t){void 0!==t&&e.errorAction&&(this.warn("switching to level ".concat(t," after ").concat(e.details)),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}},{key:"redundantFailover",value:function(e){var t=this,r=this.hls,i=this.penalizedRenditions,n=e.parent===dt.MAIN?e.level:r.loadLevel,a=r.levels[n],o=a.url.length,s=e.frag?e.frag.urlId:a.urlId;a.urlId!==s||e.frag&&!a.details||this.penalizeRendition(a,e);for(var l=function(l){var u=(s+l)%o,c=i[u];if(!c||function(e,t,r){if(performance.now()-e.lastErrorPerfMs>3e5)return!0;var i=e.details;if(t.details===x.FRAG_GAP&&i&&t.frag){var n=t.frag.start,a=Gt(null,i.fragments,n);if(a&&!a.gap)return!0}if(r&&e.errors.length<r.errors.length){var o=e.errors[e.errors.length-1];if(i&&o.frag&&t.frag&&Math.abs(o.frag.start-t.frag.start)>3*i.targetduration)return!0}return!1}(c,e,i[s]))return t.warn("Switching to Redundant Stream ".concat(u+1,"/").concat(o,': "').concat(a.url[u],'" after ').concat(e.details)),t.playlistError=0,r.levels.forEach((function(e){e.urlId=u})),r.nextLoadLevel=n,{v:!0}},u=1;u<o;u++){var c=l(u);if("object"===(0,v.default)(c))return c.v}return!1}},{key:"penalizeRendition",value:function(e,t){var r=this.penalizedRenditions,i=r[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};i.lastErrorPerfMs=performance.now(),i.errors.push(t),i.details=e.details,r[e.urlId]=i}}]),e}();var Xt,Qt=function(){function e(t,r){(0,p.default)(this,e),this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=P.log.bind(P,"".concat(r,":")),this.warn=P.warn.bind(P,"".concat(r,":")),this.hls=t}return(0,g.default)(e,[{key:"destroy",value:function(){this.clearTimer(),this.hls=this.log=this.warn=null}},{key:"clearTimer",value:function(){clearTimeout(this.timer),this.timer=-1}},{key:"startLoad",value:function(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}},{key:"stopLoad",value:function(){this.canLoad=!1,this.clearTimer()}},{key:"switchParams",value:function(e,t){var r=null==t?void 0:t.renditionReports;if(r){for(var i=-1,n=0;n<r.length;n++){var a=r[n],o=void 0;try{o=new self.URL(a.URI,t.url).href}catch(d){P.warn("Could not construct new URL for Rendition Report: ".concat(d)),o=a.URI||""}if(o===e){i=n;break}o===e.substring(0,o.length)&&(i=n)}if(-1!==i){var s=r[i],l=parseInt(s["LAST-MSN"])||(null==t?void 0:t.lastPartSn),u=parseInt(s["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){var c=Math.min(t.age-t.partTarget,t.targetduration);u>=0&&c>t.partTarget&&(u+=1)}return new Rt(l,u>=0?u:void 0,xt.No)}}}},{key:"loadPlaylist",value:function(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}},{key:"shouldLoadPlaylist",value:function(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}},{key:"shouldReloadPlaylist",value:function(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)}},{key:"playlistLoaded",value:function(e,t,r){var i=this,n=t.details,a=t.stats,o=self.performance.now(),s=a.loading.first?Math.max(0,o-a.loading.first):0;if(n.advancedDateTime=Date.now()-s,n.live||null!=r&&r.live){if(n.reloaded(r),r&&this.log("live playlist ".concat(e," ").concat(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:"MISSED")),r&&n.fragments.length>0&&Dt(r,n),!this.canLoad||!n.live)return;var l,u=void 0,c=void 0;if(n.canBlockReload&&n.endSN&&n.advanced){var d=this.hls.config.lowLatencyMode,h=n.lastPartSn,f=n.endSN,p=n.lastPartIndex,g=-1!==p,v=h===f,y=d?0:p;g?(u=v?f+1:h,c=v?y:p+1):u=f+1;var m=n.age,_=m+n.ageHeader,b=Math.min(_-n.partTarget,1.5*n.targetduration);if(b>0){if(r&&b>r.tuneInGoal)this.warn("CDN Tune-in goal increased from: ".concat(r.tuneInGoal," to: ").concat(b," with playlist age: ").concat(n.age)),b=0;else{var T=Math.floor(b/n.targetduration);if(u+=T,void 0!==c){var S=Math.round(b%n.targetduration/n.partTarget);c+=S}this.log("CDN Tune-in age: ".concat(n.ageHeader,"s last advanced ").concat(m.toFixed(2),"s goal: ").concat(b," skip sn ").concat(T," to part ").concat(c))}n.tuneInGoal=b}if(l=this.getDeliveryDirectives(n,t.deliveryDirectives,u,c),d||!v)return void this.loadPlaylist(l)}else n.canBlockReload&&(l=this.getDeliveryDirectives(n,t.deliveryDirectives,u,c));var E=this.hls.mainForwardBufferInfo,k=E?E.end-E.len:0,A=1e3*(n.edge-k),w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,r=1e3*e.targetduration;if(e.updated){var i=e.fragments,n=4;if(i.length&&r*n>t){var a=1e3*i[i.length-1].duration;a<r&&(r=a)}}else r/=2;return Math.round(r)}(n,A);n.updated&&o>this.requestScheduled+w&&(this.requestScheduled=a.loading.start),void 0!==u&&n.canBlockReload?this.requestScheduled=a.loading.first+w-(1e3*n.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+w<o?this.requestScheduled=o:this.requestScheduled-o<=0&&(this.requestScheduled+=w);var x=this.requestScheduled-o;x=Math.max(0,x),this.log("reload live playlist ".concat(e," in ").concat(Math.round(x)," ms")),this.timer=self.setTimeout((function(){return i.loadPlaylist(l)}),x)}else this.clearTimer()}},{key:"getDeliveryDirectives",value:function(e,t,r,i){var n=function(e,t){var r=e.canSkipUntil,i=e.canSkipDateRanges,n=e.endSN,a=void 0!==t?t-n:0;return r&&a<r?i?xt.v2:xt.Yes:xt.No}(e,r);return null!=t&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,i=t.part,n=xt.No),new Rt(r,i,n)}},{key:"checkRetry",value:function(e){var t=this,r=e.details,i=Ft(e),n=e.errorAction,a=n||{},o=a.action,s=a.retryCount,l=void 0===s?0:s,u=a.retryConfig,c=!!n&&!!u&&(o===Wt.RetryRequest||!n.resolved&&o===Wt.SendAlternateToPenaltyBox);if(c){var d;if(this.requestScheduled=-1,i&&null!=(d=e.context)&&d.deliveryDirectives)this.warn("Retrying playlist loading ".concat(l+1,"/").concat(u.maxNumRetry,' after "').concat(r,'" without delivery-directives')),this.loadPlaylist();else{var h=Bt(u,l);this.timer=self.setTimeout((function(){return t.loadPlaylist()}),h),this.warn("Retrying playlist loading ".concat(l+1,"/").concat(u.maxNumRetry,' after "').concat(r,'" in ').concat(h,"ms"))}e.levelRetry=!0,n.resolved=!0}return c}}]),e}(),Jt=function(e){(0,d.default)(r,e);var t=(0,h.default)(r);function r(e,i){var n;return(0,p.default)(this,r),n=t.call(this,e,"[level-controller]"),n._levels=[],n._firstLevel=-1,n._startLevel=void 0,n.currentLevel=null,n.currentLevelIndex=-1,n.manualLevelIndex=-1,n.steering=void 0,n.onParsedComplete=void 0,n.steering=i,n._registerListeners(),n}return(0,g.default)(r,[{key:"_registerListeners",value:function(){var e=this.hls;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(A.FRAG_LOADED,this.onFragLoaded,this),e.on(A.ERROR,this.onError,this)}},{key:"_unregisterListeners",value:function(){var e=this.hls;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this),e.off(A.ERROR,this.onError,this)}},{key:"destroy",value:function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),(0,u.default)((0,c.default)(r.prototype),"destroy",this).call(this)}},{key:"startLoad",value:function(){var e=this._levels;e.forEach((function(e){e.loadError=0,e.fragmentError=0})),(0,u.default)((0,c.default)(r.prototype),"startLoad",this).call(this)}},{key:"resetLevels",value:function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}},{key:"onManifestLoading",value:function(e,t){this.resetLevels()}},{key:"onManifestLoaded",value:function(e,t){var r,i=[],n={};t.levels.forEach((function(e){var t,a=e.attrs;-1!==(null==(t=e.audioCodec)?void 0:t.indexOf("mp4a.40.34"))&&(Xt||(Xt=/chrome|firefox/i.test(navigator.userAgent)),Xt&&(e.audioCodec=void 0));var o=a.AUDIO,s=a.CODECS,l=a["FRAME-RATE"],u=a["PATHWAY-ID"],c=a.RESOLUTION,d=a.SUBTITLES,h="".concat(u||".","-"),f="".concat(h).concat(e.bitrate,"-").concat(c,"-").concat(l,"-").concat(s);r=n[f],r?r.addFallback(e):(r=new Lt(e),n[f]=r,i.push(r)),Zt(r,"audio",o),Zt(r,"text",d)})),this.filterAndSortMediaOptions(i,t)}},{key:"filterAndSortMediaOptions",value:function(e,t){var r=this,i=[],n=[],a=!1,o=!1,s=!1,l=e.filter((function(e){var t=e.audioCodec,r=e.videoCodec,i=e.width,n=e.height,l=e.unknownCodecs;return a||(a=!(!i||!n)),o||(o=!!r),s||(s=!!t),!(null!=l&&l.length)&&(!t||Qe(t,"audio"))&&(!r||Qe(r,"video"))}));if((a||o)&&s&&(l=l.filter((function(e){var t=e.videoCodec,r=e.width,i=e.height;return!!t||!(!r||!i)}))),0!==l.length){t.audioTracks&&(i=t.audioTracks.filter((function(e){return!e.audioCodec||Qe(e.audioCodec,"audio")})),$t(i)),t.subtitles&&(n=t.subtitles,$t(n));var u=l.slice(0);l.sort((function(e,t){return e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"]?(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1:e.bitrate!==t.bitrate?e.bitrate-t.bitrate:e.attrs["FRAME-RATE"]!==t.attrs["FRAME-RATE"]?e.attrs.decimalFloatingPoint("FRAME-RATE")-t.attrs.decimalFloatingPoint("FRAME-RATE"):e.attrs.SCORE!==t.attrs.SCORE?e.attrs.decimalFloatingPoint("SCORE")-t.attrs.decimalFloatingPoint("SCORE"):a&&e.height!==t.height?e.height-t.height:0}));var c=u[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==u.length))for(var d=0;d<u.length;d++)if(u[d].pathwayId===l[0].pathwayId){c=u[d];break}this._levels=l;for(var h=0;h<l.length;h++)if(l[h]===c){this._firstLevel=h,this.log("manifest loaded, ".concat(l.length," level(s) found, first bitrate: ").concat(c.bitrate));break}var f=s&&!o,p={levels:l,audioTracks:i,subtitleTracks:n,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:o,altAudio:!f&&i.some((function(e){return!!e.url}))};this.hls.trigger(A.MANIFEST_PARSED,p),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else Promise.resolve().then((function(){if(r.hls){var e=new Error("no level with compatible codecs found in manifest");r.hls.trigger(A.ERROR,{type:w.MEDIA_ERROR,details:x.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:e,reason:e.message})}}))}},{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;if(0!==t.length){if(e<0||e>=t.length){var r=new Error("invalid level idx"),i=e<0;if(this.hls.trigger(A.ERROR,{type:w.OTHER_ERROR,details:x.LEVEL_SWITCH_ERROR,level:e,fatal:i,error:r,reason:r.message}),i)return;e=Math.min(e,t.length-1)}var n=this.currentLevelIndex,a=this.currentLevel,o=a?a.attrs["PATHWAY-ID"]:void 0,s=t[e],l=s.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=s,n!==e||!s.details||!a||o!==l){this.log("Switching to level ".concat(e).concat(l?" with Pathway "+l:""," from level ").concat(n).concat(o?" with Pathway "+o:""));var u=E({},s,{level:e,maxBitrate:s.maxBitrate,attrs:s.attrs,uri:s.uri,urlId:s.urlId});delete u._attrs,delete u._urlId,this.hls.trigger(A.LEVEL_SWITCHING,u);var c=s.details;if(!c||c.live){var d=this.switchParams(s.uri,null==a?void 0:a.details);this.loadPlaylist(d)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"onError",value:function(e,t){!t.fatal&&t.context&&t.context.type===ct.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}},{key:"onFragLoaded",value:function(e,t){var r=t.frag;if(void 0!==r&&r.type===dt.MAIN){var i=this._levels[r.level];void 0!==i&&(i.loadError=0)}}},{key:"onLevelLoaded",value:function(e,t){var r,i,n=t.level,a=t.details,o=this._levels[n];if(!o)return this.warn("Invalid level index ".concat(n)),void(null!=(i=t.deliveryDirectives)&&i.skip&&(a.deltaUpdateFailed=!0));n===this.currentLevelIndex?(0===o.fragmentError&&(o.loadError=0),this.playlistLoaded(n,t,o.details)):null!=(r=t.deliveryDirectives)&&r.skip&&(a.deltaUpdateFailed=!0)}},{key:"onAudioTrackSwitched",value:function(e,t){var r=this.currentLevel;if(r){var i=this.hls.audioTracks[t.id].groupId;if(r.audioGroupIds&&r.audioGroupId!==i){for(var n=-1,a=0;a<r.audioGroupIds.length;a++)if(r.audioGroupIds[a]===i){n=a;break}-1!==n&&n!==r.urlId&&(r.urlId=n,this.canLoad&&this.startLoad())}}}},{key:"loadPlaylist",value:function(e){(0,u.default)((0,c.default)(r.prototype),"loadPlaylist",this).call(this);var t=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){var n=i.urlId,a=i.uri;if(e)try{a=e.addDirectives(a)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: ".concat(s))}var o=i.attrs["PATHWAY-ID"];this.log("Loading level index ".concat(t).concat(void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:""," with").concat(o?" Pathway "+o:""," URI ").concat(n+1,"/").concat(i.url.length," ").concat(a)),this.clearTimer(),this.hls.trigger(A.LEVEL_LOADING,{url:a,level:t,id:n,deliveryDirectives:e||null})}}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}},{key:"removeLevel",value:function(e,t){var r=this,i=function(e,r){return r!==t},n=this._levels.filter((function(n,a){return a!==e||(n.url.length>1&&void 0!==t?(n.url=n.url.filter(i),n.audioGroupIds&&(n.audioGroupIds=n.audioGroupIds.filter(i)),n.textGroupIds&&(n.textGroupIds=n.textGroupIds.filter(i)),n.urlId=0,!0):(r.steering&&r.steering.removeLevel(n),!1))}));this.hls.trigger(A.LEVELS_UPDATED,{levels:n})}},{key:"onLevelsUpdated",value:function(e,t){var r=t.levels;r.forEach((function(e,t){var r=e.details;null!=r&&r.fragments&&r.fragments.forEach((function(e){e.level=t}))})),this._levels=r}}]),r}(Qt);function Zt(e,t,r){r&&("audio"===t?(e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds[e.url.length-1]=r):"text"===t&&(e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds[e.url.length-1]=r))}function $t(e){var t={};e.forEach((function(e){var r=e.groupId||"";e.id=t[r]=t[r]||0,t[r]++}))}var er={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},tr=function(){function e(t){(0,p.default)(this,e),this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=t,this._registerListeners()}return(0,g.default)(e,[{key:"_registerListeners",value:function(){var e=this.hls;e.on(A.BUFFER_APPENDED,this.onBufferAppended,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this),e.on(A.FRAG_LOADED,this.onFragLoaded,this)}},{key:"_unregisterListeners",value:function(){var e=this.hls;e.off(A.BUFFER_APPENDED,this.onBufferAppended,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this)}},{key:"destroy",value:function(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}},{key:"getAppendedFrag",value:function(e,t){var r=this.activePartLists[t];if(r)for(var i=r.length;i--;){var n=r[i];if(!n)break;var a=n.end;if(n.start<=e&&null!==a&&e<=a)return n}return this.getBufferedFrag(e,t)}},{key:"getBufferedFrag",value:function(e,t){for(var r=this.fragments,i=Object.keys(r),n=i.length;n--;){var a=r[i[n]];if((null==a?void 0:a.body.type)===t&&a.buffered){var o=a.body;if(o.start<=e&&e<=o.end)return o}}return null}},{key:"detectEvictedFragments",value:function(e,t,r,i){var n=this;this.timeRanges&&(this.timeRanges[e]=t);var a=(null==i?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach((function(i){var o=n.fragments[i];if(o&&!(a>=o.body.sn))if(o.buffered||o.loaded){var s=o.range[e];s&&s.time.some((function(e){var r=!n.isTimeBuffered(e.startPTS,e.endPTS,t);return r&&n.removeFragment(o.body),r}))}else o.body.type===r&&n.removeFragment(o.body)}))}},{key:"detectPartialFragments",value:function(e){var t=this,r=this.timeRanges,i=e.frag,n=e.part;if(r&&"initSegment"!==i.sn){var a=ir(i),o=this.fragments[a];if(o){var s=!i.relurl;Object.keys(r).forEach((function(e){var a=i.elementaryStreams[e];if(a){var l=r[e],u=s||!0===a.partial;o.range[e]=t.getBufferedTimes(i,n,u,l)}})),o.loaded=null,Object.keys(o.range).length?(o.buffered=!0,o.body.endList&&(this.endListFragments[o.body.type]=o),rr(o)||this.removeParts(i.sn-1,i.type)):this.removeFragment(o.body)}}}},{key:"removeParts",value:function(e,t){var r=this.activePartLists[t];r&&(this.activePartLists[t]=r.filter((function(t){return t.fragment.sn>=e})))}},{key:"fragBuffered",value:function(e,t){var r=ir(e),i=this.fragments[r];!i&&t&&(i=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}},{key:"getBufferedTimes",value:function(e,t,r,i){for(var n={time:[],partial:r},a=e.start,o=e.end,s=e.minEndPTS||o,l=e.maxStartPTS||a,u=0;u<i.length;u++){var c=i.start(u)-this.bufferPadding,d=i.end(u)+this.bufferPadding;if(l>=c&&s<=d){n.time.push({startPTS:Math.max(a,i.start(u)),endPTS:Math.min(o,i.end(u))});break}if(a<d&&o>c)n.partial=!0,n.time.push({startPTS:Math.max(a,i.start(u)),endPTS:Math.min(o,i.end(u))});else if(o<=c)break}return n}},{key:"getPartialFragment",value:function(e){var t,r,i,n=null,a=0,o=this.bufferPadding,s=this.fragments;return Object.keys(s).forEach((function(l){var u=s[l];u&&rr(u)&&(r=u.body.start-o,i=u.body.end+o,e>=r&&e<=i&&(t=Math.min(e-r,i-e),a<=t&&(n=u.body,a=t)))})),n}},{key:"isEndListAppended",value:function(e){var t=this.endListFragments[e];return void 0!==t&&(t.buffered||rr(t))}},{key:"getState",value:function(e){var t=ir(e),r=this.fragments[t];return r?r.buffered?rr(r)?er.PARTIAL:er.OK:er.APPENDING:er.NOT_LOADED}},{key:"isTimeBuffered",value:function(e,t,r){for(var i,n,a=0;a<r.length;a++){if(i=r.start(a)-this.bufferPadding,n=r.end(a)+this.bufferPadding,e>=i&&t<=n)return!0;if(t<=i)return!1}return!1}},{key:"onFragLoaded",value:function(e,t){var r=t.frag,i=t.part;if("initSegment"!==r.sn&&!r.bitrateTest){var n=i?null:t,a=ir(r);this.fragments[a]={body:r,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}}},{key:"onBufferAppended",value:function(e,t){var r=this,i=t.frag,n=t.part,a=t.timeRanges;if("initSegment"!==i.sn){var o=i.type;if(n){var s=this.activePartLists[o];s||(this.activePartLists[o]=s=[]),s.push(n)}this.timeRanges=a,Object.keys(a).forEach((function(e){var t=a[e];r.detectEvictedFragments(e,t,o,n)}))}}},{key:"onFragBuffered",value:function(e,t){this.detectPartialFragments(t)}},{key:"hasFragment",value:function(e){var t=ir(e);return!!this.fragments[t]}},{key:"hasParts",value:function(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}},{key:"removeFragmentsInRange",value:function(e,t,r,i,n){var a=this;i&&!this.hasGaps||Object.keys(this.fragments).forEach((function(o){var s=a.fragments[o];if(s){var l=s.body;l.type!==r||i&&!l.gap||l.start<t&&l.end>e&&(s.buffered||n)&&a.removeFragment(l)}}))}},{key:"removeFragment",value:function(e){var t=ir(e);e.stats.loaded=0,e.clearElementaryStreamInfo();var r=this.activePartLists[e.type];if(r){var i=e.sn;this.activePartLists[e.type]=r.filter((function(e){return e.fragment.sn!==i}))}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}},{key:"removeAllFragments",value:function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}]),e}();function rr(e){var t,r,i;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(r=e.range.audio)?void 0:r.partial)||(null==(i=e.range.audiovideo)?void 0:i.partial))}function ir(e){return"".concat(e.type,"_").concat(e.level,"_").concat(e.urlId,"_").concat(e.sn)}var nr=Math.pow(2,17),ar=function(){function e(t){(0,p.default)(this,e),this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}return(0,g.default)(e,[{key:"destroy",value:function(){this.loader&&(this.loader.destroy(),this.loader=null)}},{key:"abort",value:function(){this.loader&&this.loader.abort()}},{key:"load",value:function(e,t){var r=this,i=e.url;if(!i)return Promise.reject(new lr({type:w.NETWORK_ERROR,details:x.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a ".concat(i?"part list":"url")),networkDetails:null}));this.abort();var n=this.config,a=n.fLoader,o=n.loader;return new Promise((function(s,l){if(r.loader&&r.loader.destroy(),e.gap)l(sr(e));else{var u=r.loader=e.loader=a?new a(n):new o(n),c=or(e),d=Ht(n.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:nr};e.stats=u.stats,u.load(c,h,{onSuccess:function(t,i,n,a){r.resetLoader(e,u);var o=t.data;n.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(o.slice(0,16)),o=o.slice(16)),s({frag:e,part:null,payload:o,networkDetails:a})},onError:function(t,n,a,o){r.resetLoader(e,u),l(new lr({type:w.NETWORK_ERROR,details:x.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:T({url:i,data:void 0},t),error:new Error("HTTP Error ".concat(t.code," ").concat(t.text)),networkDetails:a,stats:o}))},onAbort:function(t,i,n){r.resetLoader(e,u),l(new lr({type:w.NETWORK_ERROR,details:x.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:n,stats:t}))},onTimeout:function(t,i,n){r.resetLoader(e,u),l(new lr({type:w.NETWORK_ERROR,details:x.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error("Timeout after ".concat(h.timeout,"ms")),networkDetails:n,stats:t}))},onProgress:function(r,i,n,a){t&&t({frag:e,part:null,payload:n,networkDetails:a})}})}}))}},{key:"loadPart",value:function(e,t,r){var i=this;this.abort();var n=this.config,a=n.fLoader,o=n.loader;return new Promise((function(s,l){if(i.loader&&i.loader.destroy(),e.gap||t.gap)l(sr(e,t));else{var u=i.loader=e.loader=a?new a(n):new o(n),c=or(e,t),d=Ht(n.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:nr};t.stats=u.stats,u.load(c,h,{onSuccess:function(n,a,o,l){i.resetLoader(e,u),i.updateStatsFromPart(e,t);var c={frag:e,part:t,payload:n.data,networkDetails:l};r(c),s(c)},onError:function(r,n,a,o){i.resetLoader(e,u),l(new lr({type:w.NETWORK_ERROR,details:x.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:T({url:c.url,data:void 0},r),error:new Error("HTTP Error ".concat(r.code," ").concat(r.text)),networkDetails:a,stats:o}))},onAbort:function(r,n,a){e.stats.aborted=t.stats.aborted,i.resetLoader(e,u),l(new lr({type:w.NETWORK_ERROR,details:x.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:a,stats:r}))},onTimeout:function(r,n,a){i.resetLoader(e,u),l(new lr({type:w.NETWORK_ERROR,details:x.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error("Timeout after ".concat(h.timeout,"ms")),networkDetails:a,stats:r}))}})}}))}},{key:"updateStatsFromPart",value:function(e,t){var r=e.stats,i=t.stats,n=i.total;if(r.loaded+=i.loaded,n){var a=Math.round(e.duration/t.duration),o=Math.min(Math.round(r.loaded/n),a),s=a-o,l=s*Math.round(r.loaded/o);r.total=r.loaded+l}else r.total=Math.max(r.loaded,r.total);var u=r.loading,c=i.loading;u.start?u.first+=c.first-c.start:(u.start=c.start,u.first=c.first),u.end=c.end}},{key:"resetLoader",value:function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}]),e}();function or(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=t||e,i={frag:e,part:t,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},n=r.byteRangeStartOffset,a=r.byteRangeEndOffset;if(k(n)&&k(a)){var o,s=n,l=a;if("initSegment"===e.sn&&"AES-128"===(null==(o=e.decryptdata)?void 0:o.method)){var u=a-n;u%16&&(l=a+(16-u%16)),0!==n&&(i.resetIV=!0,s=n-16)}i.rangeStart=s,i.rangeEnd=l}return i}function sr(e,t){var r=new Error("GAP ".concat(e.gap?"tag":"attribute"," found")),i={type:w.MEDIA_ERROR,details:x.FRAG_GAP,fatal:!1,frag:e,error:r,networkDetails:null};return t&&(i.part=t),(t||e).stats.aborted=!0,new lr(i)}var lr=function(e){(0,d.default)(r,e);var t=(0,h.default)(r);function r(e){var i;return(0,p.default)(this,r),i=t.call(this,e.error.message),i.data=void 0,i.data=e,i}return(0,g.default)(r)}((0,l.default)(Error)),ur=function(){function e(t){(0,p.default)(this,e),this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=t}return(0,g.default)(e,[{key:"abort",value:function(e){for(var t in this.keyUriToKeyInfo){var r=this.keyUriToKeyInfo[t].loader;if(r){if(e&&e!==r.context.frag.type)return;r.abort()}}}},{key:"detach",value:function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}},{key:"destroy",value:function(){for(var e in this.detach(),this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}},{key:"createKeyLoadError",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x.KEY_LOAD_ERROR,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;return new lr({type:w.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:n,error:r,networkDetails:i})}},{key:"loadClear",value:function(e,t){var r=this;if(this.emeController&&this.config.emeEnabled)for(var i=e.sn,n=e.cc,a=function(e){var a=t[e];if(n<=a.cc&&("initSegment"===i||"initSegment"===a.sn||i<a.sn))return r.emeController.selectKeySystemFormat(a).then((function(e){a.setKeyFormat(e)})),"break"},o=0;o<t.length;o++){var s=a(o);if("break"===s)break}}},{key:"load",value:function(e){var t=this;return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then((function(r){return t.loadInternal(e,r)})):this.loadInternal(e)}},{key:"loadInternal",value:function(e,t){var r,i;t&&e.setKeyFormat(t);var n=e.decryptdata;if(!n){var a=new Error(t?"Expected frag.decryptdata to be defined after setting format ".concat(t):"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,x.KEY_LOAD_ERROR,a))}var o=n.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,x.KEY_LOAD_ERROR,new Error('Invalid key URI: "'.concat(o,'"'))));var s,l=this.keyUriToKeyInfo[o];if(null!=(r=l)&&r.decryptdata.key)return n.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(null!=(i=l)&&i.keyLoadPromise)switch(null==(s=l.mediaKeySessionContext)?void 0:s.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return l.keyLoadPromise.then((function(t){return n.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:l}}))}switch(l=this.keyUriToKeyInfo[o]={decryptdata:n,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},n.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===n.keyFormat?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,x.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'.concat(n.method,'"'))))}}},{key:"loadKeyEME",value:function(e,t){var r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var i=this.emeController.loadKey(r);if(i)return(e.keyLoadPromise=i.then((function(t){return e.mediaKeySessionContext=t,r}))).catch((function(t){throw e.keyLoadPromise=null,t}))}return Promise.resolve(r)}},{key:"loadKeyHTTP",value:function(e,t){var r=this,i=this.config,n=i.loader,a=new n(i);return t.keyLoader=e.loader=a,e.keyLoadPromise=new Promise((function(n,o){var s={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},l=i.keyLoadPolicy.default,u={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:function(e,t,i,a){var s=i.frag,l=i.keyInfo,u=i.url;if(!s.decryptdata||l!==r.keyUriToKeyInfo[u])return o(r.createKeyLoadError(s,x.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),a));l.decryptdata.key=s.decryptdata.key=new Uint8Array(e.data),s.keyLoader=null,l.loader=null,n({frag:s,keyInfo:l})},onError:function(e,i,n,a){r.resetLoader(i),o(r.createKeyLoadError(t,x.KEY_LOAD_ERROR,new Error("HTTP Error ".concat(e.code," loading key ").concat(e.text)),n,T({url:s.url,data:void 0},e)))},onTimeout:function(e,i,n){r.resetLoader(i),o(r.createKeyLoadError(t,x.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),n))},onAbort:function(e,i,n){r.resetLoader(i),o(r.createKeyLoadError(t,x.INTERNAL_ABORTED,new Error("key loading aborted"),n))}};a.load(s,u,c)}))}},{key:"resetLoader",value:function(e){var t=e.frag,r=e.keyInfo,i=e.url,n=r.loader;t.keyLoader===n&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[i],n&&n.destroy()}}]),e}(),cr=function(){function e(){(0,p.default)(this,e),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}return(0,g.default)(e,[{key:"destroy",value:function(){this.onHandlerDestroying(),this.onHandlerDestroyed()}},{key:"onHandlerDestroying",value:function(){this.clearNextTick(),this.clearInterval()}},{key:"onHandlerDestroyed",value:function(){}},{key:"hasInterval",value:function(){return!!this._tickInterval}},{key:"hasNextTick",value:function(){return!!this._tickTimer}},{key:"setInterval",value:function(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}},{key:"clearInterval",value:function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}},{key:"clearNextTick",value:function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}},{key:"tick",value:function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}},{key:"tickImmediate",value:function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}},{key:"doTick",value:function(){}}]),e}(),dr={length:0,start:function(){return 0},end:function(){return 0}},hr=function(){function e(){(0,p.default)(this,e)}return(0,g.default)(e,null,[{key:"isBuffered",value:function(t,r){try{if(t)for(var i=e.getBuffered(t),n=0;n<i.length;n++)if(r>=i.start(n)&&r<=i.end(n))return!0}catch(a){}return!1}},{key:"bufferInfo",value:function(t,r,i){try{if(t){var n,a=e.getBuffered(t),o=[];for(n=0;n<a.length;n++)o.push({start:a.start(n),end:a.end(n)});return this.bufferedInfo(o,r,i)}}catch(s){}return{len:0,start:r,end:r,nextStart:void 0}}},{key:"bufferedInfo",value:function(e,t,r){t=Math.max(0,t),e.sort((function(e,t){var r=e.start-t.start;return r||t.end-e.end}));var i=[];if(r)for(var n=0;n<e.length;n++){var a=i.length;if(a){var o=i[a-1].end;e[n].start-o<r?e[n].end>o&&(i[a-1].end=e[n].end):i.push(e[n])}else i.push(e[n])}else i=e;for(var s,l=0,u=t,c=t,d=0;d<i.length;d++){var h=i[d].start,f=i[d].end;if(t+r>=h&&t<f)u=h,c=f,l=c-t;else if(t+r<h){s=h;break}}return{len:l,start:u||0,end:c||0,nextStart:s}}},{key:"getBuffered",value:function(e){try{return e.buffered}catch(t){return P.log("failed to get media.buffered",t),dr}}}]),e}(),fr=(0,g.default)((function e(t,r,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];(0,p.default)(this,e),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=pr(),this.buffering={audio:pr(),video:pr(),audiovideo:pr()},this.level=t,this.sn=r,this.id=i,this.size=n,this.part=a,this.partial=o}));function pr(){return{start:0,executeStart:0,executeEnd:0,end:0}}function gr(e,t){for(var r=null,i=0,n=e.length;i<n;i++){var a=e[i];if(a&&a.cc===t){r=a;break}}return r}function vr(e,t){if(e){var r=e.start+t;e.start=e.startPTS=r,e.endPTS=r+e.duration}}function yr(e,t){for(var r=t.fragments,i=0,n=r.length;i<n;i++)vr(r[i],e);t.fragmentHint&&vr(t.fragmentHint,e),t.alignedSliding=!0}function mr(e,t,r){t&&(function(e,t,r){if(function(e,t,r){return!(!t.details||!(r.endCC>r.startCC||e&&e.cc<r.startCC))}(e,r,t)){var i=function(e,t){var r=e.fragments,i=t.fragments;if(i.length&&r.length){var n=gr(r,i[0].cc);if(n&&(!n||n.startPTS))return n;P.log("No frag in previous level to align on")}else P.log("No fragments to align")}(r.details,t);i&&k(i.start)&&(P.log("Adjusting PTS using last level due to CC increase within current level ".concat(t.url)),yr(i.start,t))}}(e,r,t),!r.alignedSliding&&t.details&&function(e,t){if(!t.fragments.length||!e.hasProgramDateTime||!t.hasProgramDateTime)return;var r=t.fragments[0].programDateTime,i=e.fragments[0].programDateTime,n=(i-r)/1e3+t.fragments[0].start;n&&k(n)&&(P.log("Adjusting PTS using programDateTime delta ".concat(i-r,"ms, sliding:").concat(n.toFixed(3)," ").concat(e.url," ")),yr(n,e))}(r,t.details),r.alignedSliding||!t.details||r.skippedSegments||Pt(t.details,r))}function _r(e,t){if(e.hasProgramDateTime&&t.hasProgramDateTime){var r=e.fragments,i=t.fragments;if(r.length&&i.length){var n=Math.round(i.length/2)-1,a=i[n],o=gr(r,a.cc)||r[Math.round(r.length/2)-1],s=a.programDateTime,l=o.programDateTime;if(null!==s&&null!==l){var u=(l-s)/1e3-(o.start-a.start);yr(u,e)}}}}var br=function(){function e(t,r){(0,p.default)(this,e),this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=r}return(0,g.default)(e,[{key:"decrypt",value:function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}]),e}(),Tr=function(){function e(t,r){(0,p.default)(this,e),this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=r}return(0,g.default)(e,[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),e}();var Sr=function(){function e(){(0,p.default)(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}return(0,g.default)(e,[{key:"uint8ArrayToUint32Array_",value:function(e){for(var t=new DataView(e),r=new Uint32Array(4),i=0;i<4;i++)r[i]=t.getUint32(4*i);return r}},{key:"initTable",value:function(){var e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],n=r[1],a=r[2],o=r[3],s=this.invSubMix,l=s[0],u=s[1],c=s[2],d=s[3],h=new Uint32Array(256),f=0,p=0,g=0;for(g=0;g<256;g++)h[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){var v=p^p<<1^p<<2^p<<3^p<<4;v=v>>>8^255&v^99,e[f]=v,t[v]=f;var y=h[f],m=h[y],_=h[m],b=257*h[v]^16843008*v;i[f]=b<<24|b>>>8,n[f]=b<<16|b>>>16,a[f]=b<<8|b>>>24,o[f]=b,b=16843009*_^65537*m^257*y^16843008*f,l[v]=b<<24|b>>>8,u[v]=b<<16|b>>>16,c[v]=b<<8|b>>>24,d[v]=b,f?(f=y^h[h[h[_^y]]],p^=h[h[p]]):f=p=1}}},{key:"expandKey",value:function(e){var t=this.uint8ArrayToUint32Array_(e),r=!0,i=0;while(i<t.length&&r)r=t[i]===this.key[i],i++;if(!r){this.key=t;var n=this.keySize=t.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var a,o,s,l,u=this.ksRows=4*(n+6+1),c=this.keySchedule=new Uint32Array(u),d=this.invKeySchedule=new Uint32Array(u),h=this.sBox,f=this.rcon,p=this.invSubMix,g=p[0],v=p[1],y=p[2],m=p[3];for(a=0;a<u;a++)a<n?s=c[a]=t[a]:(l=s,a%n===0?(l=l<<8|l>>>24,l=h[l>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[255&l],l^=f[a/n|0]<<24):n>6&&a%n===4&&(l=h[l>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[255&l]),c[a]=s=(c[a-n]^l)>>>0);for(o=0;o<u;o++)a=u-o,l=3&o?c[a]:c[a-4],d[o]=o<4||a<=4?l:g[h[l>>>24]]^v[h[l>>>16&255]]^y[h[l>>>8&255]]^m[h[255&l]],d[o]=d[o]>>>0}}},{key:"networkToHostOrderSwap",value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}},{key:"decrypt",value:function(e,t,r){var i,n,a,o,s,l,u,c,d,h,f,p,g,v,y=this.keySize+6,m=this.invKeySchedule,_=this.invSBox,b=this.invSubMix,T=b[0],S=b[1],E=b[2],k=b[3],A=this.uint8ArrayToUint32Array_(r),w=A[0],x=A[1],R=A[2],L=A[3],I=new Int32Array(e),C=new Int32Array(I.length),D=this.networkToHostOrderSwap;while(t<I.length){for(d=D(I[t]),h=D(I[t+1]),f=D(I[t+2]),p=D(I[t+3]),s=d^m[0],l=p^m[1],u=f^m[2],c=h^m[3],g=4,v=1;v<y;v++)i=T[s>>>24]^S[l>>16&255]^E[u>>8&255]^k[255&c]^m[g],n=T[l>>>24]^S[u>>16&255]^E[c>>8&255]^k[255&s]^m[g+1],a=T[u>>>24]^S[c>>16&255]^E[s>>8&255]^k[255&l]^m[g+2],o=T[c>>>24]^S[s>>16&255]^E[l>>8&255]^k[255&u]^m[g+3],s=i,l=n,u=a,c=o,g+=4;i=_[s>>>24]<<24^_[l>>16&255]<<16^_[u>>8&255]<<8^_[255&c]^m[g],n=_[l>>>24]<<24^_[u>>16&255]<<16^_[c>>8&255]<<8^_[255&s]^m[g+1],a=_[u>>>24]<<24^_[c>>16&255]<<16^_[s>>8&255]<<8^_[255&l]^m[g+2],o=_[c>>>24]<<24^_[s>>16&255]<<16^_[l>>8&255]<<8^_[255&u]^m[g+3],C[t]=D(i^w),C[t+1]=D(o^x),C[t+2]=D(a^R),C[t+3]=D(n^L),w=d,x=h,R=f,L=p,t+=4}return C.buffer}}]),e}(),Er=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.removePKCS7Padding,n=void 0===i||i;if((0,p.default)(this,e),this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=t.enableSoftwareAES,this.removePKCS7Padding=n,n)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch(o){}null===this.subtle&&(this.useSoftware=!0)}return(0,g.default)(e,[{key:"destroy",value:function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}},{key:"isSync",value:function(){return this.useSoftware}},{key:"flush",value:function(){var e=this.currentResult,t=this.remainderData;if(!e||t)return this.reset(),null;var r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(e){var t=e.byteLength,r=t&&new DataView(e.buffer).getUint8(t-1);return r?re(e,0,t-r):e}(r):r}},{key:"reset",value:function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}},{key:"decrypt",value:function(e,t,r){var i=this;return this.useSoftware?new Promise((function(n,a){i.softwareDecrypt(new Uint8Array(e),t,r);var o=i.flush();o?n(o.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(e),t,r)}},{key:"softwareDecrypt",value:function(e,t,r){var i=this.currentIV,n=this.currentResult,a=this.remainderData;this.logOnce("JS AES decrypt"),a&&(e=Pe(a,e),this.remainderData=null);var o=this.getValidChunk(e);if(!o.length)return null;i&&(r=i);var s=this.softwareDecrypter;s||(s=this.softwareDecrypter=new Sr),s.expandKey(t);var l=n;return this.currentResult=s.decrypt(o.buffer,0,r),this.currentIV=re(o,-16).buffer,l||null}},{key:"webCryptoDecrypt",value:function(e,t,r){var i=this,n=this.subtle;return this.key===t&&this.fastAesKey||(this.key=t,this.fastAesKey=new Tr(n,t)),this.fastAesKey.expandKey().then((function(t){if(!n)return Promise.reject(new Error("web crypto not initialized"));i.logOnce("WebCrypto AES decrypt");var a=new br(n,new Uint8Array(r));return a.decrypt(e.buffer,t)})).catch((function(n){return P.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, ".concat(n.name,": ").concat(n.message)),i.onWebCryptoError(e,t,r)}))}},{key:"onWebCryptoError",value:function(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);var i=this.flush();if(i)return i.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}},{key:"getValidChunk",value:function(e){var t=e,r=e.length-e.length%16;return r!==e.length&&(t=re(e,0,r),this.remainderData=re(e,r)),t}},{key:"logOnce",value:function(e){this.logEnabled&&(P.log("[decrypter]: ".concat(e)),this.logEnabled=!1)}}]),e}(),kr={toString:function(e){for(var t="",r=e.length,i=0;i<r;i++)t+="[".concat(e.start(i).toFixed(3),"-").concat(e.end(i).toFixed(3),"]");return t}},Ar={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},wr=function(e){(0,d.default)(r,e);var t=(0,h.default)(r);function r(e,i,n,a,o){var l;return(0,p.default)(this,r),l=t.call(this),l.hls=void 0,l.fragPrevious=null,l.fragCurrent=null,l.fragmentTracker=void 0,l.transmuxer=null,l._state=Ar.STOPPED,l.playlistType=void 0,l.media=null,l.mediaBuffer=null,l.config=void 0,l.bitrateTest=!1,l.lastCurrentTime=0,l.nextLoadPosition=0,l.startPosition=0,l.startTimeOffset=null,l.loadedmetadata=!1,l.retryDate=0,l.levels=null,l.fragmentLoader=void 0,l.keyLoader=void 0,l.levelLastLoaded=null,l.startFragRequested=!1,l.decrypter=void 0,l.initPTS=[],l.onvseeking=null,l.onvended=null,l.logPrefix="",l.log=void 0,l.warn=void 0,l.playlistType=o,l.logPrefix=a,l.log=P.log.bind(P,"".concat(a,":")),l.warn=P.warn.bind(P,"".concat(a,":")),l.hls=e,l.fragmentLoader=new ar(e.config),l.keyLoader=n,l.fragmentTracker=i,l.config=e.config,l.decrypter=new Er(e.config),e.on(A.MANIFEST_LOADED,l.onManifestLoaded,(0,s.default)(l)),l}return(0,g.default)(r,[{key:"doTick",value:function(){this.onTickEnd()}},{key:"onTickEnd",value:function(){}},{key:"startLoad",value:function(e){}},{key:"stopLoad",value:function(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Ar.STOPPED}},{key:"_streamEnded",value:function(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;var r=t.partList;if(null!=r&&r.length){var i=r[r.length-1],n=hr.isBuffered(this.media,i.start+i.duration/2);return n}var a=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(a)}},{key:"getLevelDetails",value:function(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levels[this.levelLastLoaded])?void 0:e.details}},{key:"onMediaAttached",value:function(e,t){var r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.state===Ar.STOPPED&&this.startLoad(i.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}},{key:"onMediaSeeking",value:function(){var e=this.config,t=this.fragCurrent,r=this.media,i=this.mediaBuffer,n=this.state,a=r?r.currentTime:0,o=hr.bufferInfo(i||r,a,e.maxBufferHole);if(this.log("media seeking to ".concat(k(a)?a.toFixed(3):a,", state: ").concat(n)),this.state===Ar.ENDED)this.resetLoadingState();else if(t){var s=e.maxFragLookUpTolerance,l=t.start-s,u=t.start+t.duration+s;if(!o.len||u<o.start||l>o.end){var c=a>u;(a<l||c)&&(c&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}r&&(this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0),this.lastCurrentTime=a),this.loadedmetadata||o.len||(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoaded",value:function(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}},{key:"onHandlerDestroying",value:function(){this.stopLoad(),(0,u.default)((0,c.default)(r.prototype),"onHandlerDestroying",this).call(this)}},{key:"onHandlerDestroyed",value:function(){this.state=Ar.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,(0,u.default)((0,c.default)(r.prototype),"onHandlerDestroyed",this).call(this)}},{key:"loadFragment",value:function(e,t,r){this._loadFragForPlayback(e,t,r)}},{key:"_loadFragForPlayback",value:function(e,t,r){var i=this;this._doFragLoad(e,t,r,(function(t){if(i.fragContextChanged(e))return i.warn("Fragment ".concat(e.sn).concat(t.part?" p: "+t.part.index:""," of level ").concat(e.level," was dropped during download.")),void i.fragmentTracker.removeFragment(e);e.stats.chunkCount++,i._handleFragmentLoadProgress(t)})).then((function(t){if(t){var r=i.state;i.fragContextChanged(e)?(r===Ar.FRAG_LOADING||!i.fragCurrent&&r===Ar.PARSING)&&(i.fragmentTracker.removeFragment(e),i.state=Ar.IDLE):("payload"in t&&(i.log("Loaded fragment ".concat(e.sn," of level ").concat(e.level)),i.hls.trigger(A.FRAG_LOADED,t)),i._handleFragmentLoadComplete(t))}})).catch((function(t){i.state!==Ar.STOPPED&&i.state!==Ar.ERROR&&(i.warn(t),i.resetFragmentLoading(e))}))}},{key:"clearTrackerIfNeeded",value:function(e){var t,r=this.fragmentTracker,i=r.getState(e);if(i===er.APPENDING){var n=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,n),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength);this.reduceMaxBufferLength(o)&&r.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===er.PARTIAL&&r.removeFragment(e))}},{key:"flushMainBuffer",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e-t){var i={startOffset:e,endOffset:t,type:r};this.hls.trigger(A.BUFFER_FLUSHING,i)}}},{key:"_loadInitSegment",value:function(e,t){var r=this;this._doFragLoad(e,t).then((function(t){if(!t||r.fragContextChanged(e)||!r.levels)throw new Error("init load aborted");return t})).then((function(t){var i=r.hls,n=t.payload,a=e.decryptdata;if(n&&n.byteLength>0&&a&&a.key&&a.iv&&"AES-128"===a.method){var o=self.performance.now();return r.decrypter.decrypt(new Uint8Array(n),a.key.buffer,a.iv.buffer).catch((function(t){throw i.trigger(A.ERROR,{type:w.MEDIA_ERROR,details:x.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t})).then((function(r){var n=self.performance.now();return i.trigger(A.FRAG_DECRYPTED,{frag:e,payload:r,stats:{tstart:o,tdecrypt:n}}),t.payload=r,t}))}return t})).then((function(i){var n=r.fragCurrent,a=r.hls,o=r.levels;if(!o)throw new Error("init load aborted, missing levels");var s=e.stats;r.state=Ar.IDLE,t.fragmentError=0,e.data=new Uint8Array(i.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),i.frag===n&&a.trigger(A.FRAG_BUFFERED,{stats:s,frag:n,part:null,id:e.type}),r.tick()})).catch((function(t){r.state!==Ar.STOPPED&&r.state!==Ar.ERROR&&(r.warn(t),r.resetFragmentLoading(e))}))}},{key:"fragContextChanged",value:function(e){var t=this.fragCurrent;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId}},{key:"fragBufferedComplete",value:function(e,t){var r,i,n,a,o=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered ".concat(e.type," sn: ").concat(e.sn).concat(t?" part: "+t.index:""," of ").concat(this.playlistType===dt.MAIN?"level":"track"," ").concat(e.level," (frag:[").concat((null!=(r=e.startPTS)?r:NaN).toFixed(3),"-").concat((null!=(i=e.endPTS)?i:NaN).toFixed(3),"] > buffer:").concat(o?kr.toString(hr.getBuffered(o)):"(detached)",")")),this.state=Ar.IDLE,o&&(!this.loadedmetadata&&e.type==dt.MAIN&&o.buffered.length&&(null==(n=this.fragCurrent)?void 0:n.sn)===(null==(a=this.fragPrevious)?void 0:a.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}},{key:"seekToStartPos",value:function(){}},{key:"_handleFragmentLoadComplete",value:function(e){var t=this.transmuxer;if(t){var r=e.frag,i=e.part,n=e.partsLoaded,a=!n||0===n.length||n.some((function(e){return!e})),o=new fr(r.level,r.sn,r.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(o)}}},{key:"_handleFragmentLoadProgress",value:function(e){}},{key:"_doFragLoad",value:function(e,t){var r,i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3?arguments[3]:void 0,s=null==t?void 0:t.details;if(!this.levels||!s)throw new Error("frag load aborted, missing level".concat(s?"":" detail","s"));var l=null;if(!e.encrypted||null!=(r=e.decryptdata)&&r.key?!e.encrypted&&s.encryptedFragments.length&&this.keyLoader.loadClear(e,s.encryptedFragments):(this.log("Loading key for ".concat(e.sn," of [").concat(s.startSN,"-").concat(s.endSN,"], ").concat("[stream-controller]"===this.logPrefix?"level":"track"," ").concat(e.level)),this.state=Ar.KEY_LOADING,this.fragCurrent=e,l=this.keyLoader.load(e).then((function(e){if(!i.fragContextChanged(e.frag))return i.hls.trigger(A.KEY_LOADED,e),i.state===Ar.KEY_LOADING&&(i.state=Ar.IDLE),e})),this.hls.trigger(A.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(l=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),n=Math.max(e.start,n||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){var u=s.partList;if(u&&a){n>e.end&&s.fragmentHint&&(e=s.fragmentHint);var c=this.getNextPart(u,e,n);if(c>-1){var d,h=u[c];return this.log("Loading part sn: ".concat(e.sn," p: ").concat(h.index," cc: ").concat(e.cc," of playlist [").concat(s.startSN,"-").concat(s.endSN,"] parts [0-").concat(c,"-").concat(u.length-1,"] ").concat("[stream-controller]"===this.logPrefix?"level":"track",": ").concat(e.level,", target: ").concat(parseFloat(n.toFixed(3)))),this.nextLoadPosition=h.start+h.duration,this.state=Ar.FRAG_LOADING,d=l?l.then((function(r){return!r||i.fragContextChanged(r.frag)?null:i.doFragPartsLoad(e,h,t,a)})).catch((function(e){return i.handleFragLoadError(e)})):this.doFragPartsLoad(e,h,t,a).catch((function(e){return i.handleFragLoadError(e)})),this.hls.trigger(A.FRAG_LOADING,{frag:e,part:h,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):d}if(!e.url||this.loadedEndOfParts(u,n))return Promise.resolve(null)}}this.log("Loading fragment ".concat(e.sn," cc: ").concat(e.cc," ").concat(s?"of ["+s.startSN+"-"+s.endSN+"] ":"").concat("[stream-controller]"===this.logPrefix?"level":"track",": ").concat(e.level,", target: ").concat(parseFloat(n.toFixed(3)))),k(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Ar.FRAG_LOADING;var f,p=this.config.progressive;return f=p&&l?l.then((function(t){return!t||i.fragContextChanged(null==t?void 0:t.frag)?null:i.fragmentLoader.load(e,a)})).catch((function(e){return i.handleFragLoadError(e)})):Promise.all([this.fragmentLoader.load(e,p?a:void 0),l]).then((function(e){var t=(0,o.default)(e,1),r=t[0];return!p&&r&&a&&a(r),r})).catch((function(e){return i.handleFragLoadError(e)})),this.hls.trigger(A.FRAG_LOADING,{frag:e,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):f}},{key:"doFragPartsLoad",value:function(e,t,r,i){var n=this;return new Promise((function(a,o){var s,l=[],u=null==(s=r.details)?void 0:s.partList;(function t(s){n.fragmentLoader.loadPart(e,s,i).then((function(i){l[s.index]=i;var o=i.part;n.hls.trigger(A.FRAG_LOADED,i);var c=Mt(r,e.sn,s.index+1)||Nt(u,e.sn,s.index+1);if(!c)return a({frag:e,part:o,partsLoaded:l});t(c)})).catch(o)})(t)}))}},{key:"handleFragLoadError",value:function(e){if("data"in e){var t=e.data;e.data&&t.details===x.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(A.ERROR,t)}else this.hls.trigger(A.ERROR,{type:w.OTHER_ERROR,details:x.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}},{key:"_handleTransmuxerFlush",value:function(e){var t=this.getCurrentContext(e);if(t&&this.state===Ar.PARSING){var r=t.frag,i=t.part,n=t.level,a=self.performance.now();r.stats.parsing.end=a,i&&(i.stats.parsing.end=a),this.updateLevelTiming(r,i,n,e.partial)}else this.fragCurrent||this.state===Ar.STOPPED||this.state===Ar.ERROR||(this.state=Ar.IDLE)}},{key:"getCurrentContext",value:function(e){var t=this.levels,r=this.fragCurrent,i=e.level,n=e.sn,a=e.part;if(null==t||!t[i])return this.warn("Levels object was unset while buffering fragment ".concat(n," of level ").concat(i,". The current chunk will not be buffered.")),null;var o=t[i],s=a>-1?Mt(o,n,a):null,l=s?s.fragment:function(e,t,r){if(null==e||!e.details)return null;var i=e.details,n=i.fragments[t-i.startSN];return n||(n=i.fragmentHint,n&&n.sn===t?n:t<i.startSN&&r&&r.sn===t?r:null)}(o,n,r);return l?(r&&r!==l&&(l.stats=r.stats),{frag:l,part:s,level:o}):null}},{key:"bufferFragmentData",value:function(e,t,r,i){var n;if(e&&this.state===Ar.PARSING){var a=e.data1,o=e.data2,s=a;if(a&&o&&(s=Pe(a,o)),null!=(n=s)&&n.length){var l={type:e.type,frag:t,part:r,chunkMeta:i,parent:t.type,data:s};this.hls.trigger(A.BUFFER_APPENDING,l),e.dropped&&e.independent&&!r&&this.flushBufferGap(t)}}}},{key:"flushBufferGap",value:function(e){var t=this.media;if(t)if(hr.isBuffered(t,t.currentTime)){var r=t.currentTime,i=hr.bufferInfo(t,r,0),n=e.duration,a=Math.min(2*this.config.maxFragLookUpTolerance,.25*n),o=Math.max(Math.min(e.start-a,i.end-a),r+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}else this.flushMainBuffer(0,e.start)}},{key:"getFwdBufferInfo",value:function(e,t){var r=this.getLoadPosition();return k(r)?this.getFwdBufferInfoAtPos(e,r,t):null}},{key:"getFwdBufferInfoAtPos",value:function(e,t,r){var i=this.config.maxBufferHole,n=hr.bufferInfo(e,t,i);if(0===n.len&&void 0!==n.nextStart){var a=this.fragmentTracker.getBufferedFrag(t,r);if(a&&n.nextStart<a.end)return hr.bufferInfo(e,t,Math.max(n.nextStart,i))}return n}},{key:"getMaxBufferLength",value:function(e){var t,r=this.config;return t=e?Math.max(8*r.maxBufferSize/e,r.maxBufferLength):r.maxBufferLength,Math.min(t,r.maxMaxBufferLength)}},{key:"reduceMaxBufferLength",value:function(e){var t=this.config,r=e||t.maxBufferLength;return t.maxMaxBufferLength>=r&&(t.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to ".concat(t.maxMaxBufferLength,"s")),!0)}},{key:"getAppendedFrag",value:function(e){var t=this.fragmentTracker.getAppendedFrag(e,dt.MAIN);return t&&"fragment"in t?t.fragment:t}},{key:"getNextFragment",value:function(e,t){var r=t.fragments,i=r.length;if(!i)return null;var n,a=this.config,o=r[0].start;if(t.live){var s=a.initialLiveManifestSize;if(i<s)return this.warn("Not enough fragments to start playback (have: ".concat(i,", need: ").concat(s,")")),null;t.PTSKnown||this.startFragRequested||-1!==this.startPosition||(n=this.getInitialLiveFragment(t,r),this.startPosition=n?this.hls.liveSyncPosition||n.start:e)}else e<=o&&(n=r[0]);if(!n){var l=a.lowLatencyMode?t.partEnd:t.fragmentEnd;n=this.getFragmentAtPosition(e,l,t)}return this.mapToInitFragWhenRequired(n)}},{key:"isLoopLoading",value:function(e,t){var r=this.fragmentTracker.getState(e);return(r===er.OK||r===er.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}},{key:"getNextFragmentLoopLoading",value:function(e,t,r,i,n){var a=e.gap,o=this.getNextFragment(this.nextLoadPosition,t);if(null===o)return o;if(e=o,a&&e&&!e.gap&&r.nextStart){var s=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,i);if(null!==s&&r.len+s.len>=n)return this.log('buffer full after gaps in "'.concat(i,'" playlist starting at sn: ').concat(e.sn)),null}return e}},{key:"mapToInitFragWhenRequired",value:function(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}},{key:"getNextPart",value:function(e,t,r){for(var i=-1,n=!1,a=!0,o=0,s=e.length;o<s;o++){var l=e[o];if(a=a&&!l.independent,i>-1&&r<l.start)break;var u=l.loaded;u?i=-1:(n||l.independent||a)&&l.fragment===t&&(i=o),n=u}return i}},{key:"loadedEndOfParts",value:function(e,t){var r=e[e.length-1];return r&&t>r.start&&r.loaded}},{key:"getInitialLiveFragment",value:function(e,t){var r=this.fragPrevious,i=null;if(r){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: ".concat(r.programDateTime)),i=function(e,t,r){if(null===t||!Array.isArray(e)||!e.length||!k(t))return null;var i=e[0].programDateTime;if(t<(i||0))return null;var n=e[e.length-1].endProgramDateTime;if(t>=(n||0))return null;r=r||0;for(var a=0;a<e.length;++a){var o=e[a];if(qt(t,r,o))return o}return null}(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){var n=r.sn+1;if(n>=e.startSN&&n<=e.endSN){var a=t[n-e.startSN];r.cc===a.cc&&(i=a,this.log("Live playlist, switching playlist, load frag with next SN: ".concat(i.sn)))}i||(i=function(e,t){return jt.search(e,(function(e){return e.cc<t?1:e.cc>t?-1:0}))}(t,r.cc),i&&this.log("Live playlist, switching playlist, load frag with same CC: ".concat(i.sn)))}}else{var o=this.hls.liveSyncPosition;null!==o&&(i=this.getFragmentAtPosition(o,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}},{key:"getFragmentAtPosition",value:function(e,t,r){var i,n=this.config,a=this.fragPrevious,o=r.fragments,s=r.endSN,l=r.fragmentHint,u=n.maxFragLookUpTolerance,c=r.partList,d=!!(n.lowLatencyMode&&null!=c&&c.length&&l);if(d&&l&&!this.bitrateTest&&(o=o.concat(l),s=l.sn),e<t){var h=e>t-u?0:u;i=Gt(a,o,e,h)}else i=o[o.length-1];if(i){var f=i.sn-r.startSN,p=this.fragmentTracker.getState(i);if((p===er.OK||p===er.PARTIAL&&i.gap)&&(a=i),a&&i.sn===a.sn&&(!d||c[0].fragment.sn>i.sn)){var g=a&&i.level===a.level;if(g){var v=o[f+1];i=i.sn<s&&this.fragmentTracker.getState(v)!==er.OK?v:null}}}return i}},{key:"synchronizeToLiveEdge",value:function(e){var t=this.config,r=this.media;if(r){var i=this.hls.liveSyncPosition,n=r.currentTime,a=e.fragments[0].start,o=e.edge,s=n>=a-t.maxFragLookUpTolerance&&n<=o;if(null!==i&&r.duration>i&&(n<i||!s)){var l=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!s&&r.readyState<4||n<o-l)&&(this.loadedmetadata||(this.nextLoadPosition=i),r.readyState&&(this.warn("Playback: ".concat(n.toFixed(3)," is located too far from the end of live sliding playlist: ").concat(o,", reset currentTime to : ").concat(i.toFixed(3))),r.currentTime=i))}}}},{key:"alignPlaylists",value:function(e,t){var r=this.levels,i=this.levelLastLoaded,n=this.fragPrevious,a=null!==i?r[i]:null,o=e.fragments.length;if(!o)return this.warn("No fragments in live playlist"),0;var s=e.fragments[0].start,l=!t,u=e.alignedSliding&&k(s);if(l||!u&&!s){mr(n,a,e);var c=e.fragments[0].start;return this.log("Live playlist sliding: ".concat(c.toFixed(2)," start-sn: ").concat(t?t.startSN:"na","->").concat(e.startSN," prev-sn: ").concat(n?n.sn:"na"," fragments: ").concat(o)),c}return s}},{key:"waitForCdnTuneIn",value:function(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}},{key:"setStartPosition",value:function(e,t){var r=this.startPosition;if(r<t&&(r=-1),-1===r||-1===this.lastCurrentTime){var i=null!==this.startTimeOffset,n=i?this.startTimeOffset:e.startTimeOffset;null!==n&&k(n)?(r=t+n,n<0&&(r+=e.totalduration),r=Math.min(Math.max(t,r),t+e.totalduration),this.log("Start time offset ".concat(n," found in ").concat(i?"multivariant":"media"," playlist, adjust startPosition to ").concat(r)),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r}},{key:"getLoadPosition",value:function(){var e=this.media,t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}},{key:"handleFragLoadAborted",value:function(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn("Fragment ".concat(e.sn).concat(t?" part "+t.index:""," of level ").concat(e.level," was aborted")),this.resetFragmentLoading(e))}},{key:"resetFragmentLoading",value:function(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===Ar.FRAG_LOADING_WAITING_RETRY)||(this.state=Ar.IDLE)}},{key:"onFragmentOrKeyLoadError",value:function(e,t){if(t.chunkMeta&&!t.frag){var r=this.getCurrentContext(t.chunkMeta);r&&(t.frag=r.frag)}var i=t.frag;if(i&&i.type===e&&this.levels)if(this.fragContextChanged(i)){var n;this.warn("Frag load error must match current frag to retry ".concat(i.url," > ").concat(null==(n=this.fragCurrent)?void 0:n.url))}else{var a=t.details===x.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(i,!0);var o=t.errorAction,s=o||{},l=s.action,u=s.retryCount,c=void 0===u?0:u,d=s.retryConfig;if(o&&l===Wt.RetryRequest&&d){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var h=Bt(d,c);this.warn("Fragment ".concat(i.sn," of ").concat(e," ").concat(i.level," errored with ").concat(t.details,", retrying loading ").concat(c+1,"/").concat(d.maxNumRetry," in ").concat(h,"ms")),o.resolved=!0,this.retryDate=self.performance.now()+h,this.state=Ar.FRAG_LOADING_WAITING_RETRY}else d&&o?(this.resetFragmentErrors(e),c<d.maxNumRetry?a||(o.resolved=!0):P.warn("".concat(t.details," reached or exceeded max retry (").concat(c,")"))):this.state=Ar.ERROR;this.tickImmediate()}}},{key:"reduceLengthAndFlushBuffer",value:function(e){if(this.state===Ar.PARSING||this.state===Ar.PARSED){var t=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,t),i=r&&r.len>.5;i&&this.reduceMaxBufferLength(r.len);var n=!i;return n&&this.warn("Buffer full error while media.currentTime is not buffered, flush ".concat(t," buffer")),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),n}return!1}},{key:"resetFragmentErrors",value:function(e){e===dt.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==Ar.STOPPED&&(this.state=Ar.IDLE)}},{key:"afterBufferFlushed",value:function(e,t,r){if(e){var i=hr.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,r),this.state===Ar.ENDED&&this.resetLoadingState()}}},{key:"resetLoadingState",value:function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=Ar.IDLE}},{key:"resetStartWhenNotLoaded",value:function(e){if(!this.loadedmetadata){this.startFragRequested=!1;var t=this.levels?this.levels[e].details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}},{key:"resetWhenMissingContext",value:function(e){this.warn("The loading context changed while buffering fragment ".concat(e.sn," of level ").concat(e.level,". This chunk will not be buffered.")),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(e.level),this.resetLoadingState()}},{key:"removeUnbufferedFrags",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}},{key:"updateLevelTiming",value:function(e,t,r,i){var n,a=this,o=r.details;if(o){var s=Object.keys(e.elementaryStreams).reduce((function(t,n){var s=e.elementaryStreams[n];if(s){var l=s.endPTS-s.startPTS;if(l<=0)return a.warn("Could not parse fragment ".concat(e.sn," ").concat(n," duration reliably (").concat(l,")")),t||!1;var u=i?0:Ct(o,e,s.startPTS,s.endPTS,s.startDTS,s.endDTS);return a.hls.trigger(A.LEVEL_PTS_UPDATED,{details:o,level:r,drift:u,type:n,frag:e,start:s.startPTS,end:s.endPTS}),!0}return t}),!1);if(s)r.fragmentError=0;else if(null===(null==(n=this.transmuxer)?void 0:n.error)){var l=new Error("Found no media in fragment ".concat(e.sn," of level ").concat(r.id," resetting transmuxer to fallback to playlist timing"));if(this.warn(l.message),this.hls.trigger(A.ERROR,{type:w.MEDIA_ERROR,details:x.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:"Found no media in msn ".concat(e.sn,' of level "').concat(r.url,'"')}),!this.hls)return;this.resetTransmuxer()}this.state=Ar.PARSED,this.hls.trigger(A.FRAG_PARSED,{frag:e,part:t})}else this.warn("level.details undefined")}},{key:"resetTransmuxer",value:function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}},{key:"recoverWorkerError",value:function(e){"demuxerWorker"===e.event&&(this.resetTransmuxer(),this.resetLoadingState())}},{key:"state",get:function(){return this._state},set:function(e){var t=this._state;t!==e&&(this._state=e,this.log("".concat(t,"->").concat(e)))}}]),r}(cr);function xr(){return self.SourceBuffer||self.WebKitSourceBuffer}function Rr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}var Lr=function(){function e(){(0,p.default)(this,e),this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}return(0,g.default)(e,[{key:"resetInitSegment",value:function(e,t,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}},{key:"resetTimeStamp",value:function(e){this.initPTS=e,this.resetContiguity()}},{key:"resetContiguity",value:function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}},{key:"canParse",value:function(e,t){return!1}},{key:"appendFrame",value:function(e,t,r){}},{key:"demux",value:function(e,t){this.cachedData&&(e=Pe(this.cachedData,e),this.cachedData=null);var r,i=oe(e,0),n=i?i.length:0,a=this._audioTrack,o=this._id3Track,s=i?function(e){for(var t=de(e),r=0;r<t.length;r++){var i=t[r];if(ue(i))return ve(i)}}(i):void 0,l=e.length;(null===this.basePTS||0===this.frameIndex&&k(s))&&(this.basePTS=Ir(s,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),i&&i.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:_t.audioId3,duration:Number.POSITIVE_INFINITY});while(n<l){if(this.canParse(e,n)){var u=this.appendFrame(a,e,n);u?(this.frameIndex++,this.lastPTS=u.sample.pts,n+=u.length,r=n):n=l}else le(e,n)?(i=oe(e,n),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:_t.audioId3,duration:Number.POSITIVE_INFINITY}),n+=i.length,r=n):n++;if(n===l&&r!==l){var c=re(e,r);this.cachedData?this.cachedData=Pe(this.cachedData,c):this.cachedData=c}}return{audioTrack:a,videoTrack:Rr(),id3Track:o,textTrack:Rr()}}},{key:"demuxSampleAes",value:function(e,t,r){return Promise.reject(new Error("[".concat(this,"] This demuxer does not support Sample-AES decryption")))}},{key:"flush",value:function(e){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Rr(),id3Track:this._id3Track,textTrack:Rr()}}},{key:"destroy",value:function(){}}]),e}(),Ir=function(e,t,r){if(k(e))return 90*e;var i=r?9e4*r.baseTime/r.timescale:0;return 9e4*t+i};function Cr(e,t){return 255===e[t]&&240===(246&e[t+1])}function Dr(e,t){return 1&e[t+1]?7:9}function Pr(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function Or(e,t){return t+1<e.length&&Cr(e,t)}function Mr(e,t){if(Or(e,t)){var r=Dr(e,t);if(t+r>=e.length)return!1;var i=Pr(e,t);if(i<=r)return!1;var n=t+i;return n===e.length||Or(e,n)}return!1}function Nr(e,t,r,i,n){if(!e.samplerate){var a=function(e,t,r,i){var n,a,o,s,l=navigator.userAgent.toLowerCase(),u=i,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];n=1+((192&t[r+2])>>>6);var d=(60&t[r+2])>>>2;if(!(d>c.length-1))return o=(1&t[r+2])<<2,o|=(192&t[r+3])>>>6,P.log("manifest codec:".concat(i,", ADTS type:").concat(n,", samplingIndex:").concat(d)),/firefox/i.test(l)?d>=6?(n=5,s=new Array(4),a=d-3):(n=2,s=new Array(2),a=d):-1!==l.indexOf("android")?(n=2,s=new Array(2),a=d):(n=5,s=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&d>=6?a=d-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(d>=6&&1===o||/vivaldi/i.test(l))||!i&&1===o)&&(n=2,s=new Array(2)),a=d)),s[0]=n<<3,s[0]|=(14&d)>>1,s[1]|=(1&d)<<7,s[1]|=o<<3,5===n&&(s[1]|=(14&a)>>1,s[2]=(1&a)<<7,s[2]|=8,s[3]=0),{config:s,samplerate:c[d],channelCount:o,codec:"mp4a.40."+n,manifestCodec:u};e.trigger(A.ERROR,{type:w.MEDIA_ERROR,details:x.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:".concat(d)})}(t,r,i,n);if(!a)return;e.config=a.config,e.samplerate=a.samplerate,e.channelCount=a.channelCount,e.codec=a.codec,e.manifestCodec=a.manifestCodec,P.log("parsed codec:".concat(e.codec,", rate:").concat(a.samplerate,", channels:").concat(a.channelCount))}}function Fr(e){return 9216e4/e}function Ur(e,t,r,i,n){var a,o=Fr(e.samplerate),s=i+n*o,l=function(e,t){var r=Dr(e,t);if(t+r<=e.length){var i=Pr(e,t)-r;if(i>0)return{headerLength:r,frameLength:i}}}(t,r);if(l){var u=l.frameLength,c=l.headerLength,d=c+u,h=Math.max(0,r+d-t.length);h?(a=new Uint8Array(d-c),a.set(t.subarray(r+c,t.length),0)):a=t.subarray(r+c,r+d);var f={unit:a,pts:s};return h||e.samples.push(f),{sample:f,length:d,missing:h}}var p=t.length-r;a=new Uint8Array(p),a.set(t.subarray(r,t.length),0);var g={unit:a,pts:s};return{sample:g,length:p,missing:-1}}var Br=function(e){(0,d.default)(r,e);var t=(0,h.default)(r);function r(e,i){var n;return(0,p.default)(this,r),n=t.call(this),n.observer=void 0,n.config=void 0,n.observer=e,n.config=i,n}return(0,g.default)(r,[{key:"resetInitSegment",value:function(e,t,i,n){(0,u.default)((0,c.default)(r.prototype),"resetInitSegment",this).call(this,e,t,i,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}},{key:"canParse",value:function(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&Cr(e,t)&&Pr(e,t)<=e.length-t}(e,t)}},{key:"appendFrame",value:function(e,t,r){Nr(e,this.observer,t,r,e.manifestCodec);var i=Ur(e,t,r,this.basePTS,this.frameIndex);if(i&&0===i.missing)return i}}],[{key:"probe",value:function(e){if(!e)return!1;for(var t=oe(e,0)||[],r=t.length,i=e.length;r<i;r++)if(Mr(e,r))return P.log("ADTS sync word found !"),!0;return!1}}]),r}(Lr),Hr=/\/emsg[-/]ID3/i,Vr=function(){function e(t,r){(0,p.default)(this,e),this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=r}return(0,g.default)(e,[{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(e,t,r,i){var n=this.videoTrack=Rr("video",1),a=this.audioTrack=Rr("audio",1),o=this.txtTrack=Rr("text",1);if(this.id3Track=Rr("id3",1),this.timeOffset=0,null!=e&&e.byteLength){var s=Ie(e);if(s.video){var l=s.video,u=l.id,c=l.timescale,d=l.codec;n.id=u,n.timescale=o.timescale=c,n.codec=d}if(s.audio){var h=s.audio,f=h.id,p=h.timescale,g=h.codec;a.id=f,a.timescale=p,a.codec=g}o.id=Se.text,n.sampleDuration=0,n.duration=a.duration=i}}},{key:"resetContiguity",value:function(){this.remainderData=null}},{key:"demux",value:function(e,t){this.timeOffset=t;var r=e,i=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Pe(this.remainderData,e));var a=function(e){var t={valid:null,remainder:null},r=Re(e,["moof"]);if(!r)return t;if(r.length<2)return t.remainder=e,t;var i=r[r.length-1];return t.valid=re(e,0,i.byteOffset-8),t.remainder=re(e,i.byteOffset-8),t}(r);this.remainderData=a.remainder,i.samples=a.valid||new Uint8Array}else i.samples=r;var o=this.extractID3Track(i,t);return n.samples=Oe(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}},{key:"flush",value:function(){var e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;var i=this.extractID3Track(t,this.timeOffset);return r.samples=Oe(e,t),{videoTrack:t,audioTrack:Rr(),id3Track:i,textTrack:Rr()}}},{key:"extractID3Track",value:function(e,t){var r=this.id3Track;if(e.samples.length){var i=Re(e.samples,["emsg"]);i&&i.forEach((function(e){var i=function(e){var t=e[0],r="",i="",n=0,a=0,o=0,s=0,l=0,u=0;if(0===t){while("\0"!==Ee(e.subarray(u,u+1)))r+=Ee(e.subarray(u,u+1)),u+=1;r+=Ee(e.subarray(u,u+1)),u+=1;while("\0"!==Ee(e.subarray(u,u+1)))i+=Ee(e.subarray(u,u+1)),u+=1;i+=Ee(e.subarray(u,u+1)),u+=1,n=Ae(e,12),a=Ae(e,16),s=Ae(e,20),l=Ae(e,24),u=28}else if(1===t){u+=4,n=Ae(e,u),u+=4;var c=Ae(e,u);u+=4;var d=Ae(e,u);u+=4,o=Math.pow(2,32)*c+d,Number.isSafeInteger(o)||(o=Number.MAX_SAFE_INTEGER,P.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),s=Ae(e,u),u+=4,l=Ae(e,u),u+=4;while("\0"!==Ee(e.subarray(u,u+1)))r+=Ee(e.subarray(u,u+1)),u+=1;r+=Ee(e.subarray(u,u+1)),u+=1;while("\0"!==Ee(e.subarray(u,u+1)))i+=Ee(e.subarray(u,u+1)),u+=1;i+=Ee(e.subarray(u,u+1)),u+=1}var h=e.subarray(u,e.byteLength);return{schemeIdUri:r,value:i,timeScale:n,presentationTime:o,presentationTimeDelta:a,eventDuration:s,id:l,payload:h}}(e);if(Hr.test(i.schemeIdUri)){var n=k(i.presentationTime)?i.presentationTime/i.timeScale:t+i.presentationTimeDelta/i.timeScale,a=4294967295===i.eventDuration?Number.POSITIVE_INFINITY:i.eventDuration/i.timeScale;a<=.001&&(a=Number.POSITIVE_INFINITY);var o=i.payload;r.samples.push({data:o,len:o.byteLength,dts:n,pts:n,type:_t.emsg,duration:a})}}))}return r}},{key:"demuxSampleAes",value:function(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(e){return e=e.length>16384?e.subarray(0,16384):e,Re(e,["moof"]).length>0}}]),e}(),jr=null,Gr=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Kr=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],qr=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Wr=[0,1,1,4];function Yr(e,t,r,i,n){if(!(r+24>t.length)){var a=zr(t,r);if(a&&r+a.frameLength<=t.length){var o=9e4*a.samplesPerFrame/a.sampleRate,s=i+n*o,l={unit:t.subarray(r,r+a.frameLength),pts:s,dts:s};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(l),{sample:l,length:a.frameLength,missing:0}}}}function zr(e,t){var r=e[t+1]>>3&3,i=e[t+1]>>1&3,n=e[t+2]>>4&15,a=e[t+2]>>2&3;if(1!==r&&0!==n&&15!==n&&3!==a){var o=e[t+2]>>1&1,s=e[t+3]>>6,l=3===r?3-i:3===i?3:4,u=1e3*Gr[14*l+n-1],c=3===r?0:2===r?1:2,d=Kr[3*c+a],h=3===s?1:2,f=qr[r][i],p=Wr[i],g=8*f*p,v=Math.floor(f*u/d+o)*p;if(null===jr){var y=navigator.userAgent||"",m=y.match(/Chrome\/(\d+)/i);jr=m?parseInt(m[1]):0}var _=!!jr&&jr<=87;return _&&2===i&&u>=224e3&&0===s&&(e[t+3]=128|e[t+3]),{sampleRate:d,channelCount:h,frameLength:v,samplesPerFrame:g}}}function Xr(e,t){return 255===e[t]&&224===(224&e[t+1])&&0!==(6&e[t+1])}function Qr(e,t){return t+1<e.length&&Xr(e,t)}function Jr(e,t){if(t+1<e.length&&Xr(e,t)){var r=zr(e,t),i=4;null!=r&&r.frameLength&&(i=r.frameLength);var n=t+i;return n===e.length||Qr(e,n)}return!1}var Zr=function(){function e(t){(0,p.default)(this,e),this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return(0,g.default)(e,[{key:"loadWord",value:function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),n=Math.min(4,t);if(0===n)throw new Error("no bytes available");i.set(e.subarray(r,r+n)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n}},{key:"skipBits",value:function(e){var t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;if(e>32&&P.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){for(var t,r=8,i=8,n=0;n<e;n++)0!==i&&(t=this.readEG(),i=(r+t+256)%256),r=0===i?r:i}},{key:"readSPS",value:function(){var e,t,r,i=0,n=0,a=0,o=0,s=this.readUByte.bind(this),l=this.readBits.bind(this),u=this.readUEG.bind(this),c=this.readBoolean.bind(this),d=this.skipBits.bind(this),h=this.skipEG.bind(this),f=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);s();var g=s();if(l(5),d(3),s(),f(),100===g||110===g||122===g||244===g||44===g||83===g||86===g||118===g||128===g){var v=u();if(3===v&&d(1),f(),f(),d(1),c())for(t=3!==v?8:12,r=0;r<t;r++)c()&&p(r<6?16:64)}f();var y=u();if(0===y)u();else if(1===y)for(d(1),h(),h(),e=u(),r=0;r<e;r++)h();f(),d(1);var m=u(),_=u(),b=l(1);0===b&&d(1),d(1),c()&&(i=u(),n=u(),a=u(),o=u());var T=[1,1];if(c()&&c()){var S=s();switch(S){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[s()<<8|s(),s()<<8|s()];break}}return{width:Math.ceil(16*(m+1)-2*i-2*n),height:(2-b)*(_+1)*16-(b?2:4)*(a+o),pixelRatio:T}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}(),$r=function(){function e(t,r,i){(0,p.default)(this,e),this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new Er(r,{removePKCS7Padding:!1})}return(0,g.default)(e,[{key:"decryptBuffer",value:function(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}},{key:"decryptAacSample",value:function(e,t,r){var i=this,n=e[t].unit;if(!(n.length<=16)){var a=n.subarray(16,n.length-n.length%16),o=a.buffer.slice(a.byteOffset,a.byteOffset+a.length);this.decryptBuffer(o).then((function(a){var o=new Uint8Array(a);n.set(o,16),i.decrypter.isSync()||i.decryptAacSamples(e,t+1,r)}))}}},{key:"decryptAacSamples",value:function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}},{key:"getAvcEncryptedData",value:function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),i=0,n=32;n<e.length-16;n+=160,i+=16)r.set(e.subarray(n,n+16),i);return r}},{key:"getAvcDecryptedUnit",value:function(e,t){for(var r=new Uint8Array(t),i=0,n=32;n<e.length-16;n+=160,i+=16)e.set(r.subarray(i,i+16),n);return e}},{key:"decryptAvcSample",value:function(e,t,r,i,n){var a=this,o=Fe(n.data),s=this.getAvcEncryptedData(o);this.decryptBuffer(s.buffer).then((function(s){n.data=a.getAvcDecryptedUnit(o,s),a.decrypter.isSync()||a.decryptAvcSamples(e,t,r+1,i)}))}},{key:"decryptAvcSamples",value:function(e,t,r,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void i();for(var n=e[t].units;;r++){if(r>=n.length)break;var a=n[r];if(!(a.data.length<=48||1!==a.type&&5!==a.type)&&(this.decryptAvcSample(e,t,r,i,a),!this.decrypter.isSync()))return}}}}]),e}(),ei=function(){function e(t,r,i){(0,p.default)(this,e),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=r,this.typeSupported=i}return(0,g.default)(e,[{key:"resetInitSegment",value:function(t,r,i,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video"),this._audioTrack=e.createTrack("audio",n),this._id3Track=e.createTrack("id3"),this._txtTrack=e.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=r,this.videoCodec=i,this._duration=n}},{key:"resetTimeStamp",value:function(){}},{key:"resetContiguity",value:function(){var e=this._audioTrack,t=this._avcTrack,r=this._id3Track;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}},{key:"demux",value:function(t,r){var i,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n||(this.sampleAes=null);var o=this._avcTrack,s=this._audioTrack,l=this._id3Track,u=this._txtTrack,c=o.pid,d=o.pesData,h=s.pid,f=l.pid,p=s.pesData,g=l.pesData,v=null,y=this.pmtParsed,m=this._pmtId,_=t.length;if(this.remainderData&&(t=Pe(this.remainderData,t),_=t.length,this.remainderData=null),_<188&&!a)return this.remainderData=t,{audioTrack:s,videoTrack:o,id3Track:l,textTrack:u};var b=Math.max(0,e.syncOffset(t));_-=(_-b)%188,_<t.byteLength&&!a&&(this.remainderData=new Uint8Array(t.buffer,_,t.buffer.byteLength-_));for(var T=0,S=b;S<_;S+=188)if(71===t[S]){var E=!!(64&t[S+1]),k=ri(t,S),R=(48&t[S+3])>>4,L=void 0;if(R>1){if(L=S+5+t[S+4],L===S+188)continue}else L=S+4;switch(k){case c:E&&(d&&(i=ai(d))&&this.parseAVCPES(o,u,i,!1),d={data:[],size:0}),d&&(d.data.push(t.subarray(L,S+188)),d.size+=S+188-L);break;case h:if(E){if(p&&(i=ai(p)))switch(s.segmentCodec){case"aac":this.parseAACPES(s,i);break;case"mp3":this.parseMPEGPES(s,i);break}p={data:[],size:0}}p&&(p.data.push(t.subarray(L,S+188)),p.size+=S+188-L);break;case f:E&&(g&&(i=ai(g))&&this.parseID3PES(l,i),g={data:[],size:0}),g&&(g.data.push(t.subarray(L,S+188)),g.size+=S+188-L);break;case 0:E&&(L+=t[L]+1),m=this._pmtId=ii(t,L);break;case m:E&&(L+=t[L]+1);var I=ni(t,L,this.typeSupported,n);c=I.avc,c>0&&(o.pid=c),h=I.audio,h>0&&(s.pid=h,s.segmentCodec=I.segmentCodec),f=I.id3,f>0&&(l.pid=f),null===v||y||(P.warn("MPEG-TS PMT found at ".concat(S," after unknown PID '").concat(v,"'. Backtracking to sync byte @").concat(b," to parse all TS packets.")),v=null,S=b-188),y=this.pmtParsed=!0;break;case 17:case 8191:break;default:v=k;break}}else T++;if(T>0){var C=new Error("Found ".concat(T," TS packet/s that do not start with 0x47"));this.observer.emit(A.ERROR,A.ERROR,{type:w.MEDIA_ERROR,details:x.FRAG_PARSING_ERROR,fatal:!1,error:C,reason:C.message})}o.pesData=d,s.pesData=p,l.pesData=g;var D={audioTrack:s,videoTrack:o,id3Track:l,textTrack:u};return a&&this.extractRemainingSamples(D),D}},{key:"flush",value:function(){var e,t=this.remainderData;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e}},{key:"extractRemainingSamples",value:function(e){var t,r=e.audioTrack,i=e.videoTrack,n=e.id3Track,a=e.textTrack,o=i.pesData,s=r.pesData,l=n.pesData;if(o&&(t=ai(o))?(this.parseAVCPES(i,a,t,!0),i.pesData=null):i.pesData=o,s&&(t=ai(s))){switch(r.segmentCodec){case"aac":this.parseAACPES(r,t);break;case"mp3":this.parseMPEGPES(r,t);break}r.pesData=null}else null!=s&&s.size&&P.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=s;l&&(t=ai(l))?(this.parseID3PES(n,t),n.pesData=null):n.pesData=l}},{key:"demuxSampleAes",value:function(e,t,r){var i=this.demux(e,r,!0,!this.config.progressive),n=this.sampleAes=new $r(this.observer,this.config,t);return this.decrypt(i,n)}},{key:"decrypt",value:function(e,t){return new Promise((function(r){var i=e.audioTrack,n=e.videoTrack;i.samples&&"aac"===i.segmentCodec?t.decryptAacSamples(i.samples,0,(function(){n.samples?t.decryptAvcSamples(n.samples,0,0,(function(){r(e)})):r(e)})):n.samples&&t.decryptAvcSamples(n.samples,0,0,(function(){r(e)}))}))}},{key:"destroy",value:function(){this._duration=0}},{key:"parseAVCPES",value:function(e,t,r,i){var n,a=this,o=this.parseAVCNALu(e,r.data),s=this.avcSample,l=!1;r.data=null,s&&o.length&&!e.audFound&&(oi(s,e),s=this.avcSample=ti(!1,r.pts,r.dts,"")),o.forEach((function(i){switch(i.type){case 1:n=!0,s||(s=a.avcSample=ti(!0,r.pts,r.dts,"")),s.frame=!0;var o=i.data;if(l&&o.length>4){var u=new Zr(o).readSliceType();2!==u&&4!==u&&7!==u&&9!==u||(s.key=!0)}break;case 5:n=!0,s||(s=a.avcSample=ti(!0,r.pts,r.dts,"")),s.key=!0,s.frame=!0;break;case 6:n=!0,Ne(i.data,1,r.pts,t.samples);break;case 7:if(n=!0,l=!0,!e.sps){var c=i.data,d=new Zr(c),h=d.readSPS();e.width=h.width,e.height=h.height,e.pixelRatio=h.pixelRatio,e.sps=[c],e.duration=a._duration;for(var f=c.subarray(1,4),p="avc1.",g=0;g<3;g++){var v=f[g].toString(16);v.length<2&&(v="0"+v),p+=v}e.codec=p}break;case 8:n=!0,e.pps||(e.pps=[i.data]);break;case 9:n=!1,e.audFound=!0,s&&oi(s,e),s=a.avcSample=ti(!1,r.pts,r.dts,"");break;case 12:n=!0;break;default:n=!1,s&&(s.debug+="unknown NAL "+i.type+" ");break}if(s&&n){var y=s.units;y.push(i)}})),i&&s&&(oi(s,e),this.avcSample=null)}},{key:"getLastNalUnit",value:function(e){var t,r,i=this.avcSample;if(i&&0!==i.units.length||(i=e[e.length-1]),null!=(t=i)&&t.units){var n=i.units;r=n[n.length-1]}return r}},{key:"parseAVCNALu",value:function(e,t){var r,i,n,a=t.byteLength,o=e.naluState||0,s=o,l=[],u=0,c=-1,d=0;-1===o&&(c=0,d=31&t[0],o=0,u=1);while(u<a)if(r=t[u++],o)if(1!==o)if(r)if(1===r){if(c>=0){var h={data:t.subarray(c,u-o-1),type:d};l.push(h)}else{var f=this.getLastNalUnit(e.samples);if(f&&(s&&u<=4-s&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-s)),i=u-o-1,i>0)){var p=new Uint8Array(f.data.byteLength+i);p.set(f.data,0),p.set(t.subarray(0,i),f.data.byteLength),f.data=p,f.state=0}}u<a?(n=31&t[u],c=u,d=n,o=0):o=-1}else o=0;else o=3;else o=r?0:2;else o=r?0:1;if(c>=0&&o>=0){var g={data:t.subarray(c,a),type:d,state:o};l.push(g)}if(0===l.length){var v=this.getLastNalUnit(e.samples);if(v){var y=new Uint8Array(v.data.byteLength+t.byteLength);y.set(v.data,0),y.set(t,v.data.byteLength),v.data=y}}return e.naluState=o,l}},{key:"parseAACPES",value:function(e,t){var r,i,n,a=0,o=this.aacOverFlow,s=t.data;if(o){this.aacOverFlow=null;var l=o.missing,u=o.sample.unit.byteLength;if(-1===l){var c=new Uint8Array(u+s.byteLength);c.set(o.sample.unit,0),c.set(s,u),s=c}else{var d=u-l;o.sample.unit.set(s.subarray(0,l),d),e.samples.push(o.sample),a=o.missing}}for(r=a,i=s.length;r<i-1;r++)if(Or(s,r))break;if(r!==a){var h,f=r<i-1;h=f?"AAC PES did not start with ADTS header,offset:".concat(r):"No ADTS header found in AAC PES";var p=new Error(h);if(P.warn("parsing error: ".concat(h)),this.observer.emit(A.ERROR,A.ERROR,{type:w.MEDIA_ERROR,details:x.FRAG_PARSING_ERROR,fatal:!1,levelRetry:f,error:p,reason:h}),!f)return}if(Nr(e,this.observer,s,r,this.audioCodec),void 0!==t.pts)n=t.pts;else{if(!o)return void P.warn("[tsdemuxer]: AAC PES unknown PTS");var g=Fr(e.samplerate);n=o.sample.pts+g}var v,y=0;while(r<i){if(v=Ur(e,s,r,n,y),r+=v.length,v.missing){this.aacOverFlow=v;break}for(y++;r<i-1;r++)if(Or(s,r))break}}},{key:"parseMPEGPES",value:function(e,t){var r=t.data,i=r.length,n=0,a=0,o=t.pts;if(void 0!==o)while(a<i)if(Qr(r,a)){var s=Yr(e,r,a,o,n);if(!s)break;a+=s.length,n++}else a++;else P.warn("[tsdemuxer]: MPEG PES unknown PTS")}},{key:"parseID3PES",value:function(e,t){if(void 0!==t.pts){var r=E({},t,{type:this._avcTrack?_t.emsg:_t.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}else P.warn("[tsdemuxer]: ID3 PES unknown PTS")}}],[{key:"probe",value:function(t){var r=e.syncOffset(t);return r>0&&P.warn("MPEG2-TS detected but first sync word found @ offset ".concat(r)),-1!==r}},{key:"syncOffset",value:function(e){var t=e.length,r=Math.min(940,e.length-188)+1,i=0;while(i<r){for(var n=!1,a=i;a<t;a+=188){if(71!==e[a])break;if(n||0!==ri(e,a)||(n=!0),n&&a+188>r)return i}i++}return-1}},{key:"createTrack",value:function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:Se[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}}]),e}();function ti(e,t,r,i){return{key:e,frame:!1,pts:t,dts:r,units:[],debug:i,length:0}}function ri(e,t){return((31&e[t+1])<<8)+e[t+2]}function ii(e,t){return(31&e[t+10])<<8|e[t+11]}function ni(e,t,r,i){var n={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},a=(15&e[t+1])<<8|e[t+2],o=t+3+a-4,s=(15&e[t+10])<<8|e[t+11];t+=12+s;while(t<o){var l=ri(e,t);switch(e[t]){case 207:if(!i){P.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===n.audio&&(n.audio=l);break;case 21:-1===n.id3&&(n.id3=l);break;case 219:if(!i){P.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===n.avc&&(n.avc=l);break;case 3:case 4:!0!==r.mpeg&&!0!==r.mp3?P.log("MPEG audio found, not supported in this browser"):-1===n.audio&&(n.audio=l,n.segmentCodec="mp3");break;case 36:P.warn("Unsupported HEVC stream type found");break}t+=5+((15&e[t+3])<<8|e[t+4])}return n}function ai(e){var t,r,i,n,a,o=0,s=e.data;if(!e||0===e.size)return null;while(s[0].length<19&&s.length>1){var l=new Uint8Array(s[0].length+s[1].length);l.set(s[0]),l.set(s[1],s[0].length),s[0]=l,s.splice(1,1)}t=s[0];var u=(t[0]<<16)+(t[1]<<8)+t[2];if(1===u){if(r=(t[4]<<8)+t[5],r&&r>e.size-6)return null;var c=t[7];192&c&&(n=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&c?(a=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,n-a>54e5&&(P.warn("".concat(Math.round((n-a)/9e4),"s delta between PTS and DTS, align them")),n=a)):a=n),i=t[8];var d=i+9;if(e.size<=d)return null;e.size-=d;for(var h=new Uint8Array(e.size),f=0,p=s.length;f<p;f++){t=s[f];var g=t.byteLength;if(d){if(d>g){d-=g;continue}t=t.subarray(d),g-=d,d=0}h.set(t,o),o+=g}return r&&(r-=i+3),{data:h,pts:n,dts:a,len:r}}return null}function oi(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){var r=t.samples,i=r.length;if(!i)return void t.dropped++;var n=r[i-1];e.pts=n.pts,e.dts=n.dts}t.samples.push(e)}e.debug.length&&P.log(e.pts+"/"+e.dts+":"+e.debug)}var si=function(e){(0,d.default)(r,e);var t=(0,h.default)(r);function r(){return(0,p.default)(this,r),t.apply(this,arguments)}return(0,g.default)(r,[{key:"resetInitSegment",value:function(e,t,i,n){(0,u.default)((0,c.default)(r.prototype),"resetInitSegment",this).call(this,e,t,i,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}},{key:"canParse",value:function(e,t){return function(e,t){return Xr(e,t)&&4<=e.length-t}(e,t)}},{key:"appendFrame",value:function(e,t,r){if(null!==this.basePTS)return Yr(e,t,r,this.basePTS,this.frameIndex)}}],[{key:"probe",value:function(e){if(!e)return!1;for(var t=oe(e,0)||[],r=t.length,i=e.length;r<i;r++)if(Jr(e,r))return P.log("MPEG Audio sync word found !"),!0;return!1}}]),r}(Lr),li=function(){function e(){(0,p.default)(this,e)}return(0,g.default)(e,null,[{key:"getSilentFrame",value:function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}]),e}(),ui=Math.pow(2,32)-1,ci=function(){function e(){(0,p.default)(this,e)}return(0,g.default)(e,null,[{key:"init",value:function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:r,audio:i};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,o,l,o,s),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))}},{key:"box",value:function(e){for(var t=8,r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];var a=i.length,o=a;while(a--)t+=i[a].byteLength;var s=new Uint8Array(t);for(s[0]=t>>24&255,s[1]=t>>16&255,s[2]=t>>8&255,s[3]=255&t,s.set(e,4),a=0,t=8;a<o;a++)s.set(i[a],t),t+=i[a].byteLength;return s}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,r){r*=t;var i=Math.floor(r/(ui+1)),n=Math.floor(r%(ui+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,r,i){return e.box(e.types.moof,e.mfhd(t),e.traf(i,r))}},{key:"moov",value:function(t){var r=t.length,i=[];while(r--)i[r]=e.trak(t[r]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(e.mvex(t)))}},{key:"mvex",value:function(t){var r=t.length,i=[];while(r--)i[r]=e.trex(t[r]);return e.box.apply(null,[e.types.mvex].concat(i))}},{key:"mvhd",value:function(t,r){r*=t;var i=Math.floor(r/(ui+1)),n=Math.floor(r%(ui+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,a)}},{key:"sdtp",value:function(t){var r,i,n=t.samples||[],a=new Uint8Array(4+n.length);for(r=0;r<n.length;r++)i=n[r].flags,a[r+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e.box(e.types.sdtp,a)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var r,i,n,a=[],o=[];for(r=0;r<t.sps.length;r++)i=t.sps[r],n=i.byteLength,a.push(n>>>8&255),a.push(255&n),a=a.concat(Array.prototype.slice.call(i));for(r=0;r<t.pps.length;r++)i=t.pps[r],n=i.byteLength,o.push(n>>>8&255),o.push(255&n),o=o.concat(Array.prototype.slice.call(i));var s=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(o))),l=t.width,u=t.height,c=t.pixelRatio[0],d=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var r=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"mp3",value:function(t){var r=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))}},{key:"stsd",value:function(t){return"audio"===t.type?"mp3"===t.segmentCodec&&"mp3"===t.codec?e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var r=t.id,i=t.duration*t.timescale,n=t.width,a=t.height,o=Math.floor(i/(ui+1)),s=Math.floor(i%(ui+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,s>>24,s>>16&255,s>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,a>>8&255,255&a,0,0]))}},{key:"traf",value:function(t,r){var i=e.sdtp(t),n=t.id,a=Math.floor(r/(ui+1)),o=Math.floor(r%(ui+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o])),e.trun(t,i.length+16+20+8+16+8+8),i)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var r=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,r){var i,n,a,o,s,l,u=t.samples||[],c=u.length,d=12+16*c,h=new Uint8Array(d);for(r+=8+d,h.set(["video"===t.type?1:0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),i=0;i<c;i++)n=u[i],a=n.duration,o=n.size,s=n.flags,l=n.cts,h.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,o>>>24&255,o>>>16&255,o>>>8&255,255&o,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*i);return e.box(e.types.trun,h)}},{key:"initSegment",value:function(t){e.types||e.init();var r=e.moov(t),i=new Uint8Array(e.FTYP.byteLength+r.byteLength);return i.set(e.FTYP),i.set(r,e.FTYP.byteLength),i}}]),e}();ci.types=void 0,ci.HDLR_TYPES=void 0,ci.STTS=void 0,ci.STSC=void 0,ci.STCO=void 0,ci.STSZ=void 0,ci.VMHD=void 0,ci.SMHD=void 0,ci.STSD=void 0,ci.FTYP=void 0,ci.DINF=void 0;function di(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=e*t*r;return i?Math.round(n):n}function hi(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return di(e,1e3,1/9e4,t)}var fi=null,pi=null,gi=function(){function e(t,r,i){if((0,p.default)(this,e),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=t,this.config=r,this.typeSupported=i,this.ISGenerated=!1,null===fi){var n=navigator.userAgent||"",a=n.match(/Chrome\/(\d+)/i);fi=a?parseInt(a[1]):0}if(null===pi){var o=navigator.userAgent.match(/Safari\/(\d+)/i);pi=o?parseInt(o[1]):0}}return(0,g.default)(e,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(e){P.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}},{key:"resetNextTimestamp",value:function(){P.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}},{key:"resetInitSegment",value:function(){P.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}},{key:"getVideoStartPts",value:function(e){var t=!1,r=e.reduce((function(e,r){var i=r.pts-e;return i<-4294967296?(t=!0,vi(e,r.pts)):i>0?e:r.pts}),e[0].pts);return t&&P.debug("PTS rollover detected"),r}},{key:"remux",value:function(e,t,r,i,n,a,o,s){var l,u,c,d,h,f,p=n,g=n,v=e.pid>-1,y=t.pid>-1,m=t.samples.length,_=e.samples.length>0,b=o&&m>0||m>1,T=(!v||_)&&(!y||b)||this.ISGenerated||o;if(T){this.ISGenerated||(c=this.generateIS(e,t,n,a));var S,E=this.isVideoContiguous,k=-1;if(b&&(k=function(e){for(var t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!E&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,k>0){P.warn("[mp4-remuxer]: Dropped ".concat(k," out of ").concat(m," video samples due to a missing keyframe"));var A=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(k),t.dropped+=k,g+=(t.samples[0].pts-A)/t.inputTimeScale,S=g}else-1===k&&(P.warn("[mp4-remuxer]: No keyframe found out of ".concat(m," video samples")),f=!1);if(this.ISGenerated){if(_&&b){var w=this.getVideoStartPts(t.samples),x=vi(e.samples[0].pts,w)-w,R=x/t.inputTimeScale;p+=Math.max(0,R),g+=Math.max(0,-R)}if(_){if(e.samplerate||(P.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),c=this.generateIS(e,t,n,a)),u=this.remuxAudio(e,p,this.isAudioContiguous,a,y||b||s===dt.AUDIO?g:void 0),b){var L=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(P.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),c=this.generateIS(e,t,n,a)),l=this.remuxVideo(t,g,E,L)}}else b&&(l=this.remuxVideo(t,g,E,0));l&&(l.firstKeyFrame=k,l.independent=-1!==k,l.firstKeyFramePTS=S)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(h=yi(r,n,this._initPTS,this._initDTS)),i.samples.length&&(d=mi(i,n,this._initPTS))),{audio:u,video:l,initSegment:c,independent:f,text:d,id3:h}}},{key:"generateIS",value:function(e,t,r,i){var n,a,o,s=e.samples,l=t.samples,u=this.typeSupported,c={},d=this._initPTS,h=!d||i,f="audio/mp4";if(h&&(n=a=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":u.mpeg?(f="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3");break}c.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&u.mpeg?new Uint8Array(0):ci.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(o=e.inputTimeScale,d&&o===d.timescale?h=!1:n=a=s[0].pts-Math.round(o*r))}if(t.sps&&t.pps&&l.length&&(t.timescale=t.inputTimeScale,c.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:ci.initSegment([t]),metadata:{width:t.width,height:t.height}},h))if(o=t.inputTimeScale,d&&o===d.timescale)h=!1;else{var p=this.getVideoStartPts(l),g=Math.round(o*r);a=Math.min(a,vi(l[0].dts,p)-g),n=Math.min(n,p-g)}if(Object.keys(c).length)return this.ISGenerated=!0,h?(this._initPTS={baseTime:n,timescale:o},this._initDTS={baseTime:a,timescale:o}):n=o=void 0,{tracks:c,initPTS:n,timescale:o}}},{key:"remuxVideo",value:function(e,t,r,i){var n,a,o=e.inputTimeScale,s=e.samples,l=[],u=s.length,c=this._initPTS,d=this.nextAvcDts,h=8,f=this.videoSampleDuration,p=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,v=!1;if(!r||null===d){var y=t*o,m=s[0].pts-vi(s[0].dts,s[0].pts);d=y-m}for(var _=c.baseTime*o/c.timescale,b=0;b<u;b++){var T=s[b];T.pts=vi(T.pts-_,d),T.dts=vi(T.dts-_,d),T.dts<s[b>0?b-1:b].dts&&(v=!0)}v&&s.sort((function(e,t){var r=e.dts-t.dts,i=e.pts-t.pts;return r||i})),n=s[0].dts,a=s[s.length-1].dts;var S=a-n,k=S?Math.round(S/(u-1)):f||e.inputTimeScale/30;if(r){var R=n-d,L=R>k,I=R<-1;if((L||I)&&(L?P.warn("AVC: ".concat(hi(R,!0)," ms (").concat(R,"dts) hole between fragments detected, filling it")):P.warn("AVC: ".concat(hi(-R,!0)," ms (").concat(R,"dts) overlapping between fragments detected")),!I||d>s[0].pts)){n=d;var C=s[0].pts-R;s[0].dts=n,s[0].pts=C,P.log("Video: First PTS/DTS adjusted: ".concat(hi(C,!0),"/").concat(hi(n,!0),", delta: ").concat(hi(R,!0)," ms"))}}n=Math.max(0,n);for(var D=0,O=0,M=0;M<u;M++){for(var N=s[M],F=N.units,U=F.length,B=0,H=0;H<U;H++)B+=F[H].data.length;O+=B,D+=U,N.length=B,N.dts=Math.max(N.dts,n),p=Math.min(N.pts,p),g=Math.max(N.pts,g)}a=s[u-1].dts;var V,j=O+4*D+8;try{V=new Uint8Array(j)}catch(_e){return void this.observer.emit(A.ERROR,A.ERROR,{type:w.MUX_ERROR,details:x.REMUX_ALLOC_ERROR,fatal:!1,error:_e,bytes:j,reason:"fail allocating video mdat ".concat(j)})}var G=new DataView(V.buffer);G.setUint32(0,j),V.set(ci.types.mdat,4);for(var K=!1,q=Number.POSITIVE_INFINITY,W=Number.POSITIVE_INFINITY,Y=Number.NEGATIVE_INFINITY,z=Number.NEGATIVE_INFINITY,X=0;X<u;X++){for(var Q=s[X],J=Q.units,Z=0,$=0,ee=J.length;$<ee;$++){var te=J[$],re=te.data,ie=te.data.byteLength;G.setUint32(h,ie),h+=4,V.set(re,h),h+=ie,Z+=4+ie}var ne=void 0;if(X<u-1)f=s[X+1].dts-Q.dts,ne=s[X+1].pts-Q.pts;else{var ae=this.config,oe=X>0?Q.dts-s[X-1].dts:k;if(ne=X>0?Q.pts-s[X-1].pts:k,ae.stretchShortVideoTrack&&null!==this.nextAudioPts){var se=Math.floor(ae.maxBufferHole*o),le=(i?p+i*o:this.nextAudioPts)-Q.pts;le>se?(f=le-oe,f<0?f=oe:K=!0,P.log("[mp4-remuxer]: It is approximately ".concat(le/90," ms to the next segment; using duration ").concat(f/90," ms for the last video frame."))):f=oe}else f=oe}var ue=Math.round(Q.pts-Q.dts);q=Math.min(q,f),Y=Math.max(Y,f),W=Math.min(W,ne),z=Math.max(z,ne),l.push(new bi(Q.key,f,Z,ue))}if(l.length)if(fi){if(fi<70){var ce=l[0].flags;ce.dependsOn=2,ce.isNonSync=0}}else if(pi&&z-W<Y-q&&k/Y<.025&&0===l[0].cts){P.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var de=n,he=0,fe=l.length;he<fe;he++){var pe=de+l[he].duration,ge=de+l[he].cts;if(he<fe-1){var ve=pe+l[he+1].cts;l[he].duration=ve-ge}else l[he].duration=he?l[he-1].duration:k;l[he].cts=0,de=pe}}f=K||!f?k:f,this.nextAvcDts=d=a+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;var ye=ci.moof(e.sequenceNumber++,n,E({},e,{samples:l})),me={data1:ye,data2:V,startPTS:p/o,endPTS:(g+f)/o,startDTS:n/o,endDTS:d/o,type:"video",hasAudio:!1,hasVideo:!0,nb:l.length,dropped:e.dropped};return e.samples=[],e.dropped=0,me}},{key:"remuxAudio",value:function(e,t,r,i,n){var a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,s=a/o,l="aac"===e.segmentCodec?1024:1152,u=l*s,c=this._initPTS,d="mp3"===e.segmentCodec&&this.typeSupported.mpeg,h=[],f=void 0!==n,p=e.samples,g=d?0:8,v=this.nextAudioPts||-1,y=t*a,m=c.baseTime*a/c.timescale;if(this.isAudioContiguous=r=r||p.length&&v>0&&(i&&Math.abs(y-v)<9e3||Math.abs(vi(p[0].pts-m,y)-v)<20*u),p.forEach((function(e){e.pts=vi(e.pts-m,y)})),!r||v<0){if(p=p.filter((function(e){return e.pts>=0})),!p.length)return;v=0===n?0:i&&!f?Math.max(0,y):p[0].pts}if("aac"===e.segmentCodec)for(var _=this.config.maxAudioFramesDrift,b=0,T=v;b<p.length;b++){var S=p[b],k=S.pts,R=k-T,L=Math.abs(1e3*R/a);if(R<=-_*u&&f)0===b&&(P.warn("Audio frame @ ".concat((k/a).toFixed(3),"s overlaps nextAudioPts by ").concat(Math.round(1e3*R/a)," ms.")),this.nextAudioPts=v=T=k);else if(R>=_*u&&L<1e4&&f){var I=Math.round(R/u);T=k-I*u,T<0&&(I--,T+=u),0===b&&(this.nextAudioPts=v=T),P.warn("[mp4-remuxer]: Injecting ".concat(I," audio frame @ ").concat((T/a).toFixed(3),"s due to ").concat(Math.round(1e3*R/a)," ms gap."));for(var C=0;C<I;C++){var D=Math.max(T,0),O=li.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);O||(P.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),O=S.unit.subarray()),p.splice(b,0,{unit:O,pts:D}),T+=u,b++}}S.pts=T,T+=u}var M,N=null,F=null,U=0,B=p.length;while(B--)U+=p[B].unit.byteLength;for(var H=0,V=p.length;H<V;H++){var j=p[H],G=j.unit,K=j.pts;if(null!==F){var q=h[H-1];q.duration=Math.round((K-F)/s)}else{if(r&&"aac"===e.segmentCodec&&(K=v),N=K,!(U>0))return;U+=g;try{M=new Uint8Array(U)}catch(ee){return void this.observer.emit(A.ERROR,A.ERROR,{type:w.MUX_ERROR,details:x.REMUX_ALLOC_ERROR,fatal:!1,error:ee,bytes:U,reason:"fail allocating audio mdat ".concat(U)})}if(!d){var W=new DataView(M.buffer);W.setUint32(0,U),M.set(ci.types.mdat,4)}}M.set(G,g);var Y=G.byteLength;g+=Y,h.push(new bi(!0,l,Y,0)),F=K}var z=h.length;if(z){var X=h[h.length-1];this.nextAudioPts=v=F+s*X.duration;var Q=d?new Uint8Array(0):ci.moof(e.sequenceNumber++,N/s,E({},e,{samples:h}));e.samples=[];var J=N/a,Z=v/a,$={data1:Q,data2:M,startPTS:J,endPTS:Z,startDTS:J,endDTS:Z,type:"audio",hasAudio:!0,hasVideo:!1,nb:z};return this.isAudioContiguous=!0,$}}},{key:"remuxEmptyAudio",value:function(e,t,r,i){var n=e.inputTimeScale,a=e.samplerate?e.samplerate:n,o=n/a,s=this.nextAudioPts,l=this._initDTS,u=9e4*l.baseTime/l.timescale,c=(null!==s?s:i.startDTS*n)+u,d=i.endDTS*n+u,h=1024*o,f=Math.ceil((d-c)/h),p=li.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(P.warn("[mp4-remuxer]: remux empty Audio"),p){for(var g=[],v=0;v<f;v++){var y=c+v*h;g.push({unit:p,pts:y,dts:y})}return e.samples=g,this.remuxAudio(e,t,r,!1)}P.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")}}]),e}();function vi(e,t){var r;if(null===t)return e;r=t<e?-8589934592:8589934592;while(Math.abs(e-t)>4294967296)e+=r;return e}function yi(e,t,r,i){var n=e.samples.length;if(n){for(var a=e.inputTimeScale,o=0;o<n;o++){var s=e.samples[o];s.pts=vi(s.pts-9e4*r.baseTime/r.timescale,t*a)/a,s.dts=vi(s.dts-9e4*i.baseTime/i.timescale,t*a)/a}var l=e.samples;return e.samples=[],{samples:l}}}function mi(e,t,r){var i=e.samples.length;if(i){for(var n=e.inputTimeScale,a=0;a<i;a++){var o=e.samples[a];o.pts=vi(o.pts-9e4*r.baseTime/r.timescale,t*n)/n}e.samples.sort((function(e,t){return e.pts-t.pts}));var s=e.samples;return e.samples=[],{samples:s}}}var _i,bi=(0,g.default)((function e(t,r,i,n){(0,p.default)(this,e),this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=r,this.size=i,this.cts=n,this.flags=new Ti(t)})),Ti=(0,g.default)((function e(t){(0,p.default)(this,e),this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=t?2:1,this.isNonSync=t?0:1})),Si=function(){function e(){(0,p.default)(this,e),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}return(0,g.default)(e,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(e){this.initPTS=e,this.lastEndTime=null}},{key:"resetNextTimestamp",value:function(){this.lastEndTime=null}},{key:"resetInitSegment",value:function(e,t,r,i){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(function(e,t){if(!e||!t)return e;var r=t.keyId;if(r&&t.isCommonEncryption){var i=Re(e,["moov","trak"]);i.forEach((function(e){var t=Re(e,["mdia","minf","stbl","stsd"])[0],i=t.subarray(8),n=Re(i,["enca"]),a=n.length>0;a||(n=Re(i,["encv"])),n.forEach((function(e){var t=a?e.subarray(28):e.subarray(78),i=Re(t,["sinf"]);i.forEach((function(e){var t=Ce(e);if(t){var i=t.subarray(8,24);i.some((function(e){return 0!==e}))||(P.log("[eme] Patching keyId in 'enc".concat(a?"a":"v",">sinf>>tenc' box: ").concat(_e.hexDump(i)," -> ").concat(_e.hexDump(r))),t.set(r,8))}}))}))}))}return e}(e,i)),this.emitInitSegment=!0}},{key:"generateInitSegment",value:function(e){var t=this.audioCodec,r=this.videoCodec;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var i=this.initData=Ie(e);t||(t=Ei(i.audio,V.AUDIO)),r||(r=Ei(i.video,V.VIDEO));var n={};i.audio&&i.video?n.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:i.audio?n.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?n.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:P.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=n}},{key:"remux",value:function(e,t,r,i,n,a){var o,s,l=this.initPTS,u=this.lastEndTime,c={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};k(u)||(u=this.lastEndTime=n||0);var d=t.samples;if(null==d||!d.length)return c;var h={initPTS:void 0,timescale:1},f=this.initData;if(null!=(o=f)&&o.length||(this.generateInitSegment(d),f=this.initData),null==(s=f)||!s.length)return P.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),c;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);var p=function(e,t){for(var r=0,i=0,n=0,a=Re(e,["moof","traf"]),o=0;o<a.length;o++){var s=a[o],l=Re(s,["tfhd"])[0],u=Ae(l,4),c=t[u];if(c){var d=c.default,h=Ae(l,0)|(null==d?void 0:d.flags),f=null==d?void 0:d.duration;8&h&&(f=Ae(l,2&h?12:8));for(var p=c.timescale||9e4,g=Re(s,["trun"]),v=0;v<g.length;v++){if(r=De(g[v]),!r&&f){var y=Ae(g[v],4);r=f*y}c.type===V.VIDEO?i+=r/p:c.type===V.AUDIO&&(n+=r/p)}}}if(0===i&&0===n){for(var m=0,_=Re(e,["sidx"]),b=0;b<_.length;b++){var T=Le(_[b]);null!=T&&T.references&&(m+=T.references.reduce((function(e,t){return e+t.info.duration||0}),0))}return m}return i||n}(d,f),g=function(e,t){return Re(t,["moof","traf"]).reduce((function(t,r){var i=Re(r,["tfdt"])[0],n=i[0],a=Re(r,["tfhd"]).reduce((function(t,r){var a=Ae(r,4),o=e[a];if(o){var s=Ae(i,4);if(1===n){if(s===be)return P.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;s*=be+1,s+=Ae(i,8)}var l=o.timescale||9e4,u=s/l;if(isFinite(u)&&(null===t||u<t))return u}return t}),null);return null!==a&&isFinite(a)&&(null===t||a<t)?a:t}),null)}(f,d),v=null===g?n:g;(function(e,t,r,i){if(null===e)return!0;var n=Math.max(i,1),a=t-e.baseTime/e.timescale;return Math.abs(a-r)>n}(l,v,n,p)||h.timescale!==l.timescale&&a)&&(h.initPTS=v-n,l&&1===l.timescale&&P.warn("Adjusting initPTS by ".concat(h.initPTS-l.baseTime)),this.initPTS=l={baseTime:h.initPTS,timescale:1});var y=e?v-l.baseTime/l.timescale:u,m=y+p;(function(e,t,r){Re(t,["moof","traf"]).forEach((function(t){Re(t,["tfhd"]).forEach((function(i){var n=Ae(i,4),a=e[n];if(a){var o=a.timescale||9e4;Re(t,["tfdt"]).forEach((function(e){var t=e[0],i=Ae(e,4);if(0===t)i-=r*o,i=Math.max(i,0),xe(e,4,i);else{i*=Math.pow(2,32),i+=Ae(e,8),i-=r*o,i=Math.max(i,0);var n=Math.floor(i/(be+1)),a=Math.floor(i%(be+1));xe(e,4,n),xe(e,8,a)}}))}}))}))})(f,d,l.baseTime/l.timescale),p>0?this.lastEndTime=m:(P.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var _=!!f.audio,b=!!f.video,T="";_&&(T+="audio"),b&&(T+="video");var S={data1:d,startPTS:y,startDTS:y,endPTS:m,endDTS:m,type:T,hasAudio:_,hasVideo:b,nb:1,dropped:0};return c.audio="audio"===S.type?S:void 0,c.video="audio"!==S.type?S:void 0,c.initSegment=h,c.id3=yi(r,n,l,l),i.samples.length&&(c.text=mi(i,n,l)),c}}]),e}();function Ei(e,t){var r=null==e?void 0:e.codec;return r&&r.length>4?r:"hvc1"===r||"hev1"===r?"hvc1.1.6.L120.90":"av01"===r?"av01.0.04M.08":"avc1"===r||t===V.VIDEO?"avc1.42e01e":"mp4a.40.5"}try{_i=self.performance.now.bind(self.performance)}catch(ga){P.debug("Unable to use Performance API on this environment"),_i="undefined"!==typeof self&&self.Date.now}var ki=[{demux:Vr,remux:Si},{demux:ei,remux:gi},{demux:Br,remux:gi},{demux:si,remux:gi}],Ai=function(){function e(t,r,i,n,a){(0,p.default)(this,e),this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=r,this.config=i,this.vendor=n,this.id=a}return(0,g.default)(e,[{key:"configure",value:function(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}},{key:"push",value:function(e,t,r,i){var n=this,a=r.transmuxing;a.executeStart=_i();var o=new Uint8Array(e),s=this.currentTransmuxState,l=this.transmuxConfig;i&&(this.currentTransmuxState=i);var u=i||s,c=u.contiguous,d=u.discontinuity,h=u.trackSwitch,f=u.accurateTimeOffset,p=u.timeOffset,g=u.initSegmentChange,v=l.audioCodec,y=l.videoCodec,m=l.defaultInitPts,_=l.duration,b=l.initSegmentData,T=function(e,t){var r=null;e.byteLength>0&&null!=t&&null!=t.key&&null!==t.iv&&null!=t.method&&(r=t);return r}(o,t);if(T&&"AES-128"===T.method){var S=this.getDecrypter();if(!S.isSync())return this.decryptionPromise=S.webCryptoDecrypt(o,T.key.buffer,T.iv.buffer).then((function(e){var t=n.push(e,null,r);return n.decryptionPromise=null,t})),this.decryptionPromise;var E=S.softwareDecrypt(o,T.key.buffer,T.iv.buffer),k=r.part>-1;if(k&&(E=S.flush()),!E)return a.executeEnd=_i(),wi(r);o=new Uint8Array(E)}var R=this.needsProbing(d,h);if(R){var L=this.configureTransmuxer(o);if(L)return P.warn("[transmuxer] ".concat(L.message)),this.observer.emit(A.ERROR,A.ERROR,{type:w.MEDIA_ERROR,details:x.FRAG_PARSING_ERROR,fatal:!1,error:L,reason:L.message}),a.executeEnd=_i(),wi(r)}(d||h||g||R)&&this.resetInitSegment(b,v,y,_,t),(d||g||R)&&this.resetInitialTimestamp(m),c||this.resetContiguity();var I=this.transmux(o,T,p,f,r),C=this.currentTransmuxState;return C.contiguous=!0,C.discontinuity=!1,C.trackSwitch=!1,a.executeEnd=_i(),I}},{key:"flush",value:function(e){var t=this,r=e.transmuxing;r.executeStart=_i();var i=this.decrypter,n=this.currentTransmuxState,a=this.decryptionPromise;if(a)return a.then((function(){return t.flush(e)}));var o=[],s=n.timeOffset;if(i){var l=i.flush();l&&o.push(this.push(l,null,e))}var u=this.demuxer,c=this.remuxer;if(!u||!c)return r.executeEnd=_i(),[wi(e)];var d=u.flush(s);return xi(d)?d.then((function(r){return t.flushRemux(o,r,e),o})):(this.flushRemux(o,d,e),o)}},{key:"flushRemux",value:function(e,t,r){var i=t.audioTrack,n=t.videoTrack,a=t.id3Track,o=t.textTrack,s=this.currentTransmuxState,l=s.accurateTimeOffset,u=s.timeOffset;P.log("[transmuxer.ts]: Flushed fragment ".concat(r.sn).concat(r.part>-1?" p: "+r.part:""," of level ").concat(r.level));var c=this.remuxer.remux(i,n,a,o,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:r}),r.transmuxing.executeEnd=_i()}},{key:"resetInitialTimestamp",value:function(e){var t=this.demuxer,r=this.remuxer;t&&r&&(t.resetTimeStamp(e),r.resetTimeStamp(e))}},{key:"resetContiguity",value:function(){var e=this.demuxer,t=this.remuxer;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}},{key:"resetInitSegment",value:function(e,t,r,i,n){var a=this.demuxer,o=this.remuxer;a&&o&&(a.resetInitSegment(e,t,r,i),o.resetInitSegment(e,t,r,n))}},{key:"destroy",value:function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}},{key:"transmux",value:function(e,t,r,i,n){var a;return a=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,r,i,n):this.transmuxUnencrypted(e,r,i,n),a}},{key:"transmuxUnencrypted",value:function(e,t,r,i){var n=this.demuxer.demux(e,t,!1,!this.config.progressive),a=n.audioTrack,o=n.videoTrack,s=n.id3Track,l=n.textTrack,u=this.remuxer.remux(a,o,s,l,t,r,!1,this.id);return{remuxResult:u,chunkMeta:i}}},{key:"transmuxSampleAes",value:function(e,t,r,i,n){var a=this;return this.demuxer.demuxSampleAes(e,t,r).then((function(e){var t=a.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,r,i,!1,a.id);return{remuxResult:t,chunkMeta:n}}))}},{key:"configureTransmuxer",value:function(e){for(var t,r=this.config,i=this.observer,n=this.typeSupported,a=this.vendor,o=0,s=ki.length;o<s;o++)if(ki[o].demux.probe(e)){t=ki[o];break}if(!t)return new Error("Failed to find demuxer by probing fragment data");var l=this.demuxer,u=this.remuxer,c=t.remux,d=t.demux;u&&u instanceof c||(this.remuxer=new c(i,r,n,a)),l&&l instanceof d||(this.demuxer=new d(i,r,n),this.probe=d.probe)}},{key:"needsProbing",value:function(e,t){return!this.demuxer||!this.remuxer||e||t}},{key:"getDecrypter",value:function(){var e=this.decrypter;return e||(e=this.decrypter=new Er(this.config)),e}}]),e}();var wi=function(e){return{remuxResult:{},chunkMeta:e}};function xi(e){return"then"in e&&e.then instanceof Function}var Ri=(0,g.default)((function e(t,r,i,n,a){(0,p.default)(this,e),this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=r,this.initSegmentData=i,this.duration=n,this.defaultInitPts=a||null})),Li=(0,g.default)((function e(t,r,i,n,a,o){(0,p.default)(this,e),this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=r,this.accurateTimeOffset=i,this.trackSwitch=n,this.timeOffset=a,this.initSegmentChange=o})),Ii={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function i(){}function n(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,i,a,o){if("function"!==typeof i)throw new TypeError("The listener must be a function");var s=new n(i,a||e,o),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],s]:e._events[l].push(s):(e._events[l]=s,e._eventsCount++),e}function o(e,t){0===--e._eventsCount?e._events=new i:delete e._events[t]}function s(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,i,n=[];if(0===this._eventsCount)return n;for(i in e=this._events)t.call(e,i)&&n.push(r?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},s.prototype.listeners=function(e){var t=r?r+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,a=i.length,o=new Array(a);n<a;n++)o[n]=i[n].fn;return o},s.prototype.listenerCount=function(e){var t=r?r+e:e,i=this._events[t];return i?i.fn?1:i.length:0},s.prototype.emit=function(e,t,i,n,a,o){var s=r?r+e:e;if(!this._events[s])return!1;var l,u,c=this._events[s],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,i),!0;case 4:return c.fn.call(c.context,t,i,n),!0;case 5:return c.fn.call(c.context,t,i,n,a),!0;case 6:return c.fn.call(c.context,t,i,n,a,o),!0}for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,i);break;case 4:c[u].fn.call(c[u].context,t,i,n);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},s.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,i,n){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return o(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||n&&!s.once||i&&s.context!==i||o(this,a);else{for(var l=0,u=[],c=s.length;l<c;l++)(s[l].fn!==t||n&&!s[l].once||i&&s[l].context!==i)&&u.push(s[l]);u.length?this._events[a]=1===u.length?u[0]:u:o(this,a)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s})(Ii);var Ci=Ii.exports,Di=y(Ci),Pi=Ye()||{isTypeSupported:function(){return!1}},Oi=function(){function e(t,r,i,n){var a=this;(0,p.default)(this,e),this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var o=t.config;this.hls=t,this.id=r,this.useWorker=!!o.enableWorker,this.onTransmuxComplete=i,this.onFlush=n;var s=function(e,t){t=t||{},t.frag=a.frag,t.id=a.id,e===A.ERROR&&(a.error=t.error),a.hls.trigger(e,t)};this.observer=new Di,this.observer.on(A.FRAG_DECRYPTED,s),this.observer.on(A.ERROR,s);var l={mp4:Pi.isTypeSupported("video/mp4"),mpeg:Pi.isTypeSupported("audio/mpeg"),mp3:Pi.isTypeSupported('audio/mp4; codecs="mp3"')},u=navigator.vendor;if(this.useWorker&&"undefined"!==typeof Worker){var c=o.workerPath||function(){return"function"===typeof __HLS_WORKER_BUNDLE__}();if(c){try{o.workerPath?(P.log("loading Web Worker ".concat(o.workerPath,' for "').concat(r,'"')),this.workerContext=function(e){var t=new self.URL(e,self.location.href).href,r=new self.Worker(t);return{worker:r,scriptURL:t}}(o.workerPath)):(P.log('injecting Web Worker for "'.concat(r,'"')),this.workerContext=function(){var e=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(".concat(__HLS_WORKER_BUNDLE__.toString(),")(true);")],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r=new self.Worker(t);return{worker:r,objectURL:t}}()),this.onwmsg=function(e){return a.onWorkerMessage(e)};var d=this.workerContext.worker;d.addEventListener("message",this.onwmsg),d.onerror=function(e){var t=new Error("".concat(e.message,"  (").concat(e.filename,":").concat(e.lineno,")"));o.enableWorker=!1,P.warn('Error in "'.concat(r,'" Web Worker, fallback to inline')),a.hls.trigger(A.ERROR,{type:w.OTHER_ERROR,details:x.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})},d.postMessage({cmd:"init",typeSupported:l,vendor:u,id:r,config:JSON.stringify(o)})}catch(ga){P.warn('Error setting up "'.concat(r,'" Web Worker, fallback to inline'),ga),this.resetWorker(),this.error=null,this.transmuxer=new Ai(this.observer,l,o,u,r)}return}}this.transmuxer=new Ai(this.observer,l,o,u,r)}return(0,g.default)(e,[{key:"resetWorker",value:function(){if(this.workerContext){var e=this.workerContext,t=e.worker,r=e.objectURL;r&&self.URL.revokeObjectURL(r),t.removeEventListener("message",this.onwmsg),t.onerror=null,t.terminate(),this.workerContext=null}}},{key:"destroy",value:function(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}},{key:"push",value:function(e,t,r,i,n,a,o,s,l,u){var c,d,h=this;l.transmuxing.start=self.performance.now();var f=this.transmuxer,p=a?a.start:n.start,g=n.decryptdata,v=this.frag,y=!(v&&n.cc===v.cc),m=!(v&&l.level===v.level),_=v?l.sn-v.sn:-1,b=this.part?l.part-this.part.index:-1,T=0===_&&l.id>1&&l.id===(null==v?void 0:v.stats.chunkCount),S=!m&&(1===_||0===_&&(1===b||T&&b<=0)),E=self.performance.now();(m||_||0===n.stats.parsing.start)&&(n.stats.parsing.start=E),!a||!b&&S||(a.stats.parsing.start=E);var k=!(v&&(null==(c=n.initSegment)?void 0:c.url)===(null==(d=v.initSegment)?void 0:d.url)),A=new Li(y,S,s,m,p,k);if(!S||y||k){P.log("[transmuxer-interface, ".concat(n.type,"]: Starting new transmux session for sn: ").concat(l.sn," p: ").concat(l.part," level: ").concat(l.level," id: ").concat(l.id,"\n        discontinuity: ").concat(y,"\n        trackSwitch: ").concat(m,"\n        contiguous: ").concat(S,"\n        accurateTimeOffset: ").concat(s,"\n        timeOffset: ").concat(p,"\n        initSegmentChange: ").concat(k));var w=new Ri(r,i,t,o,u);this.configureTransmuxer(w)}if(this.frag=n,this.part=a,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:g,chunkMeta:l,state:A},e instanceof ArrayBuffer?[e]:[]);else if(f){var x=f.push(e,g,l,A);xi(x)?(f.async=!0,x.then((function(e){h.handleTransmuxComplete(e)})).catch((function(e){h.transmuxerError(e,l,"transmuxer-interface push error")}))):(f.async=!1,this.handleTransmuxComplete(x))}}},{key:"flush",value:function(e){var t=this;e.transmuxing.start=self.performance.now();var r=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(r){var i=r.flush(e),n=xi(i);n||r.async?(xi(i)||(i=Promise.resolve(i)),i.then((function(r){t.handleFlushResult(r,e)})).catch((function(r){t.transmuxerError(r,e,"transmuxer-interface flush error")}))):this.handleFlushResult(i,e)}}},{key:"transmuxerError",value:function(e,t,r){this.hls&&(this.error=e,this.hls.trigger(A.ERROR,{type:w.MEDIA_ERROR,details:x.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:r}))}},{key:"handleFlushResult",value:function(e,t){var r=this;e.forEach((function(e){r.handleTransmuxComplete(e)})),this.onFlush(t)}},{key:"onWorkerMessage",value:function(e){var t=e.data,r=this.hls;switch(t.event){case"init":var i,n=null==(i=this.workerContext)?void 0:i.objectURL;n&&self.URL.revokeObjectURL(n);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":P[t.data.logType]&&P[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data);break}}},{key:"configureTransmuxer",value:function(e){var t=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}},{key:"handleTransmuxComplete",value:function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}]),e}(),Mi=function(){function e(t,r,i,n){(0,p.default)(this,e),this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=r,this.fragmentTracker=i,this.hls=n}return(0,g.default)(e,[{key:"destroy",value:function(){this.media=null,this.hls=this.fragmentTracker=null}},{key:"poll",value:function(e,t){var r=this.config,i=this.media,n=this.stalled;if(null!==i){var a=i.currentTime,o=i.seeking,s=this.seeking&&!o,l=!this.seeking&&o;if(this.seeking=o,a===e){if(l||s)this.stalled=null;else if(!(i.paused&&!o||i.ended||0===i.playbackRate)&&hr.getBuffered(i).length){var u=hr.bufferInfo(i,a,0),c=u.len>0,d=u.nextStart||0;if(c||d){if(o){var h=u.len>2,f=!d||t&&t.start<=a||d-a>2&&!this.fragmentTracker.getPartialFragment(a);if(h||f)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var p,g=Math.max(d,u.start||0)-a,v=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,y=null==v||null==(p=v.details)?void 0:p.live,m=y?2*v.details.targetduration:2,_=this.fragmentTracker.getPartialFragment(a);if(g>0&&(g<=m||_))return void this._trySkipBufferHole(_)}var b=self.performance.now();if(null!==n){var T=b-n;if(o||!(T>=250)||(this._reportStall(u),this.media)){var S=hr.bufferInfo(i,a,r.maxBufferHole);this._tryFixBufferStall(S,T)}}else this.stalled=b}}}else if(this.moved=!0,null!==n){if(this.stallReported){var E=self.performance.now()-n;P.warn("playback not stuck anymore @".concat(a,", after ").concat(Math.round(E),"ms")),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}}},{key:"_tryFixBufferStall",value:function(e,t){var r=this.config,i=this.fragmentTracker,n=this.media;if(null!==n){var a=n.currentTime,o=i.getPartialFragment(a);if(o){var s=this._trySkipBufferHole(o);if(s||!this.media)return}(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-a<r.maxBufferHole)&&t>1e3*r.highBufferWatchdogPeriod&&(P.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}}},{key:"_reportStall",value:function(e){var t=this.hls,r=this.media,i=this.stallReported;if(!i&&r){this.stallReported=!0;var n=new Error("Playback stalling at @".concat(r.currentTime," due to low buffer (").concat(JSON.stringify(e),")"));P.warn(n.message),t.trigger(A.ERROR,{type:w.MEDIA_ERROR,details:x.BUFFER_STALLED_ERROR,fatal:!1,error:n,buffer:e.len})}}},{key:"_trySkipBufferHole",value:function(e){var t=this.config,r=this.hls,i=this.media;if(null===i)return 0;var n=i.currentTime,a=hr.bufferInfo(i,n,0),o=n<a.start?a.start:a.nextStart;if(o){var s=a.len<=t.maxBufferHole,l=a.len>0&&a.len<1&&i.readyState<3,u=o-n;if(u>0&&(s||l)){if(u>t.maxBufferHole){var c=this.fragmentTracker,d=!1;if(0===n){var h=c.getAppendedFrag(0,dt.MAIN);h&&o<h.end&&(d=!0)}if(!d){var f=e||c.getAppendedFrag(n,dt.MAIN);if(f){var p=!1,g=f.end;while(g<o){var v=c.getPartialFragment(g);if(!v){p=!0;break}g+=v.duration}if(p)return 0}}}var y=Math.max(o+.05,n+.1);if(P.warn("skipping hole, adjusting currentTime from ".concat(n," to ").concat(y)),this.moved=!0,this.stalled=null,i.currentTime=y,e&&!e.gap){var m=new Error("fragment loaded with buffer holes, seeking from ".concat(n," to ").concat(y));r.trigger(A.ERROR,{type:w.MEDIA_ERROR,details:x.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,frag:e})}return y}}return 0}},{key:"_tryNudgeBuffer",value:function(){var e=this.config,t=this.hls,r=this.media,i=this.nudgeRetry;if(null!==r){var n=r.currentTime;if(this.nudgeRetry++,i<e.nudgeMaxRetry){var a=n+(i+1)*e.nudgeOffset,o=new Error("Nudging 'currentTime' from ".concat(n," to ").concat(a));P.warn(o.message),r.currentTime=a,t.trigger(A.ERROR,{type:w.MEDIA_ERROR,details:x.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1})}else{var s=new Error("Playhead still not moving while enough data buffered @".concat(n," after ").concat(e.nudgeMaxRetry," nudges"));P.error(s.message),t.trigger(A.ERROR,{type:w.MEDIA_ERROR,details:x.BUFFER_STALLED_ERROR,error:s,fatal:!0})}}}}]),e}(),Ni=function(e){(0,d.default)(r,e);var t=(0,h.default)(r);function r(e,i,n){var a;return(0,p.default)(this,r),a=t.call(this,e,i,n,"[stream-controller]",dt.MAIN),a.audioCodecSwap=!1,a.gapController=null,a.level=-1,a._forceStartLoad=!1,a.altAudio=!1,a.audioOnly=!1,a.fragPlaying=null,a.onvplaying=null,a.onvseeked=null,a.fragLastKbps=0,a.couldBacktrack=!1,a.backtrackFragment=null,a.audioCodecSwitch=!1,a.videoBuffer=null,a._registerListeners(),a}return(0,g.default)(r,[{key:"_registerListeners",value:function(){var e=this.hls;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(A.ERROR,this.onError,this),e.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(A.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(A.BUFFER_CREATED,this.onBufferCreated,this),e.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"_unregisterListeners",value:function(){var e=this.hls;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(A.ERROR,this.onError,this),e.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(A.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(A.BUFFER_CREATED,this.onBufferCreated,this),e.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"onHandlerDestroying",value:function(){this._unregisterListeners(),this.onMediaDetaching()}},{key:"startLoad",value:function(e){if(this.levels){var t=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){var i=r.startLevel;-1===i&&(r.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=r.nextAutoLevel),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1}t>0&&-1===e&&(this.log("Override startPosition with lastCurrentTime @".concat(t.toFixed(3))),e=t),this.state=Ar.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=Ar.STOPPED}},{key:"stopLoad",value:function(){this._forceStartLoad=!1,(0,u.default)((0,c.default)(r.prototype),"stopLoad",this).call(this)}},{key:"doTick",value:function(){switch(this.state){case Ar.WAITING_LEVEL:var e,t=this.levels,r=this.level,i=null==t||null==(e=t[r])?void 0:e.details;if(i&&(!i.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(i))break;this.state=Ar.IDLE;break}break;case Ar.FRAG_LOADING_WAITING_RETRY:var n,a=self.performance.now(),o=this.retryDate;(!o||a>=o||null!=(n=this.media)&&n.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=Ar.IDLE);break}this.state===Ar.IDLE&&this.doTickIdle(),this.onTickEnd()}},{key:"onTickEnd",value:function(){(0,u.default)((0,c.default)(r.prototype),"onTickEnd",this).call(this),this.checkBuffer(),this.checkFragmentChanged()}},{key:"doTickIdle",value:function(){var e=this.hls,t=this.levelLastLoaded,r=this.levels,i=this.media,n=e.config,a=e.nextLoadLevel;if(null!==t&&(i||!this.startFragRequested&&n.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&null!=r&&r[a]){var o=r[a],s=this.getMainFwdBufferInfo();if(null!==s){var l=this.getLevelDetails();if(l&&this._streamEnded(s,l)){var u={};return this.altAudio&&(u.type="video"),this.hls.trigger(A.BUFFER_EOS,u),void(this.state=Ar.ENDED)}e.loadLevel!==a&&-1===e.manualLevel&&this.log("Adapting to level ".concat(a," from level ").concat(this.level)),this.level=e.nextLoadLevel=a;var c=o.details;if(!c||this.state===Ar.WAITING_LEVEL||c.live&&this.levelLastLoaded!==a)return this.level=a,void(this.state=Ar.WAITING_LEVEL);var d=s.len,h=this.getMaxBufferLength(o.maxBitrate);if(!(d>=h)){this.backtrackFragment&&this.backtrackFragment.start>s.end&&(this.backtrackFragment=null);var f=this.backtrackFragment?this.backtrackFragment.start:s.end,p=this.getNextFragment(f,c);if(this.couldBacktrack&&!this.fragPrevious&&p&&"initSegment"!==p.sn&&this.fragmentTracker.getState(p)!==er.OK){var g,v=(null!=(g=this.backtrackFragment)?g:p).sn,y=v-c.startSN,m=c.fragments[y-1];m&&p.cc===m.cc&&(p=m,this.fragmentTracker.removeFragment(m))}else this.backtrackFragment&&s.len&&(this.backtrackFragment=null);if(p&&this.isLoopLoading(p,f)){var _=p.gap;if(!_){var b=this.audioOnly&&!this.altAudio?V.AUDIO:V.VIDEO,T=(b===V.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;T&&this.afterBufferFlushed(T,b,dt.MAIN)}p=this.getNextFragmentLoopLoading(p,c,s,dt.MAIN,h)}p&&(!p.initSegment||p.initSegment.data||this.bitrateTest||(p=p.initSegment),this.loadFragment(p,o,f))}}}}},{key:"loadFragment",value:function(e,t,i){var n=this.fragmentTracker.getState(e);this.fragCurrent=e,n===er.NOT_LOADED||n===er.PARTIAL?"initSegment"===e.sn?this._loadInitSegment(e,t):this.bitrateTest?(this.log("Fragment ".concat(e.sn," of level ").concat(e.level," is being downloaded to test bitrate and will not be buffered")),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,(0,u.default)((0,c.default)(r.prototype),"loadFragment",this).call(this,e,t,i)):this.clearTrackerIfNeeded(e)}},{key:"getBufferedFrag",value:function(e){return this.fragmentTracker.getBufferedFrag(e,dt.MAIN)}},{key:"followingBufferedFrag",value:function(e){return e?this.getBufferedFrag(e.end+.5):null}},{key:"immediateLevelSwitch",value:function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"nextLevelSwitch",value:function(){var e=this.levels,t=this.media;if(null!=t&&t.readyState){var r,i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);var n=this.getLevelDetails();if(null!=n&&n.live){var a=this.getMainFwdBufferInfo();if(!a||a.len<2*n.targetduration)return}if(!t.paused&&e){var o=this.hls.nextLoadLevel,s=e[o],l=this.fragLastKbps;r=l&&this.fragCurrent?this.fragCurrent.duration*s.maxBitrate/(1e3*l)+1:0}else r=0;var u=this.getBufferedFrag(t.currentTime+r);if(u){var c=this.followingBufferedFrag(u);if(c){this.abortCurrentFrag();var d=c.maxStartPTS?c.maxStartPTS:c.start,h=c.duration,f=Math.max(u.end,d+Math.min(Math.max(h-this.config.maxFragLookUpTolerance,.5*h),.75*h));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}}},{key:"abortCurrentFrag",value:function(){var e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Ar.KEY_LOADING:case Ar.FRAG_LOADING:case Ar.FRAG_LOADING_WAITING_RETRY:case Ar.PARSING:case Ar.PARSED:this.state=Ar.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}},{key:"flushMainBuffer",value:function(e,t){(0,u.default)((0,c.default)(r.prototype),"flushMainBuffer",this).call(this,e,t,this.altAudio?"video":null)}},{key:"onMediaAttached",value:function(e,t){(0,u.default)((0,c.default)(r.prototype),"onMediaAttached",this).call(this,e,t);var i=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new Mi(this.config,i,this.fragmentTracker,this.hls)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),(0,u.default)((0,c.default)(r.prototype),"onMediaDetaching",this).call(this)}},{key:"onMediaPlaying",value:function(){this.tick()}},{key:"onMediaSeeked",value:function(){var e=this.media,t=e?e.currentTime:null;k(t)&&this.log("Media seeked to ".concat(t.toFixed(3)));var r=this.getMainFwdBufferInfo();null!==r&&0!==r.len?this.tick():this.warn('Main forward buffer length on "seeked" event '.concat(r?r.len:"empty",")"))}},{key:"onManifestLoading",value:function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(A.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}},{key:"onManifestParsed",value:function(e,t){var r,i=!1,n=!1;t.levels.forEach((function(e){r=e.audioCodec,r&&(-1!==r.indexOf("mp4a.40.2")&&(i=!0),-1!==r.indexOf("mp4a.40.5")&&(n=!0))})),this.audioCodecSwitch=i&&n&&!function(){var e,t=xr();return"function"===typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}},{key:"onLevelLoading",value:function(e,t){var r=this.levels;if(r&&this.state===Ar.IDLE){var i=r[t.level];(!i.details||i.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(i.details))&&(this.state=Ar.WAITING_LEVEL)}}},{key:"onLevelLoaded",value:function(e,t){var r,i=this.levels,n=t.level,a=t.details,o=a.totalduration;if(i){this.log("Level ".concat(n," loaded [").concat(a.startSN,",").concat(a.endSN,"]").concat(a.lastPartSn?"[part-".concat(a.lastPartSn,"-").concat(a.lastPartIndex,"]"):"",", cc [").concat(a.startCC,", ").concat(a.endCC,"] duration:").concat(o));var s=i[n],l=this.fragCurrent;!l||this.state!==Ar.FRAG_LOADING&&this.state!==Ar.FRAG_LOADING_WAITING_RETRY||l.level===t.level&&l.urlId===s.urlId||!l.loader||this.abortCurrentFrag();var u=0;if(a.live||null!=(r=s.details)&&r.live){if(a.fragments[0]||(a.deltaUpdateFailed=!0),a.deltaUpdateFailed)return;u=this.alignPlaylists(a,s.details)}if(s.details=a,this.levelLastLoaded=n,this.hls.trigger(A.LEVEL_UPDATED,{details:a,level:n}),this.state===Ar.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=Ar.IDLE}this.startFragRequested?a.live&&this.synchronizeToLiveEdge(a):this.setStartPosition(a,u),this.tick()}else this.warn("Levels were reset while loading level ".concat(n))}},{key:"_handleFragmentLoadProgress",value:function(e){var t,r=e.frag,i=e.part,n=e.payload,a=this.levels;if(a){var o=a[r.level],s=o.details;if(!s)return this.warn("Dropping fragment ".concat(r.sn," of level ").concat(r.level," after level details were reset")),void this.fragmentTracker.removeFragment(r);var l=o.videoCodec,u=s.PTSKnown||!s.live,c=null==(t=r.initSegment)?void 0:t.data,d=this._getAudioCodec(o),h=this.transmuxer=this.transmuxer||new Oi(this.hls,dt.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=i?i.index:-1,p=-1!==f,g=new fr(r.level,r.sn,r.stats.chunkCount,n.byteLength,f,p),v=this.initPTS[r.cc];h.push(n,c,d,l,r,i,s.totalduration,u,g,v)}else this.warn("Levels were reset while fragment load was in progress. Fragment ".concat(r.sn," of level ").concat(r.level," will not be buffered"))}},{key:"onAudioTrackSwitching",value:function(e,t){var r=this.altAudio,i=!!t.url;if(!i){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var n=this.fragCurrent;n&&(this.log("Switching to main audio track, cancel main fragment load"),n.abortRequests(),this.fragmentTracker.removeFragment(n)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var a=this.hls;r&&(a.trigger(A.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),a.trigger(A.AUDIO_TRACK_SWITCHED,t)}}},{key:"onAudioTrackSwitched",value:function(e,t){var r=t.id,i=!!this.hls.audioTracks[r].url;if(i){var n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=i,this.tick()}},{key:"onBufferCreated",value:function(e,t){var r,i,n=t.tracks,a=!1;for(var o in n){var s=n[o];if("main"===s.id){if(i=o,r=s,"video"===o){var l=n[o];l&&(this.videoBuffer=l.buffer)}}else a=!0}a&&r?(this.log("Alternate track found, use ".concat(i,".buffered to schedule main fragment loading")),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}},{key:"onFragBuffered",value:function(e,t){var r=t.frag,i=t.part;if(!r||r.type===dt.MAIN){if(this.fragContextChanged(r))return this.warn("Fragment ".concat(r.sn).concat(i?" p: "+i.index:""," of level ").concat(r.level," finished buffering, but was aborted. state: ").concat(this.state)),void(this.state===Ar.PARSED&&(this.state=Ar.IDLE));var n=i?i.stats:r.stats;this.fragLastKbps=Math.round(8*n.total/(n.buffering.end-n.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,i)}}},{key:"onError",value:function(e,t){var r;if(t.fatal)this.state=Ar.ERROR;else switch(t.details){case x.FRAG_GAP:case x.FRAG_PARSING_ERROR:case x.FRAG_DECRYPT_ERROR:case x.FRAG_LOAD_ERROR:case x.FRAG_LOAD_TIMEOUT:case x.KEY_LOAD_ERROR:case x.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(dt.MAIN,t);break;case x.LEVEL_LOAD_ERROR:case x.LEVEL_LOAD_TIMEOUT:case x.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Ar.WAITING_LEVEL||(null==(r=t.context)?void 0:r.type)!==ct.LEVEL||(this.state=Ar.IDLE);break;case x.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case x.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}},{key:"checkBuffer",value:function(){var e=this.media,t=this.gapController;if(e&&t&&e.readyState){if(this.loadedmetadata||!hr.getBuffered(e).length){var r=this.state!==Ar.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,r)}this.lastCurrentTime=e.currentTime}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=Ar.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}},{key:"onBufferFlushed",value:function(e,t){var r=t.type;if(r!==V.AUDIO||this.audioOnly&&!this.altAudio){var i=(r===V.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(i,r,dt.MAIN)}}},{key:"onLevelsUpdated",value:function(e,t){this.levels=t.levels}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"seekToStartPos",value:function(){var e=this.media;if(e){var t=e.currentTime,r=this.startPosition;if(r>=0&&t<r){if(e.seeking)return void this.log("could not seek to ".concat(r,", already seeking at ").concat(t));var i=hr.getBuffered(e),n=i.length?i.start(0):0,a=n-r;a>0&&(a<this.config.maxBufferHole||a<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by ".concat(a," to match buffer start")),r+=a,this.startPosition=r),this.log("seek to target start position ".concat(r," from current time ").concat(t)),e.currentTime=r}}}},{key:"_getAudioCodec",value:function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}},{key:"_loadBitrateTestFrag",value:function(e,t){var r=this;e.bitrateTest=!0,this._doFragLoad(e,t).then((function(i){var n=r.hls;if(i&&!r.fragContextChanged(e)){t.fragmentError=0,r.state=Ar.IDLE,r.startFragRequested=!1,r.bitrateTest=!1;var a=e.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),n.trigger(A.FRAG_LOADED,i),e.bitrateTest=!1}}))}},{key:"_handleTransmuxComplete",value:function(e){var t,r="main",i=this.hls,n=e.remuxResult,a=e.chunkMeta,o=this.getCurrentContext(a);if(o){var s=o.frag,l=o.part,u=o.level,c=n.video,d=n.text,h=n.id3,f=n.initSegment,p=u.details,g=this.altAudio?void 0:n.audio;if(this.fragContextChanged(s))this.fragmentTracker.removeFragment(s);else{if(this.state=Ar.PARSING,f){if(null!=f&&f.tracks){var v=s.initSegment||s;this._bufferInitSegment(u,f.tracks,v,a),i.trigger(A.FRAG_PARSING_INIT_SEGMENT,{frag:v,id:r,tracks:f.tracks})}var y=f.initPTS,m=f.timescale;k(y)&&(this.initPTS[s.cc]={baseTime:y,timescale:m},i.trigger(A.INIT_PTS_FOUND,{frag:s,id:r,initPTS:y,timescale:m}))}if(c&&!1!==n.independent){if(p){var _=c.startPTS,b=c.endPTS,T=c.startDTS,S=c.endDTS;if(l)l.elementaryStreams[c.type]={startPTS:_,endPTS:b,startDTS:T,endDTS:S};else if(c.firstKeyFrame&&c.independent&&1===a.id&&(this.couldBacktrack=!0),c.dropped&&c.independent){var E=this.getMainFwdBufferInfo(),w=(E?E.end:this.getLoadPosition())+this.config.maxBufferHole,x=c.firstKeyFramePTS?c.firstKeyFramePTS:_;if(w<x-this.config.maxBufferHole)return void this.backtrack(s);s.setElementaryStreamInfo(c.type,s.start,b,s.start,S,!0)}s.setElementaryStreamInfo(c.type,_,b,T,S),this.backtrackFragment&&(this.backtrackFragment=s),this.bufferFragmentData(c,s,l,a)}}else if(!1===n.independent)return void this.backtrack(s);if(g){var R=g.startPTS,L=g.endPTS,I=g.startDTS,C=g.endDTS;l&&(l.elementaryStreams[V.AUDIO]={startPTS:R,endPTS:L,startDTS:I,endDTS:C}),s.setElementaryStreamInfo(V.AUDIO,R,L,I,C),this.bufferFragmentData(g,s,l,a)}if(p&&null!=h&&null!=(t=h.samples)&&t.length){var D={id:r,frag:s,details:p,samples:h.samples};i.trigger(A.FRAG_PARSING_METADATA,D)}if(p&&d){var P={id:r,frag:s,details:p,samples:d.samples};i.trigger(A.FRAG_PARSING_USERDATA,P)}}}else this.resetWhenMissingContext(a)}},{key:"_bufferInitSegment",value:function(e,t,r,i){var n=this;if(this.state===Ar.PARSING){this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;var a=t.audio,o=t.video,s=t.audiovideo;if(a){var l=e.audioCodec,u=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(l&&(l=-1!==l.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==a.metadata.channelCount&&-1===u.indexOf("firefox")&&(l="mp4a.40.5")),-1!==u.indexOf("android")&&"audio/mpeg"!==a.container&&(l="mp4a.40.2",this.log("Android: force audio codec to ".concat(l))),e.audioCodec&&e.audioCodec!==l&&this.log('Swapping manifest audio codec "'.concat(e.audioCodec,'" for "').concat(l,'"')),a.levelCodec=l,a.id="main",this.log("Init audio buffer, container:".concat(a.container,", codecs[selected/level/parsed]=[").concat(l||"","/").concat(e.audioCodec||"","/").concat(a.codec,"]"))}o&&(o.levelCodec=e.videoCodec,o.id="main",this.log("Init video buffer, container:".concat(o.container,", codecs[level/parsed]=[").concat(e.videoCodec||"","/").concat(o.codec,"]"))),s&&this.log("Init audiovideo buffer, container:".concat(s.container,", codecs[level/parsed]=[").concat(e.attrs.CODECS||"","/").concat(s.codec,"]")),this.hls.trigger(A.BUFFER_CODECS,t),Object.keys(t).forEach((function(e){var a=t[e],o=a.initSegment;null!=o&&o.byteLength&&n.hls.trigger(A.BUFFER_APPENDING,{type:e,data:o,frag:r,part:null,chunkMeta:i,parent:r.type})})),this.tick()}}},{key:"getMainFwdBufferInfo",value:function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,dt.MAIN)}},{key:"backtrack",value:function(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Ar.IDLE}},{key:"checkFragmentChanged",value:function(){var e=this.media,t=null;if(e&&e.readyState>1&&!1===e.seeking){var r=e.currentTime;if(hr.isBuffered(e,r)?t=this.getAppendedFrag(r):hr.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;var i=this.fragPlaying,n=t.level;i&&t.sn===i.sn&&i.level===n&&t.urlId===i.urlId||(this.fragPlaying=t,this.hls.trigger(A.FRAG_CHANGED,{frag:t}),i&&i.level===n||this.hls.trigger(A.LEVEL_SWITCHED,{level:n}))}}}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentFrag",get:function(){var e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}},{key:"currentProgramDateTime",get:function(){var e=this.media;if(e){var t=e.currentTime,r=this.currentFrag;if(r&&k(t)&&k(r.programDateTime)){var i=r.programDateTime+1e3*(t-r.start);return new Date(i)}}return null}},{key:"currentLevel",get:function(){var e=this.currentFrag;return e?e.level:-1}},{key:"nextBufferedFrag",get:function(){var e=this.currentFrag;return e?this.followingBufferedFrag(e):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),r}(wr),Fi=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,p.default)(this,e),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=r,this.totalWeight_=i}return(0,g.default)(e,[{key:"sample",value:function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}]),e}(),Ui=function(){function e(t,r,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;(0,p.default)(this,e),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Fi(t),this.fast_=new Fi(r),this.defaultTTFB_=n,this.ttfb_=new Fi(t)}return(0,g.default)(e,[{key:"update",value:function(e,t){var r=this.slow_,i=this.fast_,n=this.ttfb_;r.halfLife!==e&&(this.slow_=new Fi(e,r.getEstimate(),r.getTotalWeight())),i.halfLife!==t&&(this.fast_=new Fi(t,i.getEstimate(),i.getTotalWeight())),n.halfLife!==e&&(this.ttfb_=new Fi(e,n.getEstimate(),n.getTotalWeight()))}},{key:"sample",value:function(e,t){e=Math.max(e,this.minDelayMs_);var r=8*t,i=e/1e3,n=r/i;this.fast_.sample(i,n),this.slow_.sample(i,n)}},{key:"sampleTTFB",value:function(e){var t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}},{key:"canEstimate",value:function(){return this.fast_.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"getEstimateTTFB",value:function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}},{key:"destroy",value:function(){}}]),e}(),Bi=function(){function e(t){(0,p.default)(this,e),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=t;var r=t.config;this.bwEstimator=new Ui(r.abrEwmaSlowVoD,r.abrEwmaFastVoD,r.abrEwmaDefaultEstimate),this.registerListeners()}return(0,g.default)(e,[{key:"registerListeners",value:function(){var e=this.hls;e.on(A.FRAG_LOADING,this.onFragLoading,this),e.on(A.FRAG_LOADED,this.onFragLoaded,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this),e.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(A.FRAG_LOADING,this.onFragLoading,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this),e.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this)}},{key:"destroy",value:function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}},{key:"onFragLoading",value:function(e,t){var r,i=t.frag;this.ignoreFragment(i)||(this.fragCurrent=i,this.partCurrent=null!=(r=t.part)?r:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}},{key:"onLevelSwitching",value:function(e,t){this.clearTimer()}},{key:"getTimeToLoadFrag",value:function(e,t,r,i){var n=e+r/t,a=i?this.lastLevelLoadSec:0;return n+a}},{key:"onLevelLoaded",value:function(e,t){var r=this.hls.config,i=t.stats,n=i.total,a=i.bwEstimate;k(n)&&k(a)&&(this.lastLevelLoadSec=8*n/a),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)}},{key:"_abandonRulesCheck",value:function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,i=r.autoLevelEnabled,n=r.media;if(e&&n){var a=performance.now(),o=t?t.stats:e.stats,s=t?t.duration:e.duration,l=a-o.loading.start;if(o.aborted||o.loaded&&o.loaded===o.total||0===e.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(i&&!n.paused&&n.playbackRate&&n.readyState){var u=r.mainForwardBufferInfo;if(null!==u){var c=this.bwEstimator.getEstimateTTFB(),d=Math.abs(n.playbackRate);if(!(l<=Math.max(c,s/(2*d)*1e3))){var h=u.len/d;if(!(h>=2*s/d)){var f=o.loading.first?o.loading.first-o.loading.start:-1,p=o.loaded&&f>-1,g=this.bwEstimator.getEstimate(),v=r.levels,y=r.minAutoLevel,m=v[e.level],_=o.total||Math.max(o.loaded,Math.round(s*m.maxBitrate/8)),b=l-f;b<1&&p&&(b=Math.min(l,8*o.loaded/g));var T=p?1e3*o.loaded/b:0,S=T?(_-o.loaded)/T:8*_/g+c/1e3;if(!(S<=h)){var E,w=T?8*T:g,x=Number.POSITIVE_INFINITY;for(E=e.level-1;E>y;E--){var R=v[E].maxBitrate;if(x=this.getTimeToLoadFrag(c/1e3,w,s*R,!v[E].details),x<h)break}x>=S||x>10*s||(r.nextLoadLevel=E,p?this.bwEstimator.sample(l-Math.min(c,f),o.loaded):this.bwEstimator.sampleTTFB(l),this.clearTimer(),P.warn("[abr] Fragment ".concat(e.sn).concat(t?" part "+t.index:""," of level ").concat(e.level," is loading too slowly;\n      Time to underbuffer: ").concat(h.toFixed(3)," s\n      Estimated load time for current fragment: ").concat(S.toFixed(3)," s\n      Estimated load time for down switch fragment: ").concat(x.toFixed(3)," s\n      TTFB estimate: ").concat(f,"\n      Current BW estimate: ").concat(k(g)?(g/1024).toFixed(3):"Unknown"," Kb/s\n      New BW estimate: ").concat((this.bwEstimator.getEstimate()/1024).toFixed(3)," Kb/s\n      Aborting and switching to level ").concat(E)),e.loader&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),r.trigger(A.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:o}))}}}}}}}},{key:"onFragLoaded",value:function(e,t){var r=t.frag,i=t.part,n=i?i.stats:r.stats;if(r.type===dt.MAIN&&this.bwEstimator.sampleTTFB(n.loading.first-n.loading.start),!this.ignoreFragment(r)){if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var a=i?i.duration:r.duration,o=this.hls.levels[r.level],s=(o.loaded?o.loaded.bytes:0)+n.loaded,l=(o.loaded?o.loaded.duration:0)+a;o.loaded={bytes:s,duration:l},o.realBitrate=Math.round(8*s/l)}if(r.bitrateTest){var u={stats:n,frag:r,part:i,id:r.type};this.onFragBuffered(A.FRAG_BUFFERED,u),r.bitrateTest=!1}}}},{key:"onFragBuffered",value:function(e,t){var r=t.frag,i=t.part,n=null!=i&&i.stats.loaded?i.stats:r.stats;if(!n.aborted&&!this.ignoreFragment(r)){var a=n.parsing.end-n.loading.start-Math.min(n.loading.first-n.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,n.loaded),n.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}}},{key:"ignoreFragment",value:function(e){return e.type!==dt.MAIN||"initSegment"===e.sn}},{key:"clearTimer",value:function(){self.clearInterval(this.timer)}},{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator;if(-1!==e&&!t.canEstimate())return e;var r=this.getNextABRAutoLevel();if(-1!==e){var i=this.hls.levels;if(i.length>Math.max(e,r)&&i[e].loadError<=i[r].loadError)return e}return-1!==e&&(r=Math.min(e,r)),r},set:function(e){this._nextAutoLevel=e}},{key:"getNextABRAutoLevel",value:function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,i=r.maxAutoLevel,n=r.config,a=r.minAutoLevel,o=r.media,s=t?t.duration:e?e.duration:0,l=o&&0!==o.playbackRate?Math.abs(o.playbackRate):1,u=this.bwEstimator?this.bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,c=r.mainForwardBufferInfo,d=(c?c.len:0)/l,h=this.findBestLevel(u,a,i,d,n.abrBandWidthFactor,n.abrBandWidthUpFactor);if(h>=0)return h;P.trace("[abr] ".concat(d?"rebuffering expected":"buffer is empty",", finding optimal quality level"));var f=s?Math.min(s,n.maxStarvationDelay):n.maxStarvationDelay,p=n.abrBandWidthFactor,g=n.abrBandWidthUpFactor;if(!d){var v=this.bitrateTestDelay;if(v){var y=s?Math.min(s,n.maxLoadingDelay):n.maxLoadingDelay;f=y-v,P.trace("[abr] bitrate test took ".concat(Math.round(1e3*v),"ms, set first fragment max fetchDuration to ").concat(Math.round(1e3*f)," ms")),p=g=1}}return h=this.findBestLevel(u,a,i,d+f,p,g),Math.max(h,0)}},{key:"findBestLevel",value:function(e,t,r,i,n,a){for(var o,s=this.fragCurrent,l=this.partCurrent,u=this.lastLoadedFragLevel,c=this.hls.levels,d=c[u],h=!(null==d||null==(o=d.details)||!o.live),f=null==d?void 0:d.codecSet,p=l?l.duration:s?s.duration:0,g=this.bwEstimator.getEstimateTTFB()/1e3,v=t,y=-1,m=r;m>=t;m--){var _=c[m];if(!_||f&&_.codecSet!==f)_&&(v=Math.min(m,v),y=Math.max(m,y));else{-1!==y&&P.trace("[abr] Skipped level(s) ".concat(v,"-").concat(y,' with CODECS:"').concat(c[y].attrs.CODECS,'"; not compatible with "').concat(d.attrs.CODECS,'"'));var b=_.details,T=(l?null==b?void 0:b.partTarget:null==b?void 0:b.averagetargetduration)||p,S=void 0;S=m<=u?n*e:a*e;var E=c[m].maxBitrate,A=this.getTimeToLoadFrag(g,S,E*T,void 0===b);if(P.trace("[abr] level:".concat(m," adjustedbw-bitrate:").concat(Math.round(S-E)," avgDuration:").concat(T.toFixed(1)," maxFetchDuration:").concat(i.toFixed(1)," fetchDuration:").concat(A.toFixed(1))),S>E&&(0===A||!k(A)||h&&!this.bitrateTestDelay||A<i))return m}}return-1}}]),e}(),Hi=function(){function e(){(0,p.default)(this,e),this.chunks=[],this.dataLength=0}return(0,g.default)(e,[{key:"push",value:function(e){this.chunks.push(e),this.dataLength+=e.length}},{key:"flush",value:function(){var e,t=this.chunks,r=this.dataLength;return t.length?(e=1===t.length?t[0]:function(e,t){for(var r=new Uint8Array(t),i=0,n=0;n<e.length;n++){var a=e[n];r.set(a,i),i+=a.length}return r}(t,r),this.reset(),e):new Uint8Array(0)}},{key:"reset",value:function(){this.chunks.length=0,this.dataLength=0}}]),e}();var Vi=function(e){(0,d.default)(r,e);var t=(0,h.default)(r);function r(e,i,n){var a;return(0,p.default)(this,r),a=t.call(this,e,i,n,"[audio-stream-controller]",dt.AUDIO),a.videoBuffer=null,a.videoTrackCC=-1,a.waitingVideoCC=-1,a.bufferedTrack=null,a.switchingTrack=null,a.trackId=-1,a.waitingData=null,a.mainDetails=null,a.bufferFlushed=!1,a.cachedTrackLoadedData=null,a._registerListeners(),a}return(0,g.default)(r,[{key:"onHandlerDestroying",value:function(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}},{key:"_registerListeners",value:function(){var e=this.hls;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(A.ERROR,this.onError,this),e.on(A.BUFFER_RESET,this.onBufferReset,this),e.on(A.BUFFER_CREATED,this.onBufferCreated,this),e.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"_unregisterListeners",value:function(){var e=this.hls;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(A.ERROR,this.onError,this),e.off(A.BUFFER_RESET,this.onBufferReset,this),e.off(A.BUFFER_CREATED,this.onBufferCreated,this),e.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"onInitPtsFound",value:function(e,t){var r=t.frag,i=t.id,n=t.initPTS,a=t.timescale;if("main"===i){var o=r.cc;this.initPTS[r.cc]={baseTime:n,timescale:a},this.log("InitPTS for cc: ".concat(o," found from main: ").concat(n)),this.videoTrackCC=o,this.state===Ar.WAITING_INIT_PTS&&this.tick()}}},{key:"startLoad",value:function(e){if(!this.levels)return this.startPosition=e,void(this.state=Ar.STOPPED);var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),t>0&&-1===e?(this.log("Override startPosition with lastCurrentTime @".concat(t.toFixed(3))),e=t,this.state=Ar.IDLE):(this.loadedmetadata=!1,this.state=Ar.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}},{key:"doTick",value:function(){switch(this.state){case Ar.IDLE:this.doTickIdle();break;case Ar.WAITING_TRACK:var e,t=this.levels,i=this.trackId,n=null==t||null==(e=t[i])?void 0:e.details;if(n){if(this.waitForCdnTuneIn(n))break;this.state=Ar.WAITING_INIT_PTS}break;case Ar.FRAG_LOADING_WAITING_RETRY:var a,o=performance.now(),s=this.retryDate;(!s||o>=s||null!=(a=this.media)&&a.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=Ar.IDLE);break;case Ar.WAITING_INIT_PTS:var l=this.waitingData;if(l){var d=l.frag,h=l.part,f=l.cache,p=l.complete;if(void 0!==this.initPTS[d.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=Ar.FRAG_LOADING;var g=f.flush(),v={frag:d,part:h,payload:g,networkDetails:null};this._handleFragmentLoadProgress(v),p&&(0,u.default)((0,c.default)(r.prototype),"_handleFragmentLoadComplete",this).call(this,v)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc (".concat(d.cc,") cancelled because video is at cc ").concat(this.videoTrackCC)),this.clearWaitingFragment();else{var y=this.getLoadPosition(),m=hr.bufferInfo(this.mediaBuffer,y,this.config.maxBufferHole),_=Kt(m.end,this.config.maxFragLookUpTolerance,d);_<0&&(this.log("Waiting fragment cc (".concat(d.cc,") @ ").concat(d.start," cancelled because another fragment at ").concat(m.end," is needed")),this.clearWaitingFragment())}}else this.state=Ar.IDLE}this.onTickEnd()}},{key:"clearWaitingFragment",value:function(){var e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=Ar.IDLE)}},{key:"resetLoadingState",value:function(){this.clearWaitingFragment(),(0,u.default)((0,c.default)(r.prototype),"resetLoadingState",this).call(this)}},{key:"onTickEnd",value:function(){var e=this.media;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}},{key:"doTickIdle",value:function(){var e=this.hls,t=this.levels,r=this.media,i=this.trackId,n=e.config;if(null!=t&&t[i]&&(r||!this.startFragRequested&&n.startFragPrefetch)){var a=t[i],o=a.details;if(!o||o.live&&this.levelLastLoaded!==i||this.waitForCdnTuneIn(o))this.state=Ar.WAITING_TRACK;else{var s=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&s&&(this.bufferFlushed=!1,this.afterBufferFlushed(s,V.AUDIO,dt.AUDIO));var l=this.getFwdBufferInfo(s,dt.AUDIO);if(null!==l){var u=this.bufferedTrack,c=this.switchingTrack;if(!c&&this._streamEnded(l,o))return e.trigger(A.BUFFER_EOS,{type:"audio"}),void(this.state=Ar.ENDED);var d=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,dt.MAIN),h=l.len,f=this.getMaxBufferLength(null==d?void 0:d.len);if(!(h>=f)||c){var p=o.fragments,g=p[0].start,v=l.end;if(c&&r){var y=this.getLoadPosition();u&&c.attrs!==u.attrs&&(v=y),o.PTSKnown&&y<g&&(l.end>g||l.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=g+.05)}var m=this.getNextFragment(v,o),_=!1;if(m&&this.isLoopLoading(m,v)&&(_=!!m.gap,m=this.getNextFragmentLoopLoading(m,o,l,dt.MAIN,f)),m){var b=d&&m.start>d.end+o.targetduration;if(b||(null==d||!d.len)&&l.len){var T=this.getAppendedFrag(m.start,dt.MAIN);if(null===T)return;if(_||(_=!!T.gap||!!b&&0===d.len),b&&!_||_&&l.nextStart&&l.nextStart<T.end)return}this.loadFragment(m,a,v)}else this.bufferFlushed=!0}}}}}},{key:"getMaxBufferLength",value:function(e){var t=(0,u.default)((0,c.default)(r.prototype),"getMaxBufferLength",this).call(this);return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}},{key:"onMediaDetaching",value:function(){this.videoBuffer=null,(0,u.default)((0,c.default)(r.prototype),"onMediaDetaching",this).call(this)}},{key:"onAudioTracksUpdated",value:function(e,t){var r=t.audioTracks;this.resetTransmuxer(),this.levels=r.map((function(e){return new Lt(e)}))}},{key:"onAudioTrackSwitching",value:function(e,t){var r=!!t.url;this.trackId=t.id;var i=this.fragCurrent;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.switchingTrack=t,this.state=Ar.IDLE):(this.switchingTrack=null,this.bufferedTrack=t,this.state=Ar.STOPPED),this.tick()}},{key:"onManifestLoading",value:function(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}},{key:"onLevelLoaded",value:function(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(A.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}},{key:"onAudioTrackLoaded",value:function(e,t){var r;if(null!=this.mainDetails){var i=this.levels,n=t.details,a=t.id;if(i){this.log("Track ".concat(a," loaded [").concat(n.startSN,",").concat(n.endSN,"]").concat(n.lastPartSn?"[part-".concat(n.lastPartSn,"-").concat(n.lastPartIndex,"]"):"",",duration:").concat(n.totalduration));var o=i[a],s=0;if(n.live||null!=(r=o.details)&&r.live){var l=this.mainDetails;if(n.fragments[0]||(n.deltaUpdateFailed=!0),n.deltaUpdateFailed||!l)return;!o.details&&n.hasProgramDateTime&&l.hasProgramDateTime?(_r(n,l),s=n.fragments[0].start):s=this.alignPlaylists(n,o.details)}o.details=n,this.levelLastLoaded=a,this.startFragRequested||!this.mainDetails&&n.live||this.setStartPosition(o.details,s),this.state!==Ar.WAITING_TRACK||this.waitForCdnTuneIn(n)||(this.state=Ar.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level ".concat(a))}else this.cachedTrackLoadedData=t}},{key:"_handleFragmentLoadProgress",value:function(e){var t,r=e.frag,i=e.part,n=e.payload,a=this.config,o=this.trackId,s=this.levels;if(s){var l=s[o];if(l){var u=l.details;if(!u)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(r.start);var c=a.defaultAudioCodec||l.audioCodec||"mp4a.40.2",d=this.transmuxer;d||(d=this.transmuxer=new Oi(this.hls,dt.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var h=this.initPTS[r.cc],f=null==(t=r.initSegment)?void 0:t.data;if(void 0!==h){var p=i?i.index:-1,g=-1!==p,v=new fr(r.level,r.sn,r.stats.chunkCount,n.byteLength,p,g);d.push(n,f,c,"",r,i,u.totalduration,!1,v,h)}else{this.log("Unknown video PTS for cc ".concat(r.cc,", waiting for video PTS before demuxing audio frag ").concat(r.sn," of [").concat(u.startSN," ,").concat(u.endSN,"],track ").concat(o));var y=this.waitingData=this.waitingData||{frag:r,part:i,cache:new Hi,complete:!1},m=y.cache;m.push(new Uint8Array(n)),this.waitingVideoCC=this.videoTrackCC,this.state=Ar.WAITING_INIT_PTS}}else this.warn("Audio track is undefined on fragment load progress")}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment ".concat(r.sn," of level ").concat(r.level," will not be buffered"))}},{key:"_handleFragmentLoadComplete",value:function(e){this.waitingData?this.waitingData.complete=!0:(0,u.default)((0,c.default)(r.prototype),"_handleFragmentLoadComplete",this).call(this,e)}},{key:"onBufferReset",value:function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}},{key:"onBufferCreated",value:function(e,t){var r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}},{key:"onFragBuffered",value:function(e,t){var r,i=t.frag,n=t.part;if(i.type===dt.AUDIO)if(this.fragContextChanged(i))this.warn("Fragment ".concat(i.sn).concat(n?" p: "+n.index:""," of level ").concat(i.level," finished buffering, but was aborted. state: ").concat(this.state,", audioSwitch: ").concat(this.switchingTrack?this.switchingTrack.name:"false"));else{if("initSegment"!==i.sn){this.fragPrevious=i;var a=this.switchingTrack;a&&(this.bufferedTrack=a,this.switchingTrack=null,this.hls.trigger(A.AUDIO_TRACK_SWITCHED,T({},a)))}this.fragBufferedComplete(i,n)}else this.loadedmetadata||i.type!==dt.MAIN||null!=(r=this.videoBuffer||this.media)&&r.buffered.length&&(this.loadedmetadata=!0)}},{key:"onError",value:function(e,t){var i;if(t.fatal)this.state=Ar.ERROR;else switch(t.details){case x.FRAG_GAP:case x.FRAG_PARSING_ERROR:case x.FRAG_DECRYPT_ERROR:case x.FRAG_LOAD_ERROR:case x.FRAG_LOAD_TIMEOUT:case x.KEY_LOAD_ERROR:case x.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(dt.AUDIO,t);break;case x.AUDIO_TRACK_LOAD_ERROR:case x.AUDIO_TRACK_LOAD_TIMEOUT:case x.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Ar.WAITING_TRACK||(null==(i=t.context)?void 0:i.type)!==ct.AUDIO_TRACK||(this.state=Ar.IDLE);break;case x.BUFFER_FULL_ERROR:if(!t.parent||"audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,(0,u.default)((0,c.default)(r.prototype),"flushMainBuffer",this).call(this,0,Number.POSITIVE_INFINITY,"audio"));break;case x.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}},{key:"onBufferFlushed",value:function(e,t){var r=t.type;r===V.AUDIO&&(this.bufferFlushed=!0,this.state===Ar.ENDED&&(this.state=Ar.IDLE))}},{key:"_handleTransmuxComplete",value:function(e){var t,r="audio",i=this.hls,n=e.remuxResult,a=e.chunkMeta,o=this.getCurrentContext(a);if(o){var s=o.frag,l=o.part,u=o.level,c=u.details,d=n.audio,h=n.text,f=n.id3,p=n.initSegment;if(!this.fragContextChanged(s)&&c){if(this.state=Ar.PARSING,this.switchingTrack&&d&&this.completeAudioSwitch(this.switchingTrack),null!=p&&p.tracks){var g=s.initSegment||s;this._bufferInitSegment(p.tracks,g,a),i.trigger(A.FRAG_PARSING_INIT_SEGMENT,{frag:g,id:r,tracks:p.tracks})}if(d){var v=d.startPTS,y=d.endPTS,m=d.startDTS,_=d.endDTS;l&&(l.elementaryStreams[V.AUDIO]={startPTS:v,endPTS:y,startDTS:m,endDTS:_}),s.setElementaryStreamInfo(V.AUDIO,v,y,m,_),this.bufferFragmentData(d,s,l,a)}if(null!=f&&null!=(t=f.samples)&&t.length){var b=E({id:r,frag:s,details:c},f);i.trigger(A.FRAG_PARSING_METADATA,b)}if(h){var T=E({id:r,frag:s,details:c},h);i.trigger(A.FRAG_PARSING_USERDATA,T)}}else this.fragmentTracker.removeFragment(s)}else this.resetWhenMissingContext(a)}},{key:"_bufferInitSegment",value:function(e,t,r){if(this.state===Ar.PARSING){e.video&&delete e.video;var i=e.audio;if(i){i.levelCodec=i.codec,i.id="audio",this.log("Init audio buffer, container:".concat(i.container,", codecs[parsed]=[").concat(i.codec,"]")),this.hls.trigger(A.BUFFER_CODECS,e);var n=i.initSegment;if(null!=n&&n.byteLength){var a={type:"audio",frag:t,part:null,chunkMeta:r,parent:t.type,data:n};this.hls.trigger(A.BUFFER_APPENDING,a)}this.tick()}}}},{key:"loadFragment",value:function(e,t,i){var n,a=this.fragmentTracker.getState(e);(this.fragCurrent=e,this.switchingTrack||a===er.NOT_LOADED||a===er.PARTIAL)?"initSegment"===e.sn?this._loadInitSegment(e,t):null!=(n=t.details)&&n.live&&!this.initPTS[e.cc]?(this.log("Waiting for video PTS in continuity counter ".concat(e.cc," of live stream before loading audio fragment ").concat(e.sn," of level ").concat(this.trackId)),this.state=Ar.WAITING_INIT_PTS):(this.startFragRequested=!0,(0,u.default)((0,c.default)(r.prototype),"loadFragment",this).call(this,e,t,i)):this.clearTrackerIfNeeded(e)}},{key:"completeAudioSwitch",value:function(e){var t=this.hls,i=this.media,n=this.bufferedTrack,a=null==n?void 0:n.attrs,o=e.attrs;i&&a&&(a.CHANNELS!==o.CHANNELS||a.NAME!==o.NAME||a.LANGUAGE!==o.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),(0,u.default)((0,c.default)(r.prototype),"flushMainBuffer",this).call(this,0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(A.AUDIO_TRACK_SWITCHED,T({},e))}}]),r}(wr),ji=function(e){(0,d.default)(r,e);var t=(0,h.default)(r);function r(e){var i;return(0,p.default)(this,r),i=t.call(this,e,"[audio-track-controller]"),i.tracks=[],i.groupId=null,i.tracksInGroup=[],i.trackId=-1,i.currentTrack=null,i.selectDefaultTrack=!0,i.registerListeners(),i}return(0,g.default)(r,[{key:"registerListeners",value:function(){var e=this.hls;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(A.ERROR,this.onError,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(A.ERROR,this.onError,this)}},{key:"destroy",value:function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,(0,u.default)((0,c.default)(r.prototype),"destroy",this).call(this)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}},{key:"onManifestParsed",value:function(e,t){this.tracks=t.audioTracks||[]}},{key:"onAudioTrackLoaded",value:function(e,t){var r=t.id,i=t.groupId,n=t.details,a=this.tracksInGroup[r];if(a&&a.groupId===i){var o=a.details;a.details=t.details,this.log("audio-track ".concat(r,' "').concat(a.name,'" lang:').concat(a.lang," group:").concat(i," loaded [").concat(n.startSN,"-").concat(n.endSN,"]")),r===this.trackId&&this.playlistLoaded(r,t,o)}else this.warn("Track with id:".concat(r," and group:").concat(i," not found in active group ").concat(a.groupId))}},{key:"onLevelLoading",value:function(e,t){this.switchLevel(t.level)}},{key:"onLevelSwitching",value:function(e,t){this.switchLevel(t.level)}},{key:"switchLevel",value:function(e){var t=this.hls.levels[e];if(null!=t&&t.audioGroupIds){var r=t.audioGroupIds[t.urlId];if(this.groupId!==r){this.groupId=r||null;var i=this.tracks.filter((function(e){return!r||e.groupId===r}));this.selectDefaultTrack&&!i.some((function(e){return e.default}))&&(this.selectDefaultTrack=!1),this.tracksInGroup=i;var n={audioTracks:i};this.log("Updating audio tracks, ".concat(i.length," track(s) found in group:").concat(r)),this.hls.trigger(A.AUDIO_TRACKS_UPDATED,n),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}}},{key:"onError",value:function(e,t){!t.fatal&&t.context&&t.context.type===ct.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(t))}},{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}},{key:"setAudioTrack",value:function(e){var t=this.tracksInGroup;if(e<0||e>=t.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var r=this.currentTrack;t[this.trackId];var i=t[e],n=i.groupId,a=i.name;if(this.log("Switching to audio-track ".concat(e,' "').concat(a,'" lang:').concat(i.lang," group:").concat(n)),this.trackId=e,this.currentTrack=i,this.selectDefaultTrack=!1,this.hls.trigger(A.AUDIO_TRACK_SWITCHING,T({},i)),!i.details||i.details.live){var o=this.switchParams(i.url,null==r?void 0:r.details);this.loadPlaylist(o)}}}},{key:"selectInitialTrack",value:function(){var e=this.tracksInGroup,t=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(-1!==t)this.setAudioTrack(t);else{var r=new Error("No track found for running audio group-ID: ".concat(this.groupId," track count: ").concat(e.length));this.warn(r.message),this.hls.trigger(A.ERROR,{type:w.MEDIA_ERROR,details:x.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:r})}}},{key:"findTrackId",value:function(e){for(var t=this.tracksInGroup,r=0;r<t.length;r++){var i=t[r];if(!this.selectDefaultTrack||i.default){if(!e||void 0!==e.attrs["STABLE-RENDITION-ID"]&&e.attrs["STABLE-RENDITION-ID"]===i.attrs["STABLE-RENDITION-ID"])return i.id;if(e.name===i.name&&e.lang===i.lang)return i.id}}return-1}},{key:"loadPlaylist",value:function(e){(0,u.default)((0,c.default)(r.prototype),"loadPlaylist",this).call(this);var t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){var i=t.id,n=t.groupId,a=t.url;if(e)try{a=e.addDirectives(a)}catch(o){this.warn("Could not construct new URL with HLS Delivery Directives: ".concat(o))}this.log("loading audio-track playlist ".concat(i,' "').concat(t.name,'" lang:').concat(t.lang," group:").concat(n)),this.clearTimer(),this.hls.trigger(A.AUDIO_TRACK_LOADING,{url:a,id:i,groupId:n,deliveryDirectives:e||null})}}}]),r}(Qt);function Gi(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!Ki(e[r].attrs,t[r].attrs))return!1;return!0}function Ki(e,t){var r=e["STABLE-RENDITION-ID"];return r?r===t["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some((function(r){return e[r]!==t[r]}))}var qi=function(e){(0,d.default)(r,e);var t=(0,h.default)(r);function r(e,i,n){var a;return(0,p.default)(this,r),a=t.call(this,e,i,n,"[subtitle-stream-controller]",dt.SUBTITLE),a.levels=[],a.currentTrackId=-1,a.tracksBuffered=[],a.mainDetails=null,a._registerListeners(),a}return(0,g.default)(r,[{key:"onHandlerDestroying",value:function(){this._unregisterListeners(),this.mainDetails=null}},{key:"_registerListeners",value:function(){var e=this.hls;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.ERROR,this.onError,this),e.on(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(A.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"_unregisterListeners",value:function(){var e=this.hls;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.ERROR,this.onError,this),e.off(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(A.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"startLoad",value:function(e){this.stopLoad(),this.state=Ar.IDLE,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}},{key:"onManifestLoading",value:function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}},{key:"onMediaDetaching",value:function(){this.tracksBuffered=[],(0,u.default)((0,c.default)(r.prototype),"onMediaDetaching",this).call(this)}},{key:"onLevelLoaded",value:function(e,t){this.mainDetails=t.details}},{key:"onSubtitleFragProcessed",value:function(e,t){var r=t.frag,i=t.success;if(this.fragPrevious=r,this.state=Ar.IDLE,i){var n=this.tracksBuffered[this.currentTrackId];if(n){for(var a,o=r.start,s=0;s<n.length;s++)if(o>=n[s].start&&o<=n[s].end){a=n[s];break}var l=r.start+r.duration;a?a.end=l:(a={start:o,end:l},n.push(a)),this.fragmentTracker.fragBuffered(r)}}}},{key:"onBufferFlushing",value:function(e,t){var r=t.startOffset,i=t.endOffset;if(0===r&&i!==Number.POSITIVE_INFINITY){var n=this.currentTrackId,a=this.levels;if(!a.length||!a[n]||!a[n].details)return;var o=a[n].details,s=o.targetduration,l=i-s;if(l<=0)return;t.endOffsetSubtitles=Math.max(0,l),this.tracksBuffered.forEach((function(e){for(var t=0;t<e.length;)if(e[t].end<=l)e.shift();else{if(!(e[t].start<l))break;e[t].start=l,t++}})),this.fragmentTracker.removeFragmentsInRange(r,l,dt.SUBTITLE)}}},{key:"onFragBuffered",value:function(e,t){var r;this.loadedmetadata||t.frag.type!==dt.MAIN||null!=(r=this.media)&&r.buffered.length&&(this.loadedmetadata=!0)}},{key:"onError",value:function(e,t){var r=t.frag;(null==r?void 0:r.type)===dt.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Ar.STOPPED&&(this.state=Ar.IDLE))}},{key:"onSubtitleTracksUpdated",value:function(e,t){var r=this,i=t.subtitleTracks;Gi(this.levels,i)?this.levels=i.map((function(e){return new Lt(e)})):(this.tracksBuffered=[],this.levels=i.map((function(e){var t=new Lt(e);return r.tracksBuffered[t.id]=[],t})),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,dt.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null)}},{key:"onSubtitleTrackSwitch",value:function(e,t){if(this.currentTrackId=t.id,this.levels.length&&-1!==this.currentTrackId){var r=this.levels[this.currentTrackId];null!=r&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.setInterval(500)}else this.clearInterval()}},{key:"onSubtitleTrackLoaded",value:function(e,t){var r,i=t.details,n=t.id,a=this.currentTrackId,o=this.levels;if(o.length){var s=o[a];if(!(n>=o.length||n!==a)&&s){this.mediaBuffer=this.mediaBufferTimeRanges;var l=0;if(i.live||null!=(r=s.details)&&r.live){var u=this.mainDetails;if(i.deltaUpdateFailed||!u)return;var c=u.fragments[0];s.details?(l=this.alignPlaylists(i,s.details),0===l&&c&&(l=c.start,Ot(i,l))):i.hasProgramDateTime&&u.hasProgramDateTime?(_r(i,u),l=i.fragments[0].start):c&&(l=c.start,Ot(i,l))}if(s.details=i,this.levelLastLoaded=n,this.startFragRequested||!this.mainDetails&&i.live||this.setStartPosition(s.details,l),this.tick(),i.live&&!this.fragCurrent&&this.media&&this.state===Ar.IDLE){var d=Gt(null,i.fragments,this.media.currentTime,0);d||(this.warn("Subtitle playlist not aligned with playback"),s.details=void 0)}}}}},{key:"_handleFragmentLoadComplete",value:function(e){var t=this,r=e.frag,i=e.payload,n=r.decryptdata,a=this.hls;if(!this.fragContextChanged(r)&&i&&i.byteLength>0&&n&&n.key&&n.iv&&"AES-128"===n.method){var o=performance.now();this.decrypter.decrypt(new Uint8Array(i),n.key.buffer,n.iv.buffer).catch((function(e){throw a.trigger(A.ERROR,{type:w.MEDIA_ERROR,details:x.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:r}),e})).then((function(e){var t=performance.now();a.trigger(A.FRAG_DECRYPTED,{frag:r,payload:e,stats:{tstart:o,tdecrypt:t}})})).catch((function(e){t.warn("".concat(e.name,": ").concat(e.message)),t.state=Ar.IDLE}))}}},{key:"doTick",value:function(){if(this.media){if(this.state===Ar.IDLE){var e=this.currentTrackId,t=this.levels,r=t[e];if(!t.length||!r||!r.details)return;var i=r.details,n=i.targetduration,a=this.config,o=this.getLoadPosition(),s=hr.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],o-n,a.maxBufferHole),l=s.end,u=s.len,c=this.getFwdBufferInfo(this.media,dt.MAIN),d=this.getMaxBufferLength(null==c?void 0:c.len)+n;if(u>d)return;var h=i.fragments,f=h.length,p=i.edge,g=null,v=this.fragPrevious;if(l<p){var y=a.maxFragLookUpTolerance;g=Gt(v,h,Math.max(h[0].start,l),y),!g&&v&&v.start<h[0].start&&(g=h[0])}else g=h[f-1];if(!g)return;g=this.mapToInitFragWhenRequired(g),this.fragmentTracker.getState(g)===er.NOT_LOADED&&this.loadFragment(g,r,l)}}else this.state=Ar.IDLE}},{key:"getMaxBufferLength",value:function(e){var t=(0,u.default)((0,c.default)(r.prototype),"getMaxBufferLength",this).call(this);return e?Math.max(t,e):t}},{key:"loadFragment",value:function(e,t,i){this.fragCurrent=e,"initSegment"===e.sn?this._loadInitSegment(e,t):(this.startFragRequested=!0,(0,u.default)((0,c.default)(r.prototype),"loadFragment",this).call(this,e,t,i))}},{key:"mediaBufferTimeRanges",get:function(){return new Wi(this.tracksBuffered[this.currentTrackId]||[])}}]),r}(wr),Wi=(0,g.default)((function e(t){(0,p.default)(this,e),this.buffered=void 0;var r=function(e,r,i){if(r>>>=0,r>i-1)throw new DOMException("Failed to execute '".concat(e,"' on 'TimeRanges': The index provided (").concat(r,") is greater than the maximum bound (").concat(i,")"));return t[r][e]};this.buffered={get length(){return t.length},end:function(e){return r("end",e,t.length)},start:function(e){return r("start",e,t.length)}}})),Yi=function(e){(0,d.default)(r,e);var t=(0,h.default)(r);function r(e){var i;return(0,p.default)(this,r),i=t.call(this,e,"[subtitle-track-controller]"),i.media=null,i.tracks=[],i.groupId=null,i.tracksInGroup=[],i.trackId=-1,i.selectDefaultTrack=!0,i.queuedDefaultTrack=-1,i.trackChangeListener=function(){return i.onTextTracksChanged()},i.asyncPollTrackChange=function(){return i.pollTrackChange(0)},i.useTextTrackPolling=!1,i.subtitlePollingInterval=-1,i._subtitleDisplay=!0,i.registerListeners(),i}return(0,g.default)(r,[{key:"destroy",value:function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,(0,u.default)((0,c.default)(r.prototype),"destroy",this).call(this)}},{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"registerListeners",value:function(){var e=this.hls;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(A.ERROR,this.onError,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(A.ERROR,this.onError,this)}},{key:"onMediaAttached",value:function(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}},{key:"pollTrackChange",value:function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)}},{key:"onMediaDetaching",value:function(){if(this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var e=zi(this.media.textTracks);e.forEach((function(e){yt(e)})),this.subtitleTrack=-1,this.media=null}}},{key:"onManifestLoading",value:function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}},{key:"onManifestParsed",value:function(e,t){this.tracks=t.subtitleTracks}},{key:"onSubtitleTrackLoaded",value:function(e,t){var r=t.id,i=t.details,n=this.trackId,a=this.tracksInGroup[n];if(a){var o=a.details;a.details=t.details,this.log("subtitle track ".concat(r," loaded [").concat(i.startSN,"-").concat(i.endSN,"]")),r===this.trackId&&this.playlistLoaded(r,t,o)}else this.warn("Invalid subtitle track id ".concat(r))}},{key:"onLevelLoading",value:function(e,t){this.switchLevel(t.level)}},{key:"onLevelSwitching",value:function(e,t){this.switchLevel(t.level)}},{key:"switchLevel",value:function(e){var t=this.hls.levels[e];if(null!=t&&t.textGroupIds){var r=t.textGroupIds[t.urlId],i=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==r){var n=this.tracks.filter((function(e){return!r||e.groupId===r}));this.tracksInGroup=n;var a=this.findTrackId(null==i?void 0:i.name)||this.findTrackId();this.groupId=r||null;var o={subtitleTracks:n};this.log("Updating subtitle tracks, ".concat(n.length,' track(s) found in "').concat(r,'" group-id')),this.hls.trigger(A.SUBTITLE_TRACKS_UPDATED,o),-1!==a&&this.setSubtitleTrack(a,i)}else this.shouldReloadPlaylist(i)&&this.setSubtitleTrack(this.trackId,i)}}},{key:"findTrackId",value:function(e){for(var t=this.tracksInGroup,r=0;r<t.length;r++){var i=t[r];if((!this.selectDefaultTrack||i.default)&&(!e||e===i.name))return i.id}return-1}},{key:"onError",value:function(e,t){!t.fatal&&t.context&&t.context.type===ct.SUBTITLE_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.checkRetry(t)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}},{key:"loadPlaylist",value:function(e){(0,u.default)((0,c.default)(r.prototype),"loadPlaylist",this).call(this);var t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){var i=t.id,n=t.groupId,a=t.url;if(e)try{a=e.addDirectives(a)}catch(o){this.warn("Could not construct new URL with HLS Delivery Directives: ".concat(o))}this.log("Loading subtitle playlist for id ".concat(i)),this.hls.trigger(A.SUBTITLE_TRACK_LOADING,{url:a,id:i,groupId:n,deliveryDirectives:e||null})}}},{key:"toggleTrackModes",value:function(e){var t=this,r=this.media,i=this.trackId;if(r){var n=zi(r.textTracks),a=n.filter((function(e){return e.groupId===t.groupId}));if(-1===e)[].slice.call(n).forEach((function(e){e.mode="disabled"}));else{var o=a[i];o&&(o.mode="disabled")}var s=a[e];s&&(s.mode=this.subtitleDisplay?"showing":"hidden")}}},{key:"setSubtitleTrack",value:function(e,t){var r,i=this.tracksInGroup;if(this.media){if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(-1===e||null!=(r=i[e])&&r.details)||e<-1||e>=i.length)){this.clearTimer();var n=i[e];if(this.log("Switching to subtitle-track ".concat(e)+(n?' "'.concat(n.name,'" lang:').concat(n.lang," group:").concat(n.groupId):"")),this.trackId=e,n){var a=n.id,o=n.groupId,s=void 0===o?"":o,l=n.name,u=n.type,c=n.url;this.hls.trigger(A.SUBTITLE_TRACK_SWITCH,{id:a,groupId:s,name:l,type:u,url:c});var d=this.switchParams(n.url,null==t?void 0:t.details);this.loadPlaylist(d)}else this.hls.trigger(A.SUBTITLE_TRACK_SWITCH,{id:e})}}else this.queuedDefaultTrack=e}},{key:"onTextTracksChanged",value:function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var e=-1,t=zi(this.media.textTracks),r=0;r<t.length;r++)if("hidden"===t[r].mode)e=r;else if("showing"===t[r].mode){e=r;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}}}]),r}(Qt);function zi(e){for(var t=[],r=0;r<e.length;r++){var i=e[r];"subtitles"!==i.kind&&"captions"!==i.kind||!i.label||t.push(e[r])}return t}var Xi=function(){function e(t){(0,p.default)(this,e),this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}return(0,g.default)(e,[{key:"append",value:function(e,t){var r=this.queues[t];r.push(e),1===r.length&&this.buffers[t]&&this.executeNext(t)}},{key:"insertAbort",value:function(e,t){var r=this.queues[t];r.unshift(e),this.executeNext(t)}},{key:"appendBlocker",value:function(e){var t,r=new Promise((function(e){t=e})),i={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(i,e),r}},{key:"executeNext",value:function(e){var t=this.buffers,r=this.queues,i=t[e],n=r[e];if(n.length){var a=n[0];try{a.execute()}catch(o){P.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),a.onError(o),null!=i&&i.updating||(n.shift(),this.executeNext(e))}}}},{key:"shiftAndExecuteNext",value:function(e){this.queues[e].shift(),this.executeNext(e)}},{key:"current",value:function(e){return this.queues[e][0]}}]),e}(),Qi=Ye(),Ji=/([ha]vc.)(?:\.[^.,]+)+/,Zi=function(){function e(t){var r=this;(0,p.default)(this,e),this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var e=r.media,t=r.mediaSource;P.log("[buffer-controller]: Media source opened"),e&&(e.removeEventListener("emptied",r._onMediaEmptied),r.updateMediaElementDuration(),r.hls.trigger(A.MEDIA_ATTACHED,{media:e})),t&&t.removeEventListener("sourceopen",r._onMediaSourceOpen),r.checkPendingTracks()},this._onMediaSourceClose=function(){P.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){P.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var e=r.media,t=r._objectUrl;e&&e.src!==t&&P.error("Media element src was set while attaching MediaSource (".concat(t," > ").concat(e.src,")"))},this.hls=t,this._initSourceBuffer(),this.registerListeners()}return(0,g.default)(e,[{key:"hasSourceTypes",value:function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}},{key:"destroy",value:function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}},{key:"registerListeners",value:function(){var e=this.hls;e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.BUFFER_RESET,this.onBufferReset,this),e.on(A.BUFFER_APPENDING,this.onBufferAppending,this),e.on(A.BUFFER_CODECS,this.onBufferCodecs,this),e.on(A.BUFFER_EOS,this.onBufferEos,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.FRAG_PARSED,this.onFragParsed,this),e.on(A.FRAG_CHANGED,this.onFragChanged,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.BUFFER_RESET,this.onBufferReset,this),e.off(A.BUFFER_APPENDING,this.onBufferAppending,this),e.off(A.BUFFER_CODECS,this.onBufferCodecs,this),e.off(A.BUFFER_EOS,this.onBufferEos,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.FRAG_PARSED,this.onFragParsed,this),e.off(A.FRAG_CHANGED,this.onFragChanged,this)}},{key:"_initSourceBuffer",value:function(){this.sourceBuffer={},this.operationQueue=new Xi(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}},{key:"onManifestLoading",value:function(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}},{key:"onManifestParsed",value:function(e,t){var r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,P.log("".concat(this.bufferCodecEventsExpected," bufferCodec event(s) expected"))}},{key:"onMediaAttaching",value:function(e,t){var r=this.media=t.media;if(r&&Qi){var i=this.mediaSource=new Qi;i.addEventListener("sourceopen",this._onMediaSourceOpen),i.addEventListener("sourceended",this._onMediaSourceEnded),i.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(i),this._objectUrl=r.src,r.addEventListener("emptied",this._onMediaEmptied)}}},{key:"onMediaDetaching",value:function(){var e=this.media,t=this.mediaSource,r=this._objectUrl;if(t){if(P.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(ga){P.warn("[buffer-controller]: onMediaDetaching: ".concat(ga.message," while calling endOfStream"))}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),e.src===r?(e.removeAttribute("src"),e.load()):P.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(A.MEDIA_DETACHED,void 0)}},{key:"onBufferReset",value:function(){var e=this;this.getSourceBufferTypes().forEach((function(t){var r=e.sourceBuffer[t];try{r&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(r),e.sourceBuffer[t]=void 0)}catch(ga){P.warn("[buffer-controller]: Failed to reset the ".concat(t," buffer"),ga)}})),this._initSourceBuffer()}},{key:"onBufferCodecs",value:function(e,t){var r=this,i=this.getSourceBufferTypes().length;Object.keys(t).forEach((function(e){if(i){var n=r.tracks[e];if(n&&"function"===typeof n.buffer.changeType){var a=t[e],o=a.id,s=a.codec,l=a.levelCodec,u=a.container,c=a.metadata,d=(n.levelCodec||n.codec).replace(Ji,"$1"),h=(l||s).replace(Ji,"$1");if(d!==h){var f="".concat(u,";codecs=").concat(l||s);r.appendChangeType(e,f),P.log("[buffer-controller]: switching codec ".concat(d," to ").concat(h)),r.tracks[e]={buffer:n.buffer,codec:s,container:u,levelCodec:l,metadata:c,id:o}}}}else r.pendingTracks[e]=t[e]})),i||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())}},{key:"appendChangeType",value:function(e,t){var r=this,i=this.operationQueue,n={execute:function(){var n=r.sourceBuffer[e];n&&(P.log("[buffer-controller]: changing ".concat(e," sourceBuffer type to ").concat(t)),n.changeType(t)),i.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(t){P.warn("[buffer-controller]: Failed to change ".concat(e," SourceBuffer type"),t)}};i.append(n,e)}},{key:"onBufferAppending",value:function(e,t){var r=this,i=this.hls,n=this.operationQueue,a=this.tracks,o=t.data,s=t.type,l=t.frag,u=t.part,c=t.chunkMeta,d=c.buffering[s],h=self.performance.now();d.start=h;var f=l.stats.buffering,p=u?u.stats.buffering:null;0===f.start&&(f.start=h),p&&0===p.start&&(p.start=h);var g=a.audio,v=!1;"audio"===s&&"audio/mpeg"===(null==g?void 0:g.container)&&(v=!this.lastMpegAudioChunk||1===c.id||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);var y=l.start,m={execute:function(){if(d.executeStart=self.performance.now(),v){var e=r.sourceBuffer[s];if(e){var t=y-e.timestampOffset;Math.abs(t)>=.1&&(P.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to ".concat(y," (delta: ").concat(t,") sn: ").concat(l.sn,")")),e.timestampOffset=y)}}r.appendExecutor(o,s)},onStart:function(){},onComplete:function(){var e=self.performance.now();d.executeEnd=d.end=e,0===f.first&&(f.first=e),p&&0===p.first&&(p.first=e);var t=r.sourceBuffer,i={};for(var n in t)i[n]=hr.getBuffered(t[n]);r.appendError=0,r.hls.trigger(A.BUFFER_APPENDED,{type:s,frag:l,part:u,chunkMeta:c,parent:l.type,timeRanges:i})},onError:function(e){P.error("[buffer-controller]: Error encountered while trying to append to the ".concat(s," SourceBuffer"),e);var t={type:w.MEDIA_ERROR,parent:l.type,details:x.BUFFER_APPEND_ERROR,frag:l,part:u,chunkMeta:c,error:e,err:e,fatal:!1};e.code===DOMException.QUOTA_EXCEEDED_ERR?t.details=x.BUFFER_FULL_ERROR:(r.appendError++,t.details=x.BUFFER_APPEND_ERROR,r.appendError>i.config.appendErrorMaxRetry&&(P.error("[buffer-controller]: Failed ".concat(i.config.appendErrorMaxRetry," times to append segment in sourceBuffer")),t.fatal=!0)),i.trigger(A.ERROR,t)}};n.append(m,s)}},{key:"onBufferFlushing",value:function(e,t){var r=this,i=this.operationQueue,n=function(e){return{execute:r.removeExecutor.bind(r,e,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(A.BUFFER_FLUSHED,{type:e})},onError:function(t){P.warn("[buffer-controller]: Failed to remove from ".concat(e," SourceBuffer"),t)}}};t.type?i.append(n(t.type),t.type):this.getSourceBufferTypes().forEach((function(e){i.append(n(e),e)}))}},{key:"onFragParsed",value:function(e,t){var r=this,i=t.frag,n=t.part,a=[],o=n?n.elementaryStreams:i.elementaryStreams;o[V.AUDIOVIDEO]?a.push("audiovideo"):(o[V.AUDIO]&&a.push("audio"),o[V.VIDEO]&&a.push("video"));0===a.length&&P.warn("Fragments must have at least one ElementaryStreamType set. type: ".concat(i.type," level: ").concat(i.level," sn: ").concat(i.sn)),this.blockBuffers((function(){var e=self.performance.now();i.stats.buffering.end=e,n&&(n.stats.buffering.end=e);var t=n?n.stats:i.stats;r.hls.trigger(A.FRAG_BUFFERED,{frag:i,part:n,stats:t,id:i.type})}),a)}},{key:"onFragChanged",value:function(e,t){this.flushBackBuffer()}},{key:"onBufferEos",value:function(e,t){var r=this,i=this.getSourceBufferTypes().reduce((function(e,i){var n=r.sourceBuffer[i];return!n||t.type&&t.type!==i||(n.ending=!0,n.ended||(n.ended=!0,P.log("[buffer-controller]: ".concat(i," sourceBuffer now EOS")))),e&&!(n&&!n.ended)}),!0);i&&(P.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers((function(){r.getSourceBufferTypes().forEach((function(e){var t=r.sourceBuffer[e];t&&(t.ending=!1)}));var e=r.mediaSource;e&&"open"===e.readyState?(P.log("[buffer-controller]: Calling mediaSource.endOfStream()"),e.endOfStream()):e&&P.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ".concat(e.readyState))})))}},{key:"onLevelUpdated",value:function(e,t){var r=t.details;r.fragments.length&&(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}},{key:"flushBackBuffer",value:function(){var e=this.hls,t=this.details,r=this.media,i=this.sourceBuffer;if(r&&null!==t){var n=this.getSourceBufferTypes();if(n.length){var a=t.live&&null!==e.config.liveBackBufferLength?e.config.liveBackBufferLength:e.config.backBufferLength;if(k(a)&&!(a<0)){var o=r.currentTime,s=t.levelTargetDuration,l=Math.max(a,s),u=Math.floor(o/s)*s-l;n.forEach((function(r){var n=i[r];if(n){var a=hr.getBuffered(n);if(a.length>0&&u>a.start(0)){if(e.trigger(A.BACK_BUFFER_REACHED,{bufferEnd:u}),t.live)e.trigger(A.LIVE_BACK_BUFFER_REACHED,{bufferEnd:u});else if(n.ended&&a.end(a.length-1)-o<2*s)return void P.info("[buffer-controller]: Cannot flush ".concat(r," back buffer while SourceBuffer is in ended state"));e.trigger(A.BUFFER_FLUSHING,{startOffset:0,endOffset:u,type:r})}}}))}}}}},{key:"updateMediaElementDuration",value:function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var e=this.details,t=this.hls,r=this.media,i=this.mediaSource,n=e.fragments[0].start+e.totalduration,a=r.duration,o=k(i.duration)?i.duration:0;e.live&&t.config.liveDurationInfinity?(P.log("[buffer-controller]: Media Source duration is set to Infinity"),i.duration=1/0,this.updateSeekableRange(e)):(n>o&&n>a||!k(a))&&(P.log("[buffer-controller]: Updating Media Source duration to ".concat(n.toFixed(3))),i.duration=n)}}},{key:"updateSeekableRange",value:function(e){var t=this.mediaSource,r=e.fragments,i=r.length;if(i&&e.live&&null!=t&&t.setLiveSeekableRange){var n=Math.max(0,r[0].start),a=Math.max(n,n+e.totalduration);t.setLiveSeekableRange(n,a)}}},{key:"checkPendingTracks",value:function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,r=this.pendingTracks,i=Object.keys(r).length;if(i&&!e||2===i){this.createSourceBuffers(r),this.pendingTracks={};var n=this.getSourceBufferTypes();if(n.length)this.hls.trigger(A.BUFFER_CREATED,{tracks:this.tracks}),n.forEach((function(e){t.executeNext(e)}));else{var a=new Error("could not create source buffer for media codec(s)");this.hls.trigger(A.ERROR,{type:w.MEDIA_ERROR,details:x.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:a,reason:a.message})}}}},{key:"createSourceBuffers",value:function(e){var t=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(var i in e)if(!t[i]){var n=e[i];if(!n)throw Error("source buffer exists for track ".concat(i,", however track does not"));var a=n.levelCodec||n.codec,o="".concat(n.container,";codecs=").concat(a);P.log("[buffer-controller]: creating sourceBuffer(".concat(o,")"));try{var s=t[i]=r.addSourceBuffer(o),l=i;this.addBufferListener(l,"updatestart",this._onSBUpdateStart),this.addBufferListener(l,"updateend",this._onSBUpdateEnd),this.addBufferListener(l,"error",this._onSBUpdateError),this.tracks[i]={buffer:s,codec:a,container:n.container,levelCodec:n.levelCodec,metadata:n.metadata,id:n.id}}catch(ga){P.error("[buffer-controller]: error while trying to add sourceBuffer: ".concat(ga.message)),this.hls.trigger(A.ERROR,{type:w.MEDIA_ERROR,details:x.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:ga,mimeType:o})}}}},{key:"_onSBUpdateStart",value:function(e){var t=this.operationQueue,r=t.current(e);r.onStart()}},{key:"_onSBUpdateEnd",value:function(e){var t=this.operationQueue,r=t.current(e);r.onComplete(),t.shiftAndExecuteNext(e)}},{key:"_onSBUpdateError",value:function(e,t){var r=new Error("".concat(e," SourceBuffer error"));P.error("[buffer-controller]: ".concat(r),t),this.hls.trigger(A.ERROR,{type:w.MEDIA_ERROR,details:x.BUFFER_APPENDING_ERROR,error:r,fatal:!1});var i=this.operationQueue.current(e);i&&i.onError(t)}},{key:"removeExecutor",value:function(e,t,r){var i=this.media,n=this.mediaSource,a=this.operationQueue,o=this.sourceBuffer,s=o[e];if(!i||!n||!s)return P.warn("[buffer-controller]: Attempting to remove from the ".concat(e," SourceBuffer, but it does not exist")),void a.shiftAndExecuteNext(e);var l=k(i.duration)?i.duration:1/0,u=k(n.duration)?n.duration:1/0,c=Math.max(0,t),d=Math.min(r,l,u);d>c&&!s.ending?(s.ended=!1,P.log("[buffer-controller]: Removing [".concat(c,",").concat(d,"] from the ").concat(e," SourceBuffer")),s.remove(c,d)):a.shiftAndExecuteNext(e)}},{key:"appendExecutor",value:function(e,t){var r=this.operationQueue,i=this.sourceBuffer,n=i[t];if(!n)return P.warn("[buffer-controller]: Attempting to append to the ".concat(t," SourceBuffer, but it does not exist")),void r.shiftAndExecuteNext(t);n.ended=!1,n.appendBuffer(e)}},{key:"blockBuffers",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getSourceBufferTypes();if(!r.length)return P.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);var i=this.operationQueue,n=r.map((function(e){return i.appendBlocker(e)}));Promise.all(n).then((function(){e(),r.forEach((function(e){var r=t.sourceBuffer[e];null!=r&&r.updating||i.shiftAndExecuteNext(e)}))}))}},{key:"getSourceBufferTypes",value:function(){return Object.keys(this.sourceBuffer)}},{key:"addBufferListener",value:function(e,t,r){var i=this.sourceBuffer[e];if(i){var n=r.bind(this,e);this.listeners[e].push({event:t,listener:n}),i.addEventListener(t,n)}}},{key:"removeBufferListeners",value:function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach((function(e){t.removeEventListener(e.event,e.listener)}))}}]),e}(),$i={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},en=function(e){var t=e;return $i.hasOwnProperty(e)&&(t=$i[e]),String.fromCharCode(t)},tn={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rn={17:2,18:4,21:6,22:8,23:10,19:13,20:15},nn={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},an={25:2,26:4,29:6,30:8,31:10,27:13,28:15},on=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],sn=function(){function e(){(0,p.default)(this,e),this.time=null,this.verboseLevel=0}return(0,g.default)(e,[{key:"log",value:function(e,t){if(this.verboseLevel>=e){var r="function"===typeof t?t():t;P.log("".concat(this.time," [").concat(e,"] ").concat(r))}}}]),e}(),ln=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].toString(16));return t},un=function(){function e(t,r,i,n,a){(0,p.default)(this,e),this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=r||!1,this.italics=i||!1,this.background=n||"black",this.flash=a||!1}return(0,g.default)(e,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}},{key:"copy",value:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),e}(),cn=function(){function e(t,r,i,n,a,o){(0,p.default)(this,e),this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new un(r,i,n,a,o)}return(0,g.default)(e,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(e,t){this.uchar=e,this.penState.copy(t)}},{key:"setPenState",value:function(e){this.penState.copy(e)}},{key:"equals",value:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}},{key:"copy",value:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),e}(),dn=function(){function e(t){(0,p.default)(this,e),this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var r=0;r<100;r++)this.chars.push(new cn);this.logger=t,this.pos=0,this.currPenState=new un}return(0,g.default)(e,[{key:"equals",value:function(e){for(var t=!0,r=0;r<100;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<100;t++)this.chars[t].copy(e.chars[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<100;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}},{key:"setCursor",value:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>100&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=100)}},{key:"moveCursor",value:function(e){var t=this.pos+e;if(e>1)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(e){var t=this;e>=144&&this.backSpace();var r=en(e);this.pos>=100?this.logger.log(0,(function(){return"Cannot insert "+e.toString(16)+" ("+r+") at position "+t.pos+". Skipping it!"})):(this.chars[this.pos].setChar(r,this.currPenState),this.moveCursor(1))}},{key:"clearFromPos",value:function(e){var t;for(t=e;t<100;t++)this.chars[t].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var e=[],t=!0,r=0;r<100;r++){var i=this.chars[r].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")}},{key:"setPenStyles",value:function(e){this.currPenState.setStyles(e);var t=this.chars[this.pos];t.setPenState(this.currPenState)}}]),e}(),hn=function(){function e(t){(0,p.default)(this,e),this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var r=0;r<15;r++)this.rows.push(new dn(t));this.logger=t,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}return(0,g.default)(e,[{key:"reset",value:function(){for(var e=0;e<15;e++)this.rows[e].clear();this.currRow=14}},{key:"equals",value:function(e){for(var t=!0,r=0;r<15;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<15;t++)this.rows[t].copy(e.rows[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<15;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}},{key:"backSpace",value:function(){var e=this.rows[this.currRow];e.backSpace()}},{key:"clearToEndOfRow",value:function(){var e=this.rows[this.currRow];e.clearToEndOfRow()}},{key:"insertChar",value:function(e){var t=this.rows[this.currRow];t.insertChar(e)}},{key:"setPen",value:function(e){var t=this.rows[this.currRow];t.setPenStyles(e)}},{key:"moveCursor",value:function(e){var t=this.rows[this.currRow];t.moveCursor(e)}},{key:"setCursor",value:function(e){this.logger.log(2,"setCursor: "+e);var t=this.rows[this.currRow];t.setCursor(e)}},{key:"setPAC",value:function(e){this.logger.log(2,(function(){return"pacData = "+JSON.stringify(e)}));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var r=0;r<15;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){var a=n.rows[i].cueStartTime,o=this.logger.time;if(a&&null!==o&&a<o)for(var s=0;s<this.nrRollUpRows;s++)this.rows[t-this.nrRollUpRows+s+1].copy(n.rows[i+s])}}this.currRow=t;var l=this.rows[this.currRow];if(null!==e.indent){var u=e.indent,c=Math.max(u-1,0);l.setCursor(e.indent),e.color=l.chars[c].penState.foreground}var d={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(d)}},{key:"setBkgData",value:function(e){this.logger.log(2,(function(){return"bkgData = "+JSON.stringify(e)})),this.backSpace(),this.setPen(e),this.insertChar(32)}},{key:"setRollUpRows",value:function(e){this.nrRollUpRows=e}},{key:"rollUp",value:function(){var e=this;if(null!==this.nrRollUpRows){this.logger.log(1,(function(){return e.getDisplayText()}));var t=this.currRow+1-this.nrRollUpRows,r=this.rows.splice(t,1)[0];r.clear(),this.rows.splice(this.currRow,0,r),this.logger.log(2,"Rolling up")}else this.logger.log(3,"roll_up but nrRollUpRows not set yet")}},{key:"getDisplayText",value:function(e){e=e||!1;for(var t=[],r="",i=-1,n=0;n<15;n++){var a=this.rows[n].getTextString();a&&(i=n+1,e?t.push("Row "+i+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r}},{key:"getTextAndFormat",value:function(){return this.rows}}]),e}(),fn=function(){function e(t,r,i){(0,p.default)(this,e),this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=r,this.mode=null,this.verbose=0,this.displayedMemory=new hn(i),this.nonDisplayedMemory=new hn(i),this.lastOutputScreen=new hn(i),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}return(0,g.default)(e,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(e){this.outputFilter=e}},{key:"setPAC",value:function(e){this.writeScreen.setPAC(e)}},{key:"setBkgData",value:function(e){this.writeScreen.setBkgData(e)}},{key:"setMode",value:function(e){e!==this.mode&&(this.mode=e,this.logger.log(2,(function(){return"MODE="+e})),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}},{key:"insertChars",value:function(e){for(var t=this,r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(function(){return i+": "+t.writeScreen.getDisplayText(!0)})),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,(function(){return"DISPLAYED: "+t.displayedMemory.getDisplayText(!0)})),this.outputDataUpdate())}},{key:"ccRCL",value:function(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}},{key:"ccFON",value:function(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}},{key:"ccCR",value:function(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}},{key:"ccENM",value:function(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){var e=this;if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(function(){return"DISP: "+e.displayedMemory.getDisplayText()}))}this.outputDataUpdate(!0)}},{key:"ccTO",value:function(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}},{key:"ccMIDROW",value:function(e){var t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}},{key:"outputDataUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}]),e}(),pn=function(){function e(t,r,i){(0,p.default)(this,e),this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var n=new sn;this.channels=[null,new fn(t,r,n),new fn(t+1,i,n)],this.cmdHistory=yn(),this.logger=n}return(0,g.default)(e,[{key:"getHandler",value:function(e){return this.channels[e].getHandler()}},{key:"setHandler",value:function(e,t){this.channels[e].setHandler(t)}},{key:"addData",value:function(e,t){var r,i,n,a=!1;this.logger.time=e;for(var o=0;o<t.length;o+=2)if(i=127&t[o],n=127&t[o+1],0!==i||0!==n){if(this.logger.log(3,"["+ln([t[o],t[o+1]])+"] -> ("+ln([i,n])+")"),r=this.parseCmd(i,n),r||(r=this.parseMidrow(i,n)),r||(r=this.parsePAC(i,n)),r||(r=this.parseBackgroundAttributes(i,n)),!r&&(a=this.parseChars(i,n),a)){var s=this.currentChannel;if(s&&s>0){var l=this.channels[s];l.insertChars(a)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}r||a||this.logger.log(2,"Couldn't parse cleaned data "+ln([i,n])+" orig: "+ln([t[o],t[o+1]]))}}},{key:"parseCmd",value:function(e,t){var r=this.cmdHistory,i=(20===e||28===e||21===e||29===e)&&t>=32&&t<=47,n=(23===e||31===e)&&t>=33&&t<=35;if(!i&&!n)return!1;if(vn(e,t,r))return gn(null,null,r),this.logger.log(3,"Repeated command ("+ln([e,t])+") is dropped"),!0;var a=20===e||21===e||23===e?1:2,o=this.channels[a];return 20===e||21===e||28===e||29===e?32===t?o.ccRCL():33===t?o.ccBS():34===t?o.ccAOF():35===t?o.ccAON():36===t?o.ccDER():37===t?o.ccRU(2):38===t?o.ccRU(3):39===t?o.ccRU(4):40===t?o.ccFON():41===t?o.ccRDC():42===t?o.ccTR():43===t?o.ccRTD():44===t?o.ccEDM():45===t?o.ccCR():46===t?o.ccENM():47===t&&o.ccEOC():o.ccTO(t-32),gn(e,t,r),this.currentChannel=a,!0}},{key:"parseMidrow",value:function(e,t){var r=0;if((17===e||25===e)&&t>=32&&t<=47){if(r=17===e?1:2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;var i=this.channels[r];return!!i&&(i.ccMIDROW(t),this.logger.log(3,"MIDROW ("+ln([e,t])+")"),!0)}return!1}},{key:"parsePAC",value:function(e,t){var r,i=this.cmdHistory,n=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,a=(16===e||24===e)&&t>=64&&t<=95;if(!n&&!a)return!1;if(vn(e,t,i))return gn(null,null,i),!0;var o=e<=23?1:2;r=t>=64&&t<=95?1===o?tn[e]:nn[e]:1===o?rn[e]:an[e];var s=this.channels[o];return!!s&&(s.setPAC(this.interpretPAC(r,t)),gn(e,t,i),this.currentChannel=o,!0)}},{key:"interpretPAC",value:function(e,t){var r,i={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,i.underline=1===(1&r),r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i}},{key:"parseChars",value:function(e,t){var r,i,n=null,a=null;(e>=25?(r=2,a=e-8):(r=1,a=e),a>=17&&a<=19)?(i=17===a?t+80:18===a?t+112:t+144,this.logger.log(2,"Special char '"+en(i)+"' in channel "+r),n=[i]):e>=32&&e<=127&&(n=0===t?[e]:[e,t]);if(n){var o=ln(n);this.logger.log(3,"Char codes =  "+o.join(",")),gn(e,t,this.cmdHistory)}return n}},{key:"parseBackgroundAttributes",value:function(e,t){var r,i=(16===e||24===e)&&t>=32&&t<=47,n=(23===e||31===e)&&t>=45&&t<=47;if(!i&&!n)return!1;var a={};16===e||24===e?(r=Math.floor((t-32)/2),a.background=on[r],t%2===1&&(a.background=a.background+"_semi")):45===t?a.background="transparent":(a.foreground="black",47===t&&(a.underline=!0));var o=e<=23?1:2,s=this.channels[o];return s.setBkgData(a),gn(e,t,this.cmdHistory),!0}},{key:"reset",value:function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory=yn()}},{key:"cueSplitAtTime",value:function(e){for(var t=0;t<this.channels.length;t++){var r=this.channels[t];r&&r.cueSplitAtTime(e)}}}]),e}();function gn(e,t,r){r.a=e,r.b=t}function vn(e,t,r){return r.a===e&&r.b===t}function yn(){return{a:null,b:null}}var mn=function(){function e(t,r){(0,p.default)(this,e),this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=r}return(0,g.default)(e,[{key:"dispatchCue",value:function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}},{key:"newCue",value:function(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}},{key:"reset",value:function(){this.cueRanges=[],this.startTime=null}}]),e}(),_n=function(){if("undefined"!==typeof self&&self.VTTCue)return self.VTTCue;var e=["","lr","rl"],t=["start","middle","end","left","right"];function r(e,t){if("string"!==typeof t)return!1;if(!Array.isArray(e))return!1;var r=t.toLowerCase();return!!~e.indexOf(r)&&r}function i(e){return r(t,e)}function n(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)e[o]=a[o]}return e}function a(t,a,o){var s=this,l={enumerable:!0};s.hasBeenReset=!1;var u="",c=!1,d=t,h=a,f=o,p=null,g="",v=!0,y="auto",m="start",_=50,b="middle",T=50,S="middle";Object.defineProperty(s,"id",n({},l,{get:function(){return u},set:function(e){u=""+e}})),Object.defineProperty(s,"pauseOnExit",n({},l,{get:function(){return c},set:function(e){c=!!e}})),Object.defineProperty(s,"startTime",n({},l,{get:function(){return d},set:function(e){if("number"!==typeof e)throw new TypeError("Start time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",n({},l,{get:function(){return h},set:function(e){if("number"!==typeof e)throw new TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",n({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",n({},l,{get:function(){return p},set:function(e){p=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",n({},l,{get:function(){return g},set:function(t){var i=function(t){return r(e,t)}(t);if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");g=i,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",n({},l,{get:function(){return v},set:function(e){v=!!e,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",n({},l,{get:function(){return y},set:function(e){if("number"!==typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",n({},l,{get:function(){return m},set:function(e){var t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",n({},l,{get:function(){return _},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",n({},l,{get:function(){return b},set:function(e){var t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");b=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",n({},l,{get:function(){return T},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");T=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",n({},l,{get:function(){return S},set:function(e){var t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");S=t,this.hasBeenReset=!0}})),s.displayState=void 0}return a.prototype.getCueAsHTML=function(){var e=self.WebVTT;return e.convertCueToDOMTree(self,this.text)},a}(),bn=function(){function e(){(0,p.default)(this,e)}return(0,g.default)(e,[{key:"decode",value:function(e,t){if(!e)return"";if("string"!==typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}]),e}();function Tn(e){function t(e,t,r,i){return 3600*(0|e)+60*(0|t)+(0|r)+parseFloat(i||0)}var r=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return r?parseFloat(r[2])>59?t(r[2],r[3],0,r[4]):t(r[1],r[2],r[3],r[4]):null}var Sn=function(){function e(){(0,p.default)(this,e),this.values=Object.create(null)}return(0,g.default)(e,[{key:"set",value:function(e,t){this.get(e)||""===t||(this.values[e]=t)}},{key:"get",value:function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}},{key:"has",value:function(e){return e in this.values}},{key:"alt",value:function(e,t,r){for(var i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}}},{key:"integer",value:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}},{key:"percent",value:function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}]),e}();function En(e,t,r,i){var n=i?e.split(i):[e];for(var a in n)if("string"===typeof n[a]){var o=n[a].split(r);if(2===o.length){var s=o[0],l=o[1];t(s,l)}}}var kn=new _n(0,0,""),An="middle"===kn.align?"middle":"center";function wn(e,t,r){var i=e;function n(){var t=Tn(e);if(null===t)throw new Error("Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(){e=e.replace(/^\s+/,"")}if(a(),t.startTime=n(),a(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.slice(3),a(),t.endTime=n(),a(),function(e,t){var i=new Sn;En(e,(function(e,t){var n;switch(e){case"region":for(var a=r.length-1;a>=0;a--)if(r[a].id===t){i.set(e,r[a].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":n=t.split(","),i.integer(e,n[0]),i.percent(e,n[0])&&i.set("snapToLines",!1),i.alt(e,n[0],["auto"]),2===n.length&&i.alt("lineAlign",n[1],["start",An,"end"]);break;case"position":n=t.split(","),i.percent(e,n[0]),2===n.length&&i.alt("positionAlign",n[1],["start",An,"end","line-left","line-right","auto"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start",An,"end","left","right"]);break}}),/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");var n=i.get("line","auto");"auto"===n&&-1===kn.line&&(n=-1),t.line=n,t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100),t.align=i.get("align",An);var a=i.get("position","auto");"auto"===a&&50===kn.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}(e,t)}function xn(e){return e.replace(/<br(?: \/)?>/gi,"\n")}var Rn=function(){function e(){(0,p.default)(this,e),this.state="INITIAL",this.buffer="",this.decoder=new bn,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}return(0,g.default)(e,[{key:"parse",value:function(e){var t=this;function r(){var e=t.buffer,r=0;e=xn(e);while(r<e.length&&"\r"!==e[r]&&"\n"!==e[r])++r;var i=e.slice(0,r);return"\r"===e[r]&&++r,"\n"===e[r]&&++r,t.buffer=e.slice(r),i}function i(e){En(e,(function(e,t){}),/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var n="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;n=r();var a=n.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(null==a||!a[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}var o=!1;while(t.buffer){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:n=r(),t.state){case"HEADER":/:/.test(n)?i(n):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new _n(0,0,""),t.state="CUE",-1===n.indexOf("--\x3e")){t.cue.id=n;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{wn(n,t.cue,t.regionList)}catch(l){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var s=-1!==n.indexOf("--\x3e");if(!n||s&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=n;continue;case"BADCUE":n||(t.state="ID")}}}catch(l){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}},{key:"flush",value:function(){try{if((this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state||"BADWEBVTT"===this.state)throw new Error("Malformed WebVTT signature.")}catch(e){this.onparsingerror&&this.onparsingerror(e)}return this.onflush&&this.onflush(),this}}]),e}(),Ln=/\r\n|\n\r|\n|\r/g,In=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.slice(r,r+t.length)===t},Cn=function(e){var t=5381,r=e.length;while(r)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()};function Dn(e,t,r){return Cn(e.toString())+Cn(t.toString())+Cn(r)}function Pn(e,t,r,i,n,a,o){var s,l=new Rn,u=ye(new Uint8Array(e)).trim().replace(Ln,"\n").split("\n"),c=[],d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return di(e,9e4,1/t)}(t.baseTime,t.timescale),h="00:00.000",f=0,p=0,g=!0;l.oncue=function(e){var t=r[i],a=r.ccOffset,o=(f-d)/9e4;null!=t&&t.new&&(void 0!==p?a=r.ccOffset=t.start:function(e,t,r){var i=e[t],n=e[i.prevCC];if(!n||!n.new&&i.new)return e.ccOffset=e.presentationOffset=i.start,void(i.new=!1);while(null!=(a=n)&&a.new){var a;e.ccOffset+=i.start-n.start,i.new=!1,i=n,n=e[i.prevCC]}e.presentationOffset=r}(r,i,o)),o&&(a=o-r.presentationOffset);var s=e.endTime-e.startTime,l=vi(9e4*(e.startTime+a-p),9e4*n)/9e4;e.startTime=Math.max(l,0),e.endTime=Math.max(l+s,0);var u=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(u)),e.id||(e.id=Dn(e.startTime,e.endTime,u)),e.endTime>0&&c.push(e)},l.onparsingerror=function(e){s=e},l.onflush=function(){s?o(s):a(c)},u.forEach((function(e){if(g){if(In(e,"X-TIMESTAMP-MAP=")){g=!1,e.slice(16).split(",").forEach((function(e){In(e,"LOCAL:")?h=e.slice(6):In(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))}));try{p=function(e){var t=parseInt(e.slice(-3)),r=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),n=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!k(t)||!k(r)||!k(i)||!k(n))throw Error("Malformed X-TIMESTAMP-MAP: Local:".concat(e));return t+=1e3*r,t+=6e4*i,t+=36e5*n,t}(h)/1e3}catch(t){s=t}return}""===e&&(g=!1)}l.parse(e+"\n")})),l.flush()}var On=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Mn=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Nn={left:"start",center:"center",right:"end",start:"start",end:"end"};function Fn(e,t,r,i){var n=Re(new Uint8Array(e),["mdat"]);if(0!==n.length){var a=n.map((function(e){return ye(e)})),o=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return di(e,t,1/r,i)}(t.baseTime,1,t.timescale);try{a.forEach((function(e){return r(function(e,t){var r=new DOMParser,i=r.parseFromString(e,"text/xml"),n=i.getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");var a={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(a).reduce((function(e,t){return e[t]=n.getAttribute("ttp:".concat(t))||a[t],e}),{}),s="preserve"!==n.getAttribute("xml:space"),l=Bn(Un(n,"styling","style")),u=Bn(Un(n,"layout","region")),c=Un(n,"body","[begin]");return[].map.call(c,(function(e){var r=function e(t,r){return[].slice.call(t.childNodes).reduce((function(t,i,n){var a;return"br"===i.nodeName&&n?t+"\n":null!=(a=i.childNodes)&&a.length?e(i,r):r?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent}),"")}(e,s);if(!r||!e.hasAttribute("begin"))return null;var i=jn(e.getAttribute("begin"),o),n=jn(e.getAttribute("dur"),o),a=jn(e.getAttribute("end"),o);if(null===i)throw Vn(e);if(null===a){if(null===n)throw Vn(e);a=i+n}var c=new _n(i-t,a-t,r);c.id=Dn(c.startTime,c.endTime,c.text);var d=u[e.getAttribute("region")],h=l[e.getAttribute("style")],f=function(e,t,r){var i="http://www.w3.org/ns/ttml#styling",n=null,a=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;a&&r.hasOwnProperty(a)&&(n=r[a]);return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((function(r,a){var o=Hn(t,i,a)||Hn(e,i,a)||Hn(n,i,a);return o&&(r[a]=o),r}),{})}(d,h,l),p=f.textAlign;if(p){var g=Nn[p];g&&(c.lineAlign=g),c.align=p}return E(c,f),c})).filter((function(e){return null!==e}))}(e,o))}))}catch(s){i(s)}}else i(new Error("Could not parse IMSC1 mdat"))}function Un(e,t,r){var i=e.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(r)):[]}function Bn(e){return e.reduce((function(e,t){var r=t.getAttribute("xml:id");return r&&(e[r]=t),e}),{})}function Hn(e,t,r){return e&&e.hasAttributeNS(t,r)?e.getAttributeNS(t,r):null}function Vn(e){return new Error("Could not parse ttml timestamp ".concat(e))}function jn(e,t){if(!e)return null;var r=Tn(e);return null===r&&(On.test(e)?r=function(e,t){var r=On.exec(e),i=(0|r[4])+(0|r[5])/t.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+i/t.frameRate}(e,t):Mn.test(e)&&(r=function(e,t){var r=Mn.exec(e),i=Number(r[1]),n=r[2];switch(n){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}(e,t))),r}var Gn=function(){function e(t){if((0,p.default)(this,e),this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Wn(),this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var r=new mn(this,"textTrack1"),i=new mn(this,"textTrack2"),n=new mn(this,"textTrack3"),a=new mn(this,"textTrack4");this.cea608Parser1=new pn(1,r,i),this.cea608Parser2=new pn(3,n,a)}t.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(A.MANIFEST_LOADING,this.onManifestLoading,this),t.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(A.FRAG_LOADING,this.onFragLoading,this),t.on(A.FRAG_LOADED,this.onFragLoaded,this),t.on(A.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(A.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(A.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(A.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this)}return(0,g.default)(e,[{key:"destroy",value:function(){var e=this.hls;e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(A.FRAG_LOADING,this.onFragLoading,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this),e.off(A.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(A.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(A.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}},{key:"addCues",value:function(e,t,r,i,n){for(var a=!1,o=n.length;o--;){var s=n[o],l=qn(s[0],s[1],t,r);if(l>=0&&(s[0]=Math.min(s[0],t),s[1]=Math.max(s[1],r),a=!0,l/(r-t)>.5))return}if(a||n.push([t,r]),this.config.renderTextTracksNatively){var u=this.captionsTracks[e];this.Cues.newCue(u,t,r,i)}else{var c=this.Cues.newCue(null,t,r,i);this.hls.trigger(A.CUES_PARSED,{type:"captions",cues:c,track:e})}}},{key:"onInitPtsFound",value:function(e,t){var r=this,i=t.frag,n=t.id,a=t.initPTS,o=t.timescale,s=this.unparsedVttFrags;"main"===n&&(this.initPTS[i.cc]={baseTime:a,timescale:o}),s.length&&(this.unparsedVttFrags=[],s.forEach((function(e){r.onFragLoaded(A.FRAG_LOADED,e)})))}},{key:"getExistingTrack",value:function(e){var t=this.media;if(t)for(var r=0;r<t.textTracks.length;r++){var i=t.textTracks[r];if(i[e])return i}return null}},{key:"createCaptionsTrack",value:function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}},{key:"createNativeTrack",value:function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,r=this.captionsTracks,i=this.media,n=t[e],a=n.label,o=n.languageCode,s=this.getExistingTrack(e);if(s)r[e]=s,yt(r[e]),gt(r[e],i);else{var l=this.createTextTrack("captions",a,o);l&&(l[e]=!0,r[e]=l)}}}},{key:"createNonNativeTrack",value:function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var r=t.label,i={_id:e,label:r,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(A.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}}},{key:"createTextTrack",value:function(e,t,r){var i=this.media;if(i)return i.addTextTrack(e,t,r)}},{key:"onMediaAttaching",value:function(e,t){this.media=t.media,this._cleanTracks()}},{key:"onMediaDetaching",value:function(){var e=this.captionsTracks;Object.keys(e).forEach((function(t){yt(e[t]),delete e[t]})),this.nonNativeCaptionsTracks={}}},{key:"onManifestLoading",value:function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Wn(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}},{key:"_cleanTracks",value:function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var r=0;r<t.length;r++)yt(t[r])}}},{key:"onSubtitleTracksUpdated",value:function(e,t){var r=this,i=t.subtitleTracks||[],n=i.some((function(e){return"stpp.ttml.im1t"===e.textCodec}));if(this.config.enableWebVTT||n&&this.config.enableIMSC1){var a=Gi(this.tracks,i);if(a)return void(this.tracks=i);if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){var o=this.media?this.media.textTracks:null;this.tracks.forEach((function(e,t){var i;if(o&&t<o.length){for(var n=null,a=0;a<o.length;a++)if(Kn(o[a],e)){n=o[a];break}n&&(i=n)}if(i)yt(i);else{var s=r._captionsOrSubtitlesFromCharacteristics(e);i=r.createTextTrack(s,e.name,e.lang),i&&(i.mode="disabled")}i&&(i.groupId=e.groupId,r.textTracks.push(i))}))}else if(this.tracks.length){var s=this.tracks.map((function(e){return{label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}}));this.hls.trigger(A.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:s})}}}},{key:"_captionsOrSubtitlesFromCharacteristics",value:function(e){if(e.attrs.CHARACTERISTICS){var t=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),r=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(t&&r)return"captions"}return"subtitles"}},{key:"onManifestLoaded",value:function(e,t){var r=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((function(e){var t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(t){var i="textTrack".concat(t[1]),n=r.captionsProperties[i];n&&(n.label=e.name,e.lang&&(n.languageCode=e.lang),n.media=e)}}))}},{key:"closedCaptionsForLevel",value:function(e){var t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}},{key:"onFragLoading",value:function(e,t){var r=this.cea608Parser1,i=this.cea608Parser2,n=this.lastSn,a=this.lastPartIndex;if(this.enabled&&r&&i&&t.frag.type===dt.MAIN){var o,s,l=t.frag.sn,u=null!=(o=null==t||null==(s=t.part)?void 0:s.index)?o:-1;l===n+1||l===n&&u===a+1||(r.reset(),i.reset()),this.lastSn=l,this.lastPartIndex=u}}},{key:"onFragLoaded",value:function(e,t){var r=t.frag,i=t.payload,n=this.initPTS,a=this.unparsedVttFrags;if(r.type===dt.SUBTITLE)if(i.byteLength){if(!n[r.cc])return a.push(t),void(n.length&&this.hls.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Missing initial subtitle PTS")}));var o=r.decryptdata,s="stats"in t;if(null==o||!o.encrypted||s){var l=this.tracks[r.level],u=this.vttCCs;u[r.cc]||(u[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),l&&"stpp.ttml.im1t"===l.textCodec?this._parseIMSC1(r,i):this._parseVTTs(r,i,u)}}else this.hls.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}},{key:"_parseIMSC1",value:function(e,t){var r=this,i=this.hls;Fn(t,this.initPTS[e.cc],(function(t){r._appendCues(t,e.level),i.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(function(t){P.log("Failed to parse IMSC1: ".concat(t)),i.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})}))}},{key:"_parseVTTs",value:function(e,t,r){var i,n=this,a=this.hls,o=null!=(i=e.initSegment)&&i.data?Pe(e.initSegment.data,new Uint8Array(t)):t;Pn(o,this.initPTS[e.cc],r,e.cc,e.start,(function(t){n._appendCues(t,e.level),a.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(function(r){n._fallbackToIMSC1(e,t),P.log("Failed to parse VTT cue: ".concat(r)),a.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})}))}},{key:"_fallbackToIMSC1",value:function(e,t){var r=this,i=this.tracks[e.level];i.textCodec||Fn(t,this.initPTS[e.cc],(function(){i.textCodec="stpp.ttml.im1t",r._parseIMSC1(e,t)}),(function(){i.textCodec="wvtt"}))}},{key:"_appendCues",value:function(e,t){var r=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[t];if(!i||"disabled"===i.mode)return;e.forEach((function(e){return vt(i,e)}))}else{var n=this.tracks[t];if(!n)return;var a=n.default?"default":"subtitles"+t;r.trigger(A.CUES_PARSED,{type:"subtitles",cues:e,track:a})}}},{key:"onFragDecrypted",value:function(e,t){var r=t.frag;if(r.type===dt.SUBTITLE){if(!this.initPTS[r.cc])return void this.unparsedVttFrags.push(t);this.onFragLoaded(A.FRAG_LOADED,t)}}},{key:"onSubtitleTracksCleared",value:function(){this.tracks=[],this.captionsTracks={}}},{key:"onFragParsingUserdata",value:function(e,t){var r=this.cea608Parser1,i=this.cea608Parser2;if(this.enabled&&r&&i){var n=t.frag,a=t.samples;if(n.type!==dt.MAIN||"NONE"!==this.closedCaptionsForLevel(n))for(var o=0;o<a.length;o++){var s=a[o].bytes;if(s){var l=this.extractCea608Data(s);r.addData(a[o].pts,l[0]),i.addData(a[o].pts,l[1])}}}}},{key:"onBufferFlushing",value:function(e,t){var r=t.startOffset,i=t.endOffset,n=t.endOffsetSubtitles,a=t.type,o=this.media;if(o&&!(o.currentTime<i)){if(!a||"video"===a){var s=this.captionsTracks;Object.keys(s).forEach((function(e){return mt(s[e],r,i)}))}if(this.config.renderTextTracksNatively&&0===r&&void 0!==n){var l=this.textTracks;Object.keys(l).forEach((function(e){return mt(l[e],r,n)}))}}}},{key:"extractCea608Data",value:function(e){for(var t=[[],[]],r=31&e[0],i=2,n=0;n<r;n++){var a=e[i++],o=127&e[i++],s=127&e[i++];if(0!==o||0!==s){var l=0!==(4&a);if(l){var u=3&a;0!==u&&1!==u||(t[u].push(o),t[u].push(s))}}}return t}}]),e}();function Kn(e,t){return!!e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}function qn(e,t,r,i){return Math.min(t,i)-Math.max(e,r)}function Wn(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}var Yn=function(){function e(t){(0,p.default)(this,e),this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}return(0,g.default)(e,[{key:"setStreamController",value:function(e){this.streamController=e}},{key:"destroy",value:function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}},{key:"registerListeners",value:function(){var e=this.hls;e.on(A.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.BUFFER_CODECS,this.onBufferCodecs,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this)}},{key:"unregisterListener",value:function(){var e=this.hls;e.off(A.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.BUFFER_CODECS,this.onBufferCodecs,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this)}},{key:"onFpsDropLevelCapping",value:function(e,t){var r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}},{key:"onMediaAttaching",value:function(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null}},{key:"onManifestParsed",value:function(e,t){var r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}},{key:"onBufferCodecs",value:function(e,t){var r=this.hls;r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}},{key:"onMediaDetaching",value:function(){this.stopCapping()}},{key:"detectPlayerSize",value:function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var e=this.hls.levels;if(e.length){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}},{key:"getMaxLevel",value:function(t){var r=this,i=this.hls.levels;if(!i.length)return-1;var n=i.filter((function(e,i){return r.isLevelAllowed(e)&&i<=t}));return this.clientRect=null,e.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}},{key:"startCapping",value:function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"stopCapping",value:function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}},{key:"getDimensions",value:function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.width||t.height||(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}},{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(t){}return e}},{key:"isLevelAllowed",value:function(e){var t=this.restrictedLevels;return!t.some((function(t){return e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height}))}}],[{key:"getMaxLevelByMediaSize",value:function(e,t,r){if(null==e||!e.length)return-1;for(var i=function(e,t){return!t||(e.width!==t.width||e.height!==t.height)},n=e.length-1,a=0;a<e.length;a+=1){var o=e[a];if((o.width>=t||o.height>=r)&&i(o,e[a+1])){n=a;break}}return n}}]),e}(),zn=function(){function e(t){(0,p.default)(this,e),this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}return(0,g.default)(e,[{key:"setStreamController",value:function(e){this.streamController=e}},{key:"registerListeners",value:function(){this.hls.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this)}},{key:"unregisterListeners",value:function(){this.hls.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this)}},{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}},{key:"onMediaAttaching",value:function(e,t){var r=this.hls.config;if(r.capLevelOnFPSDrop){var i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&"function"===typeof i.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function(e,t,r){var i=performance.now();if(t){if(this.lastTime){var n=i-this.lastTime,a=r-this.lastDroppedFrames,o=t-this.lastDecodedFrames,s=1e3*a/n,l=this.hls;if(l.trigger(A.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:r}),s>0&&a>l.config.fpsDroppedMonitoringThreshold*o){var u=l.currentLevel;P.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=u)&&(u-=1,l.trigger(A.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:l.currentLevel}),l.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}},{key:"checkFPSInterval",value:function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}]),e}(),Xn=function(){function e(t){(0,p.default)(this,e),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=e.CDMCleanupPromise?[e.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=P.debug.bind(P,"[eme]"),this.log=P.log.bind(P,"[eme]"),this.warn=P.warn.bind(P,"[eme]"),this.error=P.error.bind(P,"[eme]"),this.hls=t,this.config=t.config,this.registerListeners()}return(0,g.default)(e,[{key:"destroy",value:function(){this.unregisterListeners(),this.onMediaDetached();var e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}},{key:"registerListeners",value:function(){this.hls.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(A.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(A.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(A.MANIFEST_LOADED,this.onManifestLoaded,this)}},{key:"unregisterListeners",value:function(){this.hls.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(A.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(A.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(A.MANIFEST_LOADED,this.onManifestLoaded,this)}},{key:"getLicenseServerUrl",value:function(e){var t=this.config,r=t.drmSystems,i=t.widevineLicenseUrl,n=r[e];if(n)return n.licenseUrl;if(e===X.WIDEVINE&&i)return i;throw new Error('no license server URL configured for key-system "'.concat(e,'"'))}},{key:"getServerCertificateUrl",value:function(e){var t=this.config.drmSystems,r=t[e];if(r)return r.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'.concat(e,'"]'))}},{key:"attemptKeySystemAccess",value:function(e){var t=this,r=this.hls.levels,i=function(e,t,r){return!!e&&r.indexOf(e)===t},n=r.map((function(e){return e.audioCodec})).filter(i),a=r.map((function(e){return e.videoCodec})).filter(i);return n.length+a.length===0&&a.push("avc1.42e01e"),new Promise((function(r,i){(function e(o){var s=o.shift();t.getMediaKeysPromise(s,n,a).then((function(e){return r({keySystem:s,mediaKeys:e})})).catch((function(t){o.length?e(o):i(t instanceof Qn?t:new Qn({type:w.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))}))})(e)}))}},{key:"requestMediaKeySystemAccess",value:function(e,t){var r=this.config.requestMediaKeySystemAccessFunc;if("function"!==typeof r){var i="Configured requestMediaKeySystemAccess is not a function ".concat(r);return null===te&&"http:"===self.location.protocol&&(i="navigator.requestMediaKeySystemAccess is not available over insecure protocol ".concat(location.protocol)),Promise.reject(new Error(i))}return r(e,t)}},{key:"getMediaKeysPromise",value:function(e,t,r){var i=this,n=function(e,t,r,i){var n;switch(e){case X.FAIRPLAY:n=["cenc","sinf"];break;case X.WIDEVINE:case X.PLAYREADY:n=["cenc"];break;case X.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error("Unknown key-system: ".concat(e))}return function(e,t,r,i){var n={initDataTypes:e,persistentState:i.persistentState||"not-allowed",distinctiveIdentifier:i.distinctiveIdentifier||"not-allowed",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:t.map((function(e){return{contentType:'audio/mp4; codecs="'.concat(e,'"'),robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null}})),videoCapabilities:r.map((function(e){return{contentType:'video/mp4; codecs="'.concat(e,'"'),robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}}))};return[n]}(n,t,r,i)}(e,t,r,this.config.drmSystemOptions),a=this.keySystemAccessPromises[e],o=null==a?void 0:a.keySystemAccess;if(!o){this.log('Requesting encrypted media "'.concat(e,'" key-system access with config: ').concat(JSON.stringify(n))),o=this.requestMediaKeySystemAccess(e,n);var s=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch((function(t){i.log('Failed to obtain access to key-system "'.concat(e,'": ').concat(t))})),o.then((function(t){i.log('Access for key-system "'.concat(t.keySystem,'" obtained'));var r=i.fetchServerCertificate(e);return i.log('Create media-keys for "'.concat(e,'"')),s.mediaKeys=t.createMediaKeys().then((function(t){return i.log('Media-keys created for "'.concat(e,'"')),r.then((function(r){return r?i.setMediaKeysServerCertificate(t,e,r):t}))})),s.mediaKeys.catch((function(t){i.error('Failed to create media-keys for "'.concat(e,'"}: ').concat(t))})),s.mediaKeys}))}return o.then((function(){return a.mediaKeys}))}},{key:"createMediaKeySessionContext",value:function(e){var t=e.decryptdata,r=e.keySystem,i=e.mediaKeys;this.log('Creating key-system session "'.concat(r,'" keyId: ').concat(_e.hexDump(t.keyId||[])));var n=i.createSession(),a={decryptdata:t,keySystem:r,mediaKeys:i,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(a),a}},{key:"renewKeySession",value:function(e){var t=e.decryptdata;if(t.pssh){var r=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t);this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(r,"cenc",t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}},{key:"getKeyIdString",value:function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return _e.hexDump(e.keyId)}},{key:"updateKeySession",value:function(e,t){var r,i=e.mediaKeysSession;return this.log('Updating key-session "'.concat(i.sessionId,'" for keyID ').concat(_e.hexDump((null==(r=e.decryptdata)?void 0:r.keyId)||[]),"\n      } (data length: ").concat(t?t.byteLength:t,")")),i.update(t)}},{key:"selectKeySystemFormat",value:function(e){var t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: ".concat(e.sn," ").concat(e.type,": ").concat(e.level,") key formats ").concat(t.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}},{key:"getKeyFormatPromise",value:function(e){var t=this;return new Promise((function(r,i){var n=ee(t.config),a=e.map(J).filter((function(e){return!!e&&-1!==n.indexOf(e)}));return t.getKeySystemSelectionPromise(a).then((function(e){var t=e.keySystem,n=$(t);n?r(n):i(new Error('Unable to find format for key-system "'.concat(t,'"')))})).catch(i)}))}},{key:"loadKey",value:function(e){var t=this,r=e.keyInfo.decryptdata,i=this.getKeyIdString(r),n="(keyId: ".concat(i,' format: "').concat(r.keyFormat,'" method: ').concat(r.method," uri: ").concat(r.uri,")");this.log("Starting session for key ".concat(n));var a=this.keyIdToKeySessionPromise[i];return a||(a=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(r).then((function(i){var a=i.keySystem,o=i.mediaKeys;return t.throwIfDestroyed(),t.log("Handle encrypted media sn: ".concat(e.frag.sn," ").concat(e.frag.type,": ").concat(e.frag.level," using key ").concat(n)),t.attemptSetMediaKeys(a,o).then((function(){t.throwIfDestroyed();var e=t.createMediaKeySessionContext({keySystem:a,mediaKeys:o,decryptdata:r});return t.generateRequestWithPreferredKeySession(e,"cenc",r.pssh,"playlist-key")}))})),a.catch((function(e){return t.handleError(e)}))),a}},{key:"throwIfDestroyed",value:function(){if(!this.hls)throw new Error("invalid state")}},{key:"handleError",value:function(e){this.hls&&(this.error(e.message),e instanceof Qn?this.hls.trigger(A.ERROR,e.data):this.hls.trigger(A.ERROR,{type:w.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}},{key:"getKeySystemForKeyPromise",value:function(e){var t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){var i=J(e.keyFormat),n=i?[i]:ee(this.config);return this.attemptKeySystemAccess(n)}return r}},{key:"getKeySystemSelectionPromise",value:function(e){if(e.length||(e=ee(this.config)),0===e.length)throw new Qn({type:w.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options ".concat(JSON.stringify({drmSystems:this.config.drmSystems})));return this.attemptKeySystemAccess(e)}},{key:"_onMediaEncrypted",value:function(e){var t=this,r=e.initDataType,i=e.initData;if(this.debug('"'.concat(e.type,'" event: init data type: "').concat(r,'"')),null!==i){var n,a;if("sinf"===r&&this.config.drmSystems[X.FAIRPLAY]){var o=Ee(new Uint8Array(i));try{var s=W(JSON.parse(o).sinf),l=Ce(new Uint8Array(s));if(!l)return;n=l.subarray(8,24),a=X.FAIRPLAY}catch(y){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{var u=function(e){if(!(e instanceof ArrayBuffer)||e.byteLength<32)return null;var t={version:0,systemId:"",kids:null,data:null},r=new DataView(e),i=r.getUint32(0);if(e.byteLength!==i&&i>44)return null;var n=r.getUint32(4);if(1886614376!==n)return null;if(t.version=r.getUint32(8)>>>24,t.version>1)return null;t.systemId=_e.hexDump(new Uint8Array(e,12,16));var a=r.getUint32(28);if(0===t.version){if(i-32<a)return null;t.data=new Uint8Array(e,32,a)}else if(1===t.version){t.kids=[];for(var o=0;o<a;o++)t.kids.push(new Uint8Array(e,32+16*o,16))}return t}(i);if(null===u)return;0===u.version&&u.systemId===Z.WIDEVINE&&u.data&&(n=u.data.subarray(8,24)),a=function(e){if(e===Z.WIDEVINE)return X.WIDEVINE}(u.systemId)}if(a&&n){for(var c=_e.hexDump(n),d=this.keyIdToKeySessionPromise,h=this.mediaKeySessions,f=d[c],p=function(e){var a=h[e],o=a.decryptdata;if(o.pssh||!o.keyId)return"continue";var s=_e.hexDump(o.keyId);return c===s||-1!==o.uri.replace(/-/g,"").indexOf(c)?(f=d[s],delete d[s],o.pssh=new Uint8Array(i),o.keyId=n,f=d[c]=f.then((function(){return t.generateRequestWithPreferredKeySession(a,r,i,"encrypted-event-key-match")})),"break"):void 0},g=0;g<h.length;g++){var v=p(g);if("continue"!==v&&"break"===v)break}f||(f=d[c]=this.getKeySystemSelectionPromise([a]).then((function(e){var a,o=e.keySystem,s=e.mediaKeys;t.throwIfDestroyed();var l=new He("ISO-23001-7",c,null!=(a=$(o))?a:"");return l.pssh=new Uint8Array(i),l.keyId=n,t.attemptSetMediaKeys(o,s).then((function(){t.throwIfDestroyed();var e=t.createMediaKeySessionContext({decryptdata:l,keySystem:o,mediaKeys:s});return t.generateRequestWithPreferredKeySession(e,r,i,"encrypted-event-no-match")}))}))),f.catch((function(e){return t.handleError(e)}))}}}},{key:"_onWaitingForKey",value:function(e){this.log('"'.concat(e.type,'" event'))}},{key:"attemptSetMediaKeys",value:function(e,t){var r=this,i=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'.concat(e,'"'));var n=Promise.all(i).then((function(){if(!r.media)throw new Error("Attempted to set mediaKeys without media element attached");return r.media.setMediaKeys(t)}));return this.setMediaKeysQueue.push(n),n.then((function(){r.log('Media-keys set for "'.concat(e,'"')),i.push(n),r.setMediaKeysQueue=r.setMediaKeysQueue.filter((function(e){return-1===i.indexOf(e)}))}))}},{key:"generateRequestWithPreferredKeySession",value:function(e,t,r,i){var n,a,o=this,s=null==(n=this.config.drmSystems)||null==(a=n[e.keySystem])?void 0:a.generateRequest;if(s)try{var l=s.call(this.hls,t,r,e);if(!l)throw new Error("Invalid response from configured generateRequest filter");t=l.initDataType,r=e.decryptdata.pssh=l.initData?new Uint8Array(l.initData):null}catch(f){var u;if(this.warn(f.message),null!=(u=this.hls)&&u.config.debug)throw f}if(null===r)return this.log('Skipping key-session request for "'.concat(i,'" (no initData)')),Promise.resolve(e);var c=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'.concat(i,'": ').concat(c," (init data type: ").concat(t," length: ").concat(r?r.byteLength:null,")"));var d=new Di;e.mediaKeysSession.onmessage=function(t){var r=e.mediaKeysSession;if(r){var i=t.messageType,n=t.message;o.log('"'.concat(i,'" message event for session "').concat(r.sessionId,'" message size: ').concat(n.byteLength)),"license-request"===i||"license-renewal"===i?o.renewLicense(e,n).catch((function(e){o.handleError(e),d.emit("error",e)})):"license-release"===i?e.keySystem===X.FAIRPLAY&&(o.updateKeySession(e,z("acknowledged")),o.removeSession(e)):o.warn('unhandled media key message type "'.concat(i,'"'))}else d.emit("error",new Error("invalid state"))},e.mediaKeysSession.onkeystatuseschange=function(t){var r=e.mediaKeysSession;if(r){o.onKeyStatusChange(e);var i=e.keyStatus;d.emit("keyStatus",i),"expired"===i&&(o.warn("".concat(e.keySystem," expired for key ").concat(c)),o.renewKeySession(e))}else d.emit("error",new Error("invalid state"))};var h=new Promise((function(e,t){d.on("error",t),d.on("keyStatus",(function(r){r.startsWith("usable")?e():"output-restricted"===r?t(new Qn({type:w.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===r?t(new Qn({type:w.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'.concat(r,'"'))):"expired"===r?t(new Error("key expired while generating request")):o.warn('unhandled key status change "'.concat(r,'"'))}))}));return e.mediaKeysSession.generateRequest(t,r).then((function(){var t;o.log('Request generated for key-session "'.concat(null==(t=e.mediaKeysSession)?void 0:t.sessionId,'" keyId: ').concat(c))})).catch((function(e){throw new Qn({type:w.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},"Error generating key-session request: ".concat(e))})).then((function(){return h})).catch((function(t){throw d.removeAllListeners(),o.removeSession(e),t})).then((function(){return d.removeAllListeners(),e}))}},{key:"onKeyStatusChange",value:function(e){var t=this;e.mediaKeysSession.keyStatuses.forEach((function(r,i){t.log('key status change "'.concat(r,'" for keyStatuses keyId: ').concat(_e.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))," session keyId: ").concat(_e.hexDump(new Uint8Array(e.decryptdata.keyId||[]))," uri: ").concat(e.decryptdata.uri)),e.keyStatus=r}))}},{key:"fetchServerCertificate",value:function(e){var t=this.config,r=t.loader,i=new r(t),n=this.getServerCertificateUrl(e);return n?(this.log('Fetching serverCertificate for "'.concat(e,'"')),new Promise((function(r,a){var o={responseType:"arraybuffer",url:n},s=t.certLoadPolicy.default,l={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:function(e,t,i,n){r(e.data)},onError:function(t,r,i,s){a(new Qn({type:w.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:T({url:o.url,data:void 0},t)},'"'.concat(e,'" certificate request failed (').concat(n,"). Status: ").concat(t.code," (").concat(t.text,")")))},onTimeout:function(t,r,i){a(new Qn({type:w.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:{url:o.url,data:void 0}},'"'.concat(e,'" certificate request timed out (').concat(n,")")))},onAbort:function(e,t,r){a(new Error("aborted"))}};i.load(o,l,u)}))):Promise.resolve()}},{key:"setMediaKeysServerCertificate",value:function(e,t,r){var i=this;return new Promise((function(n,a){e.setServerCertificate(r).then((function(a){i.log("setServerCertificate ".concat(a?"success":"not supported by CDM"," (").concat(null==r?void 0:r.byteLength,') on "').concat(t,'"')),n(e)})).catch((function(e){a(new Qn({type:w.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))}))}))}},{key:"renewLicense",value:function(e,t){var r=this;return this.requestLicense(e,new Uint8Array(t)).then((function(t){return r.updateKeySession(e,new Uint8Array(t)).catch((function(e){throw new Qn({type:w.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)}))}))}},{key:"setupLicenseXHR",value:function(e,t,r,i){var n=this,a=this.config.licenseXhrSetup;return a?Promise.resolve().then((function(){if(!r.decryptdata)throw new Error("Key removed");return a.call(n.hls,e,t,r,i)})).catch((function(o){if(!r.decryptdata)throw o;return e.open("POST",t,!0),a.call(n.hls,e,t,r,i)})).then((function(r){e.readyState||e.open("POST",t,!0);var n=r||i;return{xhr:e,licenseChallenge:n}})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}},{key:"requestLicense",value:function(e,t){var r=this,i=this.config.keyLoadPolicy.default;return new Promise((function(n,a){var o=r.getLicenseServerUrl(e.keySystem);r.log("Sending license request to URL: ".concat(o));var s=new XMLHttpRequest;s.responseType="arraybuffer",s.onreadystatechange=function(){if(!r.hls||!e.mediaKeysSession)return a(new Error("invalid state"));if(4===s.readyState)if(200===s.status){r._requestLicenseFailureCount=0;var l=s.response;r.log("License received ".concat(l instanceof ArrayBuffer?l.byteLength:l));var u=r.config.licenseResponseCallback;if(u)try{l=u.call(r.hls,s,o,e)}catch(f){r.error(f)}n(l)}else{var c=i.errorRetry,d=c?c.maxNumRetry:0;if(r._requestLicenseFailureCount++,r._requestLicenseFailureCount>d||s.status>=400&&s.status<500)a(new Qn({type:w.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:s,response:{url:o,data:void 0,code:s.status,text:s.statusText}},"License Request XHR failed (".concat(o,"). Status: ").concat(s.status," (").concat(s.statusText,")")));else{var h=d-r._requestLicenseFailureCount+1;r.warn("Retrying license request, ".concat(h," attempts left")),r.requestLicense(e,t).then(n,a)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=s,r.setupLicenseXHR(s,o,e,t).then((function(e){var t=e.xhr,r=e.licenseChallenge;t.send(r)}))}))}},{key:"onMediaAttached",value:function(e,t){if(this.config.emeEnabled){var r=t.media;this.media=r,r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}}},{key:"onMediaDetached",value:function(){var t=this,r=this.media,i=this.mediaKeySessions;r&&(r.removeEventListener("encrypted",this.onMediaEncrypted),r.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},He.clearKeyUriToKeyIdMap();var n=i.length;e.CDMCleanupPromise=Promise.all(i.map((function(e){return t.removeSession(e)})).concat(null==r?void 0:r.setMediaKeys(null).catch((function(e){t.log("Could not clear media keys: ".concat(e,". media.src: ").concat(null==r?void 0:r.src))})))).then((function(){n&&(t.log("finished closing key sessions and clearing media keys"),i.length=0)})).catch((function(e){t.log("Could not close sessions and clear media keys: ".concat(e,". media.src: ").concat(null==r?void 0:r.src))}))}},{key:"onManifestLoading",value:function(){this.keyFormatPromise=null}},{key:"onManifestLoaded",value:function(e,t){var r=t.sessionKeys;if(r&&this.config.emeEnabled&&!this.keyFormatPromise){var i=r.reduce((function(e,t){return-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e}),[]);this.log("Selecting key-system from session-keys ".concat(i.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(i)}}},{key:"removeSession",value:function(e){var t=this,r=e.mediaKeysSession,i=e.licenseXhr;if(r){this.log("Remove licenses and keys and close session ".concat(r.sessionId)),r.onmessage=null,r.onkeystatuseschange=null,i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var n=this.mediaKeySessions.indexOf(e);return n>-1&&this.mediaKeySessions.splice(n,1),r.remove().catch((function(e){t.log("Could not remove session: ".concat(e))})).then((function(){return r.close()})).catch((function(e){t.log("Could not close session: ".concat(e))}))}}}]),e}();Xn.CDMCleanupPromise=void 0;var Qn=function(e){(0,d.default)(r,e);var t=(0,h.default)(r);function r(e,i){var n;return(0,p.default)(this,r),n=t.call(this,i),n.data=void 0,e.error||(e.error=new Error(i)),n.data=e,e.err=e.error,n}return(0,g.default)(r)}((0,l.default)(Error)),Jn={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Zn=function(){function e(t){var r=this;(0,p.default)(this,e),this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){r.initialized&&(r.starved=!0),r.buffering=!0},this.onPlaying=function(){r.initialized||(r.initialized=!0),r.buffering=!1},this.applyPlaylistData=function(e){try{r.apply(e,{ot:Jn.MANIFEST,su:!r.initialized})}catch(t){P.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=function(e){try{var t=e.frag,i=r.hls.levels[t.level],n=r.getObjectType(t),a={d:1e3*t.duration,ot:n};n!==Jn.VIDEO&&n!==Jn.AUDIO&&n!=Jn.MUXED||(a.br=i.bitrate/1e3,a.tb=r.getTopBandwidth(n)/1e3,a.bl=r.getBufferLength(n)),r.apply(e,a)}catch(o){P.warn("Could not generate segment CMCD data.",o)}},this.hls=t;var i=this.config=t.config,n=i.cmcd;null!=n&&(i.pLoader=this.createPlaylistLoader(),i.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.uuid(),this.cid=n.contentId,this.useHeaders=!0===n.useHeaders,this.registerListeners())}return(0,g.default)(e,[{key:"registerListeners",value:function(){var e=this.hls;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHED,this.onMediaDetached,this),e.on(A.BUFFER_CREATED,this.onBufferCreated,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHED,this.onMediaDetached,this),e.off(A.BUFFER_CREATED,this.onBufferCreated,this)}},{key:"destroy",value:function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}},{key:"onMediaAttached",value:function(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}},{key:"onMediaDetached",value:function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}},{key:"onBufferCreated",value:function(e,t){var r,i;this.audioBuffer=null==(r=t.tracks.audio)?void 0:r.buffer,this.videoBuffer=null==(i=t.tracks.video)?void 0:i.buffer}},{key:"createData",value:function(){var e;return{v:1,sf:"h",sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}},{key:"apply",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};E(r,this.createData());var i=r.ot===Jn.INIT||r.ot===Jn.VIDEO||r.ot===Jn.MUXED;if(this.starved&&i&&(r.bs=!0,r.su=!0,this.starved=!1),null==r.su&&(r.su=this.buffering),this.useHeaders){var n=e.toHeaders(r);if(!Object.keys(n).length)return;t.headers||(t.headers={}),E(t.headers,n)}else{var a=e.toQuery(r);if(!a)return;t.url=e.appendQueryToUri(t.url,a)}}},{key:"getObjectType",value:function(e){var t=e.type;return"subtitle"===t?Jn.TIMED_TEXT:"initSegment"===e.sn?Jn.INIT:"audio"===t?Jn.AUDIO:"main"===t?this.hls.audioTracks.length?Jn.VIDEO:Jn.MUXED:void 0}},{key:"getTopBandwidth",value:function(e){var t,r=0,i=this.hls;if(e===Jn.AUDIO)t=i.audioTracks;else{var n=i.maxAutoLevel,o=n>-1?n+1:i.levels.length;t=i.levels.slice(0,o)}var s,l=(0,a.default)(t);try{for(l.s();!(s=l.n()).done;){var u=s.value;u.bitrate>r&&(r=u.bitrate)}}catch(ga){l.e(ga)}finally{l.f()}return r>0?r:NaN}},{key:"getBufferLength",value:function(e){var t=this.hls.media,r=e===Jn.AUDIO?this.audioBuffer:this.videoBuffer;if(!r||!t)return NaN;var i=hr.bufferInfo(r,t.currentTime,this.config.maxBufferHole);return 1e3*i.len}},{key:"createPlaylistLoader",value:function(){var e=this.config.pLoader,t=this.applyPlaylistData,r=e||this.config.loader;return function(){function e(t){(0,p.default)(this,e),this.loader=void 0,this.loader=new r(t)}return(0,g.default)(e,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}},{key:"destroy",value:function(){this.loader.destroy()}},{key:"abort",value:function(){this.loader.abort()}},{key:"load",value:function(e,r,i){t(e),this.loader.load(e,r,i)}}]),e}()}},{key:"createFragmentLoader",value:function(){var e=this.config.fLoader,t=this.applyFragmentData,r=e||this.config.loader;return function(){function e(t){(0,p.default)(this,e),this.loader=void 0,this.loader=new r(t)}return(0,g.default)(e,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}},{key:"destroy",value:function(){this.loader.destroy()}},{key:"abort",value:function(){this.loader.abort()}},{key:"load",value:function(e,r,i){t(e),this.loader.load(e,r,i)}}]),e}()}}],[{key:"uuid",value:function(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}},{key:"serialize",value:function(e){var t,r=[],i=function(e){return!Number.isNaN(e)&&null!=e&&""!==e&&!1!==e},n=function(e){return Math.round(e)},o=function(e){return 100*n(e/100)},s={br:n,d:n,bl:o,dl:o,mtp:o,nor:function(e){return encodeURIComponent(e)},rtp:o,tb:n},l=Object.keys(e||{}).sort(),u=(0,a.default)(l);try{for(u.s();!(t=u.n()).done;){var c=t.value,d=e[c];if(i(d)&&(("v"!==c||1!==d)&&("pr"!=c||1!==d))){var h=s[c];h&&(d=h(d));var f=(0,v.default)(d),p=void 0;p="ot"===c||"sf"===c||"st"===c?"".concat(c,"=").concat(d):"boolean"===f?c:"number"===f?"".concat(c,"=").concat(d):"".concat(c,"=").concat(JSON.stringify(d)),r.push(p)}}}catch(ga){u.e(ga)}finally{u.f()}return r.join(",")}},{key:"toHeaders",value:function(t){for(var r=Object.keys(t),i={},n=["Object","Request","Session","Status"],a=[{},{},{},{}],o={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},s=0,l=r;s<l.length;s++){var u=l[s],c=null!=o[u]?o[u]:1;a[c][u]=t[u]}for(var d=0;d<a.length;d++){var h=e.serialize(a[d]);h&&(i["CMCD-".concat(n[d])]=h)}return i}},{key:"toQuery",value:function(t){return"CMCD=".concat(encodeURIComponent(e.serialize(t)))}},{key:"appendQueryToUri",value:function(e,t){if(!t)return e;var r=e.includes("?")?"&":"?";return"".concat(e).concat(r).concat(t)}}]),e}(),$n=function(){function e(t){(0,p.default)(this,e),this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=t,this.log=P.log.bind(P,"[content-steering]:"),this.registerListeners()}return(0,g.default)(e,[{key:"registerListeners",value:function(){var e=this.hls;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.ERROR,this.onError,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e&&(e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.ERROR,this.onError,this))}},{key:"startLoad",value:function(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){var e=Math.max(1e3*this.timeToLoad-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,e)}else this.loadSteeringManifest(this.uri)}},{key:"stopLoad",value:function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}},{key:"destroy",value:function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}},{key:"removeLevel",value:function(e){var t=this.levels;t&&(this.levels=t.filter((function(t){return t!==e})))}},{key:"onManifestLoading",value:function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}},{key:"onManifestLoaded",value:function(e,t){var r=t.contentSteering;null!==r&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}},{key:"onManifestParsed",value:function(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}},{key:"onError",value:function(e,t){var r=t.errorAction;if((null==r?void 0:r.action)===Wt.SendAlternateToPenaltyBox&&r.flags===Yt.MoveAllAlternatesMatchingHost){var i=this.pathwayPriority,n=this.pathwayId;this.penalizedPathways[n]||(this.penalizedPathways[n]=performance.now()),!i&&this.levels&&(i=this.levels.reduce((function(e,t){return-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e}),[])),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==n)}}},{key:"filterParsedLevels",value:function(e){this.levels=e;var t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){var r=e[0].pathwayId;this.log("No levels found in Pathway ".concat(this.pathwayId,'. Setting initial Pathway to "').concat(r,'"')),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length?(this.log("Found ".concat(t.length,"/").concat(e.length,' levels in Pathway "').concat(this.pathwayId,'"')),t):e}},{key:"getLevelsForPathway",value:function(e){return null===this.levels?[]:this.levels.filter((function(t){return e===t.pathwayId}))}},{key:"updatePathwayPriority",value:function(e){var t;this.pathwayPriority=e;var r=this.penalizedPathways,i=performance.now();Object.keys(r).forEach((function(e){i-r[e]>3e5&&delete r[e]}));for(var n=0;n<e.length;n++){var a=e[n];if(!r[a]){if(a===this.pathwayId)return;var o=this.hls.nextLoadLevel,s=this.hls.levels[o];if(t=this.getLevelsForPathway(a),t.length>0){this.log('Setting Pathway to "'.concat(a,'"')),this.pathwayId=a,this.hls.trigger(A.LEVELS_UPDATED,{levels:t});var l=this.hls.levels[o];s&&l&&this.levels&&(l.attrs["STABLE-VARIANT-ID"]!==s.attrs["STABLE-VARIANT-ID"]&&l.bitrate!==s.bitrate&&this.log("Unstable Pathways change from bitrate ".concat(s.bitrate," to ").concat(l.bitrate)),this.hls.nextLoadLevel=o);break}}}}},{key:"clonePathways",value:function(e){var t=this,r=this.levels;if(r){var i={},a={};e.forEach((function(e){var o=e.ID,s=e["BASE-ID"],l=e["URI-REPLACEMENT"];if(!r.some((function(e){return e.pathwayId===o}))){var u=t.getLevelsForPathway(s).map((function(e){var t=E({},e);t.details=void 0,t.url=ta(e.uri,e.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l);var r=new N(e.attrs);r["PATHWAY-ID"]=o;var n=r.AUDIO&&"".concat(r.AUDIO,"_clone_").concat(o),s=r.SUBTITLES&&"".concat(r.SUBTITLES,"_clone_").concat(o);n&&(i[r.AUDIO]=n,r.AUDIO=n),s&&(a[r.SUBTITLES]=s,r.SUBTITLES=s),t.attrs=r;var u=new Lt(t);return Zt(u,"audio",n),Zt(u,"text",s),u}));r.push.apply(r,(0,n.default)(u)),ea(t.audioTracks,i,l,o),ea(t.subtitleTracks,a,l,o)}}))}}},{key:"loadSteeringManifest",value:function(e){var t,r=this,i=this.hls.config,n=i.loader;this.loader&&this.loader.destroy(),this.loader=new n(i);try{t=new self.URL(e)}catch(d){return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: ".concat(e))}if("data:"!==t.protocol){var a=0|(this.hls.bandwidthEstimate||i.abrEwmaDefaultEstimate);t.searchParams.set("_HLS_pathway",this.pathwayId),t.searchParams.set("_HLS_throughput",""+a)}var o={responseType:"json",url:t.href},s=i.steeringManifestLoadPolicy.default,l=s.errorRetry||s.timeoutRetry||{},u={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},c={onSuccess:function(e,i,n,a){r.log('Loaded steering manifest: "'.concat(t,'"'));var o=e.data;if(1===o.VERSION){r.updated=performance.now(),r.timeToLoad=o.TTL;var s=o["RELOAD-URI"],l=o["PATHWAY-CLONES"],u=o["PATHWAY-PRIORITY"];if(s)try{r.uri=new self.URL(s,t).href}catch(d){return r.enabled=!1,void r.log("Failed to parse Steering Manifest RELOAD-URI: ".concat(s))}r.scheduleRefresh(r.uri||n.url),l&&r.clonePathways(l),u&&r.updatePathwayPriority(u)}else r.log("Steering VERSION ".concat(o.VERSION," not supported!"))},onError:function(e,t,i,n){if(r.log("Error loading steering manifest: ".concat(e.code," ").concat(e.text," (").concat(t.url,")")),r.stopLoad(),410===e.code)return r.enabled=!1,void r.log("Steering manifest ".concat(t.url," no longer available"));var a=1e3*r.timeToLoad;if(429!==e.code)r.scheduleRefresh(r.uri||t.url,a);else{var o=r.loader;if("function"===typeof(null==o?void 0:o.getResponseHeader)){var s=o.getResponseHeader("Retry-After");s&&(a=1e3*parseFloat(s))}r.log("Steering manifest ".concat(t.url," rate limited"))}},onTimeout:function(e,t,i){r.log("Timeout loading steering manifest (".concat(t.url,")")),r.scheduleRefresh(r.uri||t.url)}};this.log("Requesting steering manifest: ".concat(t)),this.loader.load(o,u,c)}},{key:"scheduleRefresh",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3*this.timeToLoad;self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout((function(){t.loadSteeringManifest(e)}),r)}}]),e}();function ea(e,t,r,i){e&&Object.keys(t).forEach((function(a){var o=e.filter((function(e){return e.groupId===a})).map((function(e){var n=E({},e);return n.details=void 0,n.attrs=new N(n.attrs),n.url=n.attrs.URI=ta(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",r),n.groupId=n.attrs["GROUP-ID"]=t[a],n.attrs["PATHWAY-ID"]=i,n}));e.push.apply(e,(0,n.default)(o))}))}function ta(e,t,r,i){var n,a=i.HOST,o=i.PARAMS,s=i[r];t&&(n=null==s?void 0:s[t],n&&(e=n));var l=new self.URL(e);return a&&!n&&(l.host=a),o&&Object.keys(o).sort().forEach((function(e){e&&l.searchParams.set(e,o[e])})),l.href}var ra=/^age:\s*[\d.]+\s*$/im,ia=function(){function e(t){(0,p.default)(this,e),this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=t&&t.xhrSetup||null,this.stats=new H,this.retryDelay=0}return(0,g.default)(e,[{key:"destroy",value:function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}},{key:"abortInternal",value:function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}},{key:"abort",value:function(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}},{key:"load",value:function(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}},{key:"loadInternal",value:function(){var e=this,t=this.config,r=this.context;if(t){var i=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0;var a=this.xhrSetup;a?Promise.resolve().then((function(){if(!e.stats.aborted)return a(i,r.url)})).catch((function(e){return i.open("GET",r.url,!0),a(i,r.url)})).then((function(){e.stats.aborted||e.openAndSendXhr(i,r,t)})).catch((function(t){e.callbacks.onError({code:i.status,text:t.message},r,i,n)})):this.openAndSendXhr(i,r,t)}}},{key:"openAndSendXhr",value:function(e,t,r){e.readyState||e.open("GET",t.url,!0);var i=this.context.headers,n=r.loadPolicy,a=n.maxTimeToFirstByteMs,o=n.maxLoadTimeMs;if(i)for(var s in i)e.setRequestHeader(s,i[s]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=a&&k(a)?a:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}},{key:"readystatechange",value:function(){var e=this.context,t=this.loader,r=this.stats;if(e&&t){var i=t.readyState,n=this.config;if(!r.aborted&&i>=2&&(0===r.loading.first&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),n.timeout!==n.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),n.timeout=n.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),4===i)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;var a=t.status,o="text"!==t.responseType;if(a>=200&&a<300&&(o&&t.response||null!==t.responseText)){r.loading.end=Math.max(self.performance.now(),r.loading.first);var s=o?t.response:t.responseText,l="arraybuffer"===t.responseType?s.byteLength:s.length;if(r.loaded=r.total=l,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first),!this.callbacks)return;var u=this.callbacks.onProgress;if(u&&u(r,e,s,t),!this.callbacks)return;var c={url:t.responseURL,data:s,code:a};this.callbacks.onSuccess(c,r,e,t)}else{var d=n.loadPolicy.errorRetry,h=r.retry;Vt(d,h,!1,a)?this.retry(d):(P.error("".concat(a," while loading ").concat(e.url)),this.callbacks.onError({code:a,text:t.statusText},e,t,r))}}}}},{key:"loadtimeout",value:function(){var e,t=null==(e=this.config)?void 0:e.loadPolicy.timeoutRetry,r=this.stats.retry;if(Vt(t,r,!0))this.retry(t);else{P.warn("timeout while loading ".concat(this.context.url));var i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}},{key:"retry",value:function(e){var t=this.context,r=this.stats;this.retryDelay=Bt(e,r.retry),r.retry++,P.warn("".concat(status?"HTTP Status "+status:"Timeout"," while loading ").concat(t.url,", retrying ").concat(r.retry,"/").concat(e.maxNumRetry," in ").concat(this.retryDelay,"ms")),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}},{key:"loadprogress",value:function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}},{key:"getCacheAge",value:function(){var e=null;if(this.loader&&ra.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}},{key:"getResponseHeader",value:function(e){return this.loader&&new RegExp("^".concat(e,":\\s*[\\d.]+\\s*$"),"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}]),e}();var na=/(\d+)-(\d+)\/(\d+)/,aa=function(){function e(t){(0,p.default)(this,e),this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||oa,this.controller=new self.AbortController,this.stats=new H}return(0,g.default)(e,[{key:"destroy",value:function(){this.loader=this.callbacks=null,this.abortInternal()}},{key:"abortInternal",value:function(){var e=this.response;null!=e&&e.ok||(this.stats.aborted=!0,this.controller.abort())}},{key:"abort",value:function(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}},{key:"load",value:function(e,t,r){var i=this,n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();var a=function(e,t){var r={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(E({},e.headers))};e.rangeEnd&&r.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1));return r}(e,this.controller.signal),o=r.onProgress,s="arraybuffer"===e.responseType,l=s?"byteLength":"length",u=t.loadPolicy,c=u.maxTimeToFirstByteMs,d=u.maxLoadTimeMs;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,a),self.clearTimeout(this.requestTimeout),t.timeout=c&&k(c)?c:d,this.requestTimeout=self.setTimeout((function(){i.abortInternal(),r.onTimeout(n,e,i.response)}),t.timeout),self.fetch(this.request).then((function(a){i.response=i.loader=a;var l=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(i.requestTimeout),t.timeout=d,i.requestTimeout=self.setTimeout((function(){i.abortInternal(),r.onTimeout(n,e,i.response)}),d-(l-n.loading.start)),!a.ok){var u=a.status,c=a.statusText;throw new sa(c||"fetch, bad network response",u,a)}return n.loading.first=l,n.total=function(e){var t=e.get("Content-Range");if(t){var r=function(e){var t=na.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(k(r))return r}var i=e.get("Content-Length");if(i)return parseInt(i)}(a.headers)||n.total,o&&k(t.highWaterMark)?i.loadProgressively(a,n,e,t.highWaterMark,o):s?a.arrayBuffer():"json"===e.responseType?a.json():a.text()})).then((function(a){var s=i.response;self.clearTimeout(i.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);var u=a[l];u&&(n.loaded=n.total=u);var c={url:s.url,data:a,code:s.status};o&&!k(t.highWaterMark)&&o(n,e,a,s),r.onSuccess(c,n,e,s)})).catch((function(t){if(self.clearTimeout(i.requestTimeout),!n.aborted){var a=t&&t.code||0,o=t?t.message:null;r.onError({code:a,text:o},e,t?t.details:null,n)}}))}},{key:"getCacheAge",value:function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}},{key:"getResponseHeader",value:function(e){return this.response?this.response.headers.get(e):null}},{key:"loadProgressively",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4?arguments[4]:void 0,a=new Hi,o=e.body.getReader(),s=function s(){return o.read().then((function(o){if(o.done)return a.dataLength&&n(t,r,a.flush(),e),Promise.resolve(new ArrayBuffer(0));var l=o.value,u=l.length;return t.loaded+=u,u<i||a.dataLength?(a.push(l),a.dataLength>=i&&n(t,r,a.flush(),e)):n(t,r,l,e),s()})).catch((function(){return Promise.reject()}))};return s()}}]),e}();function oa(e,t){return new self.Request(e.url,t)}var sa=function(e){(0,d.default)(r,e);var t=(0,h.default)(r);function r(e,i,n){var a;return(0,p.default)(this,r),a=t.call(this,e),a.code=void 0,a.details=void 0,a.code=i,a.details=n,a}return(0,g.default)(r)}((0,l.default)(Error)),la=/\s/,ua={newCue:function(e,t,r,i){for(var n,a,o,s,l,u=[],c=self.VTTCue||self.TextTrackCue,d=0;d<i.rows.length;d++)if(n=i.rows[d],o=!0,s=0,l="",!n.isEmpty()){for(var h,f=0;f<n.chars.length;f++)la.test(n.chars[f].uchar)&&o?s++:(l+=n.chars[f].uchar,o=!1);n.cueStartTime=t,t===r&&(r+=1e-4),s>=16?s--:s++;var p=xn(l.trim()),g=Dn(t,r,p);null!=e&&null!=(h=e.cues)&&h.getCueById(g)||(a=new c(t,r,p),a.id=g,a.line=d+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*s/32)),u.push(a))}return e&&u.length&&(u.sort((function(e,t){return"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line})),u.forEach((function(t){return vt(e,t)}))),u}},ca=T(T({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:ia,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Bi,bufferController:Zi,capLevelController:Yn,errorController:zt,fpsController:zn,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:te,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},function(){return{cueHandler:ua,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}()),{},{subtitleStreamController:qi,subtitleTrackController:Yi,timelineController:Gn,audioStreamController:Vi,audioTrackController:ji,emeController:Xn,cmcdController:Zn,contentSteeringController:$n});function da(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var r=ha(e),i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach((function(e){var n="".concat("level"===e?"playlist":e,"LoadPolicy"),a=void 0===t[n],o=[];i.forEach((function(i){var s="".concat(e,"Loading").concat(i),l=t[s];if(void 0!==l&&a){o.push(s);var u=r[n].default;switch(t[n]={default:u},i){case"TimeOut":u.maxLoadTimeMs=l,u.maxTimeToFirstByteMs=l;break;case"MaxRetry":u.errorRetry.maxNumRetry=l,u.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":u.errorRetry.retryDelayMs=l,u.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":u.errorRetry.maxRetryDelayMs=l,u.timeoutRetry.maxRetryDelayMs=l;break}}})),o.length&&P.warn('hls.js config: "'.concat(o.join('", "'),'" setting(s) are deprecated, use "').concat(n,'": ').concat(JSON.stringify(t[n])))})),T(T({},r),t)}function ha(e){return e&&"object"===(0,v.default)(e)?Array.isArray(e)?e.map(ha):Object.keys(e).reduce((function(t,r){return t[r]=ha(e[r]),t}),{}):e}function fa(e){var t=e.loader;if(t!==aa&&t!==ia)P.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{var r=function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}();r&&(e.loader=aa,e.progressive=!0,e.enableSoftwareAES=!0,P.log("[config]: Progressive streaming enabled, using FetchLoader"))}}var pa=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,p.default)(this,e),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Di,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,D(t.debug||!1,"Hls instance");var r=this.config=da(e.DefaultConfig,t);this.userConfig=t,this._autoLevelCapping=-1,r.progressive&&fa(r);var i=r.abrController,n=r.bufferController,a=r.capLevelController,o=r.errorController,s=r.fpsController,l=new o(this),u=this.abrController=new i(this),c=this.bufferController=new n(this),d=this.capLevelController=new a(this),h=new s(this),f=new pt(this),g=new kt(this),v=r.contentSteeringController,y=v?new v(this):null,m=this.levelController=new Jt(this,y),_=new tr(this),b=new ur(this.config),T=this.streamController=new Ni(this,_,b);d.setStreamController(T),h.setStreamController(T);var S=[f,m,T];y&&S.splice(1,0,y),this.networkControllers=S;var E=[u,c,d,h,g,_];this.audioTrackController=this.createController(r.audioTrackController,S);var k=r.audioStreamController;k&&S.push(new k(this,_,b)),this.subtitleTrackController=this.createController(r.subtitleTrackController,S);var w=r.subtitleStreamController;w&&S.push(new w(this,_,b)),this.createController(r.timelineController,E),b.emeController=this.emeController=this.createController(r.emeController,E),this.cmcdController=this.createController(r.cmcdController,E),this.latencyController=this.createController(At,E),this.coreComponents=E,S.push(l);var x=l.onErrorOut;"function"===typeof x&&this.on(A.ERROR,x,l)}return(0,g.default)(e,[{key:"createController",value:function(e,t){if(e){var r=new e(this);return t&&t.push(r),r}return null}},{key:"on",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.on(e,t,r)}},{key:"once",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.once(e,t,r)}},{key:"removeAllListeners",value:function(e){this._emitter.removeAllListeners(e)}},{key:"off",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,i=arguments.length>3?arguments[3]:void 0;this._emitter.off(e,t,r,i)}},{key:"listeners",value:function(e){return this._emitter.listeners(e)}},{key:"emit",value:function(e,t,r){return this._emitter.emit(e,t,r)}},{key:"trigger",value:function(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){P.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(A.ERROR,{type:w.OTHER_ERROR,details:x.INTERNAL_EXCEPTION,fatal:!1,event:e,error:r})}return!1}},{key:"listenerCount",value:function(e){return this._emitter.listenerCount(e)}},{key:"destroy",value:function(){P.log("destroy"),this.trigger(A.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(e){return e.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(e){return e.destroy()})),this.coreComponents.length=0;var e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}},{key:"attachMedia",value:function(e){P.log("attachMedia"),this._media=e,this.trigger(A.MEDIA_ATTACHING,{media:e})}},{key:"detachMedia",value:function(){P.log("detachMedia"),this.trigger(A.MEDIA_DETACHING,void 0),this._media=null}},{key:"loadSource",value:function(e){this.stopLoad();var t=this.media,r=this.url,i=this.url=_.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});P.log("loadSource:".concat(i)),t&&r&&(r!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(A.MANIFEST_LOADING,{url:e})}},{key:"startLoad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;P.log("startLoad(".concat(e,")")),this.networkControllers.forEach((function(t){t.startLoad(e)}))}},{key:"stopLoad",value:function(){P.log("stopLoad"),this.networkControllers.forEach((function(e){e.stopLoad()}))}},{key:"swapAudioCodec",value:function(){P.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){P.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)}},{key:"removeLevel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.levelController.removeLevel(e,t)}},{key:"levels",get:function(){var e=this.levelController.levels;return e||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){P.log("set currentLevel:".concat(e)),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){P.log("set nextLevel:".concat(e)),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){P.log("set loadLevel:".concat(e)),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){P.log("set firstLevel:".concat(e)),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){P.log("set startLevel:".concat(e)),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(P.log("set autoLevelCapping:".concat(e)),this._autoLevelCapping=e)}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN}},{key:"ttfbEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(e){wt.indexOf(e)>-1&&(this._maxHdcpLevel=e)}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,t=this.config.minAutoBitrate;if(!e)return 0;for(var r=e.length,i=0;i<r;i++)if(e[i].maxBitrate>=t)return i;return 0}},{key:"maxAutoLevel",get:function(){var e,t=this.levels,r=this.autoLevelCapping,i=this.maxHdcpLevel;if(e=-1===r&&t&&t.length?t.length-1:r,i)for(var n=e;n--;){var a=t[n].attrs["HDCP-LEVEL"];if(a&&a<=i)return n}return e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.4.3"}},{key:"isSupported",value:function(){return function(){var e=Ye();if(!e)return!1;var t=xr(),r=e&&"function"===typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!t||t.prototype&&"function"===typeof t.prototype.appendBuffer&&"function"===typeof t.prototype.remove;return!!r&&!!i}()}},{key:"Events",get:function(){return A}},{key:"ErrorTypes",get:function(){return w}},{key:"ErrorDetails",get:function(){return x}},{key:"DefaultConfig",get:function(){return e.defaultConfig?e.defaultConfig:ca},set:function(t){e.defaultConfig=t}}]),e}();t.default=pa,pa.defaultConfig=void 0},"5d34":function(e,t,r){"use strict";r("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){while(!Object.prototype.hasOwnProperty.call(e,t))if(e=(0,i.default)(e),null===e)break;return e};var i=function(e){return e&&e.__esModule?e:{default:e}}(r("7e84"))},"62cf":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAAHdbkFIAAAAAXNSR0IArs4c6QAAAQdJREFUeAHtmdkOwjAMBFv+/5+hllhkKrlRz0B38uIoh2OPVyGiw3BYe75bOMz9R+uECxa0QjhyPnKXv9y/IM3mEYrrPDvOXWcE49Q0X43vzgEHQuxtP0oLDJXaqvHYg5Bg8Bs6iChofQl8XSfzUPI1kufyD14eX7s+9u6+jnIAW/oEAAEIQKA7gS2XF3sgAIF7EeBJ1v0qJgAIQAACEIAABCAAge4E7vXGJxsIQAACEIDAvxFY/H9qKZnq82C1p/rMWK0/27/OtX8LAUBScLUowLXyyhsFiISrRQGulVfeKEAkXC0KcK288kYBIuFqUYBr5ZU3ChAJV4sCXCtP3hCAAAQgMBF4AShmQIQewFksAAAAAElFTkSuQmCC"},"6c20":function(e,t,r){"use strict";r.r(t);var i=r("d22a"),n=r.n(i);for(var a in i)["default"].indexOf(a)<0&&function(e){r.d(t,e,(function(){return i[e]}))}(a);t["default"]=n.a},"6c57":function(e,t,r){var i=r("23e7"),n=r("da84");i({global:!0,forced:n.globalThis!==n},{globalThis:n})},"6f31":function(e,t,r){var i=r("24fb"),n=r("1de5"),a=r("1e1b"),o=r("8475"),s=r("62cf"),l=r("a073"),u=r("8bbe"),c=r("cee1"),d=r("e58e"),h=r("9ace"),f=r("8aaf"),p=r("4467"),g=r("8b90"),v=r("1aeb"),y=r("ef46"),m=r("ab53"),_=r("1bcf"),b=r("b317");t=i(!1);var T=n(a),S=n(o),E=n(s),k=n(l),A=n(u),w=n(c),x=n(d),R=n(h),L=n(f),I=n(p),C=n(g),D=n(v),P=n(y),O=n(m),M=n(_),N=n(b);t.push([e.i,".prism-player .prism-big-play-btn{background:url("+T+") no-repeat;background-size:contain;width:64px;height:64px}.prism-player .prism-big-play-btn .outter{border:7px solid hsla(0,0%,100%,.51);width:64px;height:64px;border-radius:100%;position:absolute;box-sizing:border-box;top:0;left:0}.prism-player .prism-big-play-btn:hover{cursor:pointer}.prism-player .prism-play-btn{width:24px;height:24px;background:url("+S+") no-repeat;background-size:contain}.prism-player .prism-play-btn:hover{cursor:pointer}.prism-player .prism-live-display{font-size:12px;color:#ebecec;line-height:44px;text-align:center;margin:0}.prism-player .live-shift-display:hover{cursor:pointer;font-size:14px}.prism-player .prism-play-btn.playing{background:url("+E+") no-repeat;background-size:contain}.prism-player .prism-play-btn.playing:hover{cursor:pointer}.prism-player .prism-fullscreen-btn{width:24px;height:24px;background:url("+k+") no-repeat;background-size:contain}.prism-player .prism-fullscreen-btn:hover{cursor:pointer}.prism-player .prism-fullscreen-btn.fullscreen{background:url("+A+") no-repeat;background-size:contain}.prism-player .prism-fullscreen-btn.fullscreen:hover{animation:hoverAnimationScale 1s 1;-moz-animation:hoverAnimationScale 1s 1;-webkit-animation:hoverAnimationScale 1s 1;-o-animation:hoverAnimationScale 1s 1;cursor:pointer}.prism-player .prism-volume{position:relative}.prism-player .prism-volume .volume-icon{width:28px;height:28px;background:url("+w+");background-size:contain}.prism-player .prism-volume .volume-icon .long-horizontal{width:3px;background:#ebecec;height:18px;position:absolute;right:5px;top:50%;-ms-transform:translateY(-50%);-webkit-transform:translateY(-50%);transform:translateY(-50%)}.prism-player .prism-volume .volume-icon .short-horizontal{width:3px;background:#ebecec;height:8px;position:absolute;right:10px;top:50%;-ms-transform:translateY(-50%);-webkit-transform:translateY(-50%);transform:translateY(-50%)}.prism-player .prism-volume .volume-icon:hover{-ms-transform-origin:0 50%;-webkit-transform-origin:0 50%;transform-origin:0 50%;background-size:contain;cursor:pointer}.prism-player .prism-volume .mute .long-horizontal{-ms-transform:rotate(-45deg);-webkit-transform:rotate(-45deg);transform:rotate(-45deg);height:12px;top:10px;left:22px}.prism-player .prism-volume .mute .short-horizontal{-ms-transform:rotate(45deg);-webkit-transform:rotate(45deg);transform:rotate(45deg);height:12px;top:10px;left:22px}.prism-player .prism-volume-control{position:absolute;bottom:44px;display:none;background:rgba(60,60,60,.95);box-shadow:0 0 6px 0 rgba(0,0,0,.1);width:32px;height:130px;z-index:10000}.prism-player .prism-volume-control .volume-control-icon{width:32px;height:32px;background:url("+x+") no-repeat;background-size:contain}.prism-player .prism-volume-control .volume-control-icon:hover{cursor:pointer;background:url("+R+") no-repeat;background-size:contain}.prism-player .prism-volume-control .volume-control-icon.mute{background:url("+L+") no-repeat;background-size:contain}.prism-player .prism-volume-control .volume-control-icon.mute:hover{background:url("+I+") no-repeat;background-size:contain;cursor:pointer}.prism-player .prism-volume-control:hover{cursor:pointer}.prism-player .prism-volume-control .volume-control-icon{position:absolute;bottom:6px;left:8px;width:26px;height:26px}.prism-player .prism-volume-control .volume-range{position:absolute;left:14px;bottom:10px;border-radius:1px;background:#6c6262;box-shadow:inset 1px 1px 1px 0 rgba(0,0,0,.06);width:4px;height:100px}.prism-player .prism-volume-control .volume-value{width:100%;height:0%;background:#30adf2;position:absolute;border-radius:1px;bottom:0}.prism-player .prism-volume-control .volume-cursor{position:absolute;bottom:0;background:#fff;width:15px;height:15px;border-radius:15px;left:-6px}.prism-player .prism-volume-control .volume-cursor:hover{background:#00c1de}.prism-player .prism-animation{width:64px;height:64px;border-radius:64px;opacity:0;position:absolute;left:50%;top:50%;-ms-transform:translate(-50%,-50%);-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.prism-player .prism-play-animation{background:url("+C+") no-repeat;background-size:contain}.prism-player .prism-pause-animation{background:url("+D+") no-repeat;background-size:contain}.prism-player .play-apply-animation{animation:prismplayanimation 1s 1;-moz-animation:prismplayanimation 1s 1;-webkit-animation:prismplayanimation 1s 1;-o-animation:prismplayanimation 1s 1;-webkit-animation-fill-mode:both;animation-fill-mode:both}@-webkit-keyframes prismplayanimation{0%{width:32px;height:32px;border-radius:32px;opacity:0}50%{width:32px;height:32px;border-radius:32px;opacity:1}99%{width:76px;height:76px;border-radius:76px;opacity:0}100%{width:0;height:0}}@keyframes prismplayanimation{0%{width:32px;height:32px;border-radius:32px;opacity:0}50%{width:32px;height:32px;border-radius:32px;opacity:1}99%{width:76px;height:76px;border-radius:76px;opacity:0}100%{width:0;height:0}}@-webkit-keyframes spinoffPulse{0%{transform:rotate(0);-webkit-transform:rotate(0);-moz-transform:rotate(0)}100%{transform:rotate(1turn);-webkit-transform:rotate(1turn);-moz-transform:rotate(1turn)}}@keyframes spinoffPulse{0%{transform:rotate(0);-webkit-transform:rotate(0);-moz-transform:rotate(0)}100%{transform:rotate(1turn);-webkit-transform:rotate(1turn);-moz-transform:rotate(1turn)}}@-webkit-keyframes hoverAnimationRotate{0%{transform:rotate(0);-webkit-transform:rotate(0);-moz-transform:rotate(0)}50%{transform:rotate(45deg);-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg)}100%{transform:rotate(0);-webkit-transform:rotate(0);-moz-transform:rotate(0)}}@keyframes hoverAnimationRotate{0%{transform:rotate(0);-webkit-transform:rotate(0);-moz-transform:rotate(0)}50%{transform:rotate(45deg);-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg)}100%{transform:rotate(0);-webkit-transform:rotate(0);-moz-transform:rotate(0)}}@-webkit-keyframes hoverAnimationScale{0%{transform:scale(1);-webkit-transform:scale(1);-moz-transform:scale(1)}50%{transform:scale(1.2);-webkit-transform:scale(1.2);-moz-transform:scale(1.2)}100%{transform:scale(1);-webkit-transform:scale(1);-moz-transform:scale(1)}}@keyframes hoverAnimationScale{0%{transform:scale(1);-webkit-transform:scale(1);-moz-transform:scale(1)}50%{transform:scale(1.2);-webkit-transform:scale(1.2);-moz-transform:scale(1.2)}100%{transform:scale(1);-webkit-transform:scale(1);-moz-transform:scale(1)}}@-webkit-keyframes hoverAnimationScaleX{0%{transform:scaleX(1);-webkit-transform:scaleX(1);-moz-transform:scaleX(1)}50%{transform:scaleX(1.2);-webkit-transform:scaleX(1.2);-moz-transform:scaleX(1.2)}100%{transform:scaleX(1);-webkit-transform:scaleX(1);-moz-transform:scaleX(1)}}@keyframes hoverAnimationScaleX{0%{transform:scaleX(1);-webkit-transform:scaleX(1);-moz-transform:scaleX(1)}50%{transform:scaleX(1.2);-webkit-transform:scaleX(1.2);-moz-transform:scaleX(1.2)}100%{transform:scaleX(1);-webkit-transform:scaleX(1);-moz-transform:scaleX(1)}}@-webkit-keyframes hoverVolumeAnimation{0%{opacity:1}50%{opacity:0}100%{opacity:1}}@keyframes hoverVolumeAnimation{0%{opacity:1}50%{opacity:0}100%{opacity:1}}.volume-hover-animation{animation:hoverVolumeAnimation .3s 1;-moz-animation:hoverVolumeAnimation .3s 1;-webkit-animation:hoverVolumeAnimation .3s 1;-o-animation:hoverVolumeAnimation .3s 1}@-webkit-keyframes hoverPlayButtonAnimation{0%{width:63px;height:63px;border:7px solid #fff}60%{width:90px;height:90px;border:7px solid hsla(0,0%,100%,.51)}100%{width:97px;height:97px;border:14px solid hsla(0,0%,100%,0)}}@keyframes hoverPlayButtonAnimation{0%{width:63px;height:63px;border:7px solid #fff}60%{width:90px;height:90px;border:7px solid hsla(0,0%,100%,.51)}100%{width:97px;height:97px;border:14px solid hsla(0,0%,100%,0)}}@-webkit-keyframes warn{0%{-webkit-transform:scale(1);transform:scale(1);opacity:0}25%{-webkit-transform:scale(1);transform:scale(1);opacity:.1}50%{-webkit-transform:scale(1.1);transform:scale(1.1);opacity:.3}75%{-webkit-transform:scale(1.5);transform:scale(1.5);opacity:.5}100%{-webkit-transform:scale(2);transform:scale(2);opacity:0}}@keyframes warn{0%{-webkit-transform:scale(1);transform:scale(1);opacity:0}25%{-webkit-transform:scale(1);transform:scale(1);opacity:.1}50%{-webkit-transform:scale(1.1);transform:scale(1.1);opacity:.3}75%{-webkit-transform:scale(1.5);transform:scale(1.5);opacity:.5}100%{-webkit-transform:scale(2);transform:scale(2);opacity:0}}.big-playbtn-hover-animation{animation:warn 1s ease-out;-moz-animation:warn 1s ease-out;-webkit-animation:warn 1s ease-out;-o-animation:warn 1s ease-out}.big-playbtn-hover-animation1{animation:hoverPlayButtonAnimation 1s 1;-moz-animation:hoverPlayButtonAnimation 1s 1;-webkit-animation:hoverPlayButtonAnimation 1s 1;-o-animation:hoverPlayButtonAnimation 1s 1}.prism-player{background-color:#000;position:relative}.prism-player a{text-decoration:none}.prism-player uni-video{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-webkit-transform:translate(-50%,-50%);-o-transform:translate(-50%,-50%);-ms-transform-origin:center;-moz-transform-origin:center;-webkit-transform-origin:center;-o-transform-origin:center}.prism-player .x5-full-screen{object-fit:fill;object-position:50% 50%}.prism-player .x5-top-left{object-fit:contain;object-position:0 0}.prism-player .prism-cover{width:100%;height:100%;background-repeat:no-repeat;background-position:50%;background-size:cover;position:absolute;top:0;left:0;z-index:11}.prism-player .prism-text-overlay{width:100%;height:100%;position:absolute;top:0;left:0;z-index:9;pointer-events:none}.prism-player .prism-ErrorMessage{width:100%;height:100%;background-color:#000;background-repeat:no-repeat;background-position:50%;background-size:contain;position:absolute;z-index:99;top:0;left:0;overflow:hidden;display:none}.prism-player .prism-ErrorMessage .prism-error-content{margin-top:20px;padding:0 5px}.prism-player .prism-ErrorMessage .prism-error-content p{text-align:center;font-size:12px;color:#fff}.prism-player .prism-ErrorMessage .prism-error-operation{margin-top:10px;margin-bottom:10px;padding-bottom:5px;border-bottom:1.5px;border-bottom-color:hsla(0,0%,100%,.15);border-bottom-style:dotted;text-align:center}.prism-player .prism-ErrorMessage .prism-error-operation a{width:80px;height:32px;line-height:32px;vertical-align:top;display:inline-block;margin-left:10px}.prism-player .prism-ErrorMessage .prism-error-operation a.prism-button-refresh{color:#21c5e0;border:solid 1px #21c5e0}.prism-player .prism-ErrorMessage .prism-error-operation a.prism-button-refresh:hover{color:#05d3f5;border-color:#05d3f5;cursor:pointer}.prism-player .prism-ErrorMessage .prism-error-operation a.prism-button-refresh:active{color:#026a7b;border-color:#026a7b}.prism-player .prism-ErrorMessage .prism-error-operation .prism-button-orange:visited{color:#05d3f5}.prism-player .prism-ErrorMessage .prism-detect-info{color:#fff;font-size:10px}.prism-player .prism-ErrorMessage .prism-detect-info p{padding:0 5px;word-break:break-all;margin:0 0 4px}.prism-player .prism-ErrorMessage .prism-detect-info span.info-label{display:inline-block;font-weight:700}.prism-player .prism-ErrorMessage .prism-detect-info span.info-content{color:grey}.prism-player .prism-big-play-btn{display:none;z-index:1000}.prism-player .prism-license-watermark{z-index:100;position:absolute;width:300px;height:120px;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;right:20px;top:20px;border:1px solid hsla(0,0%,84.7%,.12);box-shadow:0 0 12px 0 hsla(0,0%,51%,.2);border-radius:2px;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);background-color:hsla(0,0%,100%,.12)}.prism-player .prism-license-watermark .no-authorization{font-weight:500;font-size:24px;color:hsla(0,0%,100%,.9);text-shadow:1px 1px 2px rgba(0,0,0,.5);margin:0 50px}.prism-player .prism-license-watermark .apply-button{margin-top:12px;padding:5px 20px;background-color:#00bcd4;border:1px solid #26c5da;font-weight:400;font-size:14px;color:#fff;line-height:20px;cursor:pointer}.prism-player .prism-controlbar{width:100%;height:44px;position:relative;z-index:10;font-size:14px}.prism-player .prism-controlbar .prism-controlbar-bg{background:rgba(75,75,75,.15);width:100%;height:40px;position:absolute;bottom:0;left:0;z-index:-1}.prism-player .prism-time-display{height:40px;line-height:40px;color:#a4aab3;font-size:12px}.prism-player .prism-time-display .current-time{color:#fff}.prism-player .prism-live-time-display{height:44px;line-height:44px;color:#a4aab3;font-size:12px}.prism-player .prism-live-time-display span{display:inline}.prism-player .prism-live-time-display .live-text{margin-left:5px;font-size:12px;color:#ebecec}.prism-player .prism-live-time-display .current-time{color:#fff}.prism-player .prism-fullscreen-btn:hover{animation:hoverAnimationScale 1s 1;-moz-animation:hoverAnimationScale 1s 1;-webkit-animation:hoverAnimationScale 1s 1;-o-animation:hoverAnimationScale 1s 1}.prism-player .prism-liveshift-progress,.prism-player .prism-progress{bottom:40px!important;width:100%;height:4px;background:rgba(195,197,198,.5);box-shadow:inset 1px 1px 1px 0 rgba(0,0,0,.06);position:relative;cursor:pointer}.prism-player .prism-liveshift-progress .prism-progress-time,.prism-player .prism-progress .prism-progress-time{position:absolute;top:-25px;background:rgba(0,0,0,.8);box-shadow:0 0 5px 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 5px 0 rgba(0,0,0,.1);color:#fff;font-size:14px;border-radius:7.5px;padding:0 6px 0 6px;text-align:center;white-space:nowrap}.prism-player .prism-liveshift-progress .prism-progress-loaded,.prism-player .prism-progress .prism-progress-loaded{position:absolute;top:0;left:0;width:0;height:100%;background:#c3c5c6}.prism-player .prism-liveshift-progress .prism-progress-played,.prism-player .prism-progress .prism-progress-played{position:absolute;top:0;left:0;width:0;height:100%;background-color:#00c1de}.prism-player .prism-liveshift-progress .prism-progress-cursor,.prism-player .prism-progress .prism-progress-cursor{position:absolute;border-radius:8px;top:-5px;width:16px;height:16px;overflow:hidden;box-sizing:initial;background:url("+P+") 50%;display:none}.prism-player .prism-liveshift-progress .prism-progress-cursor img,.prism-player .prism-progress .prism-progress-cursor img{width:14px;height:14px;position:absolute;top:50%;left:50%;-ms-transform:translate(-50%,-50%);-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.prism-player .prism-liveshift-progress .cursor-hover,.prism-player .prism-progress .cursor-hover{border-radius:9px;width:18px;height:18px;top:-5px!important}.prism-player .prism-liveshift-progress .cursor-hover img,.prism-player .prism-progress .cursor-hover img{width:16px;height:16px}.prism-player .prism-liveshift-progress .prism-progress-marker,.prism-player .prism-progress .prism-progress-marker{width:100%;height:100%;position:absolute}.prism-player .prism-liveshift-progress .prism-progress-marker .prism-marker-dot,.prism-player .prism-progress .prism-progress-marker .prism-marker-dot{position:absolute;background:#d9edf7;width:5px;height:100%;border-radius:20%}.prism-player .prism-progress-hover{cursor:pointer;height:6px;transition:height .1s}.prism-player .prism-progress-hover .prism-marker-dot{width:10px;height:80%;top:8%;border-radius:30%}.prism-player .prism-progress-hover .prism-progress-cursor{top:-4px}.prism-player .prism-liveshift-progress{background:0 0}.prism-player .prism-liveshift-progress .prism-enable-liveshift{cursor:pointer;position:absolute;background:#fff;height:4px}.prism-player .prism-liveshift-progress .prism-enable-liveshift:hover{height:6px;transition:height .1s}.prism-player .prism-liveshift-progress .prism-liveshift-seperator{height:15px;position:absolute;right:0;top:-8px;color:#fff;margin-right:5px;margin-left:5px;right:-65px}.prism-player .prism-marker-text{padding:5px;background:rgba(0,0,0,.8);position:absolute;max-width:180px;max-height:100px;bottom:50px;color:#fff;border-radius:3px;z-index:9999;display:none;overflow:auto}.prism-player .prism-marker-text p{text-align:center;word-break:break-all;margin:0;font-size:12px}.prism-player .prism-loading{width:55px;height:55px;z-index:10}.prism-player .prism-loading .circle-androidFirefox{background-color:transparent;border:5px solid;border-color:rgba(0,193,222,.2) rgba(0,193,222,.5) rgba(0,193,222,.7) rgba(0,193,222,.1);opacity:.9;border-radius:50px;width:45px;height:45px;margin:0 auto}.prism-player .prism-loading .circle{background-color:transparent;border:5px solid;border-color:rgba(0,193,222,.2) rgba(0,193,222,.5) rgba(0,193,222,.7) rgba(0,193,222,.1);opacity:.9;border-radius:50px;width:45px;height:45px;margin:0 auto;-moz-animation:spinoffPulse .9s infinite linear;-webkit-animation:spinoffPulse .9s infinite linear}.prism-player .prism-hide{display:none}.prism-player .prism-snapshot-btn{width:32px;height:32px;background:url("+O+") no-repeat;background-size:contain}.prism-player .prism-snapshot-btn:hover{animation:hoverAnimationScale 1s 1;-moz-animation:hoverAnimationScale 1s 1;-webkit-animation:hoverAnimationScale 1s 1;-o-animation:hoverAnimationScale 1s 1;cursor:pointer}.prism-player .prism-snapshot-btn:active{displa:block}.prism-player .prism-info-display{width:100%;color:#fff;font-size:18px;text-align:center;top:50%;position:absolute;z-index:900;height:44px;line-height:28px;font-size:16px;padding:10px 12px 10px 12px}.prism-player .prism-info-display span{color:#00c1de}.prism-player .prism-info-left-bottom{width:auto!important;top:auto!important;bottom:70px;left:20px!important;text-align:left}.prism-player .prism-info-top-center{width:auto!important;top:20px!important;left:50%!important;text-align:left!important;-ms-transform:translateX(-50%)!important;-webkit-transform:translateX(-50%)!important;transform:translateX(-50%)!important;color:red!important}.prism-player .prism-info-black{color:#000!important}.prism-player .prism-auto-stream-selector{position:absolute;bottom:50%;width:100%;margin:auto;color:#efeff4;display:none}.prism-player .prism-auto-stream-selector p.tip-text{text-align:center}.prism-player .prism-auto-stream-selector .operators{width:100px;margin:auto}.prism-player .prism-button-cancel{font-size:16px;border:1px hsla(0,0%,100%,.6588235294117647) solid;padding:2px 5px 2px 5px;color:hsla(0,0%,100%,.6588235294117647);margin-left:5px;background:rgba(80,63,63,.23921568627450981)}.prism-player .prism-button-ok{font-size:16px;border:1px #fff solid;padding:2px 5px 2px 5px;color:#fff;background:rgba(80,63,63,.38823529411764707)}.prism-player .prism-button-cancel:hover,.prism-player .prism-button-ok:hover{color:#f5f5f5}.prism-player .prism-cc-btn{height:24px;width:24px;background:url("+M+") 50% no-repeat;background-size:contain}.prism-player .prism-cc-btn:hover{cursor:pointer;animation:hoverAnimationScale 1s 1;-moz-animation:hoverAnimationScale 1s 1;-webkit-animation:hoverAnimationScale 1s 1;-o-animation:hoverAnimationScale 1s 1}.prism-player .prism-setting-btn{height:24px;width:24px;background:url("+N+') 50% no-repeat;background-size:contain}.prism-player .prism-setting-btn:hover{cursor:pointer;animation:hoverAnimationRotate 1s 1;-moz-animation:hoverAnimationRotate 1s 1;-webkit-animation:hoverAnimationRotate 1s 1;-o-animation:hoverAnimationRotate 1s 1}.prism-player .prism-setting-list{background:rgba(60,60,60,.95);width:220px;position:absolute;right:14px;bottom:45px;display:none;z-index:10000;text-align:left}.prism-player .prism-setting-list .prism-setting-item{font-size:14px;color:#ebecec;height:30px}.prism-player .prism-setting-list .prism-setting-item .setting-content{width:100%}.prism-player .prism-setting-list .prism-setting-item .setting-content:hover{background:hsla(0,0%,84.7%,.1);cursor:pointer}.prism-player .prism-setting-list .prism-setting-item .setting-content span{line-height:30px}.prism-player .prism-setting-list .prism-setting-item .setting-content .setting-title{margin-left:15px}.prism-player .prism-setting-list .prism-setting-item .setting-content .current-setting{float:right;max-width:120px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.prism-player .prism-setting-list .prism-setting-item .array{display:inline-block;border-right:2px solid;border-bottom:2px solid;border-color:#fff;width:8px;height:8px;-ms-transform:rotate(-45deg);-webkit-transform:rotate(-45deg);transform:rotate(-45deg);margin-right:10px;margin-top:10px;margin-left:10px;float:right}.prism-player .prism-setting-selector{right:40px;position:absolute;bottom:45px;width:150px;background:rgba(60,60,60,.95);font-size:14px;color:#ebecec;display:none;z-index:10000;text-align:left}.prism-player .prism-setting-selector .header{background:#242424;width:150px;height:30px}.prism-player .prism-setting-selector .header:hover{cursor:pointer}.prism-player .prism-setting-selector .header .left-array{display:inline-block;border-left:2px solid;border-bottom:2px solid;border-color:#fff;width:8px;height:8px;-ms-transform:rotate(45deg);-webkit-transform:rotate(45deg);transform:rotate(45deg);margin-right:6px;margin-top:12px;margin-left:16px;float:left}.prism-player .prism-setting-selector .header span{line-height:30px}.prism-player .prism-setting-selector ul.selector-list::-webkit-scrollbar{width:10px;background-color:#424242}.prism-player .prism-setting-selector ul.selector-list::-webkit-scrollbar-track{background-color:#424242}.prism-player .prism-setting-selector ul.selector-list::-webkit-scrollbar-thumb{background-color:#8e8e8e;border:1px solid #424242;border-radius:5px}.prism-player .prism-setting-selector ul{list-style-type:none;padding-left:0;max-height:150px;overflow-y:auto;padding-left:13px;margin-top:5px}.prism-player .prism-setting-selector ul li{height:28px;padding-left:10px}.prism-player .prism-setting-selector ul li.current{color:#30adf2;padding-left:0}.prism-player .prism-setting-selector ul li.current:before{content:"";display:inline-block;line-height:0;border:5px solid transparent;border-left-color:#30adf2;border-right-width:0;margin-top:5px;padding-right:5px}.prism-player .prism-setting-selector ul li:hover{background:hsla(0,0%,84.7%,.1);cursor:pointer}.prism-player .prism-setting-selector ul span{line-height:28px;max-width:110px;display:inline-block;vertical-align:middle;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.prism-player .prism-thumbnail{border:1px solid rgba(0,0,0,.8);width:174px;height:98px;position:absolute;bottom:50px;display:none;z-index:10}.prism-player .prism-thumbnail .none{border:none}.prism-player .prism-thumbnail span{font-size:12px;color:#fff;line-height:20px;background:rgba(0,0,0,.8);text-align:center;text-shadow:1px 1px 4px #373d41;padding-left:5px;padding-right:5px;display:inline-block;position:absolute;bottom:0;left:33%}.prism-player .prism-tooltip{background:#3c3c3c;box-shadow:0 0 5px 0 rgba(0,0,0,.1);height:28px;margin:0;padding-left:5px;padding-right:5px;padding-top:0;padding-bottom:0;position:absolute;bottom:50px;color:#fff;line-height:28px;font-size:10px;white-space:nowrap;display:none;z-index:10}.prism-player .disabled{pointer-events:none;color:grey}:-webkit-full-screen{width:100%!important;height:100%!important}:-moz-full-screen{width:100%!important;height:100%!important}:-ms-full-screen{width:100%!important;height:100%!important}:-ms-fullscreen{width:100%!important;height:100%!important}:-webkit-full-screen{width:100%!important;height:100%!important}:fullscreen{width:100%!important;height:100%!important}body.prism-full-window{padding:0;margin:0;height:100%;overflow-y:auto}.prism-fullscreen{position:fixed;overflow:hidden;z-index:99999;left:0!important;top:0!important;bottom:0!important;right:0!important;width:100%!important;height:100%!important;position:absolute!important}.prism-button{cursor:pointer;text-align:center;text-shadow:0 1px 1px rgba(0,0,0,.3);border-radius:.5em;box-shadow:0 1px 2px rgba(0,0,0,.2)}.prism-button-orange{color:#a56117;border:solid 1px #a56117}.prism-button-retry{color:#f2dede;border:solid 1px #f2dede}.prism-button-orange:hover{color:#d67400;border-color:#d67400}.prism-button-orange:active{color:#d67400;border-color:#d67400}.prism-button-orange:visited{color:#d67400}.prism-button-retry:hover{color:#fcf8e3;border-color:#fcf8e3}.prism-button-retry:active{color:#fcf8e3;border-color:#fcf8e3}.prism-button-retry:visited{color:#fcf8e3}.prism-center{position:absolute;left:50%;-ms-transform:translateX(-50%);-webkit-transform:translateX(-50%);transform:translateX(-50%)}.prism-width90{width:90%}.prism-stream-selector{font-size:16px;position:relative;line-height:32px}.prism-stream-selector .current-stream-selector{text-align:center;width:70px;display:none;color:#efeff4}.prism-stream-selector .current-stream-selector:hover{cursor:pointer;color:#00c1de}.prism-stream-selector .stream-selector-tip{color:#fff;text-align:center;padding:2px 5px 2px 5px;display:none;position:absolute;bottom:61.5px;white-space:nowrap;left:43%;font-size:18px}.prism-stream-selector .stream-selector-list{position:absolute;bottom:32px;background:rgba(0,0,0,.5);color:#efeff4;padding:5px 5px 0 5px;width:70px;margin:0;display:none}.prism-stream-selector .stream-selector-list li{list-style-type:none;text-align:center;white-space:nowrap;padding:0 2px 0 2px;line-height:24px}.prism-stream-selector .stream-selector-list li:last-child{margin-bottom:10px}.prism-stream-selector .stream-selector-list li.current{color:#00c1de}.prism-stream-selector .stream-selector-list li span.current{color:#00c1de}.prism-stream-selector .stream-selector-list li:hover{cursor:pointer;color:#00c1de}.prism-speed-selector{font-size:16px;position:relative;line-height:32px}.prism-speed-selector .current-speed-selector{color:#efeff4;text-align:center;width:60px}.prism-speed-selector .current-speed-selector:hover{cursor:pointer;color:#00c1de}.prism-speed-selector .speed-selector-list{position:absolute;bottom:32px;background:rgba(0,0,0,.5);color:#efeff4;padding:5px 5px 0 5px;display:none;margin:0}.prism-speed-selector .speed-selector-list li{list-style-type:none;text-align:center;white-space:nowrap;padding:0 2px 0 2px;line-height:24px}.prism-speed-selector .speed-selector-list li:last-child{margin-bottom:10px}.prism-speed-selector .speed-selector-list li.current{color:#00c1de}.prism-speed-selector .speed-selector-list li span.current{color:#00c1de}.prism-speed-selector .speed-selector-list li:hover{cursor:pointer;color:#00c1de}.prism-ai-container{position:absolute;overflow:hidden}.prism-ai-container .prism-ai-marking{font-size:12px;position:absolute}.prism-ai-container .prism-ai-marking[vh=large]{font-size:18px}.prism-ai-container .prism-ai-marking[vh=middle]{font-size:16px}.prism-ai-container .prism-ai-marking .prism-ai-rect-region{position:relative;display:inline-block}.prism-ai-container .prism-ai-marking .prism-ai-rect-region .prism-ai-title{height:0;-ms-transform:translateY(-40px);-webkit-transform:translateY(-40px);transform:translateY(-40px)}.prism-ai-container .prism-ai-marking .prism-ai-rect-region .prism-ai-title p{background:#ff1d00;text-align:center;width:100%;color:#fff;word-break:keep-all;margin:10px 0 0 0}.prism-ai-container .prism-ai-marking .prism-ai-rect-region .prism-ai-title .top-left-anchor{width:5px;height:5px;border-top-color:red;border-top-style:solid;border-left-color:red;border-left-style:solid;border-width:1px;-ms-transform:translate(-5px,10px);-webkit-transform:translate(-5px,10px);transform:translate(-5px,10px)}.prism-ai-container .prism-ai-marking .prism-ai-rect-region .prism-ai-title .top-right-anchor{width:5px;height:5px;border-top-color:red;border-top-style:solid;border-right-color:red;border-right-style:solid;border-width:1px;-ms-transform:translate(5px,5px);-webkit-transform:translate(5px,5px);transform:translate(5px,5px);float:right}.prism-ai-container .prism-ai-marking .prism-ai-rect-region .prism-ai-rect{border-style:solid;border-color:#ff1d00;border-width:1px;box-sizing:initial;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;color:rgba(255,29,0,.3);background:rgba(255,29,0,.1)}.prism-ai-container .prism-ai-marking .prism-ai-rect-region .prism-ai-rect .prism-ai-slash-container{overflow:hidden;width:100%;height:100%;position:absolute}.prism-ai-container .prism-ai-marking .prism-ai-rect-region .prism-ai-rect .prism-ai-slash{content:"";display:block;box-sizing:border-box;border-top-width:1px;border-top-style:solid;height:10px;margin-top:15px;border-bottom-width:1px;border-bottom-style:solid;-webkit-transform:rotate(-45deg) scaleX(2);transform:rotate(-45deg) scaleX(2);-ms-transform-origin:bottom center;-webkit-transform-origin:bottom center;transform-origin:bottom center}.prism-ai-container .prism-ai-marking .prism-ai-rect-region .prism-ai-rect .prism-ai-top-slash{margin-top:-10px!important}.prism-ai-container .prism-ai-marking .prism-ai-rect-region .anchor-plug{position:absolute}.prism-ai-container .prism-ai-marking .prism-ai-rect-region .top-left{top:-7px;left:-2px}.prism-ai-container .prism-ai-marking .prism-ai-rect-region .top-right{top:-7px;right:-2px}.prism-ai-container .prism-ai-marking .prism-ai-rect-region .bottom-left{bottom:-8px;left:-2px}.prism-ai-container .prism-ai-marking .prism-ai-rect-region .bottom-right{bottom:-8px;right:-2px}.prism-ai-container .prism-ai-marking .prism-ai-labels{color:#fff;float:right;background:rgba(0,0,0,.4);padding-top:5px;padding-bottom:5px}.prism-ai-container .prism-ai-marking .prism-ai-labels p{text-align:left;padding-left:5px;padding-right:5px;margin:0}.prism-ai-container .prism-ai-marking .prism-ai-labels a{padding-left:5px;padding-right:5px}.prism-ai-container .prism-ai-marking .prism-ai-labels p[vh=large]{padding-left:25px;padding-right:25px}.prism-ai-container .prism-ai-marking .prism-ai-labels p[vh=middle]{padding-left:15px;padding-right:15px}uni-video::-webkit-media-text-track-container{overflow:visible!important}uni-video::cue{line-height:1.7}.loading-center{position:absolute;top:50%;left:50%;-ms-transform:translate(-50%,-50%);-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}',""]),e.exports=t},"7e84":function(e,t,r){"use strict";function i(e){return t.default=i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},i(e)}r("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=i,r("131a"),r("3410")},"82de":function(module,exports,__webpack_require__){(function(global){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,require,require,_typeof=__webpack_require__("7037").default;__webpack_require__("d9e2"),__webpack_require__("d401"),__webpack_require__("6c57"),__webpack_require__("d3b7"),__webpack_require__("25f0"),__webpack_require__("fb6a"),__webpack_require__("14d9"),__webpack_require__("ace4"),__webpack_require__("fb2c"),__webpack_require__("907a"),__webpack_require__("9a8c"),__webpack_require__("a975"),__webpack_require__("735e"),__webpack_require__("c1ac"),__webpack_require__("d139"),__webpack_require__("3a7b"),__webpack_require__("986a"),__webpack_require__("1d02"),__webpack_require__("d5d6"),__webpack_require__("82f8"),__webpack_require__("e91f"),__webpack_require__("60bd"),__webpack_require__("5f96"),__webpack_require__("3280"),__webpack_require__("3fcc"),__webpack_require__("ca91"),__webpack_require__("25a1"),__webpack_require__("cd26"),__webpack_require__("3c5d"),__webpack_require__("2954"),__webpack_require__("649e"),__webpack_require__("219c"),__webpack_require__("b39a"),__webpack_require__("72f7"),__webpack_require__("e25e"),__webpack_require__("99af"),__webpack_require__("a434"),__webpack_require__("c975"),__webpack_require__("8a59"),__webpack_require__("ac1f"),__webpack_require__("5319"),__webpack_require__("5cc6"),__webpack_require__("7a82"),__webpack_require__("4d63"),__webpack_require__("c607"),__webpack_require__("2c3e"),__webpack_require__("00b4"),__webpack_require__("a9e3"),__webpack_require__("159b"),__webpack_require__("e9c4"),__webpack_require__("c19f"),__webpack_require__("84c3"),__webpack_require__("498a"),__webpack_require__("caad"),__webpack_require__("2532"),__webpack_require__("466d"),__webpack_require__("a4d3"),__webpack_require__("e01a"),__webpack_require__("d28b"),__webpack_require__("3ca3"),__webpack_require__("ddb0"),__webpack_require__("4de4"),__webpack_require__("d81d"),__webpack_require__("3410"),__webpack_require__("131a"),__webpack_require__("26e9"),__webpack_require__("2b3d"),__webpack_require__("9861"),__webpack_require__("baa5"),__webpack_require__("aff5"),__webpack_require__("acd8"),__webpack_require__("1276"),__webpack_require__("3c65"),__webpack_require__("13d5"),__webpack_require__("b64b"),__webpack_require__("81b2"),__webpack_require__("0eb6"),__webpack_require__("b7ef"),__webpack_require__("8bd4"),__webpack_require__("f4b3"),__webpack_require__("bf19"),__webpack_require__("944a"),__webpack_require__("0c47"),__webpack_require__("23dc"),__webpack_require__("8b09"),__webpack_require__("a630"),__webpack_require__("7db0"),__webpack_require__("4057"),__webpack_require__("4e82"),function(e){"object"==_typeof(exports)&&"undefined"!=typeof module?module.exports=e():(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_FACTORY__=e,__WEBPACK_AMD_DEFINE_RESULT__="function"===typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}((function(){var define,module,exports;return function e(t,r,i){function n(o,s){if(!r[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return require(o,!0);if(a)return a(o,!0);throw(s=new Error("Cannot find module '"+o+"'")).code="MODULE_NOT_FOUND",s}l=r[o]={exports:{}},t[o][0].call(l.exports,(function(e){return n(t[o][1][e]||e)}),l,l.exports,e,t,r,i)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<i.length;o++)n(i[o]);return n}({1:[function(e,t,r){},{}],2:[function(e,t,r){(function(i){(function(){var n;n=function(){var t,r=Math;if("undefined"!=typeof window&&window.crypto&&(t=window.crypto),"undefined"!=typeof self&&self.crypto&&(t=self.crypto),!(t=!(t=!(t="undefined"!=typeof globalThis&&globalThis.crypto?globalThis.crypto:t)&&"undefined"!=typeof window&&window.msCrypto?window.msCrypto:t)&&void 0!==i&&i.crypto?i.crypto:t)&&"function"==typeof e)try{t=e("crypto")}catch(o){}var n=Object.create||function(e){return a.prototype=e,e=new a,a.prototype=null,e};function a(){}var o={},s=o.lib={},l=s.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},u=s.WordArray=l.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||d).stringify(this)},concat:function(e){var t=this.words,r=e.words,i=this.sigBytes,n=e.sigBytes;if(this.clamp(),i%4)for(var a=0;a<n;a++){var o=r[a>>>2]>>>24-a%4*8&255;t[i+a>>>2]|=o<<24-(i+a)%4*8}else for(var s=0;s<n;s+=4)t[i+s>>>2]=r[s>>>2];return this.sigBytes+=n,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=r.ceil(t/4)},clone:function(){var e=l.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var r=[],i=0;i<e;i+=4)r.push(function(){if(t){if("function"==typeof t.getRandomValues)try{return t.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof t.randomBytes)try{return t.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")}());return new u.init(r,e)}}),c=o.enc={},d=c.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n++){var a=t[n>>>2]>>>24-n%4*8&255;i.push((a>>>4).toString(16)),i.push((15&a).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i+=2)r[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new u.init(r,t/2)}},h=c.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n++){var a=t[n>>>2]>>>24-n%4*8&255;i.push(String.fromCharCode(a))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i++)r[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new u.init(r,t)}},f=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(h.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return h.parse(unescape(encodeURIComponent(e)))}},p=s.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t,i=this._data,n=i.words,a=i.sigBytes,o=this.blockSize,s=a/(4*o),l=(s=e?r.ceil(s):r.max((0|s)-this._minBufferSize,0))*o;e=r.min(4*l,a);if(l){for(var c=0;c<l;c+=o)this._doProcessBlock(n,c);t=n.splice(0,l),i.sigBytes-=e}return new u.init(t,e)},clone:function(){var e=l.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),g=(s.Hasher=p.extend({cfg:l.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new g.HMAC.init(e,r).finalize(t)}}}),o.algo={});return o},"object"==_typeof(r)?t.exports=r=n():"function"==typeof define&&define.amd?define([],n):this.CryptoJS=n()}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{crypto:1}],3:[function(e,t,r){var i;i=function(e){var t;return t=e.lib.WordArray,e.enc.Base64={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=this._map,n=(e.clamp(),[]),a=0;a<r;a+=3)for(var o=(t[a>>>2]>>>24-a%4*8&255)<<16|(t[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|t[a+2>>>2]>>>24-(a+2)%4*8&255,s=0;s<4&&a+.75*s<r;s++)n.push(i.charAt(o>>>6*(3-s)&63));var l=i.charAt(64);if(l)for(;n.length%4;)n.push(l);return n.join("")},parse:function(e){var r=e.length,i=this._map;if(!(n=this._reverseMap))for(var n=this._reverseMap=[],a=0;a<i.length;a++)n[i.charCodeAt(a)]=a;for(var o,s,l=i.charAt(64),u=(l&&-1!==(l=e.indexOf(l))&&(r=l),e),c=r,d=n,h=[],f=0,p=0;p<c;p++)p%4&&(o=d[u.charCodeAt(p-1)]<<p%4*2,s=d[u.charCodeAt(p)]>>>6-p%4*2,h[f>>>2]|=(o|s)<<24-f%4*8,f++);return t.create(h,f)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},e.enc.Base64},"object"==_typeof(r)?t.exports=r=i(e("crypto-js/core")):"function"==typeof define&&define.amd?define(["crypto-js/core"],i):i(this.CryptoJS)},{"crypto-js/core":2}],4:[function(e,t,r){var i;i=function(e){return e.enc.Utf8},"object"==_typeof(r)?t.exports=r=i(e("crypto-js/core")):"function"==typeof define&&define.amd?define(["crypto-js/core"],i):i(this.CryptoJS)},{"crypto-js/core":2}],5:[function(e,t,r){var i;i=function(e){return e.HmacSHA1},"object"==_typeof(r)?t.exports=r=i(e("crypto-js/core"),e("crypto-js/sha1"),e("crypto-js/hmac")):"function"==typeof define&&define.amd?define(["crypto-js/core","crypto-js/sha1","crypto-js/hmac"],i):i(this.CryptoJS)},{"crypto-js/core":2,"crypto-js/hmac":6,"crypto-js/sha1":7}],6:[function(e,t,r){var i;i=function(e){var t,r;t=e.lib.Base,r=e.enc.Utf8,e.algo.HMAC=t.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=r.parse(t));for(var i=e.blockSize,n=4*i,a=(e=((t=t.sigBytes>n?e.finalize(t):t).clamp(),this._oKey=t.clone()),t=this._iKey=t.clone(),e.words),o=t.words,s=0;s<i;s++)a[s]^=1549556828,o[s]^=909522486;e.sigBytes=t.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;e=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(e))}})},"object"==_typeof(r)?t.exports=r=i(e("crypto-js/core")):"function"==typeof define&&define.amd?define(["crypto-js/core"],i):i(this.CryptoJS)},{"crypto-js/core":2}],7:[function(e,t,r){var i;i=function(e){var t,r,i,n,a;return r=(t=e).lib,i=r.WordArray,n=r.Hasher,r=t.algo,a=[],r=r.SHA1=n.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,i=r[0],n=r[1],o=r[2],s=r[3],l=r[4],u=0;u<80;u++){a[u]=u<16?0|e[t+u]:(c=a[u-3]^a[u-8]^a[u-14]^a[u-16])<<1|c>>>31;var c=(i<<5|i>>>27)+l+a[u];c+=u<20?1518500249+(n&o|~n&s):u<40?1859775393+(n^o^s):u<60?(n&o|n&s|o&s)-1894007588:(n^o^s)-899497514,l=s,s=o,o=n<<30|n>>>2,n=i,i=c}r[0]=r[0]+i|0,r[1]=r[1]+n|0,r[2]=r[2]+o|0,r[3]=r[3]+s|0,r[4]=r[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[14+(64+i>>>9<<4)]=Math.floor(r/4294967296),t[15+(64+i>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}}),t.SHA1=n._createHelper(r),t.HmacSHA1=n._createHmacHelper(r),e.SHA1},"object"==_typeof(r)?t.exports=r=i(e("crypto-js/core")):"function"==typeof define&&define.amd?define(["crypto-js/core"],i):i(this.CryptoJS)},{"crypto-js/core":2}],8:[function(e,t,r){(function(i,n){(function(){var a;a=function(){"use strict";function t(e){return"function"==typeof e}var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=0,o=void 0,s=void 0,l=function(e,t){p[a]=e,p[a+1]=t,2===(a+=2)&&(s?s(g):_())},u="undefined"!=typeof window?window:void 0,c=u||{},d=(c=c.MutationObserver||c.WebKitMutationObserver,"undefined"==typeof self&&void 0!==i&&"[object process]"==={}.toString.call(i)),h="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function f(){var e=setTimeout;return function(){return e(g,1)}}var p=new Array(1e3);function g(){for(var e=0;e<a;e+=2)(0,p[e])(p[e+1]),p[e]=void 0,p[e+1]=void 0;a=0}var v,y,m,_=void 0;function b(e,t){var r,i=this,n=new this.constructor(E),a=(void 0===n[S]&&O(n),i._state);return a?(r=arguments[a-1],l((function(){return D(a,n,r,i._result)}))):I(i,n,e,t),n}function T(e){var t;return e&&"object"==_typeof(e)&&e.constructor===this?e:(w(t=new this(E),e),t)}_=d?function(){return i.nextTick(g)}:c?(y=0,d=new c(g),m=document.createTextNode(""),d.observe(m,{characterData:!0}),function(){m.data=y=++y%2}):h?((v=new MessageChannel).port1.onmessage=g,function(){return v.port2.postMessage(0)}):(void 0===u&&"function"==typeof e?function(){try{var e=Function("return this")().require("vertx");return void 0!==(o=e.runOnLoop||e.runOnContext)?function(){o(g)}:f()}catch(e){return f()}}:f)();var S=Math.random().toString(36).substring(2);function E(){}var k=void 0;function A(e,r,i){var n,a;r.constructor===e.constructor&&i===b&&r.constructor.resolve===T?(n=e,1===(a=r)._state?R(n,a._result):2===a._state?L(n,a._result):I(a,void 0,(function(e){return w(n,e)}),(function(e){return L(n,e)}))):void 0!==i&&t(i)?function(e,t,r){l((function(e){var i=!1,n=function(e,t,r,i){try{e.call(t,r,i)}catch(e){return e}}(r,t,(function(r){i||(i=!0,(t!==r?w:R)(e,r))}),(function(t){i||(i=!0,L(e,t))}),e._label);!i&&n&&(i=!0,L(e,n))}),e)}(e,r,i):R(e,r)}function w(e,t){if(e===t)L(e,new TypeError("You cannot resolve a promise with itself"));else if(r=_typeof(t),null===t||"object"!=r&&"function"!=r)R(e,t);else{r=void 0;try{r=t.then}catch(t){return void L(e,t)}A(e,t,r)}var r}function x(e){e._onerror&&e._onerror(e._result),C(e)}function R(e,t){e._state===k&&(e._result=t,e._state=1,0!==e._subscribers.length)&&l(C,e)}function L(e,t){e._state===k&&(e._state=2,e._result=t,l(x,e))}function I(e,t,r,i){var n=e._subscribers,a=n.length;e._onerror=null,n[a]=t,n[a+1]=r,n[a+2]=i,0===a&&e._state&&l(C,e)}function C(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var i,n=void 0,a=e._result,o=0;o<t.length;o+=3)i=t[o],n=t[o+r],i?D(r,i,n,a):n(a);e._subscribers.length=0}}function D(e,r,i,n){var a=t(i),o=void 0,s=void 0,l=!0;if(a){try{o=i(n)}catch(e){l=!1,s=e}if(r===o)return void L(r,new TypeError("A promises callback cannot return that same promise."))}else o=n;r._state===k&&(a&&l?w(r,o):!1===l?L(r,s):1===e?R(r,o):2===e&&L(r,o))}var P=0;function O(e){e[S]=P++,e._state=void 0,e._result=void 0,e._subscribers=[]}N.prototype._enumerate=function(e){for(var t=0;this._state===k&&t<e.length;t++)this._eachEntry(e[t],t)},N.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,i=r.resolve;if(i===T){var n,a=void 0,o=void 0,s=!1;try{a=e.then}catch(t){s=!0,o=t}a===b&&e._state!==k?this._settledAt(e._state,t,e._result):"function"!=typeof a?(this._remaining--,this._result[t]=e):r===F?(n=new r(E),s?L(n,o):A(n,e,a),this._willSettleAt(n,t)):this._willSettleAt(new r((function(t){return t(e)})),t)}else this._willSettleAt(i(e),t)},N.prototype._settledAt=function(e,t,r){var i=this.promise;i._state===k&&(this._remaining--,2===e?L(i,r):this._result[t]=r),0===this._remaining&&R(i,this._result)},N.prototype._willSettleAt=function(e,t){var r=this;I(e,void 0,(function(e){return r._settledAt(1,t,e)}),(function(e){return r._settledAt(2,t,e)}))};var M=N;function N(e,t){this._instanceConstructor=e,this.promise=new e(E),this.promise[S]||O(this.promise),r(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0!==this.length&&(this.length=this.length||0,this._enumerate(t),0!==this._remaining)||R(this.promise,this._result)):L(this.promise,new Error("Array Methods must be provided an Array"))}U.prototype.catch=function(e){return this.then(null,e)},U.prototype.finally=function(e){var r=this.constructor;return t(e)?this.then((function(t){return r.resolve(e()).then((function(){return t}))}),(function(t){return r.resolve(e()).then((function(){throw t}))})):this.then(e,e)};var F=U;function U(e){if(this[S]=P++,this._result=this._state=void 0,this._subscribers=[],E!==e){if("function"!=typeof e)throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof U))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");var t=this;try{e((function(e){w(t,e)}),(function(e){L(t,e)}))}catch(e){L(t,e)}}}return F.prototype.then=b,F.all=function(e){return new M(this,e).promise},F.race=function(e){var t=this;return r(e)?new t((function(r,i){for(var n=e.length,a=0;a<n;a++)t.resolve(e[a]).then(r,i)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},F.resolve=T,F.reject=function(e){var t=new this(E);return L(t,e),t},F._setScheduler=function(e){s=e},F._setAsap=function(e){l=e},F._asap=l,F.polyfill=function(){var e=void 0;if(void 0!==n)e=n;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=F},F.Promise=F},"object"==_typeof(r)&&void 0!==t?t.exports=a():"function"==typeof define&&define.amd?define(a):this.ES6Promise=a()}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:9}],9:[function(e,t,r){var i,n;t=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}try{i="function"==typeof setTimeout?setTimeout:a}catch(e){i=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}function s(t){if(i===setTimeout)return setTimeout(t,0);if((i===a||!i)&&setTimeout)return(i=setTimeout)(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}var l,u=[],c=!1,d=-1;function h(){c&&l&&(c=!1,l.length?u=l.concat(u):d=-1,u.length)&&f()}function f(){if(!c){for(var e=s(h),t=(c=!0,u.length);t;){for(l=u,u=[];++d<t;)l&&l[d].run();d=-1,t=u.length}l=null,c=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===o||!n)&&clearTimeout)return(n=clearTimeout)(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}t.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||c||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={},t.on=g,t.addListener=g,t.once=g,t.off=g,t.removeListener=g,t.removeAllListeners=g,t.emit=g,t.prependListener=g,t.prependOnceListener=g,t.listeners=function(e){return[]},t.binding=function(e){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(e){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}},{}],10:[function(e,t,r){t.exports={name:"aliyun-aliplayer",version:"2.15.6",description:"aliyun h5 player",main:"./dist/aliplayer-min",files:["dist"],repository:{type:"git",url:""},keywords:["clam","prismplayer"],scripts:{start:"npx grunt live",build:"npx grunt build","publish-beta":'node ./update-beta-version.js && npm run build && git add . && git commit -m "feat: build assets for daily" && def p -d'},devDependencies:{"@babel/core":"^7.15.0","@babel/preset-env":"^7.15.0","babel-loader":"^8.2.2","babel-plugin-es6-promise":"^1.1.1",babelify:"^10.0.0",grunt:"^1.0.4","grunt-autoprefixer":"^3.0.4","grunt-babel":"^8.0.0","grunt-browserify":"^5.3.0","grunt-contrib-clean":"^2.0.0","grunt-contrib-connect":"^3.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-cssmin":"^3.0.0","grunt-contrib-less":"^2.0.0","grunt-contrib-uglify":"^4.0.1","grunt-contrib-watch":"^1.1.0","grunt-run":"^0.8.1","grunt-text-replace":"^0.4.0"},dependencies:{"crypto-js":"^4.1.1"}}},{}],11:[function(e,t,r){var i=e("../ui/component"),n=(e("../lib/util"),e("../lib/dom")),a=e("../lib/event"),o=(e("../lib/ua"),e("../lang/index")),s=e("../player/base/event/eventtype");e=i.extend({init:function(e,t){i.call(this,e,t),this.className=t.className||"prism-auto-stream-selector",this.addClass(this.className)},createEl:function(){var e=i.prototype.createEl.call(this,"div");return e.innerHTML="<div><p class='tip-text'></p></div><div class='operators'><a class='prism-button prism-button-ok' type='button'>"+o.get("OK_Text")+"</a><a class='prism-button prism-button-cancel'  target='_blank'>"+o.get("Cancel_Text")+"</a></div>",e},bindEvent:function(){var e=this,t=(e._player.on(s.Private.AutoStreamShow,(function(t){var r,i=document.querySelector("#"+e.getId()+" .tip-text");e._player._getLowerQualityLevel&&(r=e._player._getLowerQualityLevel())&&(e._switchUrl=r,i.innerText=o.get("Auto_Stream_Tip_Text").replace("$$",r.item.desc),n.css(e.el(),"display","block"))})),e._player.on(s.Private.AutoStreamHide,(function(t){document.querySelector("#"+e.getId()+" .tip-text"),n.css(e.el(),"display","none")})),document.querySelector("#"+e.getId()+" .prism-button-ok"));a.on(t,"click",(function(){e._player._changeStream&&e._switchUrl&&(e._player._changeStream(e._switchUrl.index,o.get("Quality_Change_Text")),e._player.trigger(s.Private.SettingListHide)),n.css(e.el(),"display","none")})),t=document.querySelector("#"+e.getId()+" .prism-button-cancel");a.on(t,"click",(function(){n.css(e.el(),"display","none"),e._player.trigger(s.Private.SettingListHide)}))}});t.exports=e},{"../lang/index":23,"../lib/dom":32,"../lib/event":33,"../lib/ua":49,"../lib/util":51,"../player/base/event/eventtype":70,"../ui/component":130}],12:[function(e,t,r){var i=e("../ui/component"),n=e("../lib/dom"),a=e("../lib/event"),o=e("../lib/ua"),s=e("../lib/function"),l=(e("../lang/index"),e("../lib/util")),u=e("../config"),c=e("../lib/playerutil"),d=e("../player/base/event/eventtype");e=i.extend({init:function(e,t){i.call(this,e,t),this.className=t.className||"prism-liveshift-progress",this.addClass(this.className),this._liveshiftService=e._liveshiftService},createEl:function(){var e=i.prototype.createEl.call(this);return e.innerHTML='<div class="prism-enable-liveshift"><div class="prism-progress-loaded"></div><div class="prism-progress-played"></div><div class="prism-progress-cursor"><img></img></div><p class="prism-progress-time"></p><div class="prism-liveshift-seperator"></div></div><div class="prism-disable-liveshift"></div>',e},bindEvent:function(){function e(e){t._progressDown=e}var t=this,r=(this.loadedNode=document.querySelector("#"+this.id()+" .prism-progress-loaded"),this.playedNode=document.querySelector("#"+this.id()+" .prism-progress-played"),this.cursorNode=document.querySelector("#"+this.id()+" .prism-progress-cursor"),this.timeNode=document.querySelector("#"+this.id()+" .prism-progress-time"),this.controlNode=document.querySelector("#"+this._player._options.id+" .prism-controlbar"),this.seperatorNode=document.querySelector("#"+this.id()+" .prism-liveshift-seperator"),this.progressNode=document.querySelector("#"+this.id()+" .prism-enable-liveshift"),document.querySelector("#"+this.id()+" .prism-progress-cursor img")),i="//"+u.domain+"/de/prismplayer/"+u.h5Version+"/skins/default/img/dragcursor.png";this._player._options.skinsDomain?i=this._player._options.skinsDomain+"/skins/default/img/dragcursor.png":u.domain?-1<u.domain.indexOf("localhost")&&(i="//"+u.domain+"/build/skins/default/img/dragcursor.png"):i=this._player&&this._player._options&&this._player._options.sdkDomain?this._player._options.sdkDomain+"/de/prismplayer/"+u.h5Version+"/skins/default/img/dragcursor.png":"de/prismplayer/"+u.h5Version+"/skins/default/img/dragcursor.png",r.src=i,a.on(this.cursorNode,"mousedown",(function(e){t._onMouseDown(e)})),a.on(this.cursorNode,"touchstart",(function(e){t._onMouseDown(e)})),a.on(this.progressNode,"mousemove",(function(e){t._progressMove(e)})),a.on(this.progressNode,"touchmove",(function(e){t._progressMove(e)})),a.on(this.progressNode,"mousedown",(function(t){e(!0)})),a.on(this.progressNode,"touchstart",(function(t){e(!0)})),a.on(this.progressNode,"mouseup",(function(t){e(!1)})),a.on(this.progressNode,"touchend",(function(t){e(!1)})),a.on(this._el,"click",(function(e){t._onMouseClick(e)})),this._player.on(d.Private.HideProgress,(function(e){t._hideProgress(e)})),this._player.on(d.Private.CancelHideProgress,(function(e){t._cancelHideProgress(e)})),this._player.on(d.Private.ShowBar,(function(){t._updateLayout()})),a.on(this.progressNode,d.Private.MouseOver,(function(e){t._onMouseOver(e)})),a.on(this.progressNode,d.Private.MouseOut,(function(e){t._onMouseOut(e)})),this.bindTimeupdate=s.bind(this,this._onTimeupdate),this._player.on(d.Player.TimeUpdate,this.bindTimeupdate),c.isLiveShift(this._player._options)&&t._liveshiftService.start(6e4,(function(e){e={mediaId:t._player._options.vid||"",error_code:e.Code,error_msg:e.Message},t._player.logError(e),t._player.trigger(d.Player.Error,e)})),this._player.on(d.Private.LiveShiftQueryCompleted,(function(){t._updateSeperator(),t._updateLayout()})),this._player.on(d.Private.LiveShiftSwitchToLive,(function(){t._updateCursorPosition()})),this._player.on(d.Player.Pause,(function(){t._liveshiftService.stop()})),o.IS_IPAD?this.interval=setInterval((function(){t._onProgress()}),500):this._player.on(d.Video.Progress,(function(){t._onProgress()}))},_updateSeperator:function(){this._liveshiftService.currentTimeDisplay&&(this.seperatorNode.innerText=this._liveshiftService.currentTimeDisplay)},_updateLayout:function(){var e=this.seperatorNode.offsetWidth,t=this.el().offsetWidth,r=t-e;0!=e&&0!=r&&(n.css(this.progressNode,"width",100*(r-10)/t+"%"),n.css(this.seperatorNode,"right",-1*(e+10)+"px"))},_progressMove:function(e){var t=this._getSeconds(e),r=this._liveshiftService.availableLiveShiftTime,i=(t=(this.timeNode.innerText="-"+l.formatTime(r-t),r?t/r:0),r=1-this.timeNode.clientWidth/this.el().clientWidth,r<t&&(t=r),this.timeNode&&(n.css(this.timeNode,"display","block"),n.css(this.timeNode,"left",100*t+"%")),this);!o.IS_PC&&i._progressDown&&(i.progressSeekTimer&&clearTimeout(i.progressSeekTimer),i.progressSeekTimer=setTimeout((function(){i._progressDown||i._onMouseClick(e)}),200))},_hideProgress:function(e){a.off(this.cursorNode,"mousedown"),a.off(this.cursorNode,"touchstart")},_cancelHideProgress:function(e){var t=this;a.on(this.cursorNode,"mousedown",(function(e){t._onMouseDown(e)})),a.on(this.cursorNode,"touchstart",(function(e){t._onMouseDown(e)}))},_canSeekable:function(e){var t=!0;return"function"==typeof this._player.canSeekable?this._player.canSeekable(e):t},_onMouseOver:function(e){this._updateCursorPosition(this._getCurrentTime()),n.css(this.timeNode,"display","block")},_onMouseOut:function(e){n.css(this.timeNode,"display","none")},_getSeconds:function(e){for(var t=this.el().offsetLeft,r=this.el();r=r.offsetParent;){var i=n.getTranslateX(r);t+=r.offsetLeft+i}e=(e.touches&&e.touches.length?e.touches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e).pageX;var a=this.progressNode.offsetWidth,o=this._liveshiftService.availableLiveShiftTime;return sec=(sec=(sec=o?(e-t)/a*o:0)<0?0:sec)>o?o:sec},_onMouseClick:function(e){var t=this,r=(e=this._getSeconds(e),this._liveshiftService.availableLiveShiftTime),i=r-e,n=this._player._options;i<=n.liveShiftMinOffset&&(e=r-(i=n.liveShiftMinOffset)),this._player.trigger(d.Private.SeekStart,{fromTime:this._getCurrentTime()}),r=this._liveshiftService.getSourceUrl(i),n=c.isHls(t._player._options.source);t._player._loadByUrlInner(r,e,!0),t._player.trigger(d.Private.Play_Btn_Hide),t._liveshiftService.seekTime=e,t._player.trigger(d.Private.EndStart,{toTime:e}),t._updateProgressBar(this.playedNode,e),t._updateCursorPosition(e),setTimeout((function(){t._progressDown||t._onMouseOut()}),500),n&&setTimeout((function(){t._player.play()}))},_onMouseDown:function(e){var t=this;e.preventDefault(),this._player.trigger(d.Private.SeekStart,{fromTime:this._getCurrentTime()}),a.on(this.controlNode,"mousemove",(function(e){t._onMouseMove(e)})),a.on(this.controlNode,"touchmove",(function(e){t._onMouseMove(e)})),a.on(this.controlNode,"mouseup",(function(e){t._onMouseUp(e)})),a.on(this.controlNode,"touchend",(function(e){t._onMouseUp(e)}))},_onMouseUp:function(e){e.preventDefault(),a.off(this.controlNode,"mousemove"),a.off(this.controlNode,"touchmove"),a.off(this._player.tag,"mouseup"),a.off(this._player.tag,"touchend"),a.off(this.controlNode,"mouseup"),a.off(this.controlNode,"touchend"),this._onMouseClick(e)},_onMouseMove:function(e){e.preventDefault()},_onTimeupdate:function(e){this._player._seeking||(o.IS_ANDROID&&o.IS_UC&&(this._hasResetFlagUC&&this._player.getCurrentTime()&&(this._hasResetFlagUC=!1,this._basePtsUC=this._player.getCurrentTime()),this._player.getCurrentTime()||(this._hasResetFlagUC=!0,this._basePtsUC=0)),this._updateProgressBar(this.playedNode,this._getCurrentTime()),this._updateCursorPosition(this._getCurrentTime()),this._player.trigger(d.Private.UpdateProgressBar,{time:this._getCurrentTime()}))},_getCurrentTime:function(){var e=this._liveshiftService.seekTime;-1==e&&(e=0),e=this._player.getCurrentTime()+e;return o.IS_ANDROID&&o.IS_UC&&(e-=this._basePtsUC||0),e},_onProgress:function(e){this._player.getDuration()&&1<=this._player.getBuffered().length&&this._updateProgressBar(this.loadedNode,this._player.getBuffered().end(this._player.getBuffered().length-1))},_updateProgressBar:function(e,t){var r,i;1!=this._player._switchSourcing&&(i=0,-1==this._liveshiftService.seekTime?i=1:1<(i=(r=this._liveshiftService.availableLiveShiftTime)?t/r:0)&&(this._liveshiftService.seekTime=-(i=1)),this.liveShiftStartDisplay,e)&&n.css(e,"width",100*i+"%")},_updateCursorPosition:function(e){var t,r,i,a;this._player.el()&&1!=this._player._switchSourcing&&(i=0,a=1,t=this._player.el().clientWidth,-1==this._liveshiftService.seekTime?i=1:1<(i=(r=this._liveshiftService.availableLiveShiftTime)?e/r:0)&&(this._liveshiftService.seekTime=-1),0!=t&&(a=1-(e=10/t),i-=e),i=i<0?0:i,this.cursorNode)&&(a<i?(n.css(this.cursorNode,"right","0px"),n.css(this.cursorNode,"left","auto")):(n.css(this.cursorNode,"right","auto"),n.css(this.cursorNode,"left",100*i+"%")))}});t.exports=e},{"../config":14,"../lang/index":23,"../lib/dom":32,"../lib/event":33,"../lib/function":35,"../lib/playerutil":46,"../lib/ua":49,"../lib/util":51,"../player/base/event/eventtype":70,"../ui/component":130}],13:[function(e,t,r){var i=e("../ui/component"),n=e("../lib/util"),a=e("../player/base/event/eventtype");e=i.extend({init:function(e,t){i.call(this,e,t),this.className=t.className||"prism-live-time-display",this.addClass(this.className),this._liveshiftService=e._liveshiftService},createEl:function(){var e=i.prototype.createEl.call(this,"div");return e.innerHTML='<span class="current-time">00:00</span> <span class="time-bound">/</span> <span class="end-time">00:00</span><span class="live-text">Live: </span><span class="live-time"></span>',e},bindEvent:function(){var e=this;this._player.on(a.Video.TimeUpdate,(function(){var t,r=e._liveshiftService,i=document.querySelector("#"+e.id()+" .current-time");r.liveShiftStartDisplay&&r.availableLiveShiftTime>r.seekTime&&-1!=r.seekTime?(t=e._liveshiftService.getBaseTime(),t=n.formatTime(t+e._player.getCurrentTime()),i.innerText=t):r.currentTimeDisplay&&(i.innerText=r.currentTimeDisplay)})),this._player.on(a.Private.LiveShiftQueryCompleted,(function(){e.updateTime()}))},updateTime:function(){document.querySelector("#"+this.id()+" .end-time").innerText=this._liveshiftService.liveTimeRange.endDisplay,document.querySelector("#"+this.id()+" .live-time").innerText=this._liveshiftService.currentTimeDisplay}});t.exports=e},{"../lib/util":51,"../player/base/event/eventtype":70,"../ui/component":130}],14:[function(e,t,r){e=e("../package.json"),t.exports={domain:"g.alicdn.com",flashVersion:"2.8.2",h5Version:e.version.split("-")[0],rtsVersion:"2.2.6",cityBrain:!0,logDuration:10,logCount:100,logReportTo:"https://videocloud.cn-hangzhou.log.aliyuncs.com/logstores/newplayer/track"}},{"../package.json":10}],15:[function(e,t,r){var i,n,a,o;e("./lib/patch-ssr").isSSR||(e("./lang/index").load(),i=e("./player/adaptivePlayer"),n=e("./lib/reloadInstanceUtil"),a=e("./lib/componentutil"),o=e("./config"),(e=function(e,t){return e=i.create(e,t),n.storeUserEvents(e),e}).getVersion=function(){return o.h5Version},a.register(e),(a=window.Aliplayer=e).players={},e.reloadInstance=n.reloadInstance,"undefined"==typeof Uint8Array)||Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice}),t.exports=a},{"./config":14,"./lang/index":23,"./lib/componentutil":27,"./lib/patch-ssr":44,"./lib/reloadInstanceUtil":47,"./player/adaptivePlayer":66}],16:[function(e,t,r){var i=e("../player/base/event/eventtype"),n=e("../lib/constants"),a=e("../lang/index");t.exports=function(){function e(e){var t=this;void 0===e&&(e={}),this.interval=3e3,this.player=null,this.timer=null,this.playerInitDone=!1,this.player=e.player,this.player.on(i.Player.Init,(function(){t.playerInitDone=!0}))}var t=e.prototype;return t.start=function(){var e=this;this.stop(),this.player&&this.player._options&&!this.player._options.preventRecord||(this.timer=setInterval((function(){e.playerInitDone&&e.check()}),this.interval))},t.stop=function(){this.clearTimer()},t.check=function(){var e=!1,t=this.detectPrototype()||this.detectNativeFn();return(t||this.detectDeperateVideo())&&(console.log("isMediaSourceModified",t),this.clearTimer(),this.displayError(),this.setupErrorStyle(),this.destroyVideo(),localStorage.setItem("_intercept_mediastream_",""),e=!0),e},t.dispose=function(){this.stop(),this.player=null,this.playerInitDone=!1},t.clearTimer=function(){this.timer&&(clearInterval(this.timer),this.timer=null)},t.displayError=function(){var e=this.player,t={mediaId:e._options&&e._options.vid?e._options.vid:"",error_code:n.ErrorCode.RecordNotAllowed,error_msg:a.get("Record_Not_Allowed")};e.logError(t),e.trigger(i.Player.Error,t)},t.setupErrorStyle=function(){this.hideRetry();var e=document.querySelector(".prism-ErrorMessage");e&&(e.style.opacity="1",e.style.visibility="visible")},t.hideRetry=function(){var e=document.querySelector("#"+this.player.id()+" .prism-button-retry");e&&(e.style.display="none")},t.destroyVideo=function(){this.player._drm&&this.player.destroy();var e=this.player.tag;e&&e.parentNode&&e.parentNode.removeChild(e)},t.detectPrototype=function(){var e=window,t=e.MediaSource;return t&&e.EventTarget&&t.__proto__.__proto__===e.EventTarget},t.detectNativeFn=function(){var e=window.MediaSource;return e&&!this.isNativeFn(e.prototype.addSourceBuffer)},t.isNativeFn=function(e){var t=RegExp("^".concat(Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?"),"$")),r=_typeof(e);return null!==e&&("object"==r||"function"==r)&&t.test(e)},t.detectDeperateVideo=function(){var e=this.player.tag;if(e)return-1!==(e.getAttribute("id")||"").indexOf("360")},e}()},{"../lang/index":23,"../lib/constants":28,"../player/base/event/eventtype":70}],17:[function(e,t,r){var i=e("../lib/oo"),n=e("../lang/index"),a=(e=i.extend({init:function(e,t){this._player=e,this._options=e.options()}}),e.prototype.handle=function(e){var t,r;this._options.autoPlayDelay&&(t=(t=this._options.autoPlayDelayDisplayText)||n.get("AutoPlayDelayDisplayText").replace("$$",this._options.autoPlayDelay),this._player.trigger("info_show",t),this._player.trigger("h5_loading_hide"),this._player.trigger("play_btn_hide"),(r=this)._timeHandler=setTimeout((function(){r._player.trigger("info_hide"),r._options.autoPlayDelay=0,e&&e()}),1e3*this._options.autoPlayDelay),this._player.on("play",(function(){a(r)})),this._player.on("pause",(function(){a(r)})))},e.prototype.dispose=function(){a(this),this._player=null},function(e){e._timeHandler&&(clearTimeout(e._timeHandler),e._timeHandler=null)});t.exports=e},{"../lang/index":23,"../lib/oo":43}],18:[function(e,t,r){var i=e("../lib/event"),n=e("../lib/data"),a=e("../player/base/event/eventtype"),o=n.guid();e={};function s(e){var t,r,i=this._options.keyFastForwardStep,n=this._options.isLive;switch(e&&e.keyCode){case 39:n||(e.preventDefault(),t=this.getDuration(),r=this.getCurrentTime()+i,this.seek(r=t<r?t:r),l.call(this,r),u.call(this,r));break;case 37:n||(e.preventDefault(),r=this.getCurrentTime()-i,this.seek(r=r<0?0:r),l.call(this,r),u.call(this,r));break;case 38:e.preventDefault(),this.getVolume()<1&&0<=this.getVolume()&&this.setVolume(Number((this.getVolume()+.1).toFixed(1)));break;case 40:e.preventDefault(),0<this.getVolume()&&this.getVolume()<=1&&this.setVolume(Number((this.getVolume()-.1).toFixed(1)));break;case 32:if(n)return;e.preventDefault(),this.tag.paused?this.play(!0):this.pause(!0)}}function l(e){this.trigger(a.Private.UpdateProgress,{targetTime:e})}function u(e){this.trigger(a.Private.UpdateCursorPosition,{targetTime:e})}e.init=function(){var e;this._options.keyShortCuts&&((e=s.bind(this)).guid=o,i.on(window.document,"keydown",e))},e.dispose=function(){var e;this._options.keyShortCuts&&((e=s.bind(this)).guid=o,i.off(window.document,"keydown",e))},t.exports=e},{"../lib/data":30,"../lib/event":33,"../player/base/event/eventtype":70}],19:[function(e,t,r){var i="undefined"==typeof Promise?e("es6-promise").Promise:Promise,n=e("../lib/constants").LicenseResultCode,a=e("../lib/io"),o=((e={})[n.ResourceIncorrect]="license resource init error",e[n.LicenseKeyInvalid]="invalid license key",e[n.DomainInvalid]="invalid domain",e[n.CertInvalid]="invalid cert content",e[n.NotFound]="license not found",e[n.Expired]="license expired",e);e=function(){function e(){}return e.getLicense=function(e,t){var r=this;return this.isWasmSupported()?t?e?this.instance?i.resolve(this.instance):new i((function(i,o){r.resolvers.push(i),r.rejecters.push(o),1===r.resolvers.length&&a.loadJS("https://g.alicdn.com/video-cloud-fe/websdk-license/0.1.0/index.js",(function(){window.loadLicenseSource().then((function(i){return i.init(2,e,t).then((function(e){r.instance=e,r.resolvers.forEach((function(t){t(e)}))})).catch((function(e){console.error(e),r.rejecters.forEach((function(e){e(n.CertInvalid)}))}))})).catch((function(){r.rejecters.forEach((function(e){e(n.ResourceIncorrect)}))})).finally((function(){r.resolvers=[],r.rejecters=[]}))}),(function(){r.rejecters.forEach((function(e){e(n.ResourceIncorrect)}))}))})):i.reject(n.DomainInvalid):i.reject(n.LicenseKeyInvalid):i.reject(n.WasmNotSupported)},e.isWasmSupported=function(){return"object"==("undefined"===typeof WebAssembly?"undefined":_typeof(WebAssembly))&&"function"==typeof WebAssembly.instantiate},e.logError=function(e){o[e]&&console.error(o[e])},e}();e.instance=void 0,e.resolvers=[],e.rejecters=[],t.exports=e},{"../lib/constants":28,"../lib/io":40,"es6-promise":8}],20:[function(e,t,r){t.exports=t.exports={OD:"OD",FD:"360p",LD:"540p",SD:"720p",HD:"1080p","2K":"2K","4K":"4K",FHD:"FHD",XLD:"XLD",SQ:"SQ",HQ:"HQ",Speed:"Speed",Speed_05X_Text:"0.5X",Speed_1X_Text:"Normal",Speed_125X_Text:"1.25X",Speed_15X_Text:"1.5X",Speed_2X_Text:"2X",Refresh_Text:"Refresh",Cancel:"Cancel",Mute:"Mute",Snapshot:"Snapshot",Detection_Text:"Diagnosis",Play_DateTime:"Time",Quality_Change_Fail_Switch_Text:"Cannot play, switch to ",Quality_Change_Text:"Switch to ",Quality_The_Url:"The url",AutoPlayDelayDisplayText:"Play in $$ seconds",Error_Load_Abort_Text:"Data abort erro",Error_Network_Text:"Loading failed due to network error",Error_Decode_Text:"Decode error",Error_Server_Network_NotSupport_Text:"Network error or  the format of video is unsupported",Error_Offline_Text:"The network is unreachable, please click Refresh",Error_Play_Text:"Error occured while playing",Error_Retry_Text:" Please close or refresh",Error_AuthKey_Text:"Authentication expired or the domain is not in white list",Error_H5_Not_Support_Text:"The format of video is not supported by h5 player，please use flash player",Error_Not_Support_M3U8_Text:"The format of m3u8 is not supported by this explorer",Error_Not_Support_MP4_Text:"The format of mp4 is not supported by this explorer",Error_Not_Support_encrypt_Text:"Play the encrypted video,please set encryptType to 1",Error_Vod_URL_Is_Empty_Text:"The url is empty",Error_Vod_Fetch_Urls_Text:"Error occured when fetch urls，please close or refresh",Fetch_Playauth_Error:"Error occured when fetch playauth close or refresh",Error_Playauth_Decode_Text:"PlayAuth parse failed",Error_Vid_Not_Same_Text:"Cannot renew url due to vid changed",Error_Playauth_Expired_Text:"Playauth expired, please close or refresh",Error_MTS_Fetch_Urls_Text:"Error occurred while requesting mst server",Error_Load_M3U8_Failed_Text:"The m3u8 file loaded failed,please make sure domain configuration https certificate or enable cors",Error_Load_M3U8_Timeout_Text:"Timeout error occored when the m3u8 file loaded",Error_Liveshift_M3U8_Not_Found_Text:"No more liveshift video avaliable",Error_M3U8_Decode_Text:"The m3u8 file decoded failed",Error_TX_Decode_Text:"Video decoded failed",Error_Waiting_Timeout_Text:"Buffering timeout, please close or refresh",Error_Invalidate_Source:"Video shoud be mp4、mp3、m3u8、mpd or flv",Error_Empty_Source:"Video URL shouldn't be empty",Error_Vid_Empty_Source:"vid's video URL hasn't been fetched",Error_Mediaauth_Empty_Source:"mediaAuth's video URL hasn't been fetched",Error_Fetch_NotStream:"The vid has no stream to play",Error_Fetch_Media_Not_Found:"Data is not found",Error_Not_Found:"Url is not found",Error_Drm_License_Request_Failed:"DRM license request failed",Error_Drm_Not_Supported:"DRM in not supported",Error_Drm_Load:"DRM load error",Error_Region_Block_Text:"This video is not available in your region",Live_End:"Live has finished",Play_Before_Fullscreen:"Please play before fullscreen",Can_Not_Seekable:"Can not seek to this position",Cancel_Text:"Cancel",OK_Text:"OK",Auto_Stream_Tip_Text:"Internet is slow, does switch to $$",Request_Block_Text:"This request is blocked, the video Url should be over https",Open_Html_By_File:"Html page should be on the server",Maybe_Cors_Error:"please make sure domain configuration https certificate or enable cors",Speed_Switch_To:"Speed switch to ",Curent_Volume:"Current volume:",Volume_Mute:"set to mute",Volume_UnMute:"set to unmute",ShiftLiveTime_Error:"Live start time should not be greater than over time",Error_Not_Support_Format_On_Mobile:"flv、rmtp can't be supported on mobile，please use m3u8",SessionId_Ticket_Invalid:"please assign value for sessionId and ticket properties",Http_Error:" An HTTP network request failed with an error, but not from the server.",Http_Timeout:"A network request timed out",DRM_License_Expired:"DRM license is expired, please refresh",Not_Support_DRM:"Browser doesn't support DRM",CC_Switch_To:"Subtitle switch to ",AudioTrack_Switch_To:"Audio tracks switch to ",Subtitle:"Subtitle/CC",AudioTrack:"Audio Track",Quality:"Quality",Auto:"Auto",Quality_Switch_To:"Quality switch to ",Fullscreen:"Full Screen",Setting:"Settings",Volume:"Volume",Play:"Play",Pause:"Pause",CloseSubtitle:"Close CC",OpenSubtitle:"Open CC",ExistFullScreen:"Exit Full Screen",Muted:"Muted",Retry:"Retry",SwitchToLive:"Return to live",iOSNotSupportVodEncription:"iOS desn't support Vod's private encription video, please use HLS standard encription or DRM",UseChromeForVodEncription:"This browser desn't suport Vod's encription video, please use latest Chrome",Record_Not_Allowed:"Recording or playing in seperated window is not allowed, please disable related plugins or switch browser.",License_No_Authorization:"Aliplayer without Authorization",License_Click_To_Apply:"Click to apply",Rts_Err_Http_Signal_Error:"(RTS)http signal error",Rts_Err_Play_Failed:"(RTS)play faild error",Rts_Err_No_Data_For:"ms received no data",Rts_Err_Browser_Not_Support:"(RTS)browser not support",Rts_Err_Not_Support_Webrtc:"(RTS)not support webrtc",Rts_Err_Browser_Version_Too_Low:"(RTS)browser version too low",Rts_Err_Not_Support_H264:"(RTS)not support h264",Rts_Err_Create_Offer_Error:"(RTS)create offer error",Rts_Err_Play_Url_Error:"(RTS)play url error",Rts_Err_Subscribe_Nonthing:"(RTS)subscribe nonthing",Rts_Err_Http_Request_Failed:"(RTS)HTTP request failed",Rts_Err_Http_Answer_Failed:"(RTS)answer failed",Rts_Err_PeerConnection_Unknown:"(RTS)Unknown PeerConnection",Splayer_Err_Env_Check:"(SP)This browser can't play this media",Splayer_Err_Coroutine:"(SP)Coroutine error",Splayer_Err_Decoder:"(SP)Decode error",Splayer_Err_Buffering:"(SP)Buffering error",Splayer_Err_Parser_Not_Found:"(SP)Media container is not supported"}},{}],21:[function(e,t,r){t.exports=t.exports={OD:"OD",LD:"360p",FD:"540p",SD:"720p",HD:"1080p","2K":"2K","4K":"4K",FHD:"FHD",XLD:"XLD",SQ:"SQ",HQ:"HQ",Forbidden_Text:"Internal information is strictly forbidden to outsider",Refresh:"Refresh",Diagnosis:"Diagnosis",Live_Finished:"Live has finished, thanks for watching",Play:"Play",Pause:"Pause",Snapshot:"Snapshot",Replay:"Replay",Live:"Live",Encrypt:"Encrypt",Sound:"Sound",Fullscreen:"Full Screen",Exist_Fullscreen:"Exit Full-screen",Resolution:"Resolution",Next:"Next Video",Brightness:"Brightness",Default:"Default",Contrast:"Contrast",Titles_Credits:"Titles and Credits",Skip_Titles:"Skip Titles",Skip_Credits:"Skip Credits",Not_Support_Out_Site:"The video is not supported for outside website, please watch it by TaoTV",Watch_Now:"Watch now",Network_Error:"Network is unreachable, please try to refresh",Video_Error:"Playing a video error, please try to refresh",Decode_Error:"Data decoding error",Live_Not_Start:"Live has not started, to be expected",Live_Loading:"Live information is loading, please try to refresh",Fetch_Playauth_Error:"Error occured when fetch playauth close or refresh",Live_End:"Live has finished",Live_Abrot:"Signal aborted, please try to refresh",Corss_Domain_Error:"Please ensure your domain has obtained IPC license and combined CNAME, \r\n or to set  cross-domain accessing available",Url_Timeout_Error:"The video url is timeout, please try to refresh",Connetction_Error:"Sorry，the video cannot play because of connection error, please try to watch other videos",Fetch_MTS_Error:"Fetching video list failed, please ensure",Token_Expired_Error:"Requesting open api failed, please ensure token expired or not",Video_Lists_Empty_Error:"The video list is empty, please check the format of video",Encrypted_Failed_Error:"Fetching encrypted file failed, please check the permission of player",Fetch_Failed_Permission_Error:"Fetching video list failed, please check the permission of player",Invalidate_Param_Error:"No video url, please check the parameters",AutoPlayDelayDisplayText:"Play in $$ seconds",Fetch_MTS_NOT_NotStream_Error:"The vid has no stream to play",Cancel_Text:"Cancel",OK_Text:"OK",Auto_Stream_Tip_Text:"Internet is slow, does switch to $$",Open_Html_By_File:"Html page should be on the server",Cant_Use_Flash_On_Mobile:"Mobile doesn't support flash player，please use h5 player",Flash_Not_Ready:"Flash Player plugin hasn't been installed <a href='https://www.flash.cn/' target='_blank'>install plugin</a>, or check if disable Flash plugin"}},{}],22:[function(e,t,r){t.exports=t.exports={OD:"原画",FD:"流畅",LD:"标清",SD:"高清",HD:"超清","2K":"2K","4K":"4K",FHD:"全高清",XLD:"极速",SQ:"普通音质",HQ:"高音质",Forbidden_Text:"内部信息，严禁外传",Refresh:"刷新",Diagnosis:"诊断",Live_Finished:"直播已结束,谢谢观看",Play:"播放",Pause:"暂停",Snapshot:"截图",Replay:"重播",Live:"直播",Encrypt:"加密",Sound:"声音",Fullscreen:"全屏",Exist_Fullscreen:"退出全屏",Resolution:"清晰度",Next:"下一集",Brightness:"亮度",Default:"默认",Contrast:"对比度",Titles_Credits:"片头片尾",Skip_Titles:"跳过片头",Skip_Credits:"跳过片尾",Not_Support_Out_Site:"该视频暂不支持站外播放，请到淘TV观看",Watch_Now:"立即观看",Network_Error:"网络无法连接，请尝试检查网络后刷新试试",Video_Error:"视频播放异常，请刷新试试",Decode_Error:"播放数据解码错误",Live_Not_Start:"亲，直播还未开始哦，敬请期待",Live_Loading:"直播信息加载中，请刷新试试",Live_End:"亲，直播已结束",Live_Abrot:"当前直播信号中断，请刷新后重试",Corss_Domain_Error:"请确认您的域名已完成备案和CNAME绑定，\r\n并处于启用状态，或资源允许跨越访问",Url_Timeout_Error:"您所观看的视频地址连接超时，请刷新后重试",Connetction_Error:"抱歉,该视频由于连接错误暂时不能播放,请观看其它视频",Fetch_MTS_Error:"获取视频列表失败，请确认",Token_Expired_Error:"请求接口失败，请确认Token是否过期",Video_Lists_Empty_Error:"获取视频列表为空，请确认播放数据与格式",Encrypted_Failed_Error:"获取视频加密秘钥错误，请确认播放权限",Fetch_Failed_Permission_Error:"获取视频列表失败，请确认播放权限",Invalidate_Param_Error:"无输入视频，请确认输入参数",AutoPlayDelayDisplayText:"$$秒以后开始播放",Fetch_MTS_NOT_NotStream_Error:"此vid没有可播放视频",Cancel_Text:"取消",OK_Text:"确认",Auto_Stream_Tip_Text:"网络不给力，是否切换到$$",Fetch_Playauth_Error:"获取播放凭证出错啦，请尝试退出重试或刷新",Open_Html_By_File:"不能直接在浏览器打开html文件，请部署到服务端",Cant_Use_Flash_On_Mobile:"移动端不支持Flash播放器，请使用h5播放器",Flash_Not_Ready:"Flash Player插件未安装<a href='https://www.flash.cn/' target='_blank'>安装插件</a>，如果已经安装请检查是否被禁用"}},{}],23:[function(e,t,r){function i(){var e;return void 0!==window[l]&&window[l]||(e=(e=(navigator.language||navigator.browserLanguage).toLowerCase())&&-1<e.indexOf("zh")?"zh-cn":"en-us",window[l]=e),window[l]}function n(t,r){var i=d(t),n=c(),a="flash"==t?"en-us"==n?e("./flash/en-us"):"zh-cn"==n?e("./flash/zh-cn"):r[n]:"en-us"==n?e("./en-us"):"zh-cn"==n?e("./zh-cn"):r[n];o.set(i,JSON.stringify(a)),u(t,a)}var a=e("../config"),o=e("../lib/storage"),s=(e("../lib/io"),"aliplayer_lang_data"),l="aliplayer_lang",u=function(e,t){e=d(e),window[e]=t},c=function(){return i()},d=function(e){var t=c();return s+"_"+(e=e||"h5")+"_"+a.h5Version.replace(/\./g,"_")+"_"+t};t.exports.setCurrentLanguage=function(t,r,a){var o=window[l];if(!("en-us"==(t=void 0!==t&&t?t:i())||"zh-cn"==t||a&&a[t]))throw new Error("There is not language resource for "+t+", please specify the language resource by languageTexts property");window[l]=t,n(r,a),t!=o&&e("../lib/constants").updateByLanguage()},t.exports.getCurrentLanguage=i,t.exports.getLanguageData=function(e,t){return e=d(e),window[e]},t.exports.load=n,t.exports.get=function(e,t){if(t=d(t=t||"h5"),t=window[t],t)return t[e]}},{"../config":14,"../lib/constants":28,"../lib/io":40,"../lib/storage":48,"./en-us":20,"./flash/en-us":21,"./flash/zh-cn":22,"./zh-cn":24}],24:[function(e,t,r){t.exports=t.exports={OD:"原画",FD:"流畅",LD:"标清",SD:"高清",HD:"超清","2K":"2K","4K":"4K",FHD:"全高清",XLD:"极速",SQ:"普通音质",HQ:"高音质",Speed:"倍速",Speed_05X_Text:"0.5X",Speed_1X_Text:"正常",Speed_125X_Text:"1.25X",Speed_15X_Text:"1.5X",Speed_2X_Text:"2X",Quality_Change_Fail_Switch_Text:"不能播放，切换为",Quality_Change_Text:"正在为您切换到 ",Quality_The_Url:"此地址",Refresh_Text:"刷新",Detection_Text:"诊断",Cancel:"取消",Mute:"静音",Snapshot:"截图",Play_DateTime:"播放时间",AutoPlayDelayDisplayText:"$$秒以后开始播放",Error_Load_Abort_Text:"获取数据过程被中止",Error_Network_Text:"网络错误加载数据失败",Error_Decode_Text:"解码错误",Error_Server_Network_NotSupport_Text:"服务器、网络错误或格式不支持",Error_Offline_Text:"网络不可用，请确定",Error_Play_Text:"播放出错啦",Error_Retry_Text:"请尝试退出重试或刷新",Error_AuthKey_Text:"可能鉴权过期、域名不在白名单或请求被拦截",Error_H5_Not_Support_Text:"h5不支持此格式，请使用flash播放器",Error_Not_Support_M3U8_Text:"浏览器不支持m3u8视频播放",Error_Not_Support_MP4_Text:"浏览器不支持mp4视频播放",Error_Not_Support_encrypt_Text:"播放加密视频，请设置属性encryptType to 1",Error_Vod_URL_Is_Empty_Text:"获取播放地址为空",Error_Vod_Fetch_Urls_Text:"获取地址出错啦，请尝试退出重试或刷新",Fetch_Playauth_Error:"获取播放凭证出错啦，请尝试退出重试或刷新",Error_Playauth_Decode_Text:"playauth解析错误",Error_Vid_Not_Same_Text:"不能更新地址，vid和播放中的不一致",Error_Playauth_Expired_Text:"凭证已过期，请尝试退出重试或刷新",Error_MTS_Fetch_Urls_Text:"MTS获取取数失败",Error_Load_M3U8_Failed_Text:"获取m3u8文件失败,请确认域名是否配置了https证书或者是否开启了允许跨域访问",Error_Load_M3U8_Timeout_Text:"获取m3u8文件超时",Error_Liveshift_M3U8_Not_Found_Text:"没有更多时移视频了",Error_M3U8_Decode_Text:"获取m3u8文件解析失败",Error_TX_Decode_Text:"解析数据出错",Error_Waiting_Timeout_Text:"缓冲数据超时，请尝试退出重试或刷新",Error_Invalidate_Source:"播放地址格式需要为mp4、mp3、m3u8、mpd或flv",Error_Empty_Source:"播放地址不能为空",Error_Vid_Empty_Source:"vid对应的视频地址还未获取到",Error_Mediaauth_Empty_Source:"mediaAuth对应的视频地址还未获取到",Error_Fetch_NotStream:"此vid没有可播放视频",Error_Fetch_Media_Not_Found:"数据不存在或已被删除",Error_Not_Found:"播放地址不存在",Error_Drm_License_Request_Failed:"DRM License 请求失败",Error_Drm_Not_Supported:"当前浏览器不支持 DRM 播放",Error_Drm_Load:"DRM 播放错误",Error_Region_Block_Text:"您所在的地区无法观看该视频",Live_End:"亲，直播已结束",Play_Before_Fullscreen:"播放后再全屏",Can_Not_Seekable:"不能seek到这里",Cancel_Text:"取消",OK_Text:"确认",Auto_Stream_Tip_Text:"网络不给力，是否切换到$$",Request_Block_Text:"浏览器安全策略视频地址不能为http协议，与网站https协议不一致",Open_Html_By_File:"不能直接在浏览器打开html文件，请部署到服务端",Maybe_Cors_Error:"请确认域名是否配置了https证书或者是否开启了允许跨域访问",Speed_Switch_To:"倍速切换到 ",Curent_Volume:"当前音量：",Volume_Mute:"设置为静音",Volume_UnMute:"设置为非静音",ShiftLiveTime_Error:"直播开始时间不能大于直播结束时间",Error_Not_Support_Format_On_Mobile:"移动端不支持flv、rmtp视频，请使用m3u8",SessionId_Ticket_Invalid:"DRM视频播放，sessionId和ticket属性不能为空",Http_Error:"Http网络请求失败",Http_Timeout:"http请求超时",DRM_License_Expired:"DRM license超时，请刷新",Not_Support_DRM:"浏览器不支持DRM视频的播放或未受到用户许可",CC_Switch_To:"字幕切换到 ",AudioTrack_Switch_To:"音轨切换到 ",Subtitle:"字幕",AudioTrack:"音轨",Quality:"清晰度",Auto:"自动",Quality_Switch_To:"清晰度切换到 ",Fullscreen:"全屏",Setting:"设置",Volume:"音量",Play:"播放",Pause:"暂停",CloseSubtitle:"关闭字幕",OpenSubtitle:"打开字幕",ExistFullScreen:"退出全屏",Muted:"静音",Retry:"重试",SwitchToLive:"返回直播",iOSNotSupportVodEncription:"iOS不支持阿里云视频加密（加密）播放，请使用标准加密或DRM",UseChromeForVodEncription:"浏览器不支持点播加密播放，请使用最新Chrome浏览器",Record_Not_Allowed:"禁止录屏或小窗口播放，请关闭插件或更换浏览器",License_No_Authorization:"播放器SDK未激活",License_Click_To_Apply:"点击申请License",Rts_Err_Http_Signal_Error:"(RTS)信令请求失败",Rts_Err_Play_Failed:"(RTS)播放失败",Rts_Err_No_Data_For:"毫秒没有数据",Rts_Err_Browser_Not_Support:"(RTS)不支持此浏览器",Rts_Err_Not_Support_Webrtc:"(RTS)不支持webrtc",Rts_Err_Browser_Version_Too_Low:"(RTS)浏览器版本过低",Rts_Err_Not_Support_H264:"(RTS)不支持H264",Rts_Err_Create_Offer_Error:"(RTS)create offer失败",Rts_Err_Play_Url_Error:"(RTS)播放url协议错误",Rts_Err_Subscribe_Nonthing:"(RTS)参数设置错误",Rts_Err_Http_Request_Failed:"(RTS)HTTP请求失败",Rts_Err_Http_Answer_Failed:"(RTS)answer失败",Rts_Err_PeerConnection_Unknown:"(RTS)PeerConnection异常",Splayer_Err_Env_Check:"(SP)当前环境不支持播放该视频",Splayer_Err_Coroutine:"(SP)Coroutine 错误",Splayer_Err_Decode:"(SP)解码错误",Splayer_Err_Buffering:"(SP)缓冲区错误",Splayer_Err_Parser_Not_Found:"(SP)不支持的媒体容器"}},{}],25:[function(e,t,r){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";if(window.Uint8Array)for(var n=new Uint8Array(256),a=0;a<i.length;a++)n[i.charCodeAt(a)]=a;t.exports={decode:function(e){for(var t,r,i,a,o=.75*e.length,s=e.length,l=0,u=(o=("="===e[e.length-1]&&(o--,"="===e[e.length-2])&&o--,new ArrayBuffer(o)),new Uint8Array(o)),c=0;c<s;c+=4)t=n[e.charCodeAt(c)],r=n[e.charCodeAt(c+1)],i=n[e.charCodeAt(c+2)],a=n[e.charCodeAt(c+3)],u[l++]=t<<2|r>>4,u[l++]=(15&r)<<4|i>>2,u[l++]=(3&i)<<6|63&a;return o},encode:function(e){for(var t=new Uint8Array(e),r=t.length,n="",a=0;a<r;a+=3)n=(n=(n=(n+=i[t[a]>>2])+i[(3&t[a])<<4|t[a+1]>>4])+i[(15&t[a+1])<<2|t[a+2]>>6])+i[63&t[a+2]];return r%3==2?n=n.substring(0,n.length-1)+"=":r%3==1&&(n=n.substring(0,n.length-2)+"=="),n},unpackPlayReady:function(e){if(e=function(e,t,r){if(!e)return"";r||e.byteLength%2==0||console.log("Data has an incorrect length, must be even."),r=e instanceof ArrayBuffer?e:((r=new Uint8Array(e.byteLength)).set(new Uint8Array(e)),r.buffer);for(var i=Math.floor(e.byteLength/2),n=new Uint16Array(i),a=new DataView(r),o=0;o<i;o++)n[o]=a.getUint16(2*o,!0);return function(e){for(var t="",r=0;r<e.length;r+=16e3){var i=e.subarray(r,r+16e3);t+=String.fromCharCode.apply(null,i)}return t}(n)}(e,0,!0),-1!=e.indexOf("PlayReadyKeyMessage")){e=(new DOMParser).parseFromString(e,"application/xml");for(var t=e.getElementsByTagName("HttpHeader"),r={},i=0;i<t.length;++i){var n=t[i].querySelector("name"),a=t[i].querySelector("value");r[n.textContent]=a.textContent}return{header:r,changange:e.querySelector("Challenge").textContent}}console.log("PlayReady request is already unwrapped.")}}},{}],26:[function(e,t,r){var i=e("./videox-demux.min");function n(){}t.exports=function(e,t,r){void 0===t&&(t=n),void 0===r&&(r=n);var a=new i.Demuxer({progressive:!0});a.on("loadedmetadata",(function(e){void 0===e&&(e={}),a.suspend(),a.destroy(),a=null,t(e)})),a.on("error",(function(e){r(e)})),a.load(e)}},{"./videox-demux.min":52}],27:[function(e,t,r){var i=e("./oo"),n=e("../player/base/event/eventtype");t.exports.stopPropagation=function(e){window.event?window.event.cancelBubble=!0:e.stopPropagation()},t.exports.register=function(e){e.util={stopPropagation:t.exports.stopPropagation},e.Component=i.extend,e.EventType=n.Player}},{"../player/base/event/eventtype":70,"./oo":43}],28:[function(e,t,r){function i(){t.exports.VideoErrorCodeText={1:n.get("Error_Load_Abort_Text"),2:n.get("Error_Network_Text"),3:n.get("Error_Decode_Text"),4:n.get("Error_Server_Network_NotSupport_Text")},t.exports.VideoLevels={0:n.get("OD"),640:n.get("FD"),960:n.get("LD"),1280:n.get("SD"),1920:n.get("HD"),2580:n.get("2K"),3840:n.get("4K")},t.exports.QualityLevels={OD:n.get("OD"),LD:n.get("LD"),FD:n.get("FD"),SD:n.get("SD"),HD:n.get("HD"),"2K":n.get("2K"),"4K":n.get("4K"),XLD:n.get("XLD"),FHD:n.get("FHD"),SQ:n.get("SQ"),HQ:n.get("HQ")},t.exports.SpeedLevels=[{key:.5,text:n.get("Speed_05X_Text")},{key:1,text:n.get("Speed_1X_Text")},{key:1.25,text:n.get("Speed_125X_Text")},{key:1.5,text:n.get("Speed_15X_Text")},{key:2,text:n.get("Speed_2X_Text")}]}var n=e("../lang/index");t.exports.LOAD_START="loadstart",t.exports.LOADED_METADATA="loadedmetadata",t.exports.LOADED_DATA="loadeddata",t.exports.PROGRESS="progress",t.exports.CAN_PLAY="canplay",t.exports.CAN_PLYA_THROUGH="canplaythrough",t.exports.PLAY="play",t.exports.PAUSE="pause",t.exports.ENDED="ended",t.exports.PLAYING="playing",t.exports.WAITING="waiting",t.exports.ERROR="error",t.exports.SUSPEND="suspend",t.exports.STALLED="stalled",t.exports.AuthKeyExpiredEvent="authkeyexpired",t.exports.USER_EVENT_NAME="__user_events__",t.exports.PLAYER_SDK_CODE=9201,t.exports.FEATURE_ID_H265=30001,t.exports.LicenseResultCode={Success:0,NotFound:1,Expired:2,CertInvalid:3,WasmNotSupported:4,ResourceIncorrect:5,LicenseKeyInvalid:6,DomainInvalid:7},t.exports.DRMKeySystem={4:"com.microsoft.playready",5:"com.widevine.alpha"},t.exports.EncryptionType={Private:1,Standard:2,ChinaDRM:3,PlayReady:4,Widevine:5},t.exports.VodEncryptionType={AliyunVoDEncryption:1,HLSEncryption:2,Widevine:5,"Widevine-FairPlay":5},t.exports.DRMType={Widevine:"Widevine",PlayReady:"PlayReady"},t.exports.ErrorCode={InvalidParameter:4001,AuthKeyExpired:4002,InvalidSourceURL:4003,NotFoundSourceURL:4004,StartLoadData:4005,LoadedMetadata:4006,PlayingError:4007,LoadingTimeout:4008,RequestDataError:4009,EncrptyVideoNotSupport:4010,FormatNotSupport:4011,PlayauthDecode:4012,PlayDataDecode:4013,NetworkUnavaiable:4014,UserAbort:4015,NetworkError:4016,URLsIsEmpty:4017,DrmLicenseRequestFailed:4018,RecordNotAllowed:4019,MediaNotFound:4020,DrmNotSupported:4021,DrmLoadError:4022,RegionBlock:4023,CrossDomain:4027,OtherError:4400,ServerAPIError:4500,FlashNotInstalled:4600,RtsSignalError:4100,RtsPlayFailedError:4200,RtsNotSupportWebRtc:4110,RtsBrowserNotSupport:4111,RtsBrowserVersionTooLow:4112,RtsNotSupportH264:4113,RtsCreateOfferError:4114,RtsAutoPLayFaild:4115,RtsPlayUrlError:4116,RtsSubscribeNonthing:4117,RtsHtmlElementError:4118,RtsHtmlElementNotMatch:4119,RtsBrowserNotSupportRtc:4120,RtsHttpRequestFaild:4121,RtsHttpAnswerFaild:4122,RtsPeerConnectionUnknown:4123,SplayerEnvCheckError:4300,SplayerCoroutineError:4301,SplayerDecodeError:4302,SplayerBufferingError:4303,SplayerParserNotFound:4304},t.exports.AuthKeyExpired=7200,t.exports.AuthKeyRefreshExpired=7e3,t.exports.AuthInfoExpired=100,t.exports.VideoErrorCode={1:4015,2:4016,3:4013,4:4400},t.exports.RegionBlockMessages=["black location","denied by region block"],t.exports.IconType={FontClass:"fontclass",Symbol:"symbol",Sprite:"Sprite"},t.exports.SelectedStreamLevel="selectedStreamLevel",t.exports.SelectedCC="selectedCC",t.exports.HWDetectHvc1="HWDetectHvc1",t.exports.HWDetectHev1="HWDetectHev1",t.exports.WidthMapToLevel={0:"OD",640:"FD",960:"LD",1280:"SD",1920:"HD",2580:"2K",3840:"4K"},i(),t.exports.updateByLanguage=i},{"../lang/index":23}],29:[function(e,t,r){t.exports.get=function(e){for(var t=e+"",r=document.cookie.split(";"),i=0;i<r.length;i++){var n=r[i].trim();if(0==n.indexOf(t))return unescape(n.substring(t.length+1,n.length))}return""},t.exports.set=function(e,t,r){var i=new Date;i.setTime(i.getTime()+24*r*60*60*1e3),r="expires="+i.toGMTString();document.cookie=e+"="+escape(t)+"; "+r}},{}],30:[function(e,t,r){var i=e("./object");t.exports.cache={},t.exports.guid=function(e,t){var r,i,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[];if(t=t||n.length,e)for(r=0;r<e;r++)a[r]=n[0|Math.random()*t];else for(a[8]=a[13]=a[18]=a[23]="-",a[14]="4",r=0;r<36;r++)a[r]||(i=0|16*Math.random(),a[r]=n[19==r?3&i|8:i]);return a.join("")},t.exports.expando="vdata"+(new Date).getTime(),t.exports.getData=function(e){var r=e[t.exports.expando];return r||(r=e[t.exports.expando]=t.exports.guid(),t.exports.cache[r]={}),t.exports.cache[r]},t.exports.hasData=function(e){var r="";return!(!(r=e?e[t.exports.expando]:r)||i.isEmpty(t.exports.cache[r]))},t.exports.removeData=function(e){var r="";if(r=e?e[t.exports.expando]:r){delete t.exports.cache[r];try{delete e[t.exports.expando]}catch(r){e.removeAttribute?e.removeAttribute(t.exports.expando):e[t.exports.expando]=null}}}},{"./object":42}],31:[function(e,t,r){var i,n="undefined"==typeof Promise?e("es6-promise").Promise:Promise;e="undefined"!=typeof self?self:this,i=function(){return t=[function(e,t,r){"use strict";(function(e){t.b=function(e){for(var t=(e=void 0===e?{}:e).includes,r=(e=e.excludes,e=void 0===e?[]:e,!1),i=!1,n=0,a=void 0===t?[]:t;n<a.length;n++)if(!0===a[n]){r=!0;break}for(var o=0,s=e;o<s.length;o++)if(!0===s[o]){i=!0;break}return r&&!i},t.c=function(e,t,r){return e=n.a[e],void 0!==e&&Object(i.compare)(e,t,r)},t.a=function(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:this};var i=r(11),n=(r.n(i),r(4))}).call(t,r(10))},function(e,t,r){"use strict";r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return a})),r.d(t,"b",(function(){return o})),r.d(t,"f",(function(){return s})),r.d(t,"a",(function(){return l})),r.d(t,"e",(function(){return u}));t=r(3),r=r(0),r=Object(r.a)();var i,n="InstallTrigger"in((null==r?void 0:r.window)||{})||/firefox/i.test(t.b),a=/trident/i.test(t.b)||/msie/i.test(t.b),o=/edge/i.test(t.b),s=/webkit/i.test(t.b)&&!o,l=void 0!==(null==(i=null==r?void 0:r.window)?void 0:i.chrome)||/chrome/i.test(t.b),u="[object SafariRemoteNotification]"===((null==(r=null==(i=null==r?void 0:r.window)?void 0:i.safari)?void 0:r.pushNotification)||!1).toString()||/safari/i.test(t.b)&&!l},function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return s}));var i=r(1);function n(e){if(console){if(!i.d&&!i.b)return console[e];if("log"===e||"clear"===e)return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];console[e].apply(console,t)}}return function(){for(var e=0;e<arguments.length;e++);}}var a=n("log"),o=n("table"),s=n("clear")},function(e,t,r){"use strict";t.a=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return null!=i&&i.document?(e=i.document).createElement.apply(e,t):{}},r.d(t,"b",(function(){return n}));t=r(0);var i=Object(t.a)(),n=(null==(r=null==i?void 0:i.navigator)?void 0:r.userAgent)||"xxxxx"},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));for(var i={},n=0,a=(r(3).b||"").match(/\w+\/(\d|\.)+(\s|$)/gi)||[];n<a.length;n++){var o=a[n].split("/"),s=o[0];o=o[1];i[s]=o}},function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"d",(function(){return n})),r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){return o})),r.d(t,"e",(function(){return s}));t=r(3);var i=/ipad/i.test(t.b),n=/macintosh/i.test(t.b),a=/iphone/i.test(t.b),o=/android/i.test(t.b),s=/windows/i.test(t.b)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addListener=function(e){d.addListener(e)},t.removeListener=function(e){d.removeListener(e)},t.isLaunch=function(){return d.isLaunch()},t.launch=function(){d.launch()},t.stop=function(){d.stop()},t.setDetectDelay=function(e){d.setDetectDelay(e)};var i=r(7),n=r(8),a=(r.d(t,"DevtoolsDetector",(function(){return i.a})),r.d(t,"checkers",(function(){return n})),r(0)),o=(r.d(t,"match",(function(){return a.b})),r.d(t,"specificVersionMatch",(function(){return a.c})),r(1)),s=(r.d(t,"isFirefox",(function(){return o.c})),r.d(t,"isIE",(function(){return o.d})),r.d(t,"isEdge",(function(){return o.b})),r.d(t,"isWebkit",(function(){return o.f})),r.d(t,"isChrome",(function(){return o.a})),r.d(t,"isSafari",(function(){return o.e})),r(2)),l=(r.d(t,"log",(function(){return s.b})),r.d(t,"table",(function(){return s.c})),r.d(t,"clear",(function(){return s.a})),r(17)),u=(r.d(t,"isMobile",(function(){return l.a})),r(4)),c=(r.d(t,"versionMap",(function(){return u.a})),r(5)),d=(r.d(t,"isIpad",(function(){return c.b})),r.d(t,"isMac",(function(){return c.d})),r.d(t,"isIphone",(function(){return c.c})),r.d(t,"isAndroid",(function(){return c.a})),r.d(t,"isWindows",(function(){return c.e})),new i.a({checkers:[n.elementIdChecker,n.regToStringChecker,n.functionToStringChecker,n.depRegToStringChecker,n.dateToStringChecker,n.debuggerChecker]}));t.default=d},function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=this&&this.__awaiter||function(e,t,r,i){return new(r=r||n)((function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,i,n,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){var l=[o,s];if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&l[0]?i.return:l[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,l[1])).done)return n;switch(i=0,(l=n?[2&l[0],n.value]:l)[0]){case 0:case 1:n=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,i=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(n=0<(n=a.trys).length&&n[n.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!n||l[1]>n[0]&&l[1]<n[3]))a.label=l[1];else if(6===l[0]&&a.label<n[1])a.label=n[1],n=l;else{if(!(n&&a.label<n[2])){n[2]&&a.ops.pop(),a.trys.pop();continue}a.label=n[2],a.ops.push(l)}}l=t.call(e,a)}catch(s){l=[6,s],i=0}finally{r=n=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}},o=(s.prototype.launch=function(){this._detectLoopDelay<=0&&this.setDetectDelay(500),this._detectLoopStopped&&(this._detectLoopStopped=!1,this._detectLoop())},s.prototype.stop=function(){this._detectLoopStopped||(this._detectLoopStopped=!0,clearTimeout(this._timer))},s.prototype.isLaunch=function(){return!this._detectLoopStopped},s.prototype.setDetectDelay=function(e){this._detectLoopDelay=e},s.prototype.addListener=function(e){this._listeners.push(e)},s.prototype.removeListener=function(e){this._listeners=this._listeners.filter((function(t){return t!==e}))},s.prototype._broadcast=function(e){for(var t=0,r=this._listeners;t<r.length;t++){var i=r[t];try{i(e.isOpen,e)}catch(e){}}},s.prototype._detectLoop=function(){return i(this,void 0,void 0,(function(){var e,t,r,i,n,o=this;return a(this,(function(a){switch(a.label){case 0:e=!1,t="",r=0,i=this._checkers,a.label=1;case 1:return r<i.length?[4,(n=i[r]).isEnable()]:[3,6];case 2:return a.sent()?(t=n.name,[4,n.isOpen()]):[3,4];case 3:e=a.sent(),a.label=4;case 4:if(e)return[3,6];a.label=5;case 5:return r++,[3,1];case 6:return e!=this._isOpen&&(this._isOpen=e,this._broadcast({isOpen:e,checkerName:t})),0<this._detectLoopDelay?this._timer=setTimeout((function(){return o._detectLoop()}),this._detectLoopDelay):this.stop(),[2]}}))}))},s);function s(e){e=e.checkers,this._listeners=[],this._isOpen=!1,this._detectLoopStopped=!0,this._detectLoopDelay=500,this._checkers=e.slice()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(9),n=(r.d(t,"depRegToStringChecker",(function(){return i.a})),r(12)),a=(r.d(t,"elementIdChecker",(function(){return n.a})),r(13)),o=(r.d(t,"functionToStringChecker",(function(){return a.a})),r(14)),s=(r.d(t,"regToStringChecker",(function(){return o.a})),r(15)),l=(r.d(t,"debuggerChecker",(function(){return s.a})),r(16));r.d(t,"dateToStringChecker",(function(){return l.a}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var i=r(1),a=r(2),o=r(0),s=this&&this.__awaiter||function(e,t,r,i){return new(r=r||n)((function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))},l=this&&this.__generator||function(e,t){var r,i,n,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){var l=[o,s];if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&l[0]?i.return:l[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,l[1])).done)return n;switch(i=0,(l=n?[2&l[0],n.value]:l)[0]){case 0:case 1:n=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,i=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(n=0<(n=a.trys).length&&n[n.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!n||l[1]>n[0]&&l[1]<n[3]))a.label=l[1];else if(6===l[0]&&a.label<n[1])a.label=n[1],n=l;else{if(!(n&&a.label<n[2])){n[2]&&a.ops.pop(),a.trys.pop();continue}a.label=n[2],a.ops.push(l)}}l=t.call(e,a)}catch(s){l=[6,s],i=0}finally{r=n=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}},u=/ /,c=!1,d=(u.toString=function(){return c=!0,d.name},{name:"dep-reg-to-string",isOpen:function(){return s(this,void 0,void 0,(function(){return l(this,(function(e){return c=!1,Object(a.c)({dep:u}),Object(a.a)(),[2,c]}))}))},isEnable:function(){return s(this,void 0,void 0,(function(){return l(this,(function(e){return[2,Object(o.b)({includes:[!0],excludes:[i.c,i.d]})]}))}))}})},function(e,t){var r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==("undefined"===typeof window?"undefined":_typeof(window))&&(r=window)}e.exports=r},function(e,t,r){var i;void 0!==(t="function"==typeof(i=function(){var e=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function t(e){var t=e.replace(/^v/,"").replace(/\+.*$/,""),r=function(e,t){return-1===e.indexOf("-")?e.length:e.indexOf("-")}(t),i=t.substring(0,r).split(".");return i.push(t.substring(r+1)),i}function r(e){return isNaN(Number(e))?e:Number(e)}function i(t){if("string"!=typeof t)throw new TypeError("Invalid argument expected string");if(!e.test(t))throw new Error("Invalid argument not valid semver ('"+t+"' received)")}function n(e,n){[e,n].forEach(i);for(var a=t(e),o=t(n),s=0;s<Math.max(a.length-1,o.length-1);s++){var l=parseInt(a[s]||0,10),u=parseInt(o[s]||0,10);if(l>u)return 1;if(u>l)return-1}var c=a[a.length-1],d=o[o.length-1];if(c&&d){var h=c.split(".").map(r),f=d.split(".").map(r);for(s=0;s<Math.max(h.length,f.length);s++){if(void 0===h[s]||"string"==typeof f[s]&&"number"==typeof h[s])return-1;if(void 0===f[s]||"string"==typeof h[s]&&"number"==typeof f[s])return 1;if(h[s]>f[s])return 1;if(f[s]>h[s])return-1}}else if(c||d)return c?-1:1;return 0}var a=[">",">=","=","<","<="],o={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};return n.validate=function(t){return"string"==typeof t&&e.test(t)},n.compare=function(e,t,r){!function(e){if("string"!=typeof e)throw new TypeError("Invalid operator type, expected string but got "+_typeof(e));if(-1===a.indexOf(e))throw new TypeError("Invalid operator, expected one of "+a.join("|"))}(r);var i=n(e,t);return o[r].indexOf(i)>-1},n})?i.apply(t,[]):i)&&(e.exports=t)},function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var i=r(1),a=r(2),o=r(0),s=(t=r(3),this&&this.__awaiter||function(e,t,r,i){return new(r=r||n)((function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))}),l=this&&this.__generator||function(e,t){var r,i,n,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){var l=[o,s];if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&l[0]?i.return:l[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,l[1])).done)return n;switch(i=0,(l=n?[2&l[0],n.value]:l)[0]){case 0:case 1:n=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,i=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(n=0<(n=a.trys).length&&n[n.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!n||l[1]>n[0]&&l[1]<n[3]))a.label=l[1];else if(6===l[0]&&a.label<n[1])a.label=n[1],n=l;else{if(!(n&&a.label<n[2])){n[2]&&a.ops.pop(),a.trys.pop();continue}a.label=n[2],a.ops.push(l)}}l=t.call(e,a)}catch(s){l=[6,s],i=0}finally{r=n=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}},u=Object(t.a)("div"),c=!1,d=(Object.defineProperty(u,"id",{get:function(){return c=!0,d.name},configurable:!0}),{name:"element-id",isOpen:function(){return s(this,void 0,void 0,(function(){return l(this,(function(e){return c=!1,Object(a.b)(u),Object(a.a)(),[2,c]}))}))},isEnable:function(){return s(this,void 0,void 0,(function(){return l(this,(function(e){return[2,Object(o.b)({includes:[!0],excludes:[i.d,i.b,i.c]})]}))}))}})},function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var i=r(1),a=r(2),o=r(5),s=r(0),l=this&&this.__awaiter||function(e,t,r,i){return new(r=r||n)((function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))},u=this&&this.__generator||function(e,t){var r,i,n,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){var l=[o,s];if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&l[0]?i.return:l[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,l[1])).done)return n;switch(i=0,(l=n?[2&l[0],n.value]:l)[0]){case 0:case 1:n=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,i=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(n=0<(n=a.trys).length&&n[n.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!n||l[1]>n[0]&&l[1]<n[3]))a.label=l[1];else if(6===l[0]&&a.label<n[1])a.label=n[1],n=l;else{if(!(n&&a.label<n[2])){n[2]&&a.ops.pop(),a.trys.pop();continue}a.label=n[2],a.ops.push(l)}}l=t.call(e,a)}catch(s){l=[6,s],i=0}finally{r=n=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}};function c(){}var d=0,h=(c.toString=function(){return d++,""},{name:"function-to-string",isOpen:function(){return l(this,void 0,void 0,(function(){return u(this,(function(e){return d=0,Object(a.b)(c),Object(a.a)(),[2,2===d]}))}))},isEnable:function(){return l(this,void 0,void 0,(function(){return u(this,(function(e){return[2,Object(s.b)({includes:[!0],excludes:[i.c,(o.b||o.c)&&i.a]})]}))}))}})},function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var i=r(2),a=r(1),o=r(0),s=this&&this.__awaiter||function(e,t,r,i){return new(r=r||n)((function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))},l=this&&this.__generator||function(e,t){var r,i,n,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){var l=[o,s];if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&l[0]?i.return:l[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,l[1])).done)return n;switch(i=0,(l=n?[2&l[0],n.value]:l)[0]){case 0:case 1:n=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,i=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(n=0<(n=a.trys).length&&n[n.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!n||l[1]>n[0]&&l[1]<n[3]))a.label=l[1];else if(6===l[0]&&a.label<n[1])a.label=n[1],n=l;else{if(!(n&&a.label<n[2])){n[2]&&a.ops.pop(),a.trys.pop();continue}a.label=n[2],a.ops.push(l)}}l=t.call(e,a)}catch(s){l=[6,s],i=0}finally{r=n=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}},u=/ /,c=!1,d=(u.toString=function(){return c=!0,d.name},{name:"reg-to-string",isOpen:function(){return s(this,void 0,void 0,(function(){return l(this,(function(e){return c=!1,Object(i.b)(u),Object(i.a)(),[2,c]}))}))},isEnable:function(){return s(this,void 0,void 0,(function(){return l(this,(function(e){return[2,Object(o.b)({includes:[!0],excludes:[a.f]})]}))}))}})},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=this&&this.__awaiter||function(e,t,r,i){return new(r=r||n)((function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,i,n,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){var l=[o,s];if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&l[0]?i.return:l[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,l[1])).done)return n;switch(i=0,(l=n?[2&l[0],n.value]:l)[0]){case 0:case 1:n=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,i=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(n=0<(n=a.trys).length&&n[n.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!n||l[1]>n[0]&&l[1]<n[3]))a.label=l[1];else if(6===l[0]&&a.label<n[1])a.label=n[1],n=l;else{if(!(n&&a.label<n[2])){n[2]&&a.ops.pop(),a.trys.pop();continue}a.label=n[2],a.ops.push(l)}}l=t.call(e,a)}catch(s){l=[6,s],i=0}finally{r=n=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}};function o(){return(performance||Date).now()}var s={name:"debugger-checker",isOpen:function(){return i(this,void 0,void 0,(function(){var e;return a(this,(function(t){return e=o(),function(){}.constructor("debugger")(),[2,100<o()-e]}))}))},isEnable:function(){return i(this,void 0,void 0,(function(){return a(this,(function(e){return[2,!0]}))}))}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var i=r(1),a=r(2),o=r(0),s=this&&this.__awaiter||function(e,t,r,i){return new(r=r||n)((function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))},l=this&&this.__generator||function(e,t){var r,i,n,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){var l=[o,s];if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&l[0]?i.return:l[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,l[1])).done)return n;switch(i=0,(l=n?[2&l[0],n.value]:l)[0]){case 0:case 1:n=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,i=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(n=0<(n=a.trys).length&&n[n.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!n||l[1]>n[0]&&l[1]<n[3]))a.label=l[1];else if(6===l[0]&&a.label<n[1])a.label=n[1],n=l;else{if(!(n&&a.label<n[2])){n[2]&&a.ops.pop(),a.trys.pop();continue}a.label=n[2],a.ops.push(l)}}l=t.call(e,a)}catch(s){l=[6,s],i=0}finally{r=n=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}},u=new Date,c=0,d=(u.toString=function(){return c++,""},{name:"date-to-string",isOpen:function(){return s(this,void 0,void 0,(function(){return l(this,(function(e){return c=0,Object(a.b)(u),Object(a.a)(),[2,2===c]}))}))},isEnable:function(){return s(this,void 0,void 0,(function(){return l(this,(function(e){return[2,Object(o.b)({includes:[i.a],excludes:[]})]}))}))}})},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));t=r(3);var i=/mobile/i.test(t.b)}],r={},e.m=t,e.c=r,e.d=function(t,r,i){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="",e(e.s=6);function e(i){var n;return(r[i]||(n=r[i]={i:i,l:!1,exports:{}},t[i].call(n.exports,n,n.exports,e),n.l=!0,n)).exports}var t,r},"object"==_typeof(r)&&"object"==_typeof(t)?t.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==_typeof(r)?r.devtoolsDetector=i():e.devtoolsDetector=i()},{"es6-promise":8}],32:[function(e,t,r){var i=e("./object");t.exports.el=function(e){return document.getElementById(e)},t.exports.createEl=function(e,t){var r;return e=e||"div",t=t||{},r=document.createElement(e),i.each(t,(function(e,t){-1!==e.indexOf("aria-")||"role"==e?r.setAttribute(e,t):r[e]=t})),r},t.exports.addClass=function(e,t){-1==(" "+e.className+" ").indexOf(" "+t+" ")&&(e.className=""===e.className?t:e.className+" "+t)},t.exports.removeClass=function(e,t){var r,i;if(-1!=e.className.indexOf(t)){for(i=(r=e.className.split(" ")).length-1;0<=i;i--)r[i]===t&&r.splice(i,1);e.className=r.join(" ")}},t.exports.hasClass=function(e,t){return-1!=e.className.indexOf(t)},t.exports.getClasses=function(e){return e.className?e.className.split(" "):[]},t.exports.getElementAttributes=function(e){var t,r,i={};if(e&&e.attributes&&0<e.attributes.length)for(var n,a=(n=e.attributes).length-1;0<=a;a--)t=n[a].name,r=n[a].value,"boolean"!=typeof e[t]&&-1===",autoplay,controls,loop,muted,default,".indexOf(","+t+",")||(r=null!==r),i[t]=r;return i},t.exports.insertFirst=function(e,t){t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)},t.exports.blockTextSelection=function(){document.body.focus(),document.onselectstart=function(){return!1}},t.exports.unblockTextSelection=function(){document.onselectstart=function(){return!0}},t.exports.css=function(e,t,r){return!(!e||!e.style)&&(t&&r?(e.style[t]=r,!0):r||"string"!=typeof t?!r&&"object"==_typeof(t)&&(i.each(t,(function(t,r){e.style[t]=r})),!0):e.style[t])},t.exports.getTransformName=function(e){for(var t=["transform","WebkitTransform","MozTransform","msTransform","OTransform"],r=t[0],i=0,n=t.length;i<n;i++)if(void 0!==e.style[t[i]]){r=t[i];break}return r},t.exports.getTransformEventName=function(e,t){for(var r=["","Webkit","Moz","ms","O"],i=t.toLowerCase(),n=["transform","WebkitTransform","MozTransform","msTransform","OTransform"],a=0,o=n.length;a<o;a++)if(void 0!==e.style[n[a]]){0!=a&&(i=r[a]+t);break}return i},t.exports.addCssByStyle=function(e){var t=document,r=t.createElement("style");r.setAttribute("type","text/css"),r.styleSheet?r.styleSheet.cssText=e:(e=t.createTextNode(e),r.appendChild(e)),e=t.getElementsByTagName("head");(e.length?e[0]:t.documentElement).appendChild(r)},t.exports.getTranslateX=function(e){var r=0;if(e)try{var i=window.getComputedStyle(e),n=t.exports.getTransformName(e);r=new(window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix)(i[n]).m41}catch(e){console.log(e)}return r},t.exports.getPointerPosition=function(e,r){var i={},n=t.exports.findPosition(e),a=e.offsetWidth,o=(e=e.offsetHeight,n.top),s=(n=n.left,r.pageY),l=r.pageX;return r.changedTouches&&(l=r.changedTouches[0].pageX,s=r.changedTouches[0].pageY),i.y=Math.max(0,Math.min(1,(o-s+e)/e)),i.x=Math.max(0,Math.min(1,(l-n)/a)),i},t.exports.findPosition=function(e){var t,r,i,n;return(t=e.getBoundingClientRect&&e.parentNode?e.getBoundingClientRect():t)?(e=document.documentElement,n=document.body,i=e.clientLeft||n.clientLeft||0,r=window.pageXOffset||n.scrollLeft,r=t.left+r-i,i=e.clientTop||n.clientTop||0,e=window.pageYOffset||n.scrollTop,n=t.top+e-i,{left:Math.round(r),top:Math.round(n)}):{left:0,top:0}}},{"./object":42}],33:[function(e,t,r){var i=e("./object"),n=e("./data"),a=e("./ua"),o=e("./fastclick");function s(e,t,r,n){i.each(r,(function(r){e(t,r,n)}))}t.exports.on=function(e,r,l){if(e){if(i.isArray(r))return s(t.exports.on,e,r,l);a.IS_MOBILE&&"click"==r&&o.attach(e);var u=n.getData(e);u.handlers||(u.handlers={}),u.handlers[r]||(u.handlers[r]=[]),l.guid||(l.guid=n.guid()),u.handlers[r].push(l),u.dispatcher||(u.disabled=!1,u.dispatcher=function(r){if(!u.disabled){r=t.exports.fixEvent(r);var i=u.handlers[r.type];if(i)for(var n=i.slice(0),a=0,o=n.length;a<o&&!r.isImmediatePropagationStopped();a++)n[a].call(e,r)}}),1==u.handlers[r].length&&(e.addEventListener?e.addEventListener(r,u.dispatcher,!1):e.attachEvent&&e.attachEvent("on"+r,u.dispatcher))}},t.exports.off=function(e,r,a){if(e&&n.hasData(e)){var o=n.getData(e);if(o.handlers){var l=function(r){o.handlers[r]=[],t.exports.cleanUpEvents(e,r)};if(i.isArray(r))return s(t.exports.off,e,r,a);if(r){var u=o.handlers[r];if(u)if(a){if(a.guid)for(var c=0;c<u.length;c++)u[c].guid===a.guid&&u.splice(c--,1);t.exports.cleanUpEvents(e,r)}else l(r)}else for(var d in o.handlers)l(d)}}},t.exports.cleanUpEvents=function(e,t){var r=n.getData(e);0===r.handlers[t].length&&(delete r.handlers[t],e.removeEventListener?e.removeEventListener(t,r.dispatcher,!1):e.detachEvent&&e.detachEvent("on"+t,r.dispatcher)),i.isEmpty(r.handlers)&&(delete r.handlers,delete r.dispatcher,delete r.disabled),i.isEmpty(r)&&n.removeData(e)},t.exports.fixEvent=function(e){function t(){return!0}function r(){return!1}if(!e||!e.isPropagationStopped){var i,n,a,o=e||window.event;for(i in e={},o)"layerX"===i||"layerY"===i||"keyboardEvent.keyLocation"===i||"returnValue"==i&&o.preventDefault||(e[i]=o[i]);e.target||(e.target=e.srcElement||document),e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement,e.preventDefault=function(){o.preventDefault&&o.preventDefault(),e.returnValue=!1,e.isDefaultPrevented=t,e.defaultPrevented=!0},e.isDefaultPrevented=r,e.defaultPrevented=!1,e.stopPropagation=function(){o.stopPropagation&&o.stopPropagation(),e.cancelBubble=!0,e.isPropagationStopped=t},e.isPropagationStopped=r,e.stopImmediatePropagation=function(){o.stopImmediatePropagation&&o.stopImmediatePropagation(),e.isImmediatePropagationStopped=t,e.stopPropagation()},e.isImmediatePropagationStopped=r,null!=e.clientX&&(n=document.documentElement,a=document.body,e.pageX=e.clientX+(n&&n.scrollLeft||a&&a.scrollLeft||0)-(n&&n.clientLeft||a&&a.clientLeft||0),e.pageY=e.clientY+(n&&n.scrollTop||a&&a.scrollTop||0)-(n&&n.clientTop||a&&a.clientTop||0)),e.which=e.charCode||e.keyCode,null!=e.button&&(e.button=1&e.button?0:4&e.button?1:2&e.button?2:0)}return e},t.exports.trigger=function(e,r){var i,a,o;if(e)return i=n.hasData(e)?n.getData(e):{},a=e.parentNode||e.ownerDocument,"string"==typeof r&&(o=null,!e.paramData&&0!=e.paramData||(o=e.paramData,e.paramData=null,e.removeAttribute(o)),r={type:r,target:e,paramData:o}),r=t.exports.fixEvent(r),i.dispatcher&&i.dispatcher.call(e,r),a&&!r.isPropagationStopped()&&!1!==r.bubbles?t.exports.trigger(a,r):a||r.defaultPrevented||(o=n.getData(r.target),r.target[r.type]&&(o.disabled=!0,"function"==typeof r.target[r.type]&&r.target[r.type](),o.disabled=!1)),!r.defaultPrevented},t.exports.one=function(e,r,a){if(e){var o=function i(){t.exports.off(e,r,i),a.apply(this,arguments)};if(i.isArray(r))return s(t.exports.one,e,r,a);o.guid=a.guid=a.guid||n.guid(),t.exports.on(e,r,o)}}},{"./data":30,"./fastclick":34,"./object":42,"./ua":49}],34:[function(e,t,r){function i(e,t){var r;if(t=t||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=t.touchBoundary||10,this.layer=e,this.tapDelay=t.tapDelay||200,this.tapTimeout=t.tapTimeout||700,!i.notNeeded(e)){for(var n=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],o=0,s=n.length;o<s;o++)this[n[o]]=function(e,t){return function(){return e.apply(t,arguments)}}(this[n[o]],this);a&&(e.addEventListener("mouseover",this.onMouse,!0),e.addEventListener("mousedown",this.onMouse,!0),e.addEventListener("mouseup",this.onMouse,!0)),e.addEventListener("click",this.onClick,!0),e.addEventListener("touchstart",this.onTouchStart,!1),e.addEventListener("touchmove",this.onTouchMove,!1),e.addEventListener("touchend",this.onTouchEnd,!1),e.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(e.removeEventListener=function(t,r,i){var n=Node.prototype.removeEventListener;"click"===t?n.call(e,t,r.hijacked||r,i):n.call(e,t,r,i)},e.addEventListener=function(t,r,i){var n=Node.prototype.addEventListener;"click"===t?n.call(e,t,r.hijacked||(r.hijacked=function(e){e.propagationStopped||r(e)}),i):n.call(e,t,r,i)}),"function"==typeof e.onclick&&(r=e.onclick,e.addEventListener("click",(function(e){r(e)}),!1),e.onclick=null)}}var n=0<=navigator.userAgent.indexOf("Windows Phone"),a=0<navigator.userAgent.indexOf("Android")&&!n,o=/iP(ad|hone|od)/.test(navigator.userAgent)&&!n,s=o&&/OS 4_\d(_\d)?/.test(navigator.userAgent),l=o&&/OS [6-7]_\d/.test(navigator.userAgent),u=0<navigator.userAgent.indexOf("BB10");i.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(o&&"file"===e.type||e.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(e.className)},i.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!a;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},i.prototype.sendClick=function(e,t){var r;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),t=t.changedTouches[0],(r=document.createEvent("MouseEvents")).initMouseEvent(this.determineEventType(e),!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),r.forwardedTouchEvent=!0,e.dispatchEvent(r)},i.prototype.determineEventType=function(e){return a&&"select"===e.tagName.toLowerCase()?"mousedown":"click"},i.prototype.focus=function(e){var t;o&&e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type&&"month"!==e.type&&"email"!==e.type?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},i.prototype.updateScrollParent=function(e){var t,r=e.fastClickScrollParent;if(!r||!r.contains(e)){t=e;do{if(t.scrollHeight>t.offsetHeight){r=t,e.fastClickScrollParent=t;break}}while(t=t.parentElement)}r&&(r.fastClickLastScrollTop=r.scrollTop)},i.prototype.getTargetElementFromEventTarget=function(e){return e.nodeType===Node.TEXT_NODE?e.parentNode:e},i.prototype.onTouchStart=function(e){var t,r,i;if(!(1<e.targetTouches.length)){if(t=this.getTargetElementFromEventTarget(e.target),r=e.targetTouches[0],o){if((i=window.getSelection()).rangeCount&&!i.isCollapsed)return!0;if(!s){if(r.identifier&&r.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=r.identifier,this.updateScrollParent(t)}}this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=r.pageX,this.touchStartY=r.pageY,e.timeStamp-this.lastClickTime<this.tapDelay&&e.preventDefault()}return!0},i.prototype.touchHasMoved=function(e){e=e.changedTouches[0];var t=this.touchBoundary;return Math.abs(e.pageX-this.touchStartX)>t||Math.abs(e.pageY-this.touchStartY)>t},i.prototype.onTouchMove=function(e){return this.trackingClick&&(this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))&&(this.trackingClick=!1,this.targetElement=null),!0},i.prototype.findControl=function(e){return void 0!==e.control?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},i.prototype.onTouchEnd=function(e){var t,r,i,n=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0;if(e.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,t=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,l&&(i=e.changedTouches[0],(n=document.elementFromPoint(i.pageX-window.pageXOffset,i.pageY-window.pageYOffset)||n).fastClickScrollParent=this.targetElement.fastClickScrollParent),"label"===(i=n.tagName.toLowerCase())){if(r=this.findControl(n)){if(this.focus(n),a)return!1;n=r}}else if(this.needsFocus(n))return 100<e.timeStamp-t||o&&window.top!==window&&"input"===i?this.targetElement=null:(this.focus(n),this.sendClick(n,e),o&&"select"===i||(this.targetElement=null,e.preventDefault())),!1;return!(!o||s||!(r=n.fastClickScrollParent)||r.fastClickLastScrollTop===r.scrollTop)||(this.needsClick(n)||(e.preventDefault(),this.sendClick(n,e)),!1)},i.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},i.prototype.onMouse=function(e){return!this.targetElement||!(!e.forwardedTouchEvent&&e.cancelable&&(!this.needsClick(this.targetElement)||this.cancelNextClick)&&(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),1))},i.prototype.onClick=function(e){return this.trackingClick?(this.targetElement=null,!(this.trackingClick=!1)):"submit"===e.target.type&&0===e.detail||((e=this.onMouse(e))||(this.targetElement=null),e)},i.prototype.destroy=function(){var e=this.layer;a&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},i.notNeeded=function(e){var t,r;if(void 0===window.ontouchstart)return!0;if(r=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!a)return!0;if(t=document.querySelector("meta[name=viewport]")){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(31<r&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(u&&10<=(r=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/))[1]&&3<=r[2]&&(t=document.querySelector("meta[name=viewport]"))){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===e.style.msTouchAction||"manipulation"===e.style.touchAction||!!(27<=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]&&(t=document.querySelector("meta[name=viewport]"))&&(-1!==t.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))||"none"===e.style.touchAction||"manipulation"===e.style.touchAction},i.attach=function(e,t){return new i(e,t)},t.exports=i},{}],35:[function(e,t,r){var i=e("./data");t.exports.bind=function(e,t,r){function n(){return t.apply(e,arguments)}return t.guid||(t.guid=i.guid()),n.guid=r?r+"_"+t.guid:t.guid,n}},{"./data":30}],36:[function(e,t,r){function i(){"use strict";i=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(t){u=function(e,t,r){return e[t]=r}}function c(e,t,r,i){var a,o,s,l;t=t&&t.prototype instanceof f?t:f,t=Object.create(t.prototype),i=new S(i||[]);return n(t,"_invoke",{value:(a=e,o=r,s=i,l="suspendedStart",function(e,t){if("executing"===l)throw new Error("Generator is already running");if("completed"===l){if("throw"===e)throw t;return k()}for(s.method=e,s.arg=t;;){var r=s.delegate;if(r&&(r=function e(t,r){var i=t.iterator[r.method];if(void 0===i){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method))return h;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}return i=d(i,t.iterator,r.arg),"throw"===i.type?(r.method="throw",r.arg=i.arg,r.delegate=null,h):(i=i.arg,i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h))}(r,s),r)){if(r===h)continue;return r}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if("suspendedStart"===l)throw l="completed",s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);if(l="executing",r=d(a,o,s),"normal"===r.type){if(l=s.done?"completed":"suspendedYield",r.arg===h)continue;return{value:r.arg,done:s.done}}"throw"===r.type&&(l="completed",s.method="throw",s.arg=r.arg)}})}),t}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var h={};function f(){}function p(){}function g(){}a={};var v=(u(a,o,(function(){return this})),Object.getPrototypeOf),y=(v=v&&v(v(E([]))),v&&v!==t&&r.call(v,o)&&(a=v),g.prototype=f.prototype=Object.create(a));function m(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){var i;n(this,"_invoke",{value:function(n,a){function o(){return new t((function(i,o){!function i(n,a,o,s){var l;n=d(e[n],e,a);if("throw"!==n.type)return(a=(l=n.arg).value)&&"object"==_typeof(a)&&r.call(a,"__await")?t.resolve(a.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(a).then((function(e){l.value=e,o(l)}),(function(e){return i("throw",e,o,s)}));s(n.arg)}(n,a,i,o)}))}return i=i?i.then(o,o):o()}})}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function E(e){if(e){var t,i=e[o];if(i)return i.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return t=-1,(i=function i(){for(;++t<e.length;)if(r.call(e,t))return i.value=e[t],i.done=!1,i;return i.value=void 0,i.done=!0,i}).next=i}return{next:k}}function k(){return{value:void 0,done:!0}}return n(y,"constructor",{value:p.prototype=g,configurable:!0}),n(g,"constructor",{value:p,configurable:!0}),p.displayName=u(g,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){return e="function"==typeof e&&e.constructor,!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,u(e,l,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},m(_.prototype),u(_.prototype,s,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,i,n,a){void 0===a&&(a=Promise);var o=new _(c(t,r,i,n),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},m(y),u(y,l,"Generator"),u(y,o,(function(){return this})),u(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t,r=Object(e),i=[];for(t in r)i.push(t);return i.reverse(),function e(){for(;i.length;){var t=i.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},e.values=E,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(r,i){return o.type="throw",o.arg=e,t.next=r,i&&(t.method="next",t.arg=void 0),!!i}for(var n=this.tryEntries.length-1;0<=n;--n){var a=this.tryEntries[n],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;0<=i;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}var o=(a=a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc?null:a)?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,i,n=this.tryEntries[t];if(n.tryLoc===e)return"throw"===(r=n.completion).type&&(i=r.arg,T(n)),i}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:E(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function n(e,t,r,i,n,a,o){try{var s=e[a](o),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(i,n)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(i,a){var o=e.apply(t,r);function s(e){n(o,i,a,s,l,"next",e)}function l(e){n(o,i,a,s,l,"throw",e)}s(void 0)}))}}var o,s="undefined"==typeof Promise?e("es6-promise").Promise:Promise;e=self,o=function(){"use strict";function e(e,t,r,i){void 0===t&&(t=!1),void 0===r&&(r="");var n=performance.now(),a=i;return new s((function(i){o=e,void 0===(s=t?100:0)&&(s=100),(l=document.createElement("video")).setAttribute("width",""+s),l.setAttribute("height",""+s),l.setAttribute("muted","muted"),l.setAttribute("crossorigin","anonymous"),l.setAttribute("preload","preload"),l.setAttribute("autoplay","autoplay"),l.setAttribute("webkit-playsinline","webkit-playsinline"),l.setAttribute("playsinline","playsinline"),l.setAttribute("x-webkit-airplay","x-webkit-airplay"),l.setAttribute("playsinline","playsinline"),l.src=o;var o,s,l,u=l,c=setInterval((function(){var e,o,s,l,d;(performance.now()-n>a||0!==u.videoWidth)&&(clearInterval(c),e=0!==u.videoWidth,t?(u.setAttribute("controls","controls"),o=u,void 0===(s=r)&&(s=""),l=document.createElement("dv"),(d=document.createElement("h3")).innerText=s,l.appendChild(o),l.appendChild(d),document.body.appendChild(l)):(u.pause(),u=null),i(e))}))}))}var t={d:function(e,r){for(var i in r)t.o(r,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:r[i]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},r={},n=(t.d(r,{default:function(){return f}}),navigator.userAgent),o=/qqbrowser/i.test(n.toLowerCase()),l=/Edge/i.test(n),u=(l=/Chrome/i.test(n)&&!l&&!o,/Safari/i.test(n)&&!l),c=(o=n.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/),l=o&&o[1],l&&Number(l.split(".")[0])),d=function(){var e=a(i().mark((function e(t){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return r=e.sent,e.next=5,r.blob();case 5:return r=e.sent,e.abrupt("return",URL.createObjectURL(r));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h={includeSystemHijack:!0,showVideo:!1,codecTags:["hev1","hvc1"],timeout:2e3},f=function(t){return void 0===t&&(t={}),new s(function(){var r=a(i().mark((function r(n){var a,o,s,l,f,p,g,v,y,m,_;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=Object.assign({},h,t),a=s.includeSystemHijack,o=s.showVideo,p=s.codecTags,s=s.timeout,l=performance.now(),f=-1<p.indexOf("hvc1"),p=-1<p.indexOf("hev1"),g="https://ice-pub-media.myalicdn.com/vod-demo/hevc/01s_20x20_hvc1.mp4",m=y=!(v="https://ice-pub-media.myalicdn.com/vod-demo/hevc/01s_20x20_hev1.mp4"),!(u&&c&&11<=c)){r.next=13;break}if(r.t0=a,r.t0){r.next=8;break}return r.next=7,d(g);case 7:g=r.sent;case 8:return r.next=10,e(g,o,"hvc1",s);case 10:y=r.sent,r.next=33;break;case 13:if(r.t1=f,!r.t1){r.next=23;break}if(r.t2=a,r.t2){r.next=20;break}return r.next=19,d(g);case 19:g=r.sent;case 20:return r.next=22,e(g,o,"hvc1",s);case 22:y=r.sent;case 23:if(r.t3=p,!r.t3){r.next=33;break}if(r.t4=a,r.t4){r.next=30;break}return r.next=29,d(v);case 29:v=r.sent;case 30:return r.next=32,e(v,o,"hev1",s);case 32:m=r.sent;case 33:_=performance.now(),n({isHvc1Supported:y,isHev1Supported:m,time:Math.ceil(_-l)});case 35:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())};return r.default},"object"==_typeof(r)&&"object"==_typeof(t)?t.exports=o():"function"==typeof define&&define.amd?define([],o):"object"==_typeof(r)?r.hevcDetector=o():e.hevcDetector=o()},{"es6-promise":8}],37:[function(e,t,r){var i=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,n=/^([^\/;?#]*)(.*)$/,a=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,s={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var i=s.parseURL(e);if(i)return i.path=s.normalizePath(i.path),s.buildURLFromParts(i);throw new Error("Error trying to parse base URL.")}if(i=s.parseURL(t),!i)throw new Error("Error trying to parse relative URL.");if(i.scheme)return r.alwaysNormalize?(i.path=s.normalizePath(i.path),s.buildURLFromParts(i)):t;if(t=s.parseURL(e),!t)throw new Error("Error trying to parse base URL.");!t.netLoc&&t.path&&"/"!==t.path[0]&&(e=n.exec(t.path),t.netLoc=e[1],t.path=e[2]),t.netLoc&&!t.path&&(t.path="/");var a;e={scheme:t.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment};return i.netLoc||(e.netLoc=t.netLoc,"/"!==i.path[0]&&(i.path?(a=(a=t.path).substring(0,a.lastIndexOf("/")+1)+i.path,e.path=s.normalizePath(a)):(e.path=t.path,i.params||(e.params=t.params,i.query)||(e.query=t.query)))),null===e.path&&(e.path=r.alwaysNormalize?s.normalizePath(i.path):i.path),s.buildURLFromParts(e)},parseURL:function(e){return e=i.exec(e),e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(a,"");e.length!==(e=e.replace(o,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};t.exports=s},{}],38:[function(e,t,r){function i(e){for(var t in e="string"==typeof e?this.parseAttrList(e):e)e.hasOwnProperty(t)&&(this[t]=e[t])}var n=/^(\d+)x(\d+)$/,a=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g;i.prototype={decimalInteger:function(e){return e=parseInt(this[e],10),e>Number.MAX_SAFE_INTEGER?1/0:e},hexadecimalInteger:function(e){if(this[e]){for(var t=(1&(t=(this[e]||"0x").slice(2)).length?"0":"")+t,r=new Uint8Array(t.length/2),i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(2*i,2*i+2),16);return r}return null},hexadecimalIntegerAsNumber:function(e){return e=parseInt(this[e],16),e>Number.MAX_SAFE_INTEGER?1/0:e},decimalFloatingPoint:function(e){return parseFloat(this[e])},enumeratedString:function(e){return this[e]},decimalResolution:function(e){if(e=n.exec(this[e]),null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},parseAttrList:function(e){var t,r={};for(a.lastIndex=0;null!==(t=a.exec(e));){var i=t[2];0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[t[1]]=i}return r}},t.exports=i},{}],39:[function(e,t,r){function i(){this.method=null,this.key=null,this.iv=null,this._uri=null}function n(){this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}function a(){this.loaders={}}var o=e("../constants"),s=e("../playerutil"),l=e("./attrlist"),u=e("../io"),c=e("./URLToolkit"),d=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,h=/#EXT-X-MEDIA:(.*)/g,f=new RegExp([/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),p=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(PART-INF):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,g="RegionBlock";n.prototype.getUrl=function(){return!this._url&&this.relurl&&(this._url=c.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},n.prototype.Seturl=function(e){this._url=e},n.prototype.getProgramDateTime=function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime},n.prototype.GetbyteRange=function(){var e,t,r;return this._byteRange||(e=this._byteRange=[],this.rawByteRange&&(1===(t=this.rawByteRange.split("@",2)).length?(r=this.lastByteRangeEndOffset,e[0]=r||0):e[0]=parseInt(t[1]),e[1]=parseInt(t[0])+e[0])),this._byteRange},n.prototype.getByteRangeStartOffset=function(){return this.byteRange[0]},n.prototype.getByteRangeEndOffset=function(){return this.byteRange[1]},n.prototype.getDecryptdata=function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata},a.prototype=((e={parseMasterPlaylist:function(e,t){var r=[];for(d.lastIndex=0;null!=(a=d.exec(e));){var i={},n=i.attrs=new l(a[1]),a=(i.url=this.resolve(a[2],t),n.decimalResolution("RESOLUTION"));if(a&&(i.width=a.width,i.height=a.height),i.bitrate=n.decimalInteger("AVERAGE-BANDWIDTH")||n.decimalInteger("BANDWIDTH"),i.name=n.NAME,o=n.CODECS)for(var o=o.split(/[ ,]+/),s=0;s<o.length;s++){var u=o[s];-1!==u.indexOf("avc1")?i.videoCodec=this.avc1toavcoti(u):-1!==u.indexOf("hvc1")?i.videoCodec=u:i.audioCodec=u}r.push(i)}return r},parseMasterPlaylistMedia:function(e,t,r,i){var n=[],a=0;for(h.lastIndex=0;null!=(s=h.exec(e));){var o={},s=new l(s[1]);s.TYPE===r&&(o.groupId=s["GROUP-ID"],o.name=s.NAME,o.type=r,o.default="YES"===s.DEFAULT,o.autoselect="YES"===s.AUTOSELECT,o.forced="YES"===s.FORCED,s.URI&&(o.url=this.resolve(s.URI,t)),o.lang=s.LANGUAGE,o.name||(o.name=o.lang),i&&(o.audioCodec=i),o.id=a++,n.push(o))}return n},avc1toavcoti:function(e){var t=e.split("."),r=2<t.length?(r=t.shift()+".",(r+=parseInt(t.shift()).toString(16))+("000"+parseInt(t.shift()).toString(16)).substr(-4)):e;return r},load:function(e,t,r){var i=this;u.get(e,(function(r){var n,a,o,s=i.parseMasterPlaylist(r,e);s.length&&(n=i.parseMasterPlaylistMedia(r,e,"AUDIO",s[0].audioCodec),a=i.parseMasterPlaylistMedia(r,e,"SUBTITLES"),n.length)&&(o=!1,n.forEach((function(e){e.url||(o=!0)})),!1===o)&&s[0].audioCodec&&!s[0].attrs.AUDIO&&(console.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),n.unshift({type:"main",name:"main"})),t({levels:s,audioTracks:n,subtitles:a,url:e,string:r})}),(function(e,t,i){r&&((i=s.parseHttpHeaders(i)["x-tengine-error"])&&-1<o.RegionBlockMessages.indexOf(i)&&(e=g),r(e,t))}))},loadMediaPlaylist:function(e,t,r){var i=this,n=(e=e||{}).string,a=e.url;n?(e=i.parseLevelPlaylist(n,a),t(e)):u.get(a,(function(e){e=i.parseLevelPlaylist(e,a),t(e)}),(function(e){r&&r(e)}))},resolve:function(e,t){return c.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}}).parseMasterPlaylist=function(e,t){var r=[];for(d.lastIndex=0;null!=(a=d.exec(e));){var i={},n=i.attrs=new l(a[1]),a=(i.url=this.resolve(a[2],t),n.decimalResolution("RESOLUTION"));if(a&&(i.width=a.width,i.height=a.height),i.bitrate=n.decimalInteger("AVERAGE-BANDWIDTH")||n.decimalInteger("BANDWIDTH"),i.name=n.NAME,o=n.CODECS)for(var o=o.split(/[ ,]+/),s=0;s<o.length;s++){var u=o[s];-1!==u.indexOf("avc1")?i.videoCodec=this.avc1toavcoti(u):-1!==u.indexOf("hvc1")?i.videoCodec=u:i.audioCodec=u}r.push(i)}return r},e.parseMasterPlaylistMedia=function(e,t,r,i){var n=[],a=0;for(h.lastIndex=0;null!=(s=h.exec(e));){var o={},s=new l(s[1]);s.TYPE===r&&(o.groupId=s["GROUP-ID"],o.name=s.NAME,o.type=r,o.default="YES"===s.DEFAULT,o.autoselect="YES"===s.AUTOSELECT,o.forced="YES"===s.FORCED,s.URI&&(o.url=this.resolve(s.URI,t)),o.lang=s.LANGUAGE,o.name||(o.name=o.lang),i&&(o.audioCodec=i),o.id=a++,n.push(o))}return n},e.avc1toavcoti=function(e){var t=e.split("."),r=2<t.length?(r=t.shift()+".",(r+=parseInt(t.shift()).toString(16))+("000"+parseInt(t.shift()).toString(16)).substr(-4)):e;return r},e.parseLevelPlaylist=function(e,t,r,a){var o,s,u=0,c=0,d={type:null,version:null,url:t,fragments:[],live:!0,startSN:0},h=new i,g=0,v=null,y=new n;for(f.lastIndex=0;null!==(o=f.exec(e));){var m=o[1];if(m){y.duration=parseFloat(m);var _=(" "+o[2]).slice(1);y.title=_||null,y.tagList.push(_?["INF",m,_]:["INF",m])}else if(o[3])isNaN(y.duration)||(_=u++,y.type=a,y.start=c,y.levelkey=h,y.sn=_,y.level=r,y.cc=g,y.baseurl=t,y.relurl=(" "+o[3]).slice(1),d.fragments.push(y),c+=(v=y).duration,y=new n);else if(o[4])y.rawByteRange=(" "+o[4]).slice(1),v&&(m=v.byteRangeEndOffset)&&(y.lastByteRangeEndOffset=m);else if(o[5])y.rawProgramDateTime=(" "+o[5]).slice(1),y.tagList.push(["PROGRAM-DATE-TIME",y.rawProgramDateTime]),void 0===d.programDateTime&&(d.programDateTime=new Date(new Date(Date.parse(o[5]))-1e3*c));else{for(o=o[0].match(p),s=1;s<o.length&&void 0===o[s];s++);var b=(" "+o[s+1]).slice(1),T=(" "+o[s+2]).slice(1);switch(o[s]){case"#":y.tagList.push(T?[b,T]:[b]);break;case"PLAYLIST-TYPE":d.type=b.toUpperCase();break;case"MEDIA-SEQUENCE":u=d.startSN=parseInt(b);break;case"TARGETDURATION":d.targetduration=parseFloat(b);break;case"VERSION":d.version=parseInt(b);break;case"EXTM3U":break;case"ENDLIST":d.live=!1;break;case"DIS":g++,y.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":g=parseInt(b);break;case"KEY":var S=new l(b),E=S.enumeratedString("METHOD"),k=S.URI;S=S.hexadecimalInteger("IV");E&&(h=new i,k)&&0<=["AES-128","SAMPLE-AES"].indexOf(E)&&(h.method=E,h.baseuri=t,h.reluri=k,h.key=null,h.iv=S);break;case"START":E=new l(b).decimalFloatingPoint("TIME-OFFSET"),isNaN(E)||(d.startTimeOffset=E);break;case"MAP":k=new l(b),y.relurl=k.URI,y.rawByteRange=k.BYTERANGE,y.baseurl=t,y.level=r,y.type=a,y.sn="initSegment",d.initSegment=y,y=new n;break;case"PART-INF":S=new l(b),d.partTarget=S.decimalFloatingPoint("PART-TARGET");break;default:console.log("line parsed but not handled: "+o)}}}return(y=v)&&!y.relurl&&(d.fragments.pop(),c-=y.duration),d.totalduration=c,d.averagetargetduration=c/d.fragments.length,d.endSN=u-1,d},e),a.ERROR_REGION_BLOCK=g,t.exports=a},{"../constants":28,"../io":40,"../playerutil":46,"./URLToolkit":37,"./attrlist":38}],40:[function(e,t,r){var i=e("./url");t.exports.get=function(e,r,i,n,a){t.exports.ajax("GET",e,{},r,i,n,a)},t.exports.post=function(e,r,i,n,a,o){t.exports.ajax("POST",e,r,i,n,a,o,{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json"})},t.exports.postWithHeader=function(e,r,i,n,a){t.exports.ajax("POST",e,r,n,a,!0,!1,i)},t.exports.ajax=function(e,t,r,n,a,o,s,l){var u,c,d,h;a=a||function(){},"undefined"==typeof XMLHttpRequest&&(window.XMLHttpRequest=function(){try{return new window.ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new window.ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new window.ActiveXObject("Msxml2.XMLHTTP")}catch(e){}throw new Error("This browser does not support XMLHttpRequest.")}),c=new XMLHttpRequest,d=i.parseUrl(t),h=window.location,d.protocol+d.host===h.protocol+h.host||!window.XDomainRequest||"withCredentials"in c?(u="file:"==d.protocol||"file:"==h.protocol,c.onreadystatechange=function(){4===c.readyState&&(200===c.status||u&&0===c.status?n(c.responseText):a(c.responseText,c.status,c))}):((c=new window.XDomainRequest).onload=function(){n(c.responseText)},c.onerror=a,c.onprogress=function(){},c.ontimeout=a);try{if(void 0===o&&(o=!0),c.open(e,t,o),s&&(c.withCredentials=!0),l)for(var f in l)l.hasOwnProperty(f)&&c.setRequestHeader(f,l[f])}catch(e){return void a(e)}try{c.send(r)}catch(e){a(e)}},t.exports.jsonp=function(e,t,r){var i="jsonp_callback_"+Math.round(1e5*Math.random()),n=document.createElement("script");e&&(n.src=e+(0<=e.indexOf("?")?"&":"?")+"callback="+i+"&cb="+i,n.onerror=function(){delete window[i],document.body.removeChild(n),r()},n.onload=function(){setTimeout((function(){window[i]&&(delete window[i],document.body.removeChild(n))}),0)},window[i]=function(e){delete window[i],document.body.removeChild(n),t(e)},document.body.appendChild(n))},t.exports.loadJS=function(e,t,r){var i=document.getElementsByTagName("HEAD").item(0),n=document.createElement("script");e&&e.toLowerCase().indexOf("https://")<0&&e.toLowerCase().indexOf("http://")<0&&(e=document.URL.replace(/(\/[^\/]*?)$/i,"")+e),n.type="text/javascript",n.src=e,n.onload=function(){t&&t()},n.onerror=function(){r&&r()},i.appendChild(n)}},{"./url":50}],41:[function(e,t,r){var i=e("./dom");t.exports.render=function(e,t){var r=t.align||(t.className?"":"tl"),n=t.x||0,a=(t=t.y||0,n.indexOf&&0<n.indexOf("%")?"":"px"),o=t.indexOf&&0<t.indexOf("%")?"":"px";"tl"===r?i.css(e,{float:"left","margin-left":n+a,"margin-top":t+o}):"tr"===r?i.css(e,{float:"right","margin-right":n+a,"margin-top":t+o}):"tlabs"===r?i.css(e,{position:"absolute",left:n+a,top:t+o}):"trabs"===r?i.css(e,{position:"absolute",right:n+a,top:t+o}):"blabs"===r?i.css(e,{position:"absolute",left:n+a,bottom:t+o}):"brabs"===r?i.css(e,{position:"absolute",right:n+a,bottom:t+o}):"cc"===r&&i.addClass(e,"loading-center")}},{"./dom":32}],42:[function(e,t,r){var i=Object.prototype.hasOwnProperty;t.exports.create=Object.create||function(e){function t(){}return t.prototype=e,new t},t.exports.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(arg)},t.exports.isEmpty=function(e){for(var t in e)if(null!==e[t])return!1;return!0},t.exports.each=function(e,r,n){if(t.exports.isArray(e))for(var a=0,o=e.length;a<o&&!1!==r.call(n||this,e[a],a);++a);else for(var s in e)if(i.call(e,s)&&!1===r.call(n||this,s,e[s]))break;return e},t.exports.merge=function(e,t){if(t)for(var r in t)i.call(t,r)&&(e[r]=t[r]);return e},t.exports.deepMerge=function(e,r){var n,a,o;for(n in e=t.exports.copy(e),r)i.call(r,n)&&(a=e[n],o=r[n],t.exports.isPlain(a)&&t.exports.isPlain(o)?e[n]=t.exports.deepMerge(a,o):e[n]=r[n]);return e},t.exports.copy=function(e){return t.exports.merge({},e)},t.exports.isPlain=function(e){return!!e&&"object"==_typeof(e)&&"[object Object]"===e.toString()&&e.constructor===Object},t.exports.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},t.exports.unescape=function(e){return e.replace(/&([^;]+);/g,(function(e,t){return{amp:"&",lt:"<",gt:">",quot:'"',"#x27":"'","#x60":"`"}[t.toLowerCase()]||e}))}},{}],43:[function(e,t,r){var i,n=e("./object");(i=function(){}).extend=function(e){var t,r,a=(e=e||{}).init||e.init||this.prototype.init||this.prototype.init||function(){};for(r in(((t=function(){a.apply(this,arguments)}).prototype=n.create(this.prototype)).constructor=t).extend=i.extend,t.create=i.create,e)e.hasOwnProperty(r)&&(t.prototype[r]=e[r]);return t},i.create=function(){var e=n.create(this.prototype);return this.apply(e,arguments),e},t.exports=i},{"./object":42}],44:[function(e,t,r){var i=!new Function("try {return this===window;}catch(e){ return false;}")();t.exports.isSSR=i},{}],45:[function(e,t,r){var i=e("./object"),n=e("../config"),a=e("./dom"),o=e("./cookie"),s=e("./constants"),l=e("../lang/index"),u=e("./ua"),c=e("./io"),d=e("../player/base/plugin/defaultemptycomponent"),h=e("./hardware-decoding-detector"),f={preload:!0,autoplay:!0,useNativeControls:!1,width:"100%",height:"300px",cover:"",from:"",trackLog:!0,logBatched:!0,heartHeatInterval:30,isLive:!1,playsinline:!0,showBarTime:5e3,rePlay:!1,liveRetry:5,liveRetryInterval:1,liveRetryStep:0,keyShortCuts:!1,keyFastForwardStep:10,isVBR:!1,vodRetry:3,format:"",definition:"",defaultDefinition:"",loadDataTimeout:20,waitingTimeout:60,waitingBufferedTime:3,delayLoadingShow:1,controlBarForOver:!1,controlBarVisibility:"hover",enableSystemMenu:!1,qualitySort:"asc",x5_video_position:"normal",x5_type:"",x5_fullscreen:!1,x5_orientation:"landscape|portrait",x5LandscapeAsFullScreen:!0,license:{},autoPlayDelay:0,autoPlayDelayDisplayText:"",useHlsPluginForSafari:!1,enableMSEForAndroid:!0,encryptType:0,language:"zh-cn",languageTexts:{},mediaType:"video",outputType:"",playConfig:{},reAuthInfo:{},components:[],liveTimeShiftUrl:"",liveShiftSource:"",liveShiftTime:"",liveShiftMinOffset:30,videoHeight:"100%",videoWidth:"100%",enableWorker:!0,authTimeout:"",enableMockFullscreen:!1,region:"cn-shanghai",debug:!1,progressMarkers:[],snapshotWatermark:{left:"500",top:"100",text:"",font:"16px 宋体",fillColor:"#FFFFFF",strokeColor:"#FFFFFF"},liveStartTime:"",liveOverTime:"",enableStashBufferForFlv:!0,stashInitialSizeForFlv:32,flvOption:{accurateSeek:!0},hlsOption:{stopLoadAsPaused:!1},hlsLoadingTimeOut:2e4,useHlsPlugOnMobile:!0,lowLatencyMode:!1,useHls2:void 0,skipRtsSupportCheck:!1,rtsLoadDataTimeout:6e3,rtsFallbackSource:void 0,rtsVersion:"",rtsSdkUrl:"",nudgeMaxRetry:5,tracks:[],recreatePlayer:function(){},diagnosisButtonVisible:!0,enableH265:!1,forceH265:!1,h265Threads:!0,h265Simd:!0,preventRecord:!1,traceId:"",mediaAuth:void 0,textTracks:void 0,_native:!0,hlsUriToken:"",thumbnailUrl:"",refreshAccessInfo:function(){},drmSessionTimeout:5e3,skinRes:"//"+n.domain+"/de/prismplayer-flash/"+n.flashVersion+"/atlas/defaultSkin",splayerUrl:null,splayerWasmDomain:null},p=(t.exports.defaultH5Layout=[{name:"bigPlayButton",align:"blabs",x:30,y:80},{name:"H5Loading",align:"cc"},{name:"errorDisplay",align:"tlabs",x:0,y:0},{name:"infoDisplay"},{name:"tooltip",align:"blabs",x:0,y:50},{name:"thumbnail"},{name:"controlBar",align:"blabs",x:0,y:0,children:[{name:"progress",align:"blabs",x:0,y:44},{name:"playButton",align:"tl",x:15,y:12},{name:"timeDisplay",align:"tl",x:10,y:5},{name:"fullScreenButton",align:"tr",x:10,y:12},{name:"subtitle",align:"tr",x:15,y:12},{name:"setting",align:"tr",x:15,y:12},{name:"volume",align:"tr",x:5,y:10}]}],t.exports.defaultAudioLayout=[{name:"controlBar",align:"blabs",x:0,y:0,children:[{name:"progress",align:"blabs",x:0,y:44},{name:"playButton",align:"tl",x:15,y:12},{name:"timeDisplay",align:"tl",x:10,y:5},{name:"volume",align:"tr",x:5,y:10}]}],t.exports.defaultFlashLayout=[{name:"bigPlayButton",align:"blabs",x:30,y:80},{name:"controlBar",align:"blabs",x:0,y:0,children:[{name:"progress",align:"tlabs",x:0,y:0},{name:"playButton",align:"tl",x:15,y:26},{name:"nextButton",align:"tl",x:10,y:26},{name:"timeDisplay",align:"tl",x:10,y:24},{name:"fullScreenButton",align:"tr",x:10,y:25},{name:"streamButton",align:"tr",x:10,y:23},{name:"volume",align:"tr",x:10,y:25}]},{name:"fullControlBar",align:"tlabs",x:0,y:0,children:[{name:"fullTitle",align:"tl",x:25,y:6},{name:"fullNormalScreenButton",align:"tr",x:24,y:13},{name:"fullTimeDisplay",align:"tr",x:10,y:12},{name:"fullZoom",align:"cc"}]}],t.exports.canPlayType=function(e){var t=document.createElement("video");return t.canPlayType?t.canPlayType(e):""},t.exports.canPlayHls=function(){return""!=t.exports.canPlayType("application/x-mpegURL")},t.exports.isUsedHlsPluginOnMobile=function(e){return!!(u.IS_MOBILE&&(u.IS_CHROME||u.IS_FIREFOX||u.IS_X5||u.IS_EDGE_NEW)&&t.exports.isSupportHls())},t.exports.isSafariUsedHlsPlugin=function(e){return!!(u.os.pc&&u.browser.safari&&e)},t.exports.hasUIComponent=function(e,r){if(void 0!==e&&e&&0!=e.length)for(var i=0,n=e.length;i<n;i++){var a=e[i].name;if(a==r)return!0;if("controlBar"==a)return t.exports.hasUIComponent(e[i].children,r)}return!1},t.exports.validateSource=function(e){return!0},t.exports.supportH5Video=function(){return void 0!==document.createElement("video").canPlayType},t.exports.createWrapper=function(e){var r=e.id;r="string"==typeof r?(0===r.indexOf("#")&&(r=r.slice(1)),a.el(r)):r;if(r&&r.nodeName)return t.exports.adjustContainerLayout(r,e),r;throw new TypeError("没有为播放器指定容器")},t.exports.adjustContainerLayout=function(e,t){t.width&&!e.style.width&&(e.style.width=t.width),t.height&&!e.style.height&&(e.style.height=t.height)},t.exports.isSupportHls=function(){var e=window.MediaSource=window.MediaSource||window.WebKitMediaSource,t=window.SourceBuffer=window.SourceBuffer||window.WebKitSourceBuffer;e=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),t=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return e&&t},t.exports.isSupportFlv=function(){return t.exports.isSupportHls()},t.exports.isSupportMSE=function(){return!!window.Promise&&!!window.Uint8Array&&!!Array.prototype.forEach&&t.exports.isSupportedMediaSource()},t.exports.isSupportedMediaSource=function(){return!!window.MediaSource&&!!MediaSource.isTypeSupported},t.exports.isSupportedDrm=function(){return!!(window.MediaKeys&&window.navigator&&window.navigator.requestMediaKeySystemAccess&&window.MediaKeySystemAccess&&window.MediaKeySystemAccess.prototype.getConfiguration)&&t.exports.isSupportMSE()},t.exports.isAudio=function(e){return e&&0<e.toLowerCase().indexOf(".mp3")},t.exports.isLiveShift=function(e){return e.isLive&&e.liveStartTime&&e.liveOverTime},t.exports.isHls=function(e){return e&&0<e.toLowerCase().indexOf(".m3u8")},t.exports.isDash=function(e){return e&&0<e.toLowerCase().indexOf(".mpd")},t.exports.isFlv=function(e){return e&&0<e.toLowerCase().indexOf(".flv")},t.exports.isRTMP=function(e){return e&&-1<e.toLowerCase().indexOf("rtmp:")},t.exports.isRts=function(e){return e&&-1<e.toLowerCase().indexOf("artc:")},t.exports.isMp4=function(e){return e&&-1<e.toLowerCase().indexOf(".mp4")},t.exports.checkSecuritSupport=function(){return t.exports.isSupportHls()?"":u.IS_IOS?l.get("iOSNotSupportVodEncription"):l.get("UseChromeForVodEncription")},t.exports.nativeSupportH265=function(){return u.IS_IOS||u.IS_MAC_SAFARI},t.exports.findSelectedStreamLevel=function(e,t){var r=t;if(r||(r=o.get(s.SelectedStreamLevel))){for(var i=0;i<e.length;i++)if(e[i].definition==r)return i}else o.set(s.SelectedStreamLevel,e[0].definition,365);return 0},t.exports.getHistoryDetectResult=function(e){if(e)return"hvc1"===e?o.get(s.HWDetectHvc1):"hev1"===e?o.get(s.HWDetectHev1):void 0},t.exports.setHistoryDetectResult=function(e,t){var r="unknownCodec";"hvc1"===e?r=s.HWDetectHvc1:"hev1"===e&&(r=s.HWDetectHev1),o.set(r,t)},t.exports.handleOption=function(e,r){t.exports.isRts(e.source)&&(e.isLive=!0);var n,a=i.merge(i.copy(f),e),o=[{name:"fullScreenButton",align:"tr",x:20,y:12},{name:"subtitle",align:"tr",x:15,y:12},{name:"setting",align:"tr",x:15,y:12},{name:"volume",align:"tr",x:5,y:10}],s=!1;if(e.useFlashPrism||t.exports.isRTMP(e.source)?(s=!0,o=[{name:"liveIco",align:"tlabs",x:15,y:25},{name:"fullScreenButton",align:"tr",x:10,y:25},{name:"volume",align:"tr",x:10,y:25}]):(n=t.exports.isLiveShift(a))?(o.push({name:"liveShiftProgress",align:"tlabs",x:0,y:0}),o.push({name:"playButton",align:"tl",x:15,y:12}),o.push({name:"liveDisplay",align:"tl",x:15,y:6})):o.push({name:"liveDisplay",align:"tlabs",x:15,y:6}),e.isLive)if(void 0===e.skinLayout)a.skinLayout=[{name:"errorDisplay",align:"tlabs",x:0,y:0},{name:"infoDisplay"},{name:"bigPlayButton",align:"blabs",x:30,y:80},{name:"tooltip",align:"blabs",x:0,y:56},{name:"H5Loading",align:"cc"},{name:"controlBar",align:"blabs",x:0,y:0,children:t.exports.isRts(e.source)?[{name:"fullScreenButton",align:"tr",x:20,y:12},{name:"volume",align:"tr",x:5,y:10},{name:"liveDisplay",align:"tlabs",x:15,y:6}]:o}];else if(0!=e.skinLayout){for(var l=e.skinLayout.length,u=[],c=-1,h=0;h<l;h++)if("controlBar"==a.skinLayout[h].name){c=h;for(var p=a.skinLayout[h].children.length,g=0;g<p;g++){var v,y=a.skinLayout[h].children[g].name;"liveDisplay"!=y&&"liveIco"!=y&&"fullScreenButton"!=y&&"volume"!=y&&"snapshot"!=y&&"setting"!=y&&"subtitle"!=y&&(!n||"progress"!=y&&"playButton"!=y&&"timeDisplay"!=y)||(v=a.skinLayout[h].children[g],"progress"==y?v.name="liveShiftProgress":"timeDisplay"==y?v.name="liveShiftTimeDisplay":s&&"liveDisplay"==y&&(v.name="liveIco"),u.push(v))}break}-1!=c&&(a.skinLayout[c].children=u)}return(void 0===e.components||!e.components||i.isArray(e.components)&&0==e.components.length)&&"false"!=e.components&&(a.components=[d]),a},t.exports.getLiveHostByRegion=function(e){return e&&-1<["ap-southeast-1","eu-central-1"].indexOf(e)?"live."+e+".aliyuncs.com":"live.aliyuncs.com"},t.exports.isVideoTag=function(e){return e&&"string"==typeof e.nodeName&&"video"===e.nodeName.toLowerCase()},t.exports.unqiueTextTracks=function(e){var t=[],r=(t=(e=void 0===e?[]:e).reduce((function(e,t){var r;return e.some((function(e){return e.srclang===t.srclang}))?e:((r=t).label=t.label||t.srclang,[].concat(e,[r]))}),[]),{});return t.forEach((function(e,t){r[e.label]?r[e.label].push(t):r[e.label]=[t]})),Object.keys(r).forEach((function(e){e=r[e]||[],1<e.length&&e.forEach((function(e){t[e].label=t[e].label+"("+t[e].srclang+")"}))})),t},t.exports.isHvc1Codec=function(e){return-1<(e=void 0===e?"":e).indexOf("hvc1")},t.exports.isHev1Codec=function(e){return-1<(e=void 0===e?"":e).indexOf("hev1")},t.exports.isH265Codec=function(e){return t.exports.isHvc1Codec(e=void 0===e?"":e)||t.exports.isHev1Codec(e)},t.exports.getVideoTrack=function(e){var t;return(e=void 0===e?[]:e).forEach((function(e){1===Number(e.type)&&(t=e)})),t},u.IS_ANDROID&&(u.dingTalk()||u.IS_UC||u.is_X5||u.IS_HUAWEI||u.IS_XIAOMI||u.IS_OPPO||u.IS_VIVO||u.IS_MEIZU||u.IS_SAMSUNG||u.IS_WEBVIEW)||u.os&&"windows"===u.os.name&&u.IS_UC);t.exports.shouldUseBasePlayer=function(e,r){var i,n="supported",a="unsupported";return!e||(i=t.exports.isHvc1Codec(e),t.exports.nativeSupportH265()&&i)||function(){if(p||!u.IS_CHROME&&!u.IS_EDGE_NEW)return!1;var e=0;try{e=u.USER_AGENT.match(/Chrome\/(\d+)/i)[1]}catch(i){e=0}return!(parseInt(e)<104||!window.MediaSource||!window.MediaSource.isTypeSupported('video/mp4;codecs="hvc1.1.6.L120.90"'))}()?r(!0):p?(i=t.exports.getHistoryDetectResult(e))===n?r(!0):i===a?r(!1):void h({codecTags:[e],timeout:2e3}).then((function(i){if(i=i.isHev1Supported||i.isHvc1Supported,t.exports.setHistoryDetectResult(e,i?n:a),i)return r(!0);r(!1)})).catch((function(e){console.log("hevcDetector ERROR",e),r(!1)})):r(!1)},t.exports.parseHttpHeaders=function(e){if(e)try{var t=e.getAllResponseHeaders().trim().split(/[\r\n]+/),r={};return t.forEach((function(e){e=e.split(": ");var t=e.shift();e=e.join(": ");r[t]=e})),r}catch(e){}},t.exports.detectRegionBlock=function(e,r){c.get(e,(function(){r(!1)}),(function(e,i,n){n=t.exports.parseHttpHeaders(n)["x-tengine-error"],403===i&&n&&-1<s.RegionBlockMessages.indexOf(n)?r(!0):r(!1)}))}},{"../config":14,"../lang/index":23,"../player/base/plugin/defaultemptycomponent":92,"./constants":28,"./cookie":29,"./dom":32,"./hardware-decoding-detector":36,"./io":40,"./object":42,"./ua":49}],46:[function(e,t,r){var i=e("./object"),n=e("../config"),a=e("./dom"),o=e("./cookie"),s=e("./constants"),l=e("../lang/index"),u=e("./ua"),c=e("./io"),d=e("../player/base/plugin/defaultemptycomponent"),h=e("./hardware-decoding-detector"),f={preload:!0,autoplay:!0,useNativeControls:!1,width:"100%",height:"300px",cover:"",from:"",trackLog:!0,logBatched:!0,heartHeatInterval:30,isLive:!1,playsinline:!0,showBarTime:5e3,rePlay:!1,liveRetry:5,liveRetryInterval:1,liveRetryStep:0,keyShortCuts:!1,keyFastForwardStep:10,isVBR:!1,vodRetry:3,format:"",definition:"",defaultDefinition:"",loadDataTimeout:20,waitingTimeout:60,waitingBufferedTime:3,delayLoadingShow:1,controlBarForOver:!1,controlBarVisibility:"hover",enableSystemMenu:!1,qualitySort:"asc",x5_video_position:"normal",x5_type:"",x5_fullscreen:!1,x5_orientation:"landscape|portrait",x5LandscapeAsFullScreen:!0,license:{},autoPlayDelay:0,autoPlayDelayDisplayText:"",useHlsPluginForSafari:!1,enableMSEForAndroid:!0,encryptType:0,language:"zh-cn",languageTexts:{},mediaType:"video",outputType:"",playConfig:{},reAuthInfo:{},components:[],liveTimeShiftUrl:"",liveShiftSource:"",liveShiftTime:"",liveShiftMinOffset:30,videoHeight:"100%",videoWidth:"100%",enableWorker:!0,authTimeout:"",enableMockFullscreen:!1,region:"cn-shanghai",debug:!1,progressMarkers:[],snapshotWatermark:{left:"500",top:"100",text:"",font:"16px 宋体",fillColor:"#FFFFFF",strokeColor:"#FFFFFF"},liveStartTime:"",liveOverTime:"",enableStashBufferForFlv:!0,stashInitialSizeForFlv:32,flvOption:{accurateSeek:!0},hlsOption:{stopLoadAsPaused:!1},hlsLoadingTimeOut:2e4,useHlsPlugOnMobile:!0,lowLatencyMode:!1,useHls2:void 0,skipRtsSupportCheck:!1,rtsLoadDataTimeout:6e3,rtsFallbackSource:void 0,rtsVersion:"",rtsSdkUrl:"",nudgeMaxRetry:5,tracks:[],recreatePlayer:function(){},diagnosisButtonVisible:!0,enableH265:!1,forceH265:!1,h265Threads:!0,h265Simd:!0,preventRecord:!1,traceId:"",mediaAuth:void 0,textTracks:void 0,_native:!0,hlsUriToken:"",thumbnailUrl:"",refreshAccessInfo:function(){},drmSessionTimeout:5e3,skinRes:"//"+n.domain+"/de/prismplayer-flash/"+n.flashVersion+"/atlas/defaultSkin",splayerUrl:null,splayerWasmDomain:null},p=(t.exports.defaultH5Layout=[{name:"bigPlayButton",align:"blabs",x:30,y:80},{name:"H5Loading",align:"cc"},{name:"errorDisplay",align:"tlabs",x:0,y:0},{name:"infoDisplay"},{name:"tooltip",align:"blabs",x:0,y:50},{name:"thumbnail"},{name:"controlBar",align:"blabs",x:0,y:0,children:[{name:"progress",align:"blabs",x:0,y:44},{name:"playButton",align:"tl",x:15,y:12},{name:"timeDisplay",align:"tl",x:10,y:5},{name:"fullScreenButton",align:"tr",x:10,y:12},{name:"subtitle",align:"tr",x:15,y:12},{name:"setting",align:"tr",x:15,y:12},{name:"volume",align:"tr",x:5,y:10}]}],t.exports.defaultAudioLayout=[{name:"controlBar",align:"blabs",x:0,y:0,children:[{name:"progress",align:"blabs",x:0,y:44},{name:"playButton",align:"tl",x:15,y:12},{name:"timeDisplay",align:"tl",x:10,y:5},{name:"volume",align:"tr",x:5,y:10}]}],t.exports.defaultFlashLayout=[{name:"bigPlayButton",align:"blabs",x:30,y:80},{name:"controlBar",align:"blabs",x:0,y:0,children:[{name:"progress",align:"tlabs",x:0,y:0},{name:"playButton",align:"tl",x:15,y:26},{name:"nextButton",align:"tl",x:10,y:26},{name:"timeDisplay",align:"tl",x:10,y:24},{name:"fullScreenButton",align:"tr",x:10,y:25},{name:"streamButton",align:"tr",x:10,y:23},{name:"volume",align:"tr",x:10,y:25}]},{name:"fullControlBar",align:"tlabs",x:0,y:0,children:[{name:"fullTitle",align:"tl",x:25,y:6},{name:"fullNormalScreenButton",align:"tr",x:24,y:13},{name:"fullTimeDisplay",align:"tr",x:10,y:12},{name:"fullZoom",align:"cc"}]}],t.exports.canPlayType=function(e){var t=document.createElement("video");return t.canPlayType?t.canPlayType(e):""},t.exports.canPlayHls=function(){return""!=t.exports.canPlayType("application/x-mpegURL")},t.exports.isUsedHlsPluginOnMobile=function(e){return!!(u.IS_MOBILE&&(u.IS_CHROME||u.IS_FIREFOX||u.IS_X5||u.IS_EDGE_NEW)&&t.exports.isSupportHls())},t.exports.isSafariUsedHlsPlugin=function(e){return!!(u.os.pc&&u.browser.safari&&e)},t.exports.hasUIComponent=function(e,r){if(void 0!==e&&e&&0!=e.length)for(var i=0,n=e.length;i<n;i++){var a=e[i].name;if(a==r)return!0;if("controlBar"==a)return t.exports.hasUIComponent(e[i].children,r)}return!1},t.exports.validateSource=function(e){return!0},t.exports.supportH5Video=function(){return void 0!==document.createElement("video").canPlayType},t.exports.createWrapper=function(e){var r=e.id;r="string"==typeof r?(0===r.indexOf("#")&&(r=r.slice(1)),a.el(r)):r;if(r&&r.nodeName)return t.exports.adjustContainerLayout(r,e),r;throw new TypeError("没有为播放器指定容器")},t.exports.adjustContainerLayout=function(e,t){t.width&&!e.style.width&&(e.style.width=t.width),t.height&&!e.style.height&&(e.style.height=t.height)},t.exports.isSupportHls=function(){var e=window.MediaSource=window.MediaSource||window.WebKitMediaSource,t=window.SourceBuffer=window.SourceBuffer||window.WebKitSourceBuffer;e=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),t=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return e&&t},t.exports.isSupportFlv=function(){return t.exports.isSupportHls()},t.exports.isSupportMSE=function(){return!!window.Promise&&!!window.Uint8Array&&!!Array.prototype.forEach&&t.exports.isSupportedMediaSource()},t.exports.isSupportedMediaSource=function(){return!!window.MediaSource&&!!MediaSource.isTypeSupported},t.exports.isSupportedDrm=function(){return!!(window.MediaKeys&&window.navigator&&window.navigator.requestMediaKeySystemAccess&&window.MediaKeySystemAccess&&window.MediaKeySystemAccess.prototype.getConfiguration)&&t.exports.isSupportMSE()},t.exports.isAudio=function(e){return e&&0<e.toLowerCase().indexOf(".mp3")},t.exports.isLiveShift=function(e){return e.isLive&&e.liveStartTime&&e.liveOverTime},t.exports.isHls=function(e){return e&&0<e.toLowerCase().indexOf(".m3u8")},t.exports.isDash=function(e){return e&&0<e.toLowerCase().indexOf(".mpd")},t.exports.isFlv=function(e){return e&&0<e.toLowerCase().indexOf(".flv")},t.exports.isRTMP=function(e){return e&&-1<e.toLowerCase().indexOf("rtmp:")},t.exports.isRts=function(e){return e&&-1<e.toLowerCase().indexOf("artc:")},t.exports.isMp4=function(e){return e&&-1<e.toLowerCase().indexOf(".mp4")},t.exports.checkSecuritSupport=function(){return t.exports.isSupportHls()?"":u.IS_IOS?l.get("iOSNotSupportVodEncription"):l.get("UseChromeForVodEncription")},t.exports.nativeSupportH265=function(){return u.IS_IOS||u.IS_MAC_SAFARI},t.exports.findSelectedStreamLevel=function(e,t){var r=t;if(r||(r=o.get(s.SelectedStreamLevel))){for(var i=0;i<e.length;i++)if(e[i].definition==r)return i}else o.set(s.SelectedStreamLevel,e[0].definition,365);return 0},t.exports.getHistoryDetectResult=function(e){if(e)return"hvc1"===e?o.get(s.HWDetectHvc1):"hev1"===e?o.get(s.HWDetectHev1):void 0},t.exports.setHistoryDetectResult=function(e,t){var r="unknownCodec";"hvc1"===e?r=s.HWDetectHvc1:"hev1"===e&&(r=s.HWDetectHev1),o.set(r,t)},t.exports.handleOption=function(e,r){t.exports.isRts(e.source)&&(e.isLive=!0);var n,a=i.merge(i.copy(f),e),o=[{name:"fullScreenButton",align:"tr",x:20,y:12},{name:"subtitle",align:"tr",x:15,y:12},{name:"setting",align:"tr",x:15,y:12},{name:"volume",align:"tr",x:5,y:10}],s=!1;if(e.useFlashPrism||t.exports.isRTMP(e.source)?(s=!0,o=[{name:"liveIco",align:"tlabs",x:15,y:25},{name:"fullScreenButton",align:"tr",x:10,y:25},{name:"volume",align:"tr",x:10,y:25}]):(n=t.exports.isLiveShift(a))?(o.push({name:"liveShiftProgress",align:"tlabs",x:0,y:0}),o.push({name:"playButton",align:"tl",x:15,y:12}),o.push({name:"liveDisplay",align:"tl",x:15,y:6})):o.push({name:"liveDisplay",align:"tlabs",x:15,y:6}),e.isLive)if(void 0===e.skinLayout)a.skinLayout=[{name:"errorDisplay",align:"tlabs",x:0,y:0},{name:"infoDisplay"},{name:"bigPlayButton",align:"blabs",x:30,y:80},{name:"tooltip",align:"blabs",x:0,y:56},{name:"H5Loading",align:"cc"},{name:"controlBar",align:"blabs",x:0,y:0,children:t.exports.isRts(e.source)?[{name:"fullScreenButton",align:"tr",x:20,y:12},{name:"volume",align:"tr",x:5,y:10},{name:"liveDisplay",align:"tlabs",x:15,y:6}]:o}];else if(0!=e.skinLayout){for(var l=e.skinLayout.length,u=[],c=-1,h=0;h<l;h++)if("controlBar"==a.skinLayout[h].name){c=h;for(var p=a.skinLayout[h].children.length,g=0;g<p;g++){var v,y=a.skinLayout[h].children[g].name;"liveDisplay"!=y&&"liveIco"!=y&&"fullScreenButton"!=y&&"volume"!=y&&"snapshot"!=y&&"setting"!=y&&"subtitle"!=y&&(!n||"progress"!=y&&"playButton"!=y&&"timeDisplay"!=y)||(v=a.skinLayout[h].children[g],"progress"==y?v.name="liveShiftProgress":"timeDisplay"==y?v.name="liveShiftTimeDisplay":s&&"liveDisplay"==y&&(v.name="liveIco"),u.push(v))}break}-1!=c&&(a.skinLayout[c].children=u)}return(void 0===e.components||!e.components||i.isArray(e.components)&&0==e.components.length)&&"false"!=e.components&&(a.components=[d]),a},t.exports.getLiveHostByRegion=function(e){return e&&-1<["ap-southeast-1","eu-central-1"].indexOf(e)?"live."+e+".aliyuncs.com":"live.aliyuncs.com"},t.exports.isVideoTag=function(e){return e&&"string"==typeof e.nodeName&&"video"===e.nodeName.toLowerCase()},t.exports.unqiueTextTracks=function(e){var t=[],r=(t=(e=void 0===e?[]:e).reduce((function(e,t){var r;return e.some((function(e){return e.srclang===t.srclang}))?e:((r=t).label=t.label||t.srclang,[].concat(e,[r]))}),[]),{});return t.forEach((function(e,t){r[e.label]?r[e.label].push(t):r[e.label]=[t]})),Object.keys(r).forEach((function(e){e=r[e]||[],1<e.length&&e.forEach((function(e){t[e].label=t[e].label+"("+t[e].srclang+")"}))})),t},t.exports.isHvc1Codec=function(e){return-1<(e=void 0===e?"":e).indexOf("hvc1")},t.exports.isHev1Codec=function(e){return-1<(e=void 0===e?"":e).indexOf("hev1")},t.exports.isH265Codec=function(e){return t.exports.isHvc1Codec(e=void 0===e?"":e)||t.exports.isHev1Codec(e)},t.exports.getVideoTrack=function(e){var t;return(e=void 0===e?[]:e).forEach((function(e){1===Number(e.type)&&(t=e)})),t},u.IS_ANDROID&&(u.dingTalk()||u.IS_UC||u.is_X5||u.IS_HUAWEI||u.IS_XIAOMI||u.IS_OPPO||u.IS_VIVO||u.IS_MEIZU||u.IS_SAMSUNG||u.IS_WEBVIEW)||u.os&&"windows"===u.os.name&&u.IS_UC);t.exports.shouldUseBasePlayer=function(e,r){var i,n="supported",a="unsupported";return!e||(i=t.exports.isHvc1Codec(e),t.exports.nativeSupportH265()&&i)||function(){if(p||!u.IS_CHROME&&!u.IS_EDGE_NEW)return!1;var e=0;try{e=u.USER_AGENT.match(/Chrome\/(\d+)/i)[1]}catch(i){e=0}return!(parseInt(e)<104||!window.MediaSource||!window.MediaSource.isTypeSupported('video/mp4;codecs="hvc1.1.6.L120.90"'))}()?r(!0):p?(i=t.exports.getHistoryDetectResult(e))===n?r(!0):i===a?r(!1):void h({codecTags:[e],timeout:2e3}).then((function(i){if(i=i.isHev1Supported||i.isHvc1Supported,t.exports.setHistoryDetectResult(e,i?n:a),i)return r(!0);r(!1)})).catch((function(e){console.log("hevcDetector ERROR",e),r(!1)})):r(!1)},t.exports.parseHttpHeaders=function(e){if(e)try{var t=e.getAllResponseHeaders().trim().split(/[\r\n]+/),r={};return t.forEach((function(e){e=e.split(": ");var t=e.shift();e=e.join(": ");r[t]=e})),r}catch(e){}},t.exports.detectRegionBlock=function(e,r){c.get(e,(function(){r(!1)}),(function(e,i,n){n=t.exports.parseHttpHeaders(n)["x-tengine-error"],403===i&&n&&-1<s.RegionBlockMessages.indexOf(n)?r(!0):r(!1)}))}},{"../config":14,"../lang/index":23,"../player/base/plugin/defaultemptycomponent":92,"./constants":28,"./cookie":29,"./dom":32,"./hardware-decoding-detector":36,"./io":40,"./object":42,"./ua":49}],47:[function(e,t,r){var i=e("./object"),n=e("../player/adaptiveplayer"),a=e("./constants").USER_EVENT_NAME;t.exports.reloadInstance=function(e,r,i){var o=i,s=(o.dispose(),e.readyCallback),l=e._readyCallbackCalled;e=n.create(e,(function(e){r(e),l||s(e)}));t.exports.restoreUserEvents(i,e),t.exports.removeAllProps(o),(o.__proto__=e)[a]=o[a]},t.exports.storeUserEvents=function(e){var t=e,r=t.__proto__.on,i={};t.on=function(e,n){"function"==typeof n&&(i[e]?i[e].push(n):i[e]=[n],this._el)&&(n.binded=!0,r.call(t,e,n))},t[a]=i},t.exports.restoreUserEvents=function(e,t){var r=e[a];r&&i.each(r,(function(e){r[e].forEach((function(r){t.on(e,r)}))}))},t.exports.removeAllProps=function(e,t){for(var r in t=[].concat(t=t||[],[a]),e)e.hasOwnProperty(r)&&-1===t.indexOf(r)&&delete e[r]}},{"../player/adaptiveplayer":67,"./constants":28,"./object":42}],48:[function(e,t,r){t.exports.set=function(t,r){try{window.localStorage&&localStorage.setItem(t,r)}catch(e){window[t+"_localStorage"]=r}},t.exports.get=function(t){try{if(window.localStorage)return localStorage.getItem(t)}catch(e){return window[t+"_localStorage"]}return""}},{}],49:[function(e,t,r){var i,n,a,o;if(t.exports.USER_AGENT=navigator.userAgent,t.exports.IS_IPHONE=/iPhone/i.test(t.exports.USER_AGENT),t.exports.IS_IPAD=/iPad/i.test(t.exports.USER_AGENT),t.exports.IS_IPOD=/iPod/i.test(t.exports.USER_AGENT),t.exports.IS_MAC=/mac/i.test(t.exports.USER_AGENT),t.exports.IS_EDGE=/Edge/i.test(t.exports.USER_AGENT),t.exports.IS_EDGE_NEW=/Edg/i.test(t.exports.USER_AGENT)&&!t.exports.IS_EDGE,t.exports.IS_IE11=/Trident\/7.0/i.test(t.exports.USER_AGENT),t.exports.IS_X5=/qqbrowser/i.test(t.exports.USER_AGENT.toLowerCase()),t.exports.IS_CHROME=/Chrome/i.test(t.exports.USER_AGENT)&&!t.exports.IS_EDGE&&!t.exports.IS_EDGE_NEW&&!t.exports.IS_X5,t.exports.IS_SAFARI=/Safari/i.test(t.exports.USER_AGENT)&&!t.exports.IS_CHROME&&!t.exports.IS_EDGE_NEW,t.exports.IS_FIREFOX=/Firefox/i.test(t.exports.USER_AGENT),t.exports.IS_UC=/ucweb|UCBrowser|UBrowser/i.test(t.exports.USER_AGENT),t.exports.IS_HUAWEI=/HuaweiBrowser/i.test(t.exports.USER_AGENT),t.exports.IS_XIAOMI=/MiuiBrowser/i.test(t.exports.USER_AGENT),t.exports.IS_OPPO=/HeyTapBrowser/i.test(t.exports.USER_AGENT),t.exports.IS_VIVO=/VivoBrowser/i.test(t.exports.USER_AGENT),t.exports.IS_MEIZU=/MZBrowser/i.test(t.exports.USER_AGENT),t.exports.IS_SAMSUNG=/samsungbrowser/i.test(t.exports.USER_AGENT),document.all)try{var s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");t.exports.HAS_FLASH=!!s}catch(e){t.exports.HAS_FLASH=!1}else navigator.plugins&&0<navigator.plugins.length?(s=navigator.plugins["Shockwave Flash"],t.exports.HAS_FLASH=!!s):t.exports.HAS_FLASH=!1;t.exports.IS_MAC_SAFARI=t.exports.IS_MAC&&t.exports.IS_SAFARI&&!t.exports.IS_CHROME&&!t.exports.HAS_FLASH,t.exports.IS_IOS=t.exports.IS_IPHONE||t.exports.IS_IPAD||t.exports.IS_IPOD,t.exports.IOS_VERSION=function(){var e=t.exports.USER_AGENT.match(/OS (\d+)_/i);if(e&&e[1])return e[1]}(),t.exports.IS_ANDROID=/Android/i.test(t.exports.USER_AGENT),t.exports.ANDROID_VERSION=(s=t.exports.USER_AGENT.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i))?(n=s[1]&&parseFloat(s[1]),i=s[2]&&parseFloat(s[2]),n&&i?parseFloat(s[1]+"."+s[2]):n||null):null,t.exports.IS_OLD_ANDROID=t.exports.IS_ANDROID&&/webkit/i.test(t.exports.USER_AGENT)&&t.exports.ANDROID_VERSION<2.3,t.exports.TOUCH_ENABLED=!!("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),t.exports.IS_MOBILE=t.exports.IS_IOS||t.exports.IS_ANDROID,t.exports.IS_H5=t.exports.IS_MOBILE||!t.exports.HAS_FLASH,t.exports.IS_PC=!t.exports.IS_MOBILE,t.exports.is_X5=/micromessenger/i.test(t.exports.USER_AGENT)||/qqbrowser/i.test(t.exports.USER_AGENT),t.exports.IS_ANDROID_FIREFOX=t.exports.IS_ANDROID&&t.exports.IS_FIREFOX,t.exports.CHROME_VERSION=t.exports.IS_CHROME&&t.exports.USER_AGENT.match(/Chrome\/(\d+)/i)[1],t.exports.getHost=function(e){var t,r,i="";return void 0===e||null==e||""==e?"":(t=e.indexOf("//"),r=e,i=r=-1<t?e.substring(t+2):r,(e=(i=(e=r.split("/"))&&0<e.length?e[0]:i).split(":"))&&0<e.length?e[0]:i)},t.exports.dingTalk=function(){var e=t.exports.USER_AGENT.toLowerCase();return/dingtalk/i.test(e)},t.exports.IS_DINGTALK=t.exports.dingTalk(),t.exports.wechat=function(){var e=t.exports.USER_AGENT.toLowerCase();return/micromessenger/i.test(e)},t.exports.inIFrame=function(){return self!=top},t.exports.getReferer=function(){var r=document.referrer;if(t.exports.inIFrame())try{r=top.document.referrer}catch(e){r=document.referrer}return r},t.exports.getHref=function(){if(location.href,t.exports.inIFrame())try{top.location.href}catch(e){location.href}return location.href},t.exports.check360=function(){return-1!=navigator.userAgent.indexOf("Safari")?function(){var e=navigator.userAgent.split(" ");if(-1!=e[e.length-1].indexOf("Safari"))for(var t in navigator.plugins)if("np-mswmp.dll"==navigator.plugins[t].filename)return!0;return!1}():(null==navigator.msPointerEnabled||navigator.msPointerEnabled)&&(1==navigator.msDoNotTrack||1==window.doNotTrack)&&(!!Number(window.screenX)&&window.screenLeft-window.screenX!=8||(-1!=navigator.userAgent.indexOf("MSIE 7.0")||-1!=navigator.userAgent.indexOf("MSIE 8.0"))&&null==console.count)},i=t.exports,function(e,r){var i=this.os={},n=this.browser={},a=e.match(/Web[kK]it[\/]{0,1}([\d.]+)/),o=e.match(/(Android);?[\s\/]+([\d.]+)?/),s=!!e.match(/\(Macintosh\; Intel /),l=e.match(/(iPad).*OS\s([\d_]+)/),u=e.match(/(iPod)(.*OS\s([\d_]+))?/),c=!l&&e.match(/(iPhone\sOS)\s([\d_]+)/),d=e.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),h=(r=/Win\d{2}|Windows/.test(r),e.match(/Windows Phone ([\d.]+)/)),f=d&&e.match(/TouchPad/),p=e.match(/Kindle\/([\d.]+)/),g=e.match(/Silk\/([\d._]+)/),v=e.match(/(BlackBerry).*Version\/([\d.]+)/),y=e.match(/(BB10).*Version\/([\d.]+)/),m=e.match(/(RIM\sTablet\sOS)\s([\d.]+)/),_=e.match(/PlayBook/),b=e.match(/Chrome\/([\d.]+)/)||e.match(/CriOS\/([\d.]+)/),T=e.match(/Firefox\/([\d.]+)/),S=e.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),E=e.match(/MSIE\s([\d.]+)/)||e.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),k=!b&&e.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),A=k||e.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);(n.webkit=!!a)&&(n.version=a[1]),o&&(i.android=!0,i.version=o[2]),c&&!u&&(i.ios=i.iphone=!0,i.version=c[2].replace(/_/g,".")),l&&(i.ios=i.ipad=!0,i.version=l[2].replace(/_/g,".")),u&&(i.ios=i.ipod=!0,i.version=u[3]?u[3].replace(/_/g,"."):null),h&&(i.wp=!0,i.version=h[1]),d&&(i.webos=!0,i.version=d[2]),f&&(i.touchpad=!0),v&&(i.blackberry=!0,i.version=v[2]),y&&(i.bb10=!0,i.version=y[2]),m&&(i.rimtabletos=!0,i.version=m[2]),_&&(n.playbook=!0),p&&(i.kindle=!0,i.version=p[1]),g&&(n.silk=!0,n.version=g[1]),!g&&i.android&&e.match(/Kindle Fire/)&&(n.silk=!0),b&&(n.chrome=!0,n.version=b[1]),T&&(n.firefox=!0,n.version=T[1]),S&&(i.firefoxos=!0,i.version=S[1]),E&&(n.ie=!0,n.version=E[1]),A&&(s||i.ios||r||o)&&(n.safari=!0,i.ios||i.android||(n.version=A[1])),i.ios&&(n.version=i.version),k&&(n.webview=!0),s&&((a=e.match(/[\d]*_[\d]*_[\d]*/))&&0<a.length&&a[0]&&(i.version=a[0].replace(/_/g,".")),/MQBHD/.test(e))&&(n.version=((e.match(/.*OS\s([\d_]+)/)||[])[1]||"").replace(/_/g,".")),i.tablet=!!(l||_||o&&!e.match(/Mobile/)||T&&e.match(/Tablet/)||E&&!e.match(/Phone/)&&e.match(/Touch/)),i.phone=!(i.tablet||i.ipod||!(o||c||d||v||y||b&&e.match(/Android/)||b&&e.match(/CriOS\/([\d.]+)/)||T&&e.match(/Mobile/)||E&&e.match(/Touch/))),i.pc=!i.tablet&&!i.phone,s?i.name="macOS":r?(i.name="windows",i.version=function(){var e=navigator.userAgent,t="";return(-1<e.indexOf("Windows NT 5.0")||-1<e.indexOf("Windows 2000"))&&(t="2000"),(-1<e.indexOf("Windows NT 5.1")||-1<e.indexOf("Windows XP"))&&(t="XP"),(-1<e.indexOf("Windows NT 5.2")||-1<e.indexOf("Windows 2003"))&&(t="2003"),(-1<e.indexOf("Windows NT 6.0")||-1<e.indexOf("Windows Vista"))&&(t="Vista"),(-1<e.indexOf("Windows NT 6.1")||-1<e.indexOf("Windows 7"))&&(t="7"),(-1<e.indexOf("Windows NT 6.2")||-1<e.indexOf("Windows 8"))&&(t="8"),(-1<e.indexOf("Windows NT 6.3")||-1<e.indexOf("Windows 8.1"))&&(t="8.1"),(-1<e.indexOf("Windows NT 10")||-1<e.indexOf("Windows 10"))&&(t="10"),t}()):i.name=function(){var e=navigator.userAgent,r="other",i=t.exports.os;return i.ios?"iOS":i.android?"android":-1<e.indexOf("Baiduspider")?"Baiduspider":-1<e.indexOf("PlayStation")?"PS4":(i="Win32"==navigator.platform||"Windows"==navigator.platform||-1<e.indexOf("Windows"),e="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform,e&&(r="macOS"),"X11"!=navigator.platform||i||e||(r="Unix"),-1<String(navigator.platform).indexOf("Linux")&&(r="Linux"),i?"windows":r)}(),n.name=(u=navigator.userAgent.toLowerCase(),(h=t.exports.browser).firefox?"Firefox":h.ie?/edge/.test(u)?"Edge":"IE":t.exports.IS_EDGE_NEW?"EdgeChromium":/micromessenger/.test(u)?"微信内置浏览器":/qqbrowser/.test(u)?"QQ浏览器":t.exports.IS_UC?"UC":t.exports.IS_DINGTALK?"Dingtalk":t.exports.IS_HUAWEI?"HuaweiBrowser":t.exports.IS_XIAOMI?"MiBrowser":t.exports.IS_OPPO?"OppoBrowser":t.exports.IS_VIVO?"VivoBrowser":t.exports.IS_MEIZU?"MeizuBrowser":t.exports.IS_SAMSUNG?"SamsungBrowser":t.exports.IS_WEBVIEW||/MQBHD/.test(u)?"webview":h.chrome?"Chrome":h.safari?"Safari":/baiduspider/.test(u)?"Baiduspider":/opera/.test(u)?"Opera":/360se/.test(u)?"360浏览器":/bidubrowser/.test(u)?"百度浏览器":/metasr/.test(u)?"搜狗浏览器":/lbbrowser/.test(u)?"猎豹浏览器":/playstation/.test(u)?"PS4浏览器":void 0)}.call(i,navigator.userAgent,navigator.platform),t.exports.IS_WEBVIEW=(n=t.exports.USER_AGENT,a=new RegExp("("+["WebView","(iPhone|iPod|iPad)(?!.*Safari)","Android.*(wv|.0.0.0)","Linux; U; Android"].join("|")+")","ig"),o=new RegExp("("+["VivoBrowser","MZBrowser","MiuiBrowser"].join("|")+")","ig"),!!n.match(a)&&!n.match(o))},{}],50:[function(e,t,r){var i=e("./dom");t.exports.getAbsoluteURL=function(e){return e.match(/^https?:\/\//)?e:i.createEl("div",{innerHTML:'<a href="'+e+'">x</a>'}).firstChild.href},t.exports.parseUrl=function(e){var t,r=["protocol","hostname","port","pathname","search","hash","host"],n=i.createEl("a",{href:e}),a=""===n.host&&"file:"!==n.protocol;a&&((t=i.createEl("div")).innerHTML='<a href="'+e+'"></a>',n=t.firstChild,t.setAttribute("style","display:none; position:absolute;"),document.body.appendChild(t));for(var o={},s=0;s<r.length;s++)o[r[s]]=n[r[s]];return o.segments=n.pathname.replace(/^\//,"").split("/"),a&&document.body.removeChild(t),o}},{"./dom":32}],51:[function(e,t,r){var i=e("./dom"),n=e("./ua"),a=e("./playerutil");t.exports.formatTime=function(e){e=Math.floor(e);var t,r=Math.floor(e/3600);return e%=3600,t=Math.floor(e/60),e%=60,!(r===1/0||isNaN(r)||t===1/0||isNaN(t)||e==1/0||isNaN(e))&&("00"===(r=10<=r?r:"0"+r)?"":r+":")+(10<=t?t:"0"+t)+":"+(10<=e?e:"0"+e)},t.exports.extractTime=function(e){var t;return e?("00"===(t=10<=(t=parseInt(e.getHours()))?t:"0"+t)?"":t+":")+(t=10<=(t=parseInt(e.getMinutes()))?t:"0"+t)+":"+(t=10<=(t=parseInt(e.getSeconds()))?t:"0"+t):""},t.exports.convertToTimestamp=function(e,t){var r="";return e&&(t?r=e.gettime():(r=Date.parse(e),r/=1e3)),r},t.exports.convertToDate=function(e,t){var r="";return e&&(r=new Date).setTime(1e3*e),r},t.exports.parseTime=function(e){var t,r,i;return e?(i=r=t=0,3===(e=e.split(":")).length?(t=e[0],r=e[1],i=e[2]):2===e.length?(r=e[0],i=e[1]):1===e.length&&(i=e[0]),3600*(t=parseInt(t,10))+60*(r=parseInt(r,10))+(i=Math.ceil(parseFloat(i)))):"00:00:00"},t.exports.formatDate=function(e,t){var r,i={"M+":e.getMonth()+1,"d+":e.getDate(),"H+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(r in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),i)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[r]:("00"+i[r]).substr((""+i[r]).length)));return t},t.exports.sleep=function(e){for(var t=Date.now();Date.now()-t<=e;);},t.exports.htmlEncodeAll=function(e){return null==e?"":e.replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},t.exports.toBinary=function(e){if(!window.atob)return"";for(var t=atob(e),r=t.length,i=new Uint8Array(r),n=0;n<r;n++)i[n]=t.charCodeAt(n);return i},t.exports.readyBinary=function(e){for(var t=new Uint8Array(e),r=t.length,i="",n=0;n<r;n++)i+=t[n];return i},t.exports.delayHide=function(e,t){e&&(void 0===t&&(t=1e3),e.delayHanlder&&clearTimeout(e.delayHanlder),e.delayHanlder=setTimeout((function(){i.css(e,"display","none")}),t))},t.exports.openInFile=function(){return-1!=window.location.protocol.toLowerCase().indexOf("file")},t.exports.contentProtocolMixed=function(e,t){return!!((n.os.pc&&(a.isHls(e)&&!n.browser.safari||a.isFlv(e))||t)&&"https:"==window.location.protocol.toLowerCase()&&e&&-1<e.toLowerCase().indexOf("http://"))},t.exports.queryString=function(e){var t,r,i;return 2===(e=(e=decodeURIComponent(e)).split("?")).length&&(e=e[1],t=e.split("&"))?(r={},i=0,$(t).each((function(){var e=t[i].split("=");2===e.length&&(r[e[0]]=e[1].replace(/\+/g," ")),i++})),r):{}},t.exports.log=function(e){var r=window.location.href;r=t.exports.queryString(r);r&&1==r.debug&&console.log(e)}},{"./dom":32,"./playerutil":46,"./ua":49}],52:[function(e,t,r){var i,n="undefined"==typeof Promise?e("es6-promise").Promise:Promise;e=this,i=function(){return t={926:function(e){var t=Object.prototype.hasOwnProperty;function r(e){return"[Throws: "+(e?e.message:"?")+"]"}function i(e){var i=[];return function e(n){if(null===n||"object"!=_typeof(n))return n;if(-1!==i.indexOf(n))return"[Circular]";if(i.push(n),"function"==typeof n.toJSON)try{var a=e(n.toJSON());return i.pop(),a}catch(e){return r(e)}return a=Array.isArray(n)?n.map(e):Object.keys(n).reduce((function(r,i){return r[i]=e(function(e,r){return t.call(e,r),e[r]}(n,i)),r}),{}),i.pop(),a}(e)}e.exports=function(e,t,r){return JSON.stringify(i(e),t,r)},e.exports.ensureProperties=i}},r={},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,{a:r}),r},e.d=function(t,r){for(var i in r)e.o(r,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:r[i]})},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i={},function(){"use strict";e.r(i),e.d(i,{AACParser:function(){return t},AvcSPS:function(){return M},BasicLoader:function(){return we},BitBuffer:function(){return f},Box:function(){return z},ByteBuffer:function(){return a},CTrackTypeMap:function(){return G},Demuxer:function(){return gn},DiscardType:function(){return x},EFormatType:function(){return I},EH264NALType:function(){return y},EH265NALType:function(){return b},EHandlerType:function(){return L},ELoaderStatus:function(){return Te},ESampleFlag:function(){return j},ETrackType:function(){return C},ErrorCode:function(){return R},ExpGolomb:function(){return D},FLVParser:function(){return nt},FullBox:function(){return X},H264NAL:function(){return E},H265NAL:function(){return A},HevcSPS:function(){return U},Loader:function(){return Le},MP4Parser:function(){return Gi}});var t={},r=(e.r(t),e.d(t,{AAC_DURATION:function(){return s},AAC_SAMPLING_FREQUENCIES:function(){return o},addADTSHeader:function(){return l},getADTSHeaderLength:function(){return c},getADTSLength:function(){return d},isADTS:function(){return u},readAACSamples:function(){return h}}),{}),a=(e.r(r),e.d(r,{Box:function(){return z},avc1:function(){return ot},avcC:function(){return Q},btrt:function(){return lt},co64:function(){return Ci},ctts:function(){return Li},dinf:function(){return at},dref:function(){return ut},edts:function(){return at},elst:function(){return At},esds:function(){return Vt},ftyp:function(){return jt},hdlr:function(){return Gt},hev1:function(){return st},hvc1:function(){return st},hvcC:function(){return ne},mdat:function(){return Kt},mdhd:function(){return qt},mdia:function(){return at},mfhd:function(){return rr},mfra:function(){return at},minf:function(){return at},moof:function(){return er},moov:function(){return at},mp4a:function(){return Wt},mvex:function(){return ir},mvhd:function(){return Yt},pasp:function(){return Qt},sdtp:function(){return nr},sidx:function(){return ar},stbl:function(){return at},stco:function(){return Ii},stsc:function(){return Di},stsd:function(){return Pi},stss:function(){return Oi},stsz:function(){return Mi},stts:function(){return Fi},tfdt:function(){return Yr},tfhd:function(){return _i},tkhd:function(){return Jt},traf:function(){return tr},trak:function(){return at},trex:function(){return ki},trun:function(){return Ri},url:function(){return Zt},vmhd:function(){return $t}}),g.concatUint8s=function(e){return this.concatUint8.apply(this,e)},g.concatUint8=function(){for(var e,t,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return r.length<=1?r[0]||new Uint8Array(0):(e=new Uint8Array(r.reduce((function(e,t){return e+t.byteLength}),0)),t=0,r.forEach((function(r){e.set(r,t),t+=r.byteLength})),e)},g.concat=function(e,t){return g.concatUint8(new Uint8Array(e),new Uint8Array(t)).buffer},Object.defineProperty(g.prototype,"buffer",{get:function(){return this.dv.buffer},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"unreadLength",{get:function(){return Math.max(this.end-this.offset,0)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"length",{get:function(){return this.end-this.start},enumerable:!1,configurable:!0}),g.prototype.readFloat=function(e){var t=0;switch(e){case 4:t=this.dv.getFloat32(this.offset);break;case 8:t=this.dv.getFloat64(this.offset);break;default:throw new Error("not supported for read float byte with "+e)}return this.offset+=e,t},g.prototype.back=function(e){this.offset-=e},g.prototype.skip=function(e){this.offset+=e},g.prototype.readInt=function(e){var t=this.offset;switch(this.offset+=e,e){case 1:return this.dv.getInt8(t);case 2:return this.dv.getInt16(t);case 4:return this.dv.getInt32(t);default:throw new Error("not supported for read byte with "+e)}},g.prototype.read=function(e){var t=this.offset;switch(this.offset+=e,e){case 1:return this.dv.getUint8(t);case 2:return this.dv.getUint16(t);case 3:return(this.dv.getUint16(t)<<8)+this.dv.getUint8(t+2);case 4:return this.dv.getUint32(t);default:return this.back(e-4),this.read(e-4)+this.dv.getUint32(t)*Math.pow(256,e-4)}},g.prototype.writeInt=function(e,t){var r=this.offset;switch(this.offset+=e,e){case 1:return this.dv.setInt8(r,t);case 2:return this.dv.setInt16(r,t);case 3:return this.dv.setInt8(r,t>>16),this.dv.setInt16(r+1,65535&t);case 4:return this.dv.setInt32(r,t);default:throw new Error("不支持Byte write "+e)}},g.prototype.write=function(e,t){var r=this.offset;switch(this.offset+=e,e){case 1:return this.dv.setUint8(r,t);case 2:return this.dv.setUint16(r,t);case 3:return this.dv.setUint8(r,t>>>16),this.dv.setUint16(r+1,65535&t);case 4:return this.dv.setUint32(r,t);default:throw new Error("不支持Byte write "+e)}},g.prototype.readToUint8=function(e){return e=new Uint8Array(this.dv.buffer,this.offset,e||this.unreadLength),this.offset+=e.byteLength,e},g.prototype.readToBuffer=function(e){return e=this.offset||e?this.dv.buffer.slice(this.offset,e?this.offset+e:void 0):this.dv.buffer,this.offset+=e.byteLength,e},g),o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=1024,l=function(e,t){var r=t.audioObjectType,i=t.sampleRate,n=t.channelCount,s=(t=void 0===(t=t.numberOfRawDataBlocksInFrame)?0:t,e.byteLength+7),l=(i=o.indexOf(i),new Uint8Array(7));return l[0]=255,l[1]=241,l[2]=r-1<<6,l[2]|=i<<2,l[2]|=(4&n)>>2,l[3]=(3&n)<<6,l[3]|=(6144&s)>>11,l[4]=(2047&s)>>3,l[5]=(7&s)<<5,l[5]|=31,l[6]=252,l[6]|=3&t,a.concatUint8(l,e)},u=function(e,t){return t<e.byteLength-1&&255===e[t]&&240==(246&e[t+1])},c=function(e,t){return 1&e[t+1]?7:9},d=function(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5},h=function(e){for(var t,r,i=[],n=0,a=e.byteLength;n+5<a;)u(e,n)?(t=c(e,n),r=d(e,n),i.push({audioObjectType:1+(e[2]>>>6),sampleRate:o[e[2]>>>2&15],samplingFrequencyIndex:e[2]>>>2&15,channelCount:(1&e[2])<<2|e[3]>>>6,numberOfRawDataBlocksInFrame:0,data:e.subarray(n+t,n+r)}),n+=r):n++;return i},f=(p.fromByte=function(e,t){return new p(e.read(t),t<<3)},p.prototype.skip=function(e){this.offset+=e},p.prototype.read=function(e){var t=this.len-this.offset-e;if(0<=t){for(var r=0,i=0;i<e;i++)r+=1<<i;return this.offset+=e,this.num>>>t&r}return console.warn("bit 读取位数超过限制"),0},p);function p(e,t){this.num=e,this.len=t,this.offset=0}function g(e,t,r){this.dv=new DataView(e),this.start=this.offset=t||this.dv.byteOffset,this.end=r?this.start+r:this.dv.byteLength}_.createAnnexbStartCode=function(){return new Uint8Array([0,0,0,1])},_.createAVCCStartCode=function(e){return new Uint8Array([e>>24&255,e>>16&255,e>>8&255,255&e])},_.extractAVCCNAL=function(e,t){for(var r,i=[],n=new a(e.buffer,e.byteOffset,e.byteLength);n.unreadLength>t;){if((r=n.read(t+1))<=0||r>n.unreadLength){console.warn("extract avc nalu size wrong! lengthSizeMinusOne:",t,"size:",r);break}var o=n.offset-n.start;i.push(e.subarray(o,o+r)),n.skip(r)}return i},_.extractAnnexbNAL=function(e){for(var t=e.byteLength,r=[],i=0;i<t-3;)0===e[i]?0===e[i+1]?0===e[i+2]?0===e[i+3]?i++:(1===e[i+3]&&i+4<t&&r.push({prefixStart:i,start:i+4}),i+=4):(1===e[i+2]&&r.push({prefixStart:i,start:i+3}),i+=3):i+=2:i++;return r.length?r.map((function(t,i){return i=r[i+1],i?e.subarray(t.start,i.prefixStart):e.subarray(t.start)})):[]};var v,y,m=_;function _(){}v=function(e,t){return(v=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},(k=y=y||{})[k.UNUSED=0]="UNUSED",k[k.NON_IDR_SLICE=1]="NON_IDR_SLICE",k[k.SLICE_DP_A=2]="SLICE_DP_A",k[k.SLICE_DP_B=3]="SLICE_DP_B",k[k.SLICE_DP_C=4]="SLICE_DP_C",k[k.SLICE_IDR=5]="SLICE_IDR",k[k.SEI=6]="SEI",k[k.SPS=7]="SPS",k[k.PPS=8]="PPS",k[k.DIVIDER=9]="DIVIDER",k[k.SEQUENCE_END=10]="SEQUENCE_END",k[k.STREAM_END=11]="STREAM_END",k[k.FILL=12]="FILL";var b,T,S,E=function(e){function t(t){var r=e.call(this)||this;t=new f(t.read(1),8);return r.forbiddenZeroBit=t.read(1),r.nalRefIdc=t.read(2),r.nalType=t.read(5),r}var r=t,i=e;if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=r}return v(r,i),r.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n),t.extractNALType=function(e){return 31&e[0]},t.isSlice=function(e){return e=this.extractNALType(e),e>=y.NON_IDR_SLICE&&e<=y.SLICE_IDR},t}(m),k=(T=function(e){function t(t,r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return(T=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)})),function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}T(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),A=((ae=b=b||{})[ae.TRAIL_N=0]="TRAIL_N",ae[ae.TRAIL_R=1]="TRAIL_R",ae[ae.TSA_N=2]="TSA_N",ae[ae.TSA_R=3]="TSA_R",ae[ae.STSA_N=4]="STSA_N",ae[ae.STSA_R=5]="STSA_R",ae[ae.RADL_N=6]="RADL_N",ae[ae.RADL_R=7]="RADL_R",ae[ae.RASL_N=8]="RASL_N",ae[ae.RASL_R=9]="RASL_R",ae[ae.VCL_N10=10]="VCL_N10",ae[ae.VCL_R11=11]="VCL_R11",ae[ae.VCL_N12=12]="VCL_N12",ae[ae.VCL_R13=13]="VCL_R13",ae[ae.VCL_N14=14]="VCL_N14",ae[ae.VCL_R15=15]="VCL_R15",ae[ae.BLA_W_LP=16]="BLA_W_LP",ae[ae.BLA_W_RADL=17]="BLA_W_RADL",ae[ae.BLA_N_LP=18]="BLA_N_LP",ae[ae.IDR_W_RADL=19]="IDR_W_RADL",ae[ae.IDR_N_LP=20]="IDR_N_LP",ae[ae.CRA=21]="CRA",ae[ae.VPS=32]="VPS",ae[ae.SPS=33]="SPS",ae[ae.PPS=34]="PPS",ae[ae.ACCESS_UNIT_DELIMITER=35]="ACCESS_UNIT_DELIMITER",ae[ae.EOS=36]="EOS",ae[ae.EOB=37]="EOB",ae[ae.FILLER_DATA=38]="FILLER_DATA",ae[ae.SEI=39]="SEI",ae[ae.SEI_SUFFIX=40]="SEI_SUFFIX",ae[ae.INVALID=64]="INVALID",k(w,S=m),w.extractNALType=function(e,t){return(126&e[t=void 0===t?0:t])>>1},w.isNonRefNALType=function(e){switch(e){case b.TRAIL_N:case b.STSA_N:case b.RADL_N:case b.RASL_N:case b.VCL_N10:case b.VCL_N12:case b.VCL_N14:return!0;default:return!1}},w.isNonRef=function(e){return this.isNonRefNALType(this.extractNALType(e))},w.isSlice=function(e){return e=this.extractNALType(e),e>=b.TRAIL_N&&e<=b.CRA},w.littleEndian=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]},w.parseHVCVideoData=function(e,t){for(var r=e.byteLength,i=new DataView(e.buffer,e.byteOffset,e.byteLength),n=[],a=0,o=0+t,s=this.littleEndian,l=!1;a<r;){if(r<=a+4){console.warn("parseHVCVideoData Malformed Nalu near timestamp "+o+", offset = "+a+", dataSize = "+r);break}var u=i.getUint32(a,!s);if(r-4<u)return void console.warn("parseHVCVideoData Malformed Nalus near timestamp "+o+", NaluSize > DataSize!");var c=i.getUint8(a+4)>>1&63,d=(16<=c&&c<=23&&(l=!0),0+a+4);c={type:c,data:e.subarray(d,d+u)};n.push(c),a+=4+u}return{keyframe:l,units:n}},w);function w(e){var t=S.call(this)||this;e=new f(e.read(2),16);return t.forbiddenZeroBit=e.read(1),t.nalType=e.read(6),t.nhLayerId=e.read(6),t.nhTimeId=e.read(3),t}V.prototype.loadWord=function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4);t=Math.min(4,t);if(0===t)throw new Error("no bytes available");i.set(e.subarray(r,r+t)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*t,this.bytesAvailable-=t},V.prototype.skipBits=function(e){var t;this.bitsAvailable>e||(e=(e-=this.bitsAvailable)-((t=e>>3)<<3),this.bytesAvailable-=t,this.loadWord()),this.word<<=e,this.bitsAvailable-=e},V.prototype.readBits=function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;return 32<e&&console.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,0<this.bitsAvailable?this.word<<=t:0<this.bytesAvailable&&this.loadWord(),0<(t=e-t)&&this.bitsAvailable?r<<t|this.readBits(t):r},V.prototype.skipLZ=function(){for(var e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},V.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},V.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},V.prototype.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},V.prototype.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},V.prototype.readUByte=function(){return this.readBits(8)},V.prototype.readUShort=function(){return this.readBits(16)},V.prototype.readUInt=function(){return this.readBits(32)},V.prototype.skipScalingList=function(e){for(var t=8,r=8,i=0;i<e;i++)t=0===(r=0!==r?(t+this.readEG()+256)%256:r)?t:r};var x,R,L,I,C,D=V,P=[100,110,122,244,44,83,86,118,128,138,144],O=[[0,1],[1,1],[12,11],[10,11],[16,11],[40,33],[24,11],[20,11],[32,11],[80,33],[18,11],[15,11],[64,33],[160,99],[4,3],[3,2],[2,1]],M=(H.generateCodec=function(e){return"avc1."+[e.generalProfileIdc,e.generalProfileCompatibility,e.generalLevelIdc].map((function(e){return(e=e.toString(16)).length<2?"0"+e:e})).join("")},H),N=[1,2,2,1],F=[1,2,1,1],U=(B.generateCodec=function(e){var t=["hvc1"],r=e.generalProfileSpace;return 0<r&&r<4&&t.push(String.fromCharCode(64+r)),t.push(e.generalProfileIdc.toString()),t.push(e.generalProfileCompatibilityFlags.reverse().reduce((function(e,t){return e<<1|t}),0).toString(16)),t.push((e.generalTierFlag?"H":"L")+e.generalLevelIdc),e.generalConstraintIndicatorFlags.forEach((function(e){e&&t.push(e.toString(16))})),t.join(".")},B);function B(e){var t=this;this.generalProfileSpace=0,this.generalTierFlag=0,this.generalProfileIdc=0,this.generalProfileCompatibilityFlags=[],this.generalConstraintIndicatorFlags=[],this.subLayerProfilePresentFlags=[],this.subLayerLevelPresentFlags=[],this.separateColourPlaneFlag=0,this.pixelRatio=[],this.codec="",this.checkProfileIdc=function(e){return t.generalProfileIdc===e||t.generalProfileCompatibilityFlags[e]};var r,i,n,a,o=new D(e);for(this.vpsId=o.readBits(4),this.maxSubLayersMinus1=o.readBits(3),this.temporalIdNestingFlag=o.readBits(1),this.generalProfileSpace=o.readBits(2),this.generalTierFlag=o.readBits(1),this.generalProfileIdc=o.readBits(5),r=0;r<32;r++)this.generalProfileCompatibilityFlags[r]=o.readBits(1),0===this.generalProfileIdc&&0<r&&this.generalProfileCompatibilityFlags[r]&&(this.generalProfileIdc=r);for(r=0;r<6;r++)this.generalConstraintIndicatorFlags.push(o.readUByte());for(this.generalLevelIdc=o.readUByte(),r=0;r<this.maxSubLayersMinus1;r++)this.subLayerProfilePresentFlags[r]=o.readBits(1),this.subLayerLevelPresentFlags[r]=o.readBits(1);for(0<this.maxSubLayersMinus1&&o.skipBits(2*(8-this.maxSubLayersMinus1)),r=0;r<this.maxSubLayersMinus1;r++)this.subLayerProfilePresentFlags[r]&&o.skipBits(48),this.subLayerLevelPresentFlags[r]&&o.readUByte();this.spsId=o.readUEG(),this.codec=B.generateCodec(this),this.chromaFormatIdc=o.readUEG(),3===this.chromaFormatIdc&&(this.separateColourPlaneFlag=o.readBits(1)),this.separateColourPlaneFlag&&(this.chromaFormatIdc=0),this.width=o.readUEG(),this.height=o.readUEG(),o.readBits(1)&&(e=N[this.chromaFormatIdc],a=F[this.chromaFormatIdc],i=o.readUEG()*e,e=o.readUEG()*e,n=o.readUEG()*a,a=o.readUEG()*a,this.width-=i+e,this.height-=n+a)}function H(e){this.generalProfileSpace=0,this.generalTierFlag=0,this.generalProfileIdc=0,this.generalProfileCompatibility=0,this.crop=0,this.cropLeft=0,this.cropRight=0,this.cropTop=0,this.cropBottom=0,this.pixelRatio=[],this.codec="";var t,r,i=new D(e);if(this.generalProfileIdc=i.readUByte(),this.generalProfileCompatibility=i.readUByte(),this.generalLevelIdc=i.readUByte(),this.spsId=i.readUEG(),this.codec=H.generateCodec(this),-1<P.indexOf(this.generalProfileIdc)){if(this.chromaFormatIdc=i.readUEG(),3===this.chromaFormatIdc&&i.skipBits(1),i.skipUEG(),i.skipUEG(),i.skipBits(1),i.readBits(1))for(t=0,r=3===this.chromaFormatIdc?8:12;t<r;t++)i.readBits(1)&&(t<6?i.skipScalingList(16):i.skipScalingList(64))}else this.chromaFormatIdc=1;if(i.skipUEG(),e=i.readUEG(),0===e)i.skipUEG();else if(1===e)for(i.skipBits(1),i.skipEG(),i.skipEG(),t=0,r=i.readUEG();t<r;t++)i.skipEG();i.skipUEG(),i.skipBits(1);e=i.readUEG()+1;var n,a=i.readUEG()+1,o=i.readBits(1);o||i.skipBits(1),this.height=a*(2-o),i.skipBits(1),this.crop=i.readBits(1),this.crop&&(n=1<<(1===this.chromaFormatIdc||2===this.chromaFormatIdc?1:0),o=2-o<<(1===this.chromaFormatIdc?1:0),this.cropLeft=i.readUEG()*n,this.cropRight=i.readUEG()*n,this.cropTop=i.readUEG()*o,this.cropBottom=i.readUEG()*o),this.width=16*e-(this.cropRight+this.cropLeft),this.height=16*a-(this.cropTop+this.cropBottom),i.readBits(1)&&i.readBits(1)&&(255===(n=i.readUByte())?(this.pixelRatio[0]=i.readUByte()<<8|i.readUByte(),this.pixelRatio[1]=i.readUByte()<<8|i.readUByte()):n<O.length&&(this.pixelRatio=O[n]))}function V(e){this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}(ae=x=x||{})[ae.NONE=-16]="NONE",ae[ae.DEFAULT=0]="DEFAULT",ae[ae.NONREF=8]="NONREF",ae[ae.BIDIR=16]="BIDIR",ae[ae.NONINTRA=24]="NONINTRA",ae[ae.NONKEY=32]="NONKEY",ae[ae.ALL=48]="ALL",(k=R=R||{})[k.ABORTED=1]="ABORTED",k[k.NETWORK=2]="NETWORK",k[k.DECODE=3]="DECODE",k[k.SRC_NOT_SUPPORTED=4]="SRC_NOT_SUPPORTED",k[k.PARSER=1001]="PARSER",k[k.COROUTINE=10001]="COROUTINE",k[k.WEBGL_NOT_SUPPORTED=10002]="WEBGL_NOT_SUPPORTED",k[k.BUFFERING=10004]="BUFFERING",k[k.RENDERER=10005]="RENDERER",(ae=L=L||{}).VIDE="vide",ae.SOUN="soun",(k=I=I||{})[k.FLV=0]="FLV",k[k.MP4=1]="MP4",k[k.HLS=2]="HLS",k[k.MPEGTS=3]="MPEGTS",(ae=C=C||{})[ae.UNKNOWN=0]="UNKNOWN",ae[ae.VIDEO=1]="VIDEO",ae[ae.AUDIO=2]="AUDIO",(k={})[L.VIDE]=C.VIDEO,k[L.SOUN]=C.AUDIO;var j,G=k;function K(e,t){var r=e.offset;this.start=t,this.size=e.read(4),this.type=String.fromCharCode(e.read(1),e.read(1),e.read(1),e.read(1)).trim(),1===this.size&&(this.size=e.read(8)),this.length=e.offset-r}(ae=j=j||{})[ae.DEGRADATION_PRIORITY_MASK=65535]="DEGRADATION_PRIORITY_MASK",ae[ae.IS_NON_SYNC=65536]="IS_NON_SYNC",ae[ae.PADDING_MASK=917504]="PADDING_MASK",ae[ae.REDUNDANCY_MASK=3145728]="REDUNDANCY_MASK",ae[ae.DEPENDED_MASK=12582912]="DEPENDED_MASK",ae[ae.DEPENDS_MASK=50331648]="DEPENDS_MASK",ae[ae.DEPENDS_NO=33554432]="DEPENDS_NO",ae[ae.DEPENDS_YES=16777216]="DEPENDS_YES",ie=function(e,t){return(ie=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)};k=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}ie(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};var q,W=function(){return(W=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},Y=new Date("1904-01-01T00:00:00Z").getTime(),z=(de.prototype.append=function(e){this.children.push(e)},de.mapBoxToJSON=function(e){return W({box:e},e.children.reduce((function(e,t){var r=t.header.type,i=e[r];t=de.mapBoxToJSON(t);return i?Array.isArray(i)?i.push(t):e[r]=[i,t]:e[r]=t,e}),{}))},de),X=(k(ce,re=z),ce);te=function(e,t){return(te=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}te(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(ue,ee=z);var Q=ue;function J(e){return e<10?"0"+e:e}$=function(e,t){return($=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}$(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(le,Z=z);var Z,$,ee,te,re,ie,ne=le,ae=e(926),oe=e.n(ae),se="undefined"!=typeof performance&&"function"==typeof performance.now;function le(e,t){var r,i=Z.call(this,e,t)||this;i.nalus=[],i.vps=[],i.sps=[],i.pps=[],i.sei=[],i.configVersion=t.read(1),r=new f(t.read(1),8),i.generalProfileSpace=r.read(2),i.generalTierFlag=r.read(1),i.generalProfileIdc=r.read(5),r=new f(t.read(4),32),i.generalProfileCompatibilityFlags=Array.from(new Array(32)).map((function(){return r.read(1)})),i.generalConstraintIndicatorFlags=Array.from(new Array(6)).map((function(){return t.read(1)})),i.generalLevelIdc=t.read(1),i.minSpatialSegmentationIdc=4095&t.read(2),i.parallelismType=3&t.read(1),i.chromaFormatIdc=3&t.read(1),i.bitDepthLumaMinus8=7&t.read(1),i.bitDepthChromaMinus8=7&t.read(1),i.avgFrameRate=t.read(2),r=new f(t.read(1),8),i.constantFrameRate=r.read(2),i.numTemporalLayers=r.read(3),i.temporalIdNested=r.read(1),i.lengthSizeMinusOne=r.read(2),i.nalus=[];for(var n=t.read(1),a=0;a<n;a++){var o=[],s=(r=new f(t.read(1),8)).read(1);r.read(1);for(var l=r.read(6),u=t.read(2),c=0;c<u;c++)o.push(new Uint8Array(t.read(2)).map((function(){return t.read(1)})));i.nalus.push({completeness:s,type:l,data:o}),l===b.VPS?o.forEach((function(e){return i.vps.push(e)})):l===b.SPS?o.forEach((function(e){return i.sps.push(e)})):l===b.PPS?o.forEach((function(e){return i.pps.push(e)})):l===b.SEI&&o.forEach((function(e){return i.sei.push(e)}))}return i.codec=U.generateCodec(i),i}function ue(e,t){var r=ee.call(this,e,t)||this;r.sps=[],r.pps=[],r.configVersion=t.read(1),r.generalProfileIdc=t.read(1),r.generalProfileCompatibility=t.read(1),r.generalLevelIdc=t.read(1),r.lengthSizeMinusOne=3&t.read(1),r.numOfSequenceParameterSets=31&t.read(1);var i,n=0,a=[];for(n=0;n<r.numOfSequenceParameterSets;n++){for(i=t.read(2),a=[];i--;)a.push(t.read(1));r.sps.push(new Uint8Array(a))}for(r.numOfPictureParameterSets=31&t.read(1),n=0;n<r.numOfPictureParameterSets;n++){for(i=t.read(2),a=[];i--;)a.push(t.read(1));r.pps.push(new Uint8Array(a))}return r.codec=M.generateCodec(r),r}function ce(e,t){return e=re.call(this,e,t)||this,e.version=t.read(1),e.flag=t.read(3),e}function de(e,t){this.children=[],this.isContainer=!1,this.toStandardTime=function(e){return e&&Y+1e3*e},this.header=e}function he(){return(se?performance:Date).now()}(k=q=q||{})[k.TRACE=-1]="TRACE",k[k.DEBUG=0]="DEBUG",k[k.LOG=1]="LOG",k[k.INFO=2]="INFO",k[k.WARN=10]="WARN",k[k.ERROR=11]="ERROR",k[k.NONE=1e3]="NONE";var fe=q.INFO,pe=q.ERROR,ge=2e3,ve=he(),ye=[],me=0;(ae=_e.prototype)._print=function(e,t){var r,i,n,a,o,s,l,u;fe<=e&&(r=he()-ve,n="["+q[e]+"]["+this.name+"]["+(i=r,void 0===(n=!0)&&(n=!0),u=Math.floor(i/1e3),n=void 0!==n&&n,((a=u)===1/0?a:(s=Math.floor(a/60),s-=60*(o=Math.floor(s/60)),a=Math.floor(a-60*(60*o+s)),l=[],(n||0<o)&&l.push(J(o)),l.push(J(s)),l.push(J(a)),l.join(":")))+".")+Math.floor(1e3*(i-1e3*u))+"]",ye.push({id:me++,level:e,name:this.name,timestamp:r,args:t,prefix:n,message:""}),ye.length>ge&&ye.shift(),pe<=e)&&(o=(q[e]||"").toLowerCase(),s=console[o])&&s.apply(void 0,[n].concat(t))},ae.getLogs=function(){return ye.map((function(e){return e.message=e.prefix+" "+e.args.map((function(e){return"string"==typeof e?e:oe()(e)})).join(" "),e}))},ae.clear=function(){ye=[]},ae.setSize=function(e){ge=e},ae.setLevel=function(e){fe=e},ae.setPrintLevel=function(e){pe=e},ae.reset=function(){fe=q.INFO,pe=q.ERROR,ge=2e3,ve=he(),ye=[],me=0},k=_e;function _e(e){var t=this;this.trace=function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return t._print(q.TRACE,r)},this.debug=function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return t._print(q.DEBUG,r)},this.log=function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return t._print(q.LOG,r)},this.info=function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return t._print(q.INFO,r)},this.warn=function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return t._print(q.WARN,r)},this.error=function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return t._print(q.ERROR,r)},this.name=e}function be(){var e=this;this._eventMap={},this.listeners=function(t){return e._eventMap[t]||[]},this.emit=function(t,r){return t=e._eventMap[t],!!Array.isArray(t)&&(t.forEach((function(e){return e(r)})),!0)},this.off=function(t,r){var i=e._eventMap[t];return Array.isArray(i)&&(e._eventMap[t]=i.filter((function(e){return e!==r}))),e},this.removeAllListeners=function(t){return void 0===t?e._eventMap={}:e._eventMap[t]&&(e._eventMap[t]=[]),e},this.on=function(t,r){return e._eventMap[t]?e._eventMap[t].push(r):e._eventMap[t]=[r],e},this.once=function(t,r){return e.on(t,(function i(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];e.off(t,i),r.apply(e,n)})),e},this.proxy=function(t,r){r.forEach((function(r){e.on(r,(function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];e.unshift(r),t.emit.apply(t,e)}))}))},this.proxyOnce=function(t,r){r.forEach((function(r){e.once(r,(function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];e.unshift(r),t.emit.apply(t,e)}))}))}}k.LogLevel=q;var Te,Se,Ee,ke,Ae=new k("demuxer"),we=(ae=(Se=function(e,t){return(Se=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Se(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),(k=Te=Te||{})[k.IDLE=0]="IDLE",k[k.LOADING=1]="LOADING",k[k.SUSPENGING=2]="SUSPENGING",k[k.ERROR=3]="ERROR",ae(Re,Ee=be),Object.defineProperty(Re.prototype,"eof",{get:function(){return this.offset===this.total},enumerable:!1,configurable:!0}),Re.prototype._changeStatus=function(e){this.status!==e&&(Ae.log("loader status changed: ".concat(Te[this.status]," -> ").concat(Te[e])),this.status=e)},Re.prototype.jump=function(e){this.offset=e},Re.prototype.load=function(e,t,r){return this.reset(),this.url=e,this.loadRange(t,r)},Re.prototype.resume=function(){return this.loadRange(this.offset)},Re.prototype.suspend=function(){this.abort(),this._changeStatus(Te.SUSPENGING)},Re.prototype.reset=function(){this.abort(),this.offset=0,this.total=1/0,this.url=""},Re.prototype.destroy=function(){this.removeAllListeners(),this.reset()},Re),xe={isIos:!1,isDingtalk:!1,isQQBrowser:!1};k=(window.navigator.userAgent||"").toLowerCase();function Re(e){void 0===e&&(e={});var t=Ee.call(this)||this;return t.timeout=15e3,t.total=1/0,t.offset=0,t.status=Te.IDLE,t.url="",t._handleError=function(e){if("AbortError"===e.name)return!1;throw t._changeStatus(Te.ERROR),t.emit("error",{code:R.NETWORK,message:e.message,origin:e}),e},t.timeout=e.timeout||t.timeout,t}/(iPhone\sOS)\s([\d_]+)/i.test(k)&&(xe.isIos=!0),-1<k.indexOf("dingtalk")?xe.isDingtalk=!0:-1<k.indexOf("qqbrowser")&&(xe.isQQBrowser=!0),Me=function(e,t){return(Me=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Me(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(He,Oe=we),He.isSupported=function(){return xe.isIos&&(xe.isDingtalk||xe.isQQBrowser)?(console.log("ios","isDingtalk",xe.isDingtalk,"isQQBrowser",xe.isQQBrowser),!1):"undefined"!=typeof AbortController&&"undefined"!=typeof ReadableStream},He.prototype.loadRange=function(e,t){var r=this;if(void 0===e&&(e=0),void 0===t&&(t=1/0),!this.url||e>=this.total)return n.resolve(!1);if(this.status===Te.LOADING||this.status===Te.ERROR)return n.resolve(!1);Ae.info("执行load, from=".concat(e," to=").concat(t," url=").concat(this.url)),this.abort();var i=new Headers,a=0<e||t<1/0;return a&&(t=Math.min(this.total-1,t),i.set("Range","bytes=".concat(e,"-").concat(t===1/0?"":t))),this._changeStatus(Te.LOADING),this.controller=new AbortController,this.emit("loadstart",void 0),this.timer=setTimeout(this.triggerTimeout,this.timeout),fetch(this.url,{method:"GET",headers:i,signal:this.controller.signal}).then((function(t){var i,n;if(clearTimeout(r.timer),t.body&&200<=t.status&&t.status<300)return i=t.body.getReader(),r.offset=e,a?(n=t.headers.get("Content-Range")||"",r.total=Number(n.split("/")[1])||r.total):r.total=Number(t.headers.get("Content-Length"))||r.total,function e(){return i.read().then((function(t){return t.done?(r.controller=null,r._changeStatus(Te.IDLE),r.emit("loadend",void 0),!0):(r.offset+=t.value.byteLength,r.emit("progress",{offset:r.offset-t.value.byteLength,data:t.value}),e())}))}();throw new Error("媒体流数据不存在")})).catch((function(e){return clearTimeout(r.timer),r._handleError(e)}))},ae=He,Pe=function(e,t){return(Pe=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Pe(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(Be,De=we),Be.prototype.abort=function(){var e=this.xhr;e&&(e.onerror=null,e.onprogress=null,e.onloadend=null,e.onreadystatechange=null,e.abort(),this.xhr=null,this._resolve(!1)),this._changeStatus(Te.IDLE)},Be.prototype.loadRange=function(e,t){var r=this;return void 0===e&&(e=0),void 0===t&&(t=1/0),!this.url||e>=this.total||this.status===Te.LOADING||this.status===Te.ERROR?n.resolve(!1):(this.abort(),new n((function(i,n){function a(){var e,t,i=o.responseText,n=i.length,a=l;0<n&&a<n&&(t=r.offset,r.offset+=n-a,l=n,r.emit("progress",{offset:t,data:(e=i.substring(a,n),new Uint8Array(e.length).map((function(t,r){return e.charCodeAt(r)})))}))}r.xhr=new XMLHttpRequest,r._resolve=i;var o=r.xhr,s=0<e||t<1/0,l=(o.open("GET",r.url),s&&o.setRequestHeader("Range","bytes=".concat(e,"-").concat(t===1/0?"":t)),o.onreadystatechange=function(){var e;o.readyState===o.HEADERS_RECEIVED&&200<=o.status&&o.status<300&&(s?(e=o.getResponseHeader("Content-Range")||"",r.total=Number(e.split("/")[1])||r.total):r.total=Number(o.getResponseHeader("Content-Length"))||r.total),o.readyState>=o.HEADERS_RECEIVED&&clearTimeout(r._timer)},r.offset=e,0);o.timeout=r.timeout,o.onprogress=a,o.onloadend=function(){a(),r.xhr=null,r._changeStatus(Te.IDLE),r.emit("loadend",void 0),i(!0)},o.onerror=function(e){r.xhr=null;try{r._handleError(new Error(e.constructor.name))}catch(e){n(e)}},o.overrideMimeType("text/plain; charset=x-user-defined"),r._changeStatus(Te.LOADING),r.emit("loadstart",void 0),r._timer=setTimeout(r.triggerTimeout,r.timeout),o.send()})))};k=Be;var Le=ae.isSupported()?ae:k;Ce=function(e,t){return(Ce=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Ce(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(Ue,Ie=be),Object.defineProperty(Ue.prototype,"loader",{get:function(){return this.customLoader||this.originLoader},enumerable:!1,configurable:!0}),Object.defineProperty(Ue.prototype,"status",{get:function(){return this.loader.status},enumerable:!1,configurable:!0}),Ue.probe=function(e){throw new Error("parser should implements static probe")},Ue.prototype.onProgress=function(e){},Ue.prototype.onLoadEnd=function(){},Ue.prototype.load=function(e){return this.reset(),this.loader.load(e)},Ue.prototype.suspend=function(){return this.loader.suspend()},Ue.prototype.resume=function(){return this.loader.resume()},Ue.prototype.reset=function(){this.loader.reset(),this.metadata=null},Ue.prototype.destroy=function(){this.reset(),this.loader.off("progress",this.onProgress),this.loader.off("loadend",this.onLoadEnd),this.originLoader.destroy(),this.removeAllListeners()};ae=Ue;var Ie,Ce,De,Pe,Oe,Me,Ne=(Fe.BUFFER_LENGTH=9,Fe);function Fe(e){this.signature=String.fromCharCode(e.read(1),e.read(1),e.read(1)),this.version=e.read(1);var t=e.read(1);this.size=e.read(4),e=new f(t,8);e.read(5),this.hasAudio=!!e.read(1),e.read(1),this.hasVideo=!!e.read(1)}function Ue(e){var t=Ie.call(this)||this;return t.skipFrame=x.DEFAULT,t.metadata=null,t.options=e,t.onProgress=t.onProgress.bind(t),t.onLoadEnd=t.onLoadEnd.bind(t),t.originLoader=new Le(t.options),t.customLoader=e.loader,t.loader.on("progress",t.onProgress),t.loader.on("loadend",t.onLoadEnd),t.skipFrame=e.skipFrame||x.DEFAULT,t}function Be(){var e=null!==De&&De.apply(this,arguments)||this;return e.xhr=null,e._timer=-1,e._resolve=function(e){},e.triggerTimeout=function(){e.abort(),e._handleError(new Error("加载超时，请重试"))},e}function He(){var e=null!==Oe&&Oe.apply(this,arguments)||this;return e.controller=null,e.timer=-1,e.abort=function(){clearTimeout(e.timer),e.controller&&!e.controller.signal.aborted&&(e.controller.abort(),e.controller=null),e._changeStatus(Te.IDLE)},e.triggerTimeout=function(){e.abort(),e._handleError(new Error("加载超时，请重试"))},e}(k=ke=ke||{})[k.AUDIO=8]="AUDIO",k[k.VIDEO=9]="VIDEO",k[k.SCRIPT=18]="SCRIPT",je.BUFFER_LENGTH=11;var Ve=je;function je(e){this.type=e.read(1),this.size=e.read(3),this.dts=e.read(3),this.dts|=e.read(1)<<24,e.skip(3)}var Ge,Ke=[5512,11025,22050,44100],qe=[8,16];(k=Ge=Ge||{})[k.ADTS_HEADER=0]="ADTS_HEADER",k[k.RAW=1]="RAW",Ze.readAudioSpecificConfig=function(e){return e=f.fromByte(e,2),{audioObjectType:e.read(5),sampleRate:o[e.read(4)],samplingFrequencyIndex:e.read(4),channelCount:e.read(4)}};var We,Ye,ze,Xe,Qe,Je=Ze;function Ze(e){var t=new f(e.read(1),8);this.codecId=t.read(4),this.sampleRate=Ke[t.read(2)],this.sampleSize=qe[t.read(1)],this.soundType=t.read(1),this.packetType=e.read(1),this.data=e.readToUint8()}function $e(e){var t=e.read(2);return Array.from(Array(t)).map((function(){var t=e.read(1);return 0<t?String.fromCharCode(t):""})).join("")}function et(e){var t=$e(e);e=tt(e);return{key:t,value:e.value,objectEnd:e.objectEnd}}function tt(e){var t={value:null,objectEnd:!1},r=e.read(1);switch(r){case We.NUMBER:t.value=e.readFloat(8);break;case We.BOOLEAN:t.value=!!e.read(1);break;case We.LONG_STRING:case We.STRING:t.value=$e(e);break;case We.OBJECT_START:t.value=function(e){for(var t={};0<e.unreadLength;){var r=et(e);if(r.objectEnd)break;t[r.key]=r.value}return t}(e);break;case We.ECMA_ARRAY:t.value=function(e){for(var t=e.read(4),r={};0<t--;){var i=et(e);r[i.key]=i.value}return r}(e);break;case We.OBJECT_END:t.objectEnd=!0;break;case We.STRICT_ARRAY:t.value=function(e){for(var t=e.read(4),r=[];0<t--;){var i=tt(e);r.push(i.value)}return r}(e);break;case We.DATE:t.value=new Date(e.readFloat(8)+60*e.readInt(2)+1e3);break;default:console.warn("unknown AMF value type",r)}return t}function rt(e){this.name=tt(e).value,this.value=tt(e).value}function it(e){var t=new f(e.read(1),8);this.type=t.read(4),this.codecId=t.read(4),this.packetType=e.read(1),this.cts=e.read(3)+4286578688^4286578688,this.data=e.readToUint8()}(k=We=We||{})[k.NUMBER=0]="NUMBER",k[k.BOOLEAN=1]="BOOLEAN",k[k.STRING=2]="STRING",k[k.OBJECT_START=3]="OBJECT_START",k[k.NULL=5]="NULL",k[k.UNDEFINED=6]="UNDEFINED",k[k.REFERENCE=7]="REFERENCE",k[k.ECMA_ARRAY=8]="ECMA_ARRAY",k[k.OBJECT_END=9]="OBJECT_END",k[k.STRICT_ARRAY=10]="STRICT_ARRAY",k[k.DATE=11]="DATE",k[k.LONG_STRING=12]="LONG_STRING",(k=Ye=Ye||{})[k.KEY=1]="KEY",k[k.INTER=2]="INTER",k[k.DISP_INTER=3]="DISP_INTER",k[k.GENERATED_KEY=4]="GENERATED_KEY",k[k.VIDEO_INFO_CMD=5]="VIDEO_INFO_CMD",(k=ze=ze||{})[k.JPEG=1]="JPEG",k[k.H263=2]="H263",k[k.SCREEN=3]="SCREEN",k[k.VP6=4]="VP6",k[k.VP6A=5]="VP6A",k[k.SCREEN2=6]="SCREEN2",k[k.H264=7]="H264",k[k.REALH263=8]="REALH263",k[k.MPEG4=9]="MPEG4",k[k.H265=12]="H265",(k=Xe=Xe||{})[k.AVC_SEQUENCE_HEADER=0]="AVC_SEQUENCE_HEADER",k[k.AVC_NALU=1]="AVC_NALU",k[k.AVC_END=2]="AVC_END",kt=function(e,t){return(kt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}kt(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(Dt,Et=ae),Dt.probe=function(e){return!(e.byteLength<9)&&"FLV"===new Ne(new a(e.buffer,e.byteOffset,e.byteLength)).signature},Dt.prototype.parse=function(e,t){var r=[];if(e.byteLength){this.unhandleBuffer&&(e=a.concat(this.unhandleBuffer,e),t-=this.unhandleBuffer.byteLength,this.unhandleBuffer=null);var i=new a(e);for(!this.header&&i.unreadLength>=Ne.BUFFER_LENGTH&&(this.header=new Ne(i),!1===this.header.hasVideo&&(this.header.hasVideo=!0),i.skip(this.header.size-Ne.BUFFER_LENGTH));i.unreadLength>4+Ve.BUFFER_LENGTH;){i.skip(4);var n=new Ve(i);if(!(i.unreadLength>=n.size)){i.back(4+Ve.BUFFER_LENGTH);break}var o=new a(i.buffer,i.offset,n.size);switch(i.skip(n.size),n.type){case ke.VIDEO:r=r.concat(this.parseVideoBody(n,o,i.offset+t));break;case ke.AUDIO:r=r.concat(this.parseAudioBody(n,o,i.offset+t));break;case ke.SCRIPT:this.parseScriptBody(n,o);break;default:return Ae.warn("unknown tag type",n.type),r}}this.unhandleBuffer=i.unreadLength?i.readToBuffer():null}return r},Dt.prototype.checkMetadata=function(){var e=this.flvMetadata,t=this.header;if(t&&!this.metadata){var r=[];if(t.hasVideo){if(!this.videoTrackMeta||!this.videoLoaded)return void console.log("checkMetadata hasVideo no this.videoTrackMeta",this.videoTrackMeta,", this.videoLoaded",this.videoLoaded);this.videoTrackMeta.baseDTS=this.baseVideoDTS,this.videoTrackMeta.basePTS=this.baseVideoPTS,r.push(this.videoTrackMeta)}if(t.hasAudio){if(!this.audioTrackMeta||!this.audioLoaded)return void console.log("checkMetadata hasAudio no this.audioTrackMeta",this.audioTrackMeta,", this.audioLoaded",this.audioLoaded);this.audioTrackMeta.baseDTS=this.baseAudioDTS,this.audioTrackMeta.basePTS=this.baseAudioPTS,r.push(this.audioTrackMeta)}t=this.options;var i=t.live;t=t.progressive;this.metadata={formatType:I.FLV,live:!!i,progressive:!i&&!!t,url:this.loader.url,basePTS:Math.min.apply(Math,r.map((function(e){return e.basePTS||0}))),baseDTS:Math.min.apply(Math,r.map((function(e){return e.baseDTS||0}))),timescale:1e3,duration:1e3*((null==e?void 0:e.duration)||1/0),tracks:r},this.emit("loadedmetadata",this.metadata)}},Dt.prototype.parseVideoBody=function(e,t,r){var i=this,n=(t=new it(t),this.emit("loadedtag",{header:e,body:t}),[]),o=t.type===Ye.KEY,s=!1;if(t.data.length)if(t.packetType===Xe.AVC_SEQUENCE_HEADER){var l=this.flvMetadata||{},u={type:C.VIDEO,id:2,baseDTS:0,basePTS:0,timescale:1e3,vps:[],sps:[],pps:[],sei:[],width:l.width||0,height:l.height||0,codec:"",pixelRatio:[]};t.codecId===ze.H264?(y=new K(new a(new ArrayBuffer(8)),0),d=new a(t.data.buffer,t.data.byteOffset,t.data.byteLength),l=new Q(y,d),u.pps=l.pps,u.sps=l.sps,u.codec=l.codec,(l=l.sps[0])&&(l=new M(l.subarray(1)),u.width=l.width,u.height=l.height)):t.codecId===ze.H265&&(console.log("parseVideoBody AVC_SEQUENCE_HEADER EVideoCodecID:",t.codecId,"body.data:",t.data),y=new K(new a(new ArrayBuffer(8)),0),d=new a(t.data.buffer,t.data.byteOffset,t.data.byteLength),l=new ne(y,d),console.log("parseVideoBody hvccBox",l),l.vps.forEach((function(e){return u.vps.push(e)})),l.pps.forEach((function(e){return u.pps.push(e)})),l.sps.forEach((function(e){return u.sps.push(e)})),l.sei.forEach((function(e){return u.sei.push(e)})),u.codec=l.codec,console.log("parseVideoBody AVC_SEQUENCE_HEADER trackMeta:",u)),this.videoTrackMeta=u,this.checkMetadata()}else{var c=[];if(t.codecId===ze.H265){if(this.skipFrame===x.NONREF&&A.isNonRefNALType(A.extractNALType(t.data,4)))return console.error("isNonRefNALType"),[];var d,h,f,p,g,v,y=A.parseHVCVideoData(t.data.subarray(0),e.dts);null!=y&&y.units&&(d=y.units,h={type:C.VIDEO,id:2,baseDTS:0,basePTS:0,timescale:1e3,vps:[],sps:[],pps:[],sei:[],width:(null==(l=this.flvMetadata)?void 0:l.width)||0,height:(null==(l=this.flvMetadata)?void 0:l.height)||0,codec:"",pixelRatio:[]},f=[],p=[],g=[],v=[],d.forEach((function(e){var t;e.type===b.TRAIL_R||e.type===b.IDR_W_RADL?c.push(e.data):e.type===b.SPS?(o=!0,t=new U(function(e){for(var t=e.byteLength,r=[],i=1;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?r.push(i+=2):i++;if(0===r.length)return e;var n=t-r.length,a=new Uint8Array(n),o=0;for(i=0;i<n;o++,i++)o===r[0]&&(o++,r.shift()),a[i]=e[o];return a}(e.data)),h.width=t.width,h.height=t.height,h.pixelRatio=t.pixelRatio,h.codec=t.codec,f.push(e.data)):e.type===b.VPS?p.push(e.data):e.type===b.PPS?g.push(e.data):e.type===b.SEI&&v.push(e.data),s=A.isNonRefNALType(e.type)&&s})),p.length&&(h.vps=p),f.length&&(h.sps=f),g.length&&(h.pps=g),v.length&&(h.sei=v),y.keyframe)&&(this.videoTrackMeta?(p.forEach((function(e){var t;return null==(t=i.videoTrackMeta)?void 0:t.vps.push(e)})),f.forEach((function(e){var t;return null==(t=i.videoTrackMeta)?void 0:t.sps.push(e)})),g.forEach((function(e){var t;return null==(t=i.videoTrackMeta)?void 0:t.pps.push(e)})),v.forEach((function(e){var t;return null==(t=i.videoTrackMeta)?void 0:t.sei.push(e)}))):this.videoTrackMeta=h)}else c=m.extractAVCCNAL(t.data,3);if(!this.videoLoaded&&this.videoTrackMeta){if(!o)return[];this.videoLoaded=!0,this.baseVideoDTS=e.dts,this.baseVideoPTS=t.cts+e.dts,this.checkMetadata()}this.videoTrackMeta&&o&&(this.videoTrackMeta.pps.forEach((function(e){return c.unshift(e)})),this.videoTrackMeta.sps.forEach((function(e){return c.unshift(e)})),this.videoTrackMeta.vps.forEach((function(e){return c.unshift(e)})),this.videoTrackMeta.sei.forEach((function(e){return c.unshift(e)}))),c.length&&(d={trackId:2,codec:(null==(l=this.videoTrackMeta)?void 0:l.codec)||"",trackType:C.VIDEO,isSync:o||t.type===Ye.KEY,isNonRef:s,data:c,dts:e.dts+t.cts,pts:e.dts+t.cts,offset:r,size:c.reduce((function(e,t){return e+t.byteLength}),0)},n.push(d))}else Ae.warn("[videox] flv parse empty data",e,t);return n},Dt.prototype.parseAudioBody=function(e,t,r){t=new Je(t);var i,n=(this.emit("loadedtag",{header:e,body:t}),[]);return t.packetType===Ge.ADTS_HEADER?(i=new a(t.data.buffer,t.data.byteOffset,t.data.byteLength),i=Je.readAudioSpecificConfig(i),this.audioTrackMeta={id:1,baseDTS:0,basePTS:0,type:C.AUDIO,codec:"mp4a.40."+i.audioObjectType,timescale:1e3,audioObjectType:i.audioObjectType,sampleRate:i.sampleRate,samplingFrequencyIndex:i.samplingFrequencyIndex,sampleSize:t.sampleSize,channelCount:i.channelCount},this.checkMetadata()):(this.audioLoaded||(this.audioLoaded=!0,this.baseAudioDTS=e.dts,this.baseAudioPTS=e.dts,this.checkMetadata()),n.push({codec:(null==(i=this.audioTrackMeta)?void 0:i.codec)||"",trackId:1,trackType:C.AUDIO,isSync:!0,isNonRef:!1,data:[t.data],dts:e.dts,pts:e.dts,offset:r,size:t.data.byteLength})),n},Dt.prototype.parseScriptBody=function(e,t){t=new rt(t),this.emit("loadedtag",{header:e,body:t}),e=t.value,e&&"onMetaData"===t.name&&(this.flvMetadata=e,Ae.info("flv script tag loaded, flv metadata:",this.flvMetadata))},Dt.prototype.onProgress=function(e){var t=e.data;e=e.offset;t.byteLength&&(t=this.parse(t.buffer,e)).length&&(e=void 0,this.cachePackets.length?(e=this.cachePackets.concat(t),this.cachePackets=[]):e=t,this.metadata&&this.loader.status!==Te.SUSPENGING?this.emit("loadeddata",{packets:e}):this.cachePackets=e)},Dt.prototype.onLoadEnd=function(){this.loader.eof&&this.emit("end",void 0)},Dt.prototype.seek=function(){},Dt.prototype.reset=function(){Et.prototype.reset.call(this),this.cachePackets=[],this.videoLoaded=!1,this.audioLoaded=!1,this.baseVideoDTS=0,this.baseVideoPTS=0,this.baseAudioDTS=0,this.baseAudioPTS=0,this.header=null,this.unhandleBuffer=null,this.flvMetadata=null,this.videoTrackMeta=null,this.audioTrackMeta=null};var nt=Dt;St=function(e,t){return(St=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}St(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(Ct,Tt=z);var at=Ct;bt=function(e,t){return(bt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}bt(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(It,_t=at);var ot=It;mt=function(e,t){return(mt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}mt(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(Lt,yt=ot);var st=Lt;vt=function(e,t){return(vt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}vt(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(Rt,gt=z);var lt=Rt;pt=function(e,t){return(pt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}pt(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(xt,ft=at);var ut=xt;ht=function(e,t){return(ht=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}ht(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(wt,dt=z);var ct,dt,ht,ft,pt,gt,vt,yt,mt,_t,bt,Tt,St,Et,kt,At=wt;ct=function(e,t){return(ct=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},k=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}ct(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};function wt(e,t){var r=dt.call(this,e,t)||this;r.entries=[],r.version=t.read(1),r.flag=t.read(3),r.entryCount=t.read(4);for(var i=0;i<r.entryCount;i++){var n=1===r.version;r.entries.push({segmentDuration:t.read(n?8:4),mediaTime:t.read(n?8:4),mediaRateInteger:t.read(2),mediaRateFraction:t.read(2)})}return r}function xt(e,t){return e=ft.call(this,e,t)||this,e.version=t.read(1),e.flag=t.read(3),e.entryCount=t.read(4),e}function Rt(e,t){return e=gt.call(this,e,t)||this,e.bufferSizeDB=t.read(4),e.maxBitrate=t.read(4),e.avgBitrate=t.read(4),e}function Lt(){return null!==yt&&yt.apply(this,arguments)||this}function It(e,t){e=_t.call(this,e,t)||this;var r=(t.skip(4),t.skip(2),e.bitReferenceId=t.read(2),e.codeStreamVersion=t.read(4),t.skip(4),t.skip(8),e.width=t.read(2),e.heigth=t.read(2),e.horizontalResolution=t.read(4),e.verticalResolution=t.read(4),t.skip(4),e.frameCount=t.read(2),Math.min(t.read(1),32));return e.compressorName=Array.from(new Array(r)).map((function(){return String.fromCharCode(t.read(1))})).join(""),t.skip(32-(r+1)),e.depth=t.read(2),t.skip(2),e}function Ct(){var e=null!==Tt&&Tt.apply(this,arguments)||this;return e.isContainer=!0,e}function Dt(){var e=null!==Et&&Et.apply(this,arguments)||this;return e.header=null,e.flvMetadata=null,e.videoTrackMeta=null,e.audioTrackMeta=null,e.unhandleBuffer=null,e.cachePackets=[],e.videoLoaded=!1,e.baseVideoPTS=0,e.baseVideoDTS=0,e.audioLoaded=!1,e.baseAudioPTS=0,e.baseAudioDTS=0,e.formatType=I.FLV,e}(Ai=Qe=Qe||{})[Ai.OD=1]="OD",Ai[Ai.IOD=2]="IOD",Ai[Ai.ESD=3]="ESD",Ai[Ai.DCD=4]="DCD",Ai[Ai.DSD=5]="DSD",Ai[Ai.SLCD=6]="SLCD";var Pt=function(){this.constructor=zt};yi.readSize=function(e){for(var t,r=0,i=4;i--&&(r=r<<7|127&(t=e.read(1)),128&t););return r},yi.extractDescriptors=function(e){for(var t,r,i,n=[];e.unreadLength;){if(t=new yi(e),i=new a(e.buffer,e.offset,t.size),e.skip(t.size),t.size<=0)return n;switch(t.tag){case Qe.ESD:r=new Ft(t,i);break;case Qe.DCD:r=new Ut(t,i);break;case Qe.DSD:r=new Bt(t,i);break;case Qe.SLCD:r=new Ht(t,i);break;default:r=null}r&&i.unreadLength&&(r.children=yi.extractDescriptors(i)),n.push(r)}return n};var Ot,Mt=yi,Nt=(vi.findDescriptor=function(e,t){var r;return e.some((function(e){return!!(r=e.probe.tag===t?e:vi.findDescriptor(e.children,t))})),r},vi),Ft=(k(gi,Wr=Nt),gi),Ut=(k(pi,qr=Nt),pi),Bt=(k(fi,Kr=Nt),fi),Ht=(k(hi,Gr=Nt),hi);jr=function(e,t){return(jr=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)};var Vt=((Ai=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}jr(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)})(di,Vr=X),di);Hr=function(e,t){return(Hr=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)};var jt=((k=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Hr(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)})(ci,Br=z),ci);Ur=function(e,t){return(Ur=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)};var Gt=((Ai=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Ur(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)})(ui,Fr=z),ui);Nr=function(e,t){return(Nr=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)};var Kt=((k=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Nr(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)})(li,Mr=z),li);Or=function(e,t){return(Or=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)};var qt=((Ai=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Or(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)})(si,Pr=z),si);Dr=function(e,t){return(Dr=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)};var Wt=((k=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Dr(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)})(oi,Cr=at),oi);Ir=function(e,t){return(Ir=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)};var Yt=((Ai=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Ir(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)})(ai,Lr=z),ai),zt=(Rr=function(e,t){return(Rr=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},ni),Xt=xr=z;if("function"!=typeof Xt&&null!==Xt)throw new TypeError("Class extends value "+String(Xt)+" is not a constructor or null");Rr(zt,Xt),zt.prototype=null===Xt?Object.create(Xt):(Pt.prototype=Xt.prototype,new Pt);var Qt=ni;wr=function(e,t){return(wr=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}wr(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(ii,Ar=z);var Jt=ii;kr=function(e,t){return(kr=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}kr(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(ri,Er=z);var Zt=ri;Sr=function(e,t){return(Sr=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Sr(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(ti,Tr=z);var $t=ti;br=function(e,t){return(br=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}br(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(ei,_r=at);var er=ei;mr=function(e,t){return(mr=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}mr(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}($r,yr=at);var tr=$r;vr=function(e,t){return(vr=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}vr(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(Zr,gr=X);var rr=Zr;pr=function(e,t){return(pr=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}pr(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(Jr,fr=at);var ir=Jr;hr=function(e,t){return(hr=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}hr(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(Qr,dr=X);var nr=Qr;cr=function(e,t){return(cr=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}cr(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(Xr,ur=X);var ar=Xr;lr=function(e,t){return(lr=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}lr(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(zr,sr=X);var or,sr,lr,ur,cr,dr,hr,fr,pr,gr,vr,yr,mr,_r,br,Tr,Sr,Er,kr,Ar,wr,xr,Rr,Lr,Ir,Cr,Dr,Pr,Or,Mr,Nr,Fr,Ur,Br,Hr,Vr,jr,Gr,Kr,qr,Wr,Yr=zr;or=function(e,t){return(or=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},k=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}or(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};function zr(e,t){return e=sr.call(this,e,t)||this,1===e.version?e.baseMediaDecodeTime=t.read(8):e.baseMediaDecodeTime=t.read(4),e}function Xr(e,t){var r=ur.call(this,e,t)||this;r.references=[],r.trackId=t.read(4),r.timescale=t.read(4),0===r.version?(r.pts=t.read(4),r.offset=t.read(4)):(r.pts=t.read(8),r.offset=t.read(8)),t.skip(2),r.references=[];for(var i=t.read(2),n=0;n<i;n++){var a=new f(t.read(4),32),o=t.read(4),s=new f(t.read(4),32);r.references.push({type:a.read(1),size:a.read(31),duration:o,startWithSap:s.read(1),sapType:s.read(3),sapDeltaTime:s.read(28)})}return r}function Qr(e,t){var r=dr.call(this,e,t)||this;r.isLeadings=[],r.sampleDependsOns=[],r.sampleIsDependedOns=[],r.sampleHasRedundancys=[];for(var i=0,n=void 0;i<t.unreadLength;i++)n=new f(t.read(1),8),r.isLeadings[i]=n.read(2),r.sampleDependsOns[i]=n.read(2),r.sampleIsDependedOns[i]=n.read(2),r.sampleHasRedundancys[i]=n.read(2);return r}function Jr(){return null!==fr&&fr.apply(this,arguments)||this}function Zr(){return null!==gr&&gr.apply(this,arguments)||this}function $r(){return null!==yr&&yr.apply(this,arguments)||this}function ei(){return null!==_r&&_r.apply(this,arguments)||this}function ti(e,t){return e=Tr.call(this,e,t)||this,e.version=t.read(1),e.flag=t.read(3),e.graphicsMode=t.read(2),e.opcolor=[t.read(2),t.read(2),t.read(2)],e}function ri(e,t){return e=Er.call(this,e,t)||this,e.version=t.read(1),e.flag=t.read(3),e}function ii(e,t){var r=Ar.call(this,e,t)||this;r.matrix=[],r.version=t.read(1),r.flag=t.read(3),r.createTime=r.toStandardTime(t.read(4)),r.modifyTime=r.toStandardTime(t.read(4)),r.trackId=t.read(4),t.skip(4),r.duration=t.read(4),t.skip(8),r.layer=t.read(2),r.alternateGroup=t.read(2),r.volume=Number(t.read(1)+"."+t.read(1)),t.skip(2);for(var i=0;i<9;i++)r.matrix.push(Number(t.read(2)+"."+t.read(2)));return r.width=Number(t.read(2)+"."+t.read(2)),r.height=Number(t.read(2)+"."+t.read(2)),r}function ni(e,t){var r=xr.call(this,e,t)||this;for(r.data=[];0<t.unreadLength;)r.data.push(t.read(1));return r}function ai(e,t){var r=Lr.call(this,e,t)||this;r.matrix=[],r.version=t.read(1),r.flag=t.read(3),r.createTime=r.toStandardTime(t.read(4)),r.modifyTime=r.toStandardTime(t.read(4)),r.timeScale=t.read(4),r.duration=t.read(4),r.rate=Number(t.read(2)+"."+t.read(2)),r.volume=Number(t.read(1)+"."+t.read(1)),t.skip(10);for(var i=0;i<9;i++)r.matrix.push(Number(t.read(2)+"."+t.read(2)));return t.skip(24),r.nextTrackId=t.read(4),r}function oi(e,t){return e=Cr.call(this,e,t)||this,t.skip(6),e.dataReferenceIndex=t.read(2),t.skip(8),e.channelCount=t.read(2),e.sampleSize=t.read(2),t.skip(4),e.sampleRate=t.read(4)>>>16,e}function si(e,t){function r(e){return 96+(31&e)}e=Pr.call(this,e,t)||this;var i=(e.version=t.read(1),e.flag=t.read(3),1===e.version);e.createTime=e.toStandardTime(t.read(i?8:4)),e.modifyTime=e.toStandardTime(t.read(i?8:4)),e.timeScale=t.read(4),e.duration=t.read(i?8:4),i=t.read(2);return e.language=String.fromCharCode(r(i>>10),r(i>>5),r(i)),e.quality=Number(t.read(1)+"."+t.read(1)),e}function li(e,t){var r=Mr.call(this,e,t)||this;return r.data=t.readToUint8(e.size-e.length),r}function ui(e,t){var r=Fr.call(this,e,t)||this;for(r.name="",r.version=t.read(1),r.flag=t.read(3),r.preDefined=String.fromCharCode(t.read(1),t.read(1),t.read(1),t.read(1)),r.handleType=String.fromCharCode(t.read(1),t.read(1),t.read(1),t.read(1)),t.skip(12);0<t.unreadLength;)r.name+=String.fromCharCode(t.read(1));return r}function ci(e,t){var r=Br.call(this,e,t)||this;for(r.compatibleBrands=[],r.majorBrand=String.fromCharCode(t.read(1),t.read(1),t.read(1),t.read(1)),r.minorVersion=t.read(4);4<=t.unreadLength;)r.compatibleBrands.push(String.fromCharCode(t.read(1),t.read(1),t.read(1),t.read(1)));return r}function di(e,t){e=Vr.call(this,e,t)||this,e.descriptors=[],e.audioObjectType=0,e.samplingfrequencyIndex=0,e.descriptors=Mt.extractDescriptors(t),t=Nt.findDescriptor(e.descriptors,Qe.DCD);var r=Nt.findDescriptor(e.descriptors,Qe.DSD);return r&&(e.audioObjectType=r.audioObjectType,e.samplingfrequencyIndex=r.samplingfrequencyIndex),e.codec=t&&r?"mp4a."+t.mepg4Audio.toString(16)+"."+r.audioObjectType.toString(16):"mp4a",e}function hi(e,t){return e=Gr.call(this,e)||this,e.esId=t.read(2),e}function fi(e,t){return e=Kr.call(this,e)||this,t=new f(t.read(2),16),e.audioObjectType=t.read(5),e.samplingfrequencyIndex=t.read(4),e.channel=t.read(4),e.frameLengthFlag=t.read(1),e.dependsOnCoreCoder=t.read(1),e.extesionFlag=t.read(1),e}function pi(e,t){return e=qr.call(this,e)||this,e.mepg4Audio=t.read(1),e.audioStream=t.read(1),e.bufferSize=t.read(3),e.maxBitrate=t.read(4),e.avgBitrate=t.read(4),e}function gi(e,t){return e=Wr.call(this,e)||this,e.streamDependenceFlag=0,e.URLFlag=0,e.OCRStreamFlag=0,e.esId=t.read(2),e.esFlag=t.read(1),128&e.esFlag&&(e.streamDependenceFlag=t.read(2)),64&e.esFlag&&(e.URLFlag=t.read(1),t.skip(e.URLFlag)),32&e.esFlag&&(e.OCRStreamFlag=t.read(2)),e}function vi(e){this.children=[],this.probe=e}function yi(e){this.tag=e.read(1),this.size=yi.readSize(e)}(Ai=Ot=Ot||{})[Ai.BASE_DATA_OFFSET=1]="BASE_DATA_OFFSET",Ai[Ai.SAMPLE_DESC=2]="SAMPLE_DESC",Ai[Ai.SAMPLE_DUR=8]="SAMPLE_DUR",Ai[Ai.SAMPLE_SIZE=16]="SAMPLE_SIZE",Ai[Ai.SAMPLE_FLAG=32]="SAMPLE_FLAG",Ai[Ai.DUR_EMPTY=65536]="DUR_EMPTY",Ai[Ai.DEFAULT_BASE_IS_MOOF=131072]="DEFAULT_BASE_IS_MOOF",k(xi,Ei=X);var mi,_i=xi;Si=function(e,t){return(Si=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Si(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(wi,Ti=X);var bi,Ti,Si,Ei,ki=wi,Ai=(bi=function(e,t){return(bi=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}bi(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});function wi(e,t){return e=Ti.call(this,e,t)||this,e.trackId=t.read(4),e.defaultSampleDescriptionIndex=t.read(4),e.defaultSampleDuration=t.read(4),e.defaultSampleSize=t.read(4),e.defaultSampleFlag=t.read(4),e}function xi(e,t){return e=Ei.call(this,e,t)||this,e.baseDataOffset=0,e.defaultSampleDescriptionIndex=0,e.defaultSampleDuration=0,e.defaultSampleSize=0,e.defaultSampleFlag=0,e.trackId=t.read(4),e.flag&Ot.BASE_DATA_OFFSET&&(e.baseDataOffset=t.read(8)),e.flag&Ot.SAMPLE_DESC&&(e.defaultSampleDescriptionIndex=t.read(4)),e.flag&Ot.SAMPLE_DUR&&(e.defaultSampleDuration=t.read(4)),e.flag&Ot.SAMPLE_SIZE&&(e.defaultSampleSize=t.read(4)),e.flag&Ot.SAMPLE_FLAG&&(e.defaultSampleFlag=t.read(4)),e}(k=mi=mi||{})[k.DATA_OFFSET=1]="DATA_OFFSET",k[k.FIRST_FLAG=4]="FIRST_FLAG",k[k.DURATION=256]="DURATION",k[k.SIZE=512]="SIZE",k[k.FLAG=1024]="FLAG",k[k.CTS_OFFSET=2048]="CTS_OFFSET",Ai(In,dn=X);var Ri=In;cn=function(e,t){return(cn=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}cn(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(Ln,un=z);var Li=Ln;ln=function(e,t){return(ln=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}ln(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(Rn,sn=z);var Ii=Rn;on=function(e,t){return(on=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}on(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(xn,an=z);var Ci=xn;nn=function(e,t){return(nn=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}nn(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(wn,rn=z);var Di=wn;tn=function(e,t){return(tn=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}tn(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(An,en=at);var Pi=An;$i=function(e,t){return($i=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}$i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(kn,Zi=at);var Oi=kn;Ji=function(e,t){return(Ji=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Ji(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(En,Qi=z);var Mi=En;function Ni(e){return Array.isArray(e)?e:e?[e]:[]}Xi=function(e,t){return(Xi=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Xi(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(Sn,zi=z);var Fi=Sn,Ui=(Tn.prototype.addTrack=function(e){this.tracks.push(e)},Tn.prototype.getTracks=function(){return this.tracks},Tn.prototype.getTrackById=function(e){return this.tracks.find((function(t){return t.options.id===e}))},Tn),Bi=function(){return(Bi=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},Hi=(bn.prototype.getSamples=function(){return this.samples},bn.prototype.getNextSampleOffset=function(){var e=this.samples[this.nextSampleIndex];return e?e.offset:0},bn.prototype.addSample=function(e){this.samples.push(e),this.duration+=e.duration},bn.prototype.processNextSample=function(e,t){void 0===t&&(t=0);var r=this.samples[this.nextSampleIndex];if(r)return this.processSample(e,t,r)},bn.prototype.processSample=function(e,t,r){var i=(t=void 0===t?0:t)+e.byteLength;t=r.offset-t;if(0<=t&&r.offset+r.size<=i)return this.nextSampleIndex++,Bi(Bi({},r),{data:e.subarray(t,t+r.size)})},bn.prototype.processSamples=function(e,t){void 0===t&&(t=0);for(var r=this.samples,i=[],n=this.nextSampleIndex,a=r.length;n<a;n++){var o=this.processSample(e,t,r[n]);if(!o)break;i.push(o)}return i},bn.prototype.seek=function(e){for(var t,r=e*this.options.timeScale,i=-1,n=-1,a=0,o=this.samples.length;a<o;a++)if((t=this.samples[a]).isSync&&(n=a),t.dts+t.cts>=r){i=n;break}if(-1<i)return this.nextSampleIndex=i,this.samples[i]},bn),Vi=(_n.prototype.createMedia=function(e){return this._parseMoovJSON(e)},_n.prototype._parseMoovJSON=function(e){var t=this,r=e.mvhd.box,i=new Ui({duration:r.duration,timeScale:r.timeScale,rate:r.rate,modifyTime:r.modifyTime,createTime:r.createTime});return e.trak&&[].concat(e.trak).forEach((function(r){var n=r.tkhd,a=(r=r.mdia,r.mdhd),o=r.hdlr,s=(r=r.minf.stbl,n=n.box,o=o.box,a=a.box,G[o.handleType]),l=(r=t._buildSamples(r,s),{id:n.trackId,name:o.name,handleType:o.handleType,type:s,createTime:n.createTime,modifyTime:n.modifyTime,layer:n.layer,volume:n.volume,matrix:n.matrix,duration:n.duration,width:n.width,height:n.height,timeScale:a.timeScale,language:a.language,quality:a.quality,defaultSampleDescriptionIndex:1,defaultSampleDuration:0,defaultSampleSize:0,defaultSampleFlag:0}),u=(s=null==(o=e.mvex)?void 0:o.trex,s&&[].concat(s).forEach((function(e){e=e.box,l.defaultSampleDescriptionIndex=e.defaultSampleDescriptionIndex,l.defaultSampleDuration=e.defaultSampleDuration,l.defaultSampleSize=e.defaultSampleSize,l.defaultSampleFlag=e.defaultSampleFlag})),new Hi(l));r.forEach((function(e){return u.addSample(e)})),i.addTrack(u)})),i},_n.prototype._buildSamples=function(e,t){var r,i,n,a,o,s,l,u,c,d,h,f,p,g,v,y,m,_=e.stts,b=e.stss,T=e.ctts,S=e.stsc,E=e.stsz||e.stz2;return E?(s=e.stco||e.co64,l=S.box,u=null==b?void 0:b.box,c=_.box,d=null==T?void 0:T.box,g=p=f=h=-1,v=0,y=[],(m=E.box.sampleSizes).forEach((function(e,_){var b={},T=l.entries;b.size=e,b.trackType=t,0===_?(i=1,r=0,b.chunkIndex=i,o=T[b.chunkRunIndex=r].samplePerChunk,a=0,n=r+1<T.length?T[r+1].firstChunk-1:1/0):_<o?(b.chunkIndex=i,b.chunkRunIndex=r):(i++,a=0,n<(b.chunkIndex=i)&&(n=1+ ++r<T.length?T[r+1].firstChunk-1:1/0),o+=T[b.chunkRunIndex=r].samplePerChunk),b.descriptionIndex=T[r].sampleDescriptionIndex-1,b.offset=s.box.chunkOffsets[b.chunkIndex-1]+a,a+=b.size,h<_&&(f++,h=Math.max(h,0),h+=c.sampleCounts[f]),0<_?((e=y[_-1]).duration=c.sampleDurations[f],b.dts=y[_-1].dts+e.duration):b.dts=0,d?(p<=_&&(g++,p=Math.max(p,0),p+=d.sampleCounts[g]),b.cts=d.sampleOffsets[g]):b.cts=0,u?_===u.sampleNumbers[v]-1?(b.isSync=!0,v++):b.isSync=!1:b.isSync=!0,b.isLast=_===m.length-1,y.push(b)})),y):[]},_n),ji=(mn.prototype.init=function(e){this.options=e},mn.prototype.parse=function(e){var t=this;Ni(e.traf).forEach((function(r){return t._buildSamples(r,e.box)}))},mn.prototype._buildSamples=function(e,t){var r=e.tfhd.box,i=this._getTrakById(r.trackId);if(i)for(var n=i.options,a=e.tfdt.box,o=r.flag,s=(o&Ot.SAMPLE_DESC?r:n).defaultSampleDescriptionIndex,l=(o&Ot.SAMPLE_DUR?r:n).defaultSampleDuration,u=(o&Ot.SAMPLE_SIZE?r:n).defaultSampleSize,c=(o&Ot.SAMPLE_FLAG?r:n).defaultSampleFlag,d=Ni(e.trun),h=n.id,f=n.type,p=o&Ot.BASE_DATA_OFFSET?r.baseDataOffset:o&Ot.DEFAULT_BASE_IS_MOOF?t.header.start:0,g=0,v=0;v<d.length;v++)for(var y=d[v].box,m=y.flag,_=y.dataOffset+p,b=0;b<y.sampleCount;b++){var T={},S=(T.trackId=h,T.trackType=f,T.descriptionIndex=s,m&mi.SIZE?T.size=y.sampleSizes[b]:T.size=u,m&mi.DURATION?T.duration=y.sampleDurations[b]:T.duration=l,T.dts=0<g?g:a?a.baseMediaDecodeTime:0,g=T.dts+T.duration,m&mi.CTS_OFFSET?T.cts=y.sampleCTSs[b]:T.cts=0,c);m&mi.FLAG?S=y.sampleFlags[b]:0===b&&m&mi.FIRST_FLAG&&(S=y.firstSampleFlag),T.offset=_,T.flag=S,T.isSync=!(S&(j.IS_NON_SYNC|j.DEPENDS_YES)),T.isLeading=S>>26&3,T.dependsOn=S>>24&3,T.isDependedOn=S>>22&3,T.hasRedundancy=S>>20&3,T.degradationPriority=65535&S,_+=T.size,T.isLast=v===d.length-1&&b===y.sampleCount-1,i.addSample(T)}},mn.prototype.destroy=function(){this.options=null},mn);Yi=function(e,t){return(Yi=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Yi(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(yn,Wi=ae),yn.probe=function(e){return!(e.byteLength<8)&&"ftyp"===[e[4],e[5],e[6],e[7]].map((function(e){return String.fromCharCode(e)})).join("")},yn.prototype.processPackets=function(e,t){var r,i=this,n=[];return this.media&&e.byteLength&&(this.media.getTracks().forEach((function(r){r.processSamples(e,t).forEach((function(e){e=i.convertSampleToPacket(e),e&&n.push(e)}))})),r=this.getMinNextSampleOffset()-t,this.unhandleBuffer=r>=e.byteLength?null:e.slice(r).buffer),n},Object.defineProperty(yn.prototype,"url",{get:function(){return this.loader.url},enumerable:!1,configurable:!0}),yn.prototype.seek=function(e){var t,r=this.options.progressive;this.unhandleBuffer=null,r&&this.loader.suspend(),null!=(t=this.media)&&t.getTracks().map((function(t){return t.seek(e)})),r&&this.loader.loadRange(this.getMinNextSampleOffset())},yn.prototype.onProgress=function(e){var t=e.data;e=e.offset;t.length&&(this.unhandleBuffer&&(t=a.concatUint8(new Uint8Array(this.unhandleBuffer),t),e-=this.unhandleBuffer.byteLength,this.unhandleBuffer=null),this.metadata||this.parse(new a(t.buffer,0),e),this.metadata)&&(t=this.processPackets(t,e)).length&&this.emit("loadeddata",{packets:t})},yn.prototype.getMinNextSampleOffset=function(){return this.media?Math.min.apply(Math,this.media.getTracks().map((function(e){return e.getNextSampleOffset()}))):0},yn.prototype.parse=function(e,t){var i,n=this;void 0===t&&(t=0);for(var o=e.offset,s=0,l=this;8<=e.unreadLength;){var u=function(){var u,c,d,h,f;return s=e.offset-o,0===(u=new K(e,t+s)).size?(d=new Error("box [".concat(u.type,"] size 为 0")),console.error(d),l.emit("error",{code:R.PARSER,message:d.message,origin:d}),"break"):l.options.progressive&&"mdat"===u.type&&!l.metadata?(c=u.start+u.size,l.loader.suspend(),l.unhandleBuffer=null,Ae.info("检测到mdat box在moov box之后，跳转moov起始偏移位"),l.loader.loadRange(c).then((function(){n.unhandleBuffer=null,n.loader.jump(u.start),n.loader.status!==Te.SUSPENGING&&n.loader.loadRange(u.start,c)})),{value:void 0}):(d=u.size-u.length,e.unreadLength>=d?((f=r[u.type])?(h=new a(e.buffer,e.offset,d),(i=new f(u,h)).isContainer&&((f=new yn({sub:!0})).proxy(l,["loadedbox"]),f.parse(h,s+t+u.length),f.removeAllListeners(),f.boxes.forEach((function(e){i.append(e)})))):i=new z(u),e.skip(d),l.boxes.push(i),void l.emit("loadedbox",i)):(e.back(u.length),"break"))}();if("object"==_typeof(u))return u.value;if("break"===u)break}e.unreadLength&&(this.unhandleBuffer=e.readToBuffer())},yn.prototype.reset=function(){Wi.prototype.reset.call(this),this.boxes=[],this.unhandleBuffer=null,this.avcCBox=void 0,this.hvcCBox=void 0,this.mp4aBox=void 0,this.media=null,this.moofParser.destroy()};var Gi=yn;qi=function(e,t){return(qi=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)};var Ki,qi,Wi,Yi,zi,Xi,Qi,Ji,Zi,$i,en,tn,rn,nn,an,on,sn,ln,un,cn,dn,hn=function(){return(hn=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},fn=["loadedcodecinfo","loadedmetadata","updatedmetadata","loadeddata","error"],pn=[Gi,nt],gn=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}qi(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(vn,Ki=be),vn.prototype.createLoader=function(){var e=new Le(this.options);return e.proxy(this,["progress","error"]),e.proxyOnce(this,["loadstart","loadend"]),e.once("progress",this.handleFirstLoadData),e},vn.prototype.createParser=function(e){return e=new e(hn(hn({},this.options),{loader:this.loader})),e.proxy(this,fn),e},Object.defineProperty(vn.prototype,"skipFrame",{get:function(){return this.activeParser.skipFrame},set:function(e){Ae.info("设置skipFrame:",e),void 0!==e&&(this.options.skipFrame=e,this.activeParser.skipFrame=e)},enumerable:!1,configurable:!0}),Object.defineProperty(vn.prototype,"status",{get:function(){return this.activeParser.status},enumerable:!1,configurable:!0}),Object.defineProperty(vn.prototype,"url",{get:function(){return this.loader.url},enumerable:!1,configurable:!0}),vn.prototype.parse=function(e){Ae.info("执行parse"),this.loader.reset(),this.handleFirstLoadData({offset:0,data:e}),this.activeParser.onLoadEnd()},vn.prototype.load=function(e){return Ae.info("执行load",e),this.loader.destroy(),this.loader=this.createLoader(),this.loader.load(e)},vn.prototype.seek=function(e){return Ae.info("执行seek",e),this.activeParser.seek(e)},vn.prototype.suspend=function(){return this.activeParser.suspend()},vn.prototype.resume=function(){return this.activeParser.resume()},vn.prototype.destroy=function(){Ae.info("执行destory"),this.loader.destroy(),this.activeParser.destroy(),this.removeAllListeners()},vn);function vn(e){void 0===e&&(e={});var t=Ki.call(this)||this;return t.loader=new Le,t.parserClasses=pn,t.logger=Ae,t.handleFirstLoadData=function(e){var r,i;e&&((i=t.parserClasses.find((function(t){return t.probe(e.data)})))?(r=t.activeParser.formatType,t.activeParser.destroy(),t.activeParser=t.createParser(i),Ae.info("切换parser, ".concat(I[r]," -> ").concat(I[t.activeParser.formatType])),t.emit("parserchange",void 0),t.activeParser.onProgress(e)):(i="未找到对应的Parser, Byte数据: "+e.data.slice(0,20).join(","),Ae.error(i),t.emit("error",{code:R.PARSER,message:i})))},t.options=e,t.loader=t.createLoader(),t.activeParser=t.createParser(t.parserClasses[0]),t.logger.info("demuxer options",e),t}function yn(e){var t=Wi.call(this,e=void 0===e?{}:e)||this;return t.media=null,t.unhandleBuffer=null,t.formatType=I.MP4,t.boxes=[],t._handleBoxLoad=function(e){var r,i,n,a,o,s,l,u,c,d,h=e.header.type;t._handleCodecBoxLoaded(h),"hvcC"===h?t.hvcCBox=e:"hvc1"===h||"hev1"===h?t.hvcCBox&&(t.hvcCBox.codecTag=h):"avcC"===h?t.avcCBox=e:"esds"===h?t.esdsBox=e:"mp4a"===h?t.mp4aBox=e:"moov"===h?(d=z.mapBoxToJSON(e),t.media=t.moovParser.createMedia(d),t.moofParser.init({media:t.media}),o=(d=t.mp4aBox||{}).sampleRate,r=void 0===o?0:o,o=d.sampleSize,i=void 0===o?0:o,o=d.channelCount,n=void 0===o?0:o,o=(d=t.esdsBox||{}).audioObjectType,a=void 0===o?0:o,o=d.codec,s=void 0===o?"":o,l=[],u=[],c=[],t.hvcCBox?(u=t.hvcCBox.vps,c=t.hvcCBox.pps,l=t.hvcCBox.sps):t.avcCBox&&(c=t.avcCBox.pps,l=t.avcCBox.sps),t.metadata={formatType:I.MP4,live:!!t.options.live,progressive:!!t.options.progressive,url:t.loader.url,basePTS:0,baseDTS:0,duration:t.media.options.duration,timescale:t.media.options.timeScale,tracks:t.media.getTracks().map((function(e){var o,d,h,f={};switch(f.id=e.options.id,f.type=e.options.type,f.timescale=e.options.timeScale,f.baseDTS=0,f.basePTS=0,f.type){case C.VIDEO:f.width=e.options.width,f.height=e.options.height,f.vps=u,f.sps=l,f.pps=c,f.rotate=(o=e.options.matrix).length<5||(d=Math.hypot(o[0],o[3]),h=Math.hypot(o[1],o[4]),0===d)||0===h?0:180*Math.atan2(o[1]/h,o[0]/d)/Math.PI,f.pixelRatio=[],f.codec=t.hvcCBox?t.hvcCBox.codec:(null==(h=t.avcCBox)?void 0:h.codec)||"",f.codecTag=t.hvcCBox?t.hvcCBox.codecTag:void 0;break;case C.AUDIO:f.audioObjectType=a,f.sampleRate=r,f.sampleSize=i,f.channelCount=n,f.codec=s;break;default:f.type=C.UNKNOWN}return f}))},d=Number(t.options.offsetTime),t.metadata.progressive&&0<d&&t.seek(d),Ae.info("loadedmetadata metadata:",t.metadata),t.emit("loadedmetadata",t.metadata)):"moof"===h&&(Ae.info("检测到moof box被加载，当前素材为fMP4"),t.moofParser.parse(z.mapBoxToJSON(e)))},t._handleCodecBoxLoaded=function(e){var r=["hvc1","hev1","avc1"].find((function(t){return t===e}));r&&t.emit("loadedcodecinfo",r)},t.convertSampleToPacket=function(e){var r,i,n,a,o;return e.trackType===C.VIDEO&&(t.hvcCBox||t.avcCBox)?(o=e.data,r=e.isSync,i=(n=t.hvcCBox||t.avcCBox).lengthSizeMinusOne,n=n.codec,a=m.extractAVCCNAL(o,i),o=!1,t.hvcCBox&&(o=a.every((function(e){return A.isNonRef(e)}))),r&&(t.hvcCBox?(t.hvcCBox.pps.forEach((function(e){return a.unshift(e)})),t.hvcCBox.sps.forEach((function(e){return a.unshift(e)})),t.hvcCBox.vps.forEach((function(e){return a.unshift(e)}))):t.avcCBox&&(t.avcCBox.pps.forEach((function(e){return a.unshift(e)})),t.avcCBox.sps.forEach((function(e){return a.unshift(e)})))),{codec:n,trackId:e.trackId,trackType:e.trackType,isLast:e.isLast,dts:e.dts,pts:e.cts+e.dts,isSync:e.isSync,isNonRef:o,data:a,size:a.reduce((function(e,t){return e+t.byteLength}),0),offset:e.offset}):e.trackType===C.AUDIO&&t.esdsBox?{codec:t.esdsBox.codec,trackId:e.trackId,trackType:e.trackType,dts:e.dts,pts:e.cts+e.dts,isLast:e.isLast,isSync:!0,isNonRef:!1,data:[e.data],size:e.data.byteLength,offset:e.offset}:void 0},t.options=e,t.moovParser=new Vi,t.moofParser=new ji,e.sub||t.on("loadedbox",t._handleBoxLoad),t}function mn(){var e=this;this.options=null,this._getTrakById=function(t){var r;return null==(r=e.options)?void 0:r.media.getTracks().find((function(e){return e.options.id===t}))}}function _n(){}function bn(e){this.samples=[],this.nextSampleIndex=0,this.duration=0,this.options=e}function Tn(e){this.tracks=[],this.options=e}function Sn(e,t){var r=zi.call(this,e,t)||this;r.sampleCounts=[],r.sampleDurations=[],r.version=t.read(1),r.flag=t.read(3);for(var i=t.read(4),n=0;n<i;n++)r.sampleCounts[n]=t.read(4),r.sampleDurations[n]=t.read(4);return r}function En(e,t){var r=Qi.call(this,e,t)||this;r.isContainer=!0,r.sampleSizes=[],r.version=t.read(1),r.flag=t.read(3),r.sampleSize=t.read(4);for(var i=t.read(4),n=0;n<i;n++)0===r.sampleSize?r.sampleSizes.push(t.read(4)):r.sampleSizes.push(r.sampleSize);return r}function kn(e,t){var r=Zi.call(this,e,t)||this;r.sampleNumbers=[],r.version=t.read(1),r.flag=t.read(3);for(var i=t.read(4),n=0;n<i;n++)r.sampleNumbers.push(t.read(4));return r}function An(e,t){return e=en.call(this,e,t)||this,e.version=t.read(1),e.flag=t.read(3),e.entryCount=t.read(4),e}function wn(e,t){var r=rn.call(this,e,t)||this;r.entries=[],r.version=t.read(1),r.flag=t.read(3);for(var i=t.read(4),n=0;n<i;n++)r.entries.push({firstChunk:t.read(4),samplePerChunk:t.read(4),sampleDescriptionIndex:t.read(4)});return r}function xn(e,t){var r=an.call(this,e,t)||this;r.chunkOffsets=[],r.version=t.read(1),r.flag=t.read(3);for(var i=t.read(4),n=0;n<i;n++)r.chunkOffsets.push(t.read(8));return r}function Rn(e,t){var r=sn.call(this,e,t)||this;r.chunkOffsets=[],r.version=t.read(1),r.flag=t.read(3);for(var i=t.read(4),n=0;n<i;n++)r.chunkOffsets.push(t.read(4));return r}function Ln(e,t){var r=un.call(this,e,t)||this;r.sampleCounts=[],r.sampleOffsets=[],r.version=t.read(1),r.flag=t.read(3),r.entryCount=t.read(4);for(var i=0;i<r.entryCount;i++)r.sampleCounts.push(t.read(4)),r.sampleOffsets.push(t.read(4));return r}function In(e,t){var r=dn.call(this,e,t)||this;r.sampleDurations=[],r.sampleSizes=[],r.sampleFlags=[],r.sampleCTSs=[],r.sampleCount=t.read(4),r.flag&mi.DATA_OFFSET?r.dataOffset=t.readInt(4):r.dataOffset=0,r.flag&mi.FIRST_FLAG?r.firstSampleFlag=t.read(4):r.firstSampleFlag=0;for(var i=0;i<r.sampleCount;i++)r.flag&mi.DURATION&&(r.sampleDurations[i]=t.read(4)),r.flag&mi.SIZE&&(r.sampleSizes[i]=t.read(4)),r.flag&mi.FLAG&&(r.sampleFlags[i]=t.read(4)),r.flag&mi.CTS_OFFSET&&(0===r.version?r.sampleCTSs[i]=t.read(4):r.sampleCTSs[i]=t.readInt(4));return r}}(),i;function e(i){var n=r[i];return void 0!==n||(n=r[i]={exports:{}},t[i](n,n.exports,e)),n.exports}var t,r,i},"object"==_typeof(r)&&"object"==_typeof(t)?t.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==_typeof(r)?r.VideoxDemux=i():e.VideoxDemux=i()},{"es6-promise":8}],53:[function(e,t,r){function i(e){for(var t=5381,r=e.length;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()}var n=e("./vttparse");t.exports={parse:function(e,t,r){e=e.trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n");var a,o=[],s=new n;s.oncue=function(e){e.id=i(e.startTime)+i(e.endTime)+i(e.text),e.text=decodeURIComponent(escape(e.text)),e.isBig=!1;var t=e.text.split("#xywh=");2==t.length&&(t=t[1].split(","),e.x=t[0],e.y=t[1],e.w=t[2],e.h=t[3],e.isBig=!0),0<e.endTime&&o.push(e)},s.onparsingerror=function(e){a=e},s.onflush=function(){a&&r?(r(a),console.log(a)):t(o)},e.forEach((function(e){s.parse(e+"\n")})),s.flush()}}},{"./vttparse":55}],54:[function(e,t,r){function i(e){return"string"==typeof e&&!!s[e.toLowerCase()]&&e.toLowerCase()}function n(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)e[r]=i[r]}return e}function a(e,t,r){var a=this,s=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),l={},u=(s?a=document.createElement("custom"):l.enumerable=!0,a.hasBeenReset=!1,""),c=!1,d=e,h=t,f=r,p=null,g="",v=!0,y="auto",m="start",_=50,b="middle",T=50,S="middle";if(Object.defineProperty(a,"id",n({},l,{get:function(){return u},set:function(e){u=""+e}})),Object.defineProperty(a,"pauseOnExit",n({},l,{get:function(){return c},set:function(e){c=!!e}})),Object.defineProperty(a,"startTime",n({},l,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"endTime",n({},l,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"text",n({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(a,"region",n({},l,{get:function(){return p},set:function(e){p=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"vertical",n({},l,{get:function(){return g},set:function(e){if(e="string"==typeof(e=e)&&!!o[e.toLowerCase()]&&e.toLowerCase(),!1===e)throw new SyntaxError("An invalid or illegal string was specified.");g=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"snapToLines",n({},l,{get:function(){return v},set:function(e){v=!!e,this.hasBeenReset=!0}})),Object.defineProperty(a,"line",n({},l,{get:function(){return y},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"lineAlign",n({},l,{get:function(){return m},set:function(e){if(e=i(e),!e)throw new SyntaxError("An invalid or illegal string was specified.");m=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"position",n({},l,{get:function(){return _},set:function(e){if(e<0||100<e)throw new Error("Position must be between 0 and 100.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"positionAlign",n({},l,{get:function(){return b},set:function(e){if(e=i(e),!e)throw new SyntaxError("An invalid or illegal string was specified.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"size",n({},l,{get:function(){return T},set:function(e){if(e<0||100<e)throw new Error("Size must be between 0 and 100.");T=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"align",n({},l,{get:function(){return S},set:function(e){if(e=i(e),!e)throw new SyntaxError("An invalid or illegal string was specified.");S=e,this.hasBeenReset=!0}})),a.displayState=void 0,s)return a}var o,s;t.exports="undefined"!=typeof window&&window.VTTCue?window.VTTCue:(o={"":!0,lr:!0,rl:!0},s={start:!0,middle:!0,end:!0,left:!0,right:!0},a.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},a)},{}],55:[function(e,t,r){function i(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}}var n=e("./vttcue");function a(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new i,this.regionList=[]}function o(){this.values=Object.create(null)}function s(e,t,r,i){var n,a,o=i?e.split(i):[e];for(n in o)"string"==typeof o[n]&&2===(a=o[n].split(r)).length&&t(a[0],a[1])}o.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,r){for(var i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&0<=(t=parseFloat(t))&&t<=100)&&(this.set(e,t),!0)}};var l=new n(0,0,0),u="middle"===l.align?"middle":"center";function c(e,t,r){var i,n,a=e;function c(){var t,r=(r=(r=e).match(/^(\d+):(\d{2})(:\d{2})?(\.\d{3})?/))?(t=(t=r[4])&&t.replace(".",""),r[3]?i(r[1],r[2],r[3].replace(":",""),t):59<r[1]?i(r[1],r[2],0,t):i(0,r[1],r[2],t)):null;function i(e,t,r,i){return 3600*(0|e)+60*(0|t)+(0|r)+(0|i)/1e3}if(null===r)throw new Error("Malformed timestamp: "+a);return e=e.replace(/^[^\sa-zA-Z-]+/,""),r}function d(){e=e.replace(/^\s+/,"")}if(d(),t.startTime=c(),d(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+a);e=e.substr(3),d(),t.endTime=c(),d(),i=e,t=t,n=new o,s(i,(function(e,t){switch(e){case"region":for(var i=r.length-1;0<=i;i--)if(r[i].id===t){n.set(e,r[i].region);break}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":var a=t.split(","),o=a[0];n.integer(e,o),n.percent(e,o)&&n.set("snapToLines",!1),n.alt(e,o,["auto"]),2===a.length&&n.alt("lineAlign",a[1],["start",u,"end"]);break;case"position":a=t.split(","),n.percent(e,a[0]),2===a.length&&n.alt("positionAlign",a[1],["start",u,"end","line-left","line-right","auto"]);break;case"size":n.percent(e,t);break;case"align":n.alt(e,t,["start",u,"end","left","right"])}}),/:/,/\s/),t.region=n.get("region",null),t.vertical=n.get("vertical",""),"auto"===(i=n.get("line","auto"))&&-1===l.line&&(i=-1),t.line=i,t.lineAlign=n.get("lineAlign","start"),t.snapToLines=n.get("snapToLines",!0),t.size=n.get("size",100),t.align=n.get("align",u),"auto"===(i=n.get("position","auto"))&&50===l.position&&(i="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=i}a.prototype={parse:function(e){var t=this;function r(){for(var e=0,r=(r=t.buffer).replace(/<br(?: \/)?>/gi,"\n");e<r.length&&"\r"!==r[e]&&"\n"!==r[e];)++e;var i=r.substr(0,e);return"\r"===r[e]&&++e,"\n"===r[e]&&++e,t.buffer=r.substr(e),i}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var i,a=(i=r()).match(/^WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var o=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:i=r(),t.state){case"HEADER":/:/.test(i)?s(i,(function(e,t){"Region"===e&&console.log("parse region",t)}),/:/):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new n(0,0,""),t.state="CUE",-1===i.indexOf("--\x3e")){t.cue.id=i;continue}case"CUE":try{c(i,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var l=-1!==i.indexOf("--\x3e");if(!i||l&&(o=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=i;continue;case"BADCUE":i||(t.state="ID");continue}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),!this.cue&&"HEADER"!==this.state||(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return this.onflush&&this.onflush(),this}},t.exports=a},{"./vttcue":54}],56:[function(e,t,r){function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,r){t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1})}var o=e("./vtt-parser"),s=e("./vtt-renderer"),l=e("./vtt-loader"),u=e("../../player/base/event/eventtype"),c=e("../../lib/ua"),d=e("../../lib/event"),h=e("../../ui/component/util"),f=(e=function(){function e(e){this.parser=null,this.activeRenderer=null,this.trackConfigs=null,this.hasUserTracks=!1,this.vttText={},this.tickTimer=null,this.prevPosition=null,this._enabled=!1,this._isShow=!1,this.sleeper=new f,this.player=(e=e||{}).player,this.loader=new l,this.parser=new o,this.createRendererInstance(),this.bindEvents()}var t=e.prototype;return t.bindEvents=function(){var e,t=this,r=this,n=this.player,a=(n.on(u.Private.TextTrackFounded,(function(e){if("user"===e.paramData.from)t.hasUserTracks=!0;else if(t.hasUserTracks)return;e=e.paramData.textTracks,e&&e.length&&(t.enabled=!0,t.trackConfigs=e.map((function(e){return i({},e,{label:e.label||e.srclang,language:e.srclang})})),t.trackConfigs.forEach((function(e){t.activeRenderer.addTrack(e),"always"===n.getOptions().controlBarVisibility&&t.activeRenderer.forceUpdateCuesStyle({transform:"translateY(-44px)"},t.parser.cues)})))})),n.on(u.Private.UserTrackReset,(function(){t.hasUserTracks=!1})),c.IS_IOS?(e=!1,n.on(u.Player.RequestFullScreen,(function(){e=!0})),d.on(n.tag,"webkitendfullscreen",(function(){e=!1})),d.on(n.tag.textTracks,"change",(function(){var r;t.sleeper.isSleep||(t.sleeper.sleep(1e3),t.isCustomRenderer)||e&&(r=n.tag.textTracks,(r=Array.from(r).find((function(e){return"showing"===e.mode})))?t.activeTrackConfig&&t.activeTrackConfig.language===r.language||(t.switchTrack(r.language),n.trigger(u.Private.SelectorValueChange,{type:"cc",text:r.label})):n.trigger(u.Private.CCStateChanged,{value:"off",lang:""}))}))):(n.on(u.Player.RequestFullScreen,this.adjustLayout.bind(this)),n.on(u.Player.CancelFullScreen,this.adjustLayout.bind(this)),a=h.debounce((function(){r.isCustomRenderer&&r.activeRenderer.resetCuesStyle(t.parser.cues)}),100),d.on(window,"resize",a)),h.throttle((function(){r.isShow&&(r.activeRenderer.forceUpdateCuesStyle({transform:"translateY(-44px)"},r.parser.cues),r.player.paused())&&(r.activeRenderer.hide(),r.activeRenderer.restore())}),100));n.on(u.Private.ShowBar,a),a=h.throttle((function(){r.isShow&&(r.activeRenderer.forceUpdateCuesStyle({transform:"none"},r.parser.cues),r.player.paused())&&(r.activeRenderer.hide(),r.activeRenderer.restore())}),100);n.on(u.Private.HideBar,a),n.on(u.Private.VttHide,(function(){t.hide()})),n.on(u.Private.VttSwitchTrack,(function(e){t.switchTrack(e.paramData)})),n.on(u.Private.VttClearTracks,(function(){t.reset()}))},t.createRendererInstance=function(e){this.activeRenderer&&this.activeRenderer.dispose();var t=this.player.getOptions(),r={player:this.player};this.adaptPlatform(),e?e===s.VttBasicRenderer.RENDER_TYPE_NATIVE?this.activeRenderer=new s.NativeRenderer(r):(r.overlayId=this.getOverlayId(),this.activeRenderer=new s.CustomRenderer(r)):t.useNativeTextRenderer?this.activeRenderer=new s.NativeRenderer(r):(r.overlayId=this.getOverlayId(),this.activeRenderer=new s.CustomRenderer(r))},t.switchTrack=function(e){var t,r=this;this.trackConfigs&&this.trackConfigs.length&&(this.activeTrackConfig&&(this.parser.dispose(),this.parser=new o,this.activeRenderer.clearTrack(this.activeTrackConfig.language),this.activeRenderer.hide()),this.activeTrackConfig=e,t=this.trackConfigs.find((function(t){return t.language===e})))&&(t=t._loaded?"":(t||{}).src,this.loadVtt(t,(function(){r.parseVtt(),r.activeRenderer.addCues(r.parser.cues,r.activeTrackConfig.language),r.show()})))},t.adaptPlatform=function(){var e=this.player.getOptions();c.IS_IOS&&(e.useNativeTextRenderer=!0)},t.loadVtt=function(e,t){var r=this;e?this.loader.loadFromUrl(e,(function(e){r.activeTrackConfig._loaded=!0,r.vttText[r.activeTrackConfig.language]=e,t&&t()})):t&&t()},t.show=function(){this._isShow=!0,this.isCustomRenderer&&this.startTickTimeListener(),this.activeRenderer.show(this.activeTrackConfig.language)},t.hide=function(){this._isShow=!1,this.clearTicker(),this.activeRenderer.hide()},t.switchRenderer=function(e){var t=this,r=s.VttBasicRenderer.RENDER_TYPE_NATIVE,i=s.VttBasicRenderer.RENDER_TYPE_CUSTOM;(e===r&&this.activeRenderer.type!==r||e===i&&this.activeRenderer.type!==i)&&(this.createRendererInstance(e),this.trackConfigs.forEach((function(e){return t.activeRenderer.addTrack(e)})),this.activeRenderer.addCues(this.parser.cues,this.activeTrackConfig.language),this.show())},t.parseVtt=function(){this.parser.parse(this.vttText[this.activeTrackConfig.language])},t.adjustLayout=function(){var e=this;this.isShow&&this.isCustomRenderer&&(this.activeRenderer.hide(),setTimeout((function(){e.activeRenderer.restore()}),300))},t.startTickTimeListener=function(){var e=this;this.clearTicker(),this.tick((function(){var t=e.player.getCurrentTime();isNaN(t)||e.activeRenderer.renderCues(e.findTargetCues(t))}))},t.tick=function(e){var t=this;this.tickTimer=requestAnimationFrame((function(){try{e()}catch(e){console.log("e",e)}t.tick(e)}))},t.clearTicker=function(){this.tickTimer&&(cancelAnimationFrame(this.tickTimer),this.tickTimer=null)},t.getOverlayId=function(){var e=(this.player.el().getElementsByClassName("prism-text-overlay")||[])[0];if(e)return e.id},t.findTargetCues=function(e){if(this.parser&&e!==this.prevPosition){this.prevPosition=e;for(var t=[],r=0;r<this.parser.cues.length;r++){var i=this.parser.cues[r];if(e>=i.startTime&&e<=i.endTime)t.push(i);else if(e<i.startTime)break}return t}},t.reset=function(){this.clearTicker(),this.parser&&this.parser.reset(),this.activeRenderer&&this.activeRenderer.reset()},t.dispose=function(){this.clearTicker(),this.parser&&(this.parser.dispose(),this.parser=null),this.activeRenderer&&(this.activeRenderer.dispose(),this.activeRenderer=null),this.trackConfigs=null,this.hasUserTracks=!1,this.vttText={},this.prevPosition=null,this._enabled=!1,this._isShow=!1},a(e,[{key:"isShow",get:function(){return this._isShow}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}},{key:"isCustomRenderer",get:function(){if(this.activeRenderer)return this.activeRenderer.type===s.VttBasicRenderer.RENDER_TYPE_CUSTOM}},{key:"activeTrackConfig",get:function(){var e;return null==(e=this.trackConfigs)?void 0:e.find((function(e){return e._isActive}))},set:function(e){this.trackConfigs.forEach((function(t){return t._isActive=t.language===e}))}}]),e}(),function(){function e(){this.value=!1,this.timer=null}return e.prototype.sleep=function(e){var t=this;this.timer&&clearTimeout(this.timer),this.value=!0,this.timer=setTimeout((function(){t.value=!1}),e)},a(e,[{key:"isSleep",get:function(){return this.value}}]),e}());t.exports=e},{"../../lib/event":33,"../../lib/ua":49,"../../player/base/event/eventtype":70,"../../ui/component/util":159,"./vtt-loader":58,"./vtt-parser":59,"./vtt-renderer":60}],57:[function(e,t,r){function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function n(e,t){e.prototype=Object.create(t.prototype),function(e,t){(Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}(e.prototype.constructor=e,t)}function a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,r){t&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1})}var s=e("../../lib/data"),l={DISABLED:"disabled",SHOWING:"showing",HIDDEN:"hidden"},u={SUBTITLES:"subtitles",CAPTIONS:"captions",DESCRIPTIONS:"descriptions",METADATA:"metadata",CHAPTERS:"chapters"},c=(e=function(e){function t(t){t=i({},t=void 0===t?{}:t,{kind:t.kind||u.SUBTITLES,language:t.language||t.srclang||""});var r=t.mode||l.DISABLED;return t.default,-1<[u.METADATA,u.CHAPTERS].indexOf(t.kind)&&(r=l.HIDDEN),t.mode=r,(r=e.call(this,t)||this)._cues=[],r._activeCues=[],r._settings={},r._nativeTrack=null,r._extData={},r._settings=t,r}n(t,e);var r=t.prototype;return r.setExtData=function(e){this._extData=i({},this._extData,e=void 0===e?{}:e)},r.addCue=function(e){this._cues.push(e),this.nativeTrack&&this.nativeTrack.addCue(e)},r.removeCue=function(e){this._cues=this._cues.filter((function(t){return t!==e})),this.nativeTrack&&this.nativeTrack.removeCue(e)},o(t,[{key:"default",get:function(){return this._settings.default}},{key:"mode",get:function(){return this._settings.mode},set:function(e){this._settings.mode=e,this.nativeTrack&&(this.nativeTrack.mode=e)}},{key:"language",get:function(){return this._settings.language},set:function(e){this._settings.language=e,this.nativeTrack&&(this.nativeTrack.language=e)}},{key:"cues",get:function(){return this._cues}},{key:"activeCues",get:function(){return this._activeCues}},{key:"nativeTrack",get:function(){return this._nativeTrack},set:function(e){this._nativeTrack=e}}]),t}(function(){function e(e){this._id=(e=void 0===e?{}:e).id||"prism-track-"+s.guid(),this._kind=e.kind||"",this._language=e.language||"",this._label=e.label||""}return o(e,[{key:"label",get:function(){return this._label},set:function(e){this._label=e}},{key:"id",get:function(){return this._id}},{key:"kind",get:function(){return this._kind}},{key:"language",get:function(){return this._language}}]),e}()),function(e){function t(){return e.call(this)||this}return n(t,e),t}(function(){function e(){this._trackList=[]}return e.prototype.addTrack=function(e){var t=this.length;""+t in this||Object.defineProperty(this,t,{get:function(){return this._trackList[t]}}),-1===this._trackList.indexOf(e)&&this._trackList.push(e)},o(e,[{key:"length",get:function(){return this._trackList.length}},{key:"list",get:function(){return this._trackList}}]),e}()));t.exports.TextTrack=e,t.exports.TextTrackList=c,t.exports.TRACK_MODE=l,t.exports.TRACK_KIND=u},{"../../lib/data":30}],58:[function(e,t,r){var i=e("../io");t.exports=function(){function e(){}return e.prototype.loadFromUrl=function(e,t){i.get(e,(function(e){t(e)}),(function(e,t){console.log("ERR",e,t)}))},e}()},{"../io":40}],59:[function(e,t,r){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var n=e("./vttjs").WebVTT;e=function(){function e(){var e=this;this._cues=[],this._regions=[],this.parser=new n.Parser(window,n.StringDecoder()),this.parser.onregion=function(t){e._regions.push(t)},this.parser.oncue=function(t){e._cues.push(t)},this.parser.onflush=function(){},this.parser.onparsingerror=function(e){console.log("onparsingerror",e)}}var t,r=e.prototype;return r.parse=function(e){this.parser.parse(e),this.parser.flush()},r.reset=function(){this.parser.flush(),this._cues=[],this._regions=[]},r.dispose=function(){this.parser.flush(),this.parser=null,this._cues=[],this._regions=[]},r=e,(t=[{key:"cues",get:function(){return this._cues}}])&&i(r.prototype,t),Object.defineProperty(r,"prototype",{writable:!1}),e}();t.exports=e},{"./vttjs":61}],60:[function(e,t,r){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function a(e,t){e.prototype=Object.create(t.prototype),function(e,t){(Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}(e.prototype.constructor=e,t)}e("../../player/base/event/eventtype");var o=e("./text-track"),s=e("./vttjs").WebVTT,l=e("../../lib/dom"),u=o.TextTrack,c=o.TextTrackList,d=o.TRACK_MODE,h=(o.TRACK_KIND,function(){function e(e){this.player=null,this.type=null,this.trackList=null,this.overrideStyle={},this.player=(e=e||{}).player,this.defineTextTrackGetter(),this.trackList=new c}var t=e.prototype;return t.log=function(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];(e=console).log.apply(e,["[LOG:"+this.type+"]"].concat(r))},t.defineTextTrackGetter=function(){var e=this;this.player.getTextTracks=function(){return e.trackList||[]}},t.show=function(e){e=this.findTrackByLanguage(e),e&&(e.mode=d.SHOWING)},t.findTrackByLanguage=function(e){return this.trackList.list.find((function(t){return t.language===e}))},t.clearCurrentCues=function(e){if(e){var t=e.mode;if(t===d.DISABLED&&(e.mode=d.HIDDEN),e.cues)for(var r=e.cues.length;r--;)e.removeCue(e.cues[r]);t===d.DISABLED&&(e.mode=t)}},t.addTrack=function(){},t.addCues=function(){},t.restore=function(){},t.renderCues=function(){},t.updateCuesStyle=function(){},t.clearTrack=function(e){this.clearCurrentCues(this.findTrackByLanguage(e))},t.clearAllTracks=function(){var e=this;this.trackList&&this.trackList.length&&this.trackList.list.forEach((function(t){t.mode=d.DISABLED,e.clearCurrentCues(t)})),this.trackList=new c},t.reset=function(){this.hide(),this.clearAllTracks()},t.dispose=function(){this.hide(),this.clearAllTracks(),this.player&&this.player.getTextTracks&&(this.player.getTextTracks=null),this.player=null,this.type=null},e}());h.RENDER_TYPE_CUSTOM="CUSTOM",h.RENDER_TYPE_NATIVE="NATIVE",e=function(e){function t(t){var r=e.call(this,t)||this;return r.overlayId=null,r.currentCues=null,t=t||{},r.type=h.RENDER_TYPE_CUSTOM,r.overlayId=t.overlayId,r}a(t,e);var r=t.prototype;return r.addTrack=function(e){var t=new u({kind:e.kind,label:e.label,language:e.language});t.mode=e.default?d.SHOWING:d.DISABLED,this.trackList.addTrack(t)},r.hide=function(){return s.processCues(window,[],document.getElementById(this.overlayId))},r.restore=function(){this.currentCues&&(this.currentCues.forEach((function(e){return e.displayState=null})),s.processCues(window,this.currentCues,this.overlayEl),this.updateCuesStyle(this.currentCues))},r.renderCues=function(e){e&&(this.currentCues=e,this.overlayEl||(this.overlayEl=document.getElementById(this.overlayId)),s.processCues(window,e,this.overlayEl),this.updateCuesStyle(e))},r.updateCuesStyle=function(e){var t=this;e.forEach((function(e){var r,i=e.displayState;i._styleSetDone||i&&(i.setAttribute("class","prism-cue"),t.overlayEl||(t.overlayEl=document.getElementById(t.overlayId)),e=t.overlayEl.offsetWidth,r=t.overlayEl.offsetHeight,(e=Math.min(e,r))&&(i.style.fontSize=.05*e+"px",i.style.height="auto",i.style.top="auto"),Object.keys(t.overrideStyle).forEach((function(e){t.tryUpdateStyle(i,e,t.overrideStyle[e])})),i._styleSetDone=!0)}))},r.updateOverrideStyle=function(e){this.overrideStyle=n({},this.overrideStyle,e=void 0===e?{}:e)},r.forceUpdateCuesStyle=function(e,t){void 0===t&&(t=[]),this.updateOverrideStyle(e=void 0===e?{}:e),this.resetCuesStyle(t)},r.tryUpdateStyle=function(e,t,r){try{e.style[t]=r}catch(e){}},r.resetCuesStyle=function(e){e&&e.length&&e.forEach((function(e){e.displayState&&(e.displayState=null)}))},r.dispose=function(){e.prototype.dispose.call(this),this.overlayId=null,this.currentCues=null},t}(h),o=function(e){function t(t){return(t=e.call(this,t=void 0===t?{}:t)||this).type=h.RENDER_TYPE_NATIVE,t}a(t,e);var r,n=t.prototype;return n.addTrack=function(e){var t=this.player.tag,r=Array.from(t.textTracks)||[],i=r.find((function(t){return t.language===e.language}));this.log("sameLangTrack",i,r),(r=i?(this.clearCurrentCues(i),i.kind=e.kind,i.label=e.label,i):t.addTextTrack(e.kind,e.label,e.language)).mode=e.default?d.SHOWING:d.DISABLED,i=new u(e);i.nativeTrack=r,this.trackList.addTrack(i)},n.addCues=function(e,t){var r;e&&e.length&&(r=this.trackList.list.find((function(e){return e.language===t})))&&e.forEach((function(e){r.addCue(e)}))},n.hide=function(){this.trackList.list.forEach((function(e){e.mode=e.mode===d.SHOWING?d.HIDDEN:e.mode}))},n.invalidAllTracks=function(){},n.forceUpdateCuesStyle=function(e,t){l.addCssByStyle("video::-webkit-media-text-track-container{transform: "+e.transform+";}")},n.dispose=function(){e.prototype.dispose.call(this)},n=t,(r=[{key:"activeTrack",get:function(){return this.trackList.list.find((function(e){return e.mode===d.SHOWING}))}}])&&i(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),t}(h);t.exports.VttBasicRenderer=h,t.exports.CustomRenderer=e,t.exports.NativeRenderer=o},{"../../lib/dom":32,"../../player/base/event/eventtype":70,"./text-track":57,"./vttjs":61}],61:[function(e,t,r){t.exports={WebVTT:e("./vtt.js").WebVTT}},{"./vtt.js":62}],62:[function(e,t,r){function i(e,t){return void 0===t&&(t=1),"rgba("+[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16),t].join(",")+")"}var n,a=1;function o(e,t,r){switch(r){case"webvtt.font.color":case"webvtt.font.opacity":var o=Services.prefs.getCharPref("webvtt.font.color"),s=Services.prefs.getIntPref("webvtt.font.opacity")/100;n.fontSet=i(o,s);break;case"webvtt.font.scale":a=Services.prefs.getIntPref("webvtt.font.scale")/100;break;case"webvtt.bg.color":case"webvtt.bg.opacity":o=Services.prefs.getCharPref("webvtt.bg.color"),s=Services.prefs.getIntPref("webvtt.bg.opacity")/100,n.backgroundSet=i(o,s);break;case"webvtt.edge.color":case"webvtt.edge.type":o=Services.prefs.getIntPref("webvtt.edge.type"),s=Services.prefs.getCharPref("webvtt.edge.color"),n.edgeSet=["","0px 0px ","4px 4px 4px ","-2px -2px ","2px 2px "][o]+i(s)}}"undefined"!=typeof Services&&(n={},["webvtt.font.color","webvtt.font.opacity","webvtt.font.scale","webvtt.bg.color","webvtt.bg.opacity","webvtt.edge.color","webvtt.edge.type"].forEach((function(e){o(0,0,e),Services.prefs.addObserver(e,o,!1)})));var s=Object.create||function(e){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return l.prototype=e,new l};function l(){}function u(e,t){this.name="ParsingError",this.code=e.code,this.message=t||e.message}function c(e){function t(e,t,r,i){return 3600*(0|e)+60*(0|t)+(0|r)+(0|i)/1e3}return e=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/),e?e[3]?t(e[1],e[2],e[3].replace(":",""),e[4]):59<e[1]?t(e[1],e[2],0,e[4]):t(0,e[1],e[2],e[4]):null}function d(){this.values=s(null)}function h(e,t,r,i){var n,a,o=i?e.split(i):[e];for(n in o)"string"==typeof o[n]&&2===(a=o[n].split(r)).length&&t(a[0],a[1])}((u.prototype=s(Error.prototype)).constructor=u).Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},d.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,r){for(var i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&0<=(t=parseFloat(t))&&t<=100)&&(this.set(e,t),!0)}};var f={"&amp;":"&","&lt;":"<","&gt;":">","&lrm;":"‎","&rlm;":"‏","&nbsp;":" "},p={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},g={v:"title",lang:"lang"},v={rt:"ruby"};function y(e,t){function r(e){return f[e]}for(var i,n,a,o,s,l,u,d=e.document.createElement("div"),h=d,y=[];null!==(u=void 0,u=t?(u=(u=t.match(/^([^<]*)(<[^>]+>?)?/))[1]||u[2],t=t.substr(u.length),u):null);)"<"===u[0]?"/"===u[1]?y.length&&y[y.length-1]===u.substr(2).replace(">","")&&(y.pop(),h=h.parentNode):(a=c(u.substr(1,u.length-2)))?(i=e.document.createProcessingInstruction("timestamp",a),h.appendChild(i)):(n=u.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/))&&(a=n[1],o=n[3],l=s=void 0,l=p[a],i=l?((s=e.document.createElement(l)).localName=l,(l=g[a])&&o&&(s[l]=o.trim()),s):null)&&(a=h,v[(l=i).localName]&&v[l.localName]!==a.localName||(n[2]&&(i.className=n[2].substr(1).replace("."," ")),y.push(n[1]),h.appendChild(i),h=i)):h.appendChild(e.document.createTextNode(function(e){for(;n=e.match(/&(amp|lt|gt|lrm|rlm|nbsp);/);)e=e.replace(n[0],r);return e}(u)));return d}var m=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function _(){}function b(e,t,r){var i="undefined"!=typeof navigator&&/MSIE\s8\.0/.test(navigator.userAgent),a="rgba(255, 255, 255, 1)",o="rgba(0, 0, 0, 0.8)",s="",l=(a=(void 0!==n&&(a=n.fontSet,o=n.backgroundSet,s=n.edgeSet),i&&(a="rgb(255, 255, 255)",o="rgb(0, 0, 0)"),_.call(this),this.cue=t,this.cueDiv=y(e,t.text),{color:a,backgroundColor:o,textShadow:s,position:"relative",left:0,right:0,top:0,bottom:0,display:"inline"}),i||(a.writingMode=""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",a.unicodeBidi="plaintext"),this.applyStyles(a,this.cueDiv),this.div=e.document.createElement("div"),a={textAlign:"middle"===t.align?"center":t.align,font:r.font,whiteSpace:"pre-line",position:"absolute"},i||(a.direction=function(e){var t=[],r="";if(e&&e.childNodes)for(n(t,e);r=function e(t){var r,i,a;return t&&t.length?(i=(r=t.pop()).textContent||r.innerText)?(a=i.match(/^.*(\n|\r)/))?a[t.length=0]:i:"ruby"===r.tagName?e(t):r.childNodes?(n(t,r),e(t)):void 0:null}(t);)for(var i=0;i<r.length;i++)if(function(e){for(var t=0;t<m.length;t++){var r=m[t];if(e>=r[0]&&e<=r[1])return 1}}(r.charCodeAt(i)))return"rtl";return"ltr";function n(e,t){for(var r=t.childNodes.length-1;0<=r;r--)e.push(t.childNodes[r])}}(this.cueDiv),a.writingMode=""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"plaintext"),this.applyStyles(a),this.div.appendChild(this.cueDiv),0);switch(t.positionAlign){case"start":l=t.position;break;case"middle":l=t.position-t.size/2;break;case"end":l=t.position-t.size}""===t.vertical?this.applyStyles({left:this.formatStyle(l,"%"),width:this.formatStyle(t.size,"%")}):this.applyStyles({top:this.formatStyle(l,"%"),height:this.formatStyle(t.size,"%")}),this.move=function(e){this.applyStyles({top:this.formatStyle(e.top,"px"),bottom:this.formatStyle(e.bottom,"px"),left:this.formatStyle(e.left,"px"),right:this.formatStyle(e.right,"px"),height:this.formatStyle(e.height,"px"),width:this.formatStyle(e.width,"px")})}}function T(e){var t,r,i,n,a="undefined"!=typeof navigator&&/MSIE\s8\.0/.test(navigator.userAgent);e.div&&(t=e.div.offsetHeight,r=e.div.offsetWidth,i=e.div.offsetTop,n=(n=(n=e.div.childNodes)&&n[0])&&n.getClientRects&&n.getClientRects(),e=e.div.getBoundingClientRect(),n=n?Math.max(n[0]&&n[0].height||0,e.height/n.length):0),this.left=e.left,this.right=e.right,this.top=e.top||i,this.height=e.height||t,this.bottom=e.bottom||i+(e.height||t),this.width=e.width||r,this.lineHeight=void 0!==n?n:e.lineHeight,a&&!this.lineHeight&&(this.lineHeight=13)}function S(e,t,r,i){var n,a=new T(t),o=t.cue,s=function(e){if("number"==typeof e.line&&(e.snapToLines||0<=e.line&&e.line<=100))return e.line;if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement)return-1;for(var t=e.track,r=t.textTrackList,i=0,n=0;n<r.length&&r[n]!==t;n++)"showing"===r[n].mode&&i++;return-1*++i}(o),l=[];if(o.snapToLines){switch(o.vertical){case"":l=["+y","-y"],n="height";break;case"rl":l=["+x","-x"],n="width";break;case"lr":l=["-x","+x"],n="width"}var u=a.lineHeight,c=u*Math.round(s),d=r[n]+u,h=l[0];Math.abs(c)>d&&(c=c<0?-1:1,c*=Math.ceil(d/u)*u),s<0&&(c+=""===o.vertical?r.height:r.width,l=l.reverse()),a.move(h,c)}else{var f=a.lineHeight/r.height*100;switch(o.lineAlign){case"middle":s-=f/2;break;case"end":s-=f}switch(o.vertical){case"":t.applyStyles({top:t.formatStyle(s,"%")});break;case"rl":t.applyStyles({left:t.formatStyle(s,"%")});break;case"lr":t.applyStyles({right:t.formatStyle(s,"%")})}l=["+y","-x","+x","-y"],a=new T(t)}d=function(e,t){for(var n,a=new T(e),o=1,s=0;s<t.length;s++){for(;e.overlapsOppositeAxis(r,t[s])||e.within(r)&&e.overlapsAny(i);)e.move(t[s]);if(e.within(r))return e;var l=e.intersectPercentage(r);l<o&&(n=new T(e),o=l),e=new T(a)}return n||a}(a,l),t.move(d.toCSSCompatValues(r))}function E(){}_.prototype.applyStyles=function(e,t){for(var r in t=t||this.div,e)e.hasOwnProperty(r)&&(t.style[r]=e[r])},_.prototype.formatStyle=function(e,t){return 0===e?0:e+t},(b.prototype=s(_.prototype)).constructor=b,T.prototype.move=function(e,t){switch(t=void 0!==t?t:this.lineHeight,e){case"+x":this.left+=t,this.right+=t;break;case"-x":this.left-=t,this.right-=t;break;case"+y":this.top+=t,this.bottom+=t;break;case"-y":this.top-=t,this.bottom-=t}},T.prototype.overlaps=function(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top},T.prototype.overlapsAny=function(e){for(var t=0;t<e.length;t++)if(this.overlaps(e[t]))return!0;return!1},T.prototype.within=function(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right},T.prototype.overlapsOppositeAxis=function(e,t){switch(t){case"+x":return this.left<e.left;case"-x":return this.right>e.right;case"+y":return this.top<e.top;case"-y":return this.bottom>e.bottom}},T.prototype.intersectPercentage=function(e){return Math.max(0,Math.min(this.right,e.right)-Math.max(this.left,e.left))*Math.max(0,Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top))/(this.height*this.width)},T.prototype.toCSSCompatValues=function(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}},T.getSimpleBoxPosition=function(e){var t=e.div?e.div.offsetHeight:e.tagName?e.offsetHeight:0,r=e.div?e.div.offsetWidth:e.tagName?e.offsetWidth:0,i=e.div?e.div.offsetTop:e.tagName?e.offsetTop:0;return{left:(e=e.div?e.div.getBoundingClientRect():e.tagName?e.getBoundingClientRect():e).left,right:e.right,top:e.top||i,height:e.height||t,bottom:e.bottom||i+(e.height||t),width:e.width||r}},E.StringDecoder=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}},E.convertCueToDOMTree=function(e,t){return e&&t?y(e,t):null},E.processCues=function(e,t,r){if(!e||!t||!r)return null;for(;r.firstChild;)r.removeChild(r.firstChild);var i=e.document.createElement("div");if(i.style.position="absolute",i.style.left="0",i.style.right="0",i.style.top="0",i.style.bottom="0",i.style.margin="1.5%",r.appendChild(i),function(e){for(var t=0;t<e.length;t++)if(e[t].hasBeenReset||!e[t].displayState)return 1}(t))for(var n,o,s=[],l=T.getSimpleBoxPosition(i),u={font:Math.round(.05*l.height*100)/100*a+"px sans-serif"},c=0;c<t.length;c++)o=t[c],n=new b(e,o,u),i.appendChild(n.div),S(0,n,l,s),o.displayState=n.div,s.push(T.getSimpleBoxPosition(n));else for(var d=0;d<t.length;d++)i.appendChild(t[d].displayState)},(E.Parser=function(e,t){this.window=e,this.state="INITIAL",this.buffer="",this.decoder=t||new TextDecoder("utf8"),this.regionList=[]}).prototype={reportOrThrowError:function(e){if(!(e instanceof u))throw e;this.onparsingerror&&this.onparsingerror(e)},parse:function(e){var t=this;function r(){for(var e=t.buffer,r=0;r<e.length&&"\r"!==e[r]&&"\n"!==e[r];)++r;var i=e.substr(0,r);return"\r"===e[r]&&++r,"\n"===e[r]&&++r,t.buffer=e.substr(r),i}function i(e){h(e,(function(e,r){var i;"Region"===e&&(e=r,i=new d,h(e,(function(e,t){switch(e){case"id":i.set(e,t);break;case"width":i.percent(e,t);break;case"lines":i.integer(e,t);break;case"regionanchor":case"viewportanchor":var r,n=t.split(",");2===n.length&&((r=new d).percent("x",n[0]),r.percent("y",n[1]),r.has("x")&&r.has("y"))&&(i.set(e+"X",r.get("x")),i.set(e+"Y",r.get("y")));break;case"scroll":i.alt(e,t,["up"])}}),/=/,/\s/),i.has("id"))&&((e=new t.window.VTTRegion).width=i.get("width",100),e.lines=i.get("lines",3),e.regionAnchorX=i.get("regionanchorX",0),e.regionAnchorY=i.get("regionanchorY",100),e.viewportAnchorX=i.get("viewportanchorX",0),e.viewportAnchorY=i.get("viewportanchorY",100),e.scroll=i.get("scroll",""),t.onregion&&t.onregion(e),t.regionList.push({id:i.get("id"),region:e}))}),/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var n,a=(n=r()).match(/^WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new u(u.Errors.BadSignature);t.state="HEADER"}for(var o=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:n=r(),t.state){case"HEADER":/:/.test(n)?i(n):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new t.window.VTTCue(0,0,""),t.state="CUE",-1===n.indexOf("--\x3e")){t.cue.id=n;continue}case"CUE":try{!function(e,t,r){var i,n,a=e;function o(){var t=c(e);if(null===t)throw new u(u.Errors.BadTimeStamp,"Malformed timestamp: "+a);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function s(){e=e.replace(/^\s+/,"")}if(s(),t.startTime=o(),s(),"--\x3e"!==e.substr(0,3))throw new u(u.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+a);e=e.substr(3),s(),t.endTime=o(),s(),i=e,t=t,n=new d,h(i,(function(e,t){switch(e){case"region":for(var i=r.length-1;0<=i;i--)if(r[i].id===t){n.set(e,r[i].region);break}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":var a=t.split(","),o=a[0];n.integer(e,o),n.percent(e,o)&&n.set("snapToLines",!1),n.alt(e,o,["auto"]),2===a.length&&n.alt("lineAlign",a[1],["start","middle","end"]);break;case"position":a=t.split(","),n.percent(e,a[0]),2===a.length&&n.alt("positionAlign",a[1],["start","middle","end"]);break;case"size":n.percent(e,t);break;case"align":n.alt(e,t,["start","middle","end","left","right"])}}),/:/,/\s/),t.region=n.get("region",null),t.vertical=n.get("vertical",""),t.line=n.get("line","auto"),t.lineAlign=n.get("lineAlign","start"),t.snapToLines=n.get("snapToLines",!0),t.size=n.get("size",100),t.align=n.get("align","middle"),t.position=n.get("position","auto"),t.positionAlign=n.get("positionAlign",{start:"start",left:"start",middle:"middle",end:"end",right:"end"},t.align)}(n,t.cue,t.regionList)}catch(e){t.reportOrThrowError(e),t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var s=-1!==n.indexOf("--\x3e");if(!n||s&&(o=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=n;continue;case"BADCUE":n||(t.state="ID");continue}}}catch(e){t.reportOrThrowError(e),"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var t=this;try{if(t.buffer+=t.decoder.decode(),!t.cue&&"HEADER"!==t.state||(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state)throw new u(u.Errors.BadSignature)}catch(e){t.reportOrThrowError(e)}return t.onflush&&t.onflush(),this}},this.WebVTT=E},{}],63:[function(e,t,r){var i=e("../lib/io");function n(e){this._uploadDuration=e.logDuration||5,this._uploadCount=e.logCount||10,this._logReportTo=e.logReportTo,this._logs=[],this._retry=0,this._disposed=!1,this._supportLocalStorage=!0;var t,r=this;window&&(window.onbeforeunload=function(e){if(0<r._logs.length)if(r._supportLocalStorage)localStorage.setItem("__aliplayer_log_data",JSON.stringify(r._logs));else{r._report();for(var t=(new Date).getTime(),i=t;i<t+500;)i=(new Date).getTime()}});try{localStorage?(t=localStorage.getItem("__aliplayer_log_data"),localStorage.removeItem("__aliplayer_log_data"),t&&(this._logs=JSON.parse(t))):this._supportLocalStorage=!1}catch(e){this._supportLocalStorage=!1}this._start()}e("../lib/storage"),n.prototype.add=function(e){var t=this._logs.length;e.__time__=Math.round(new Date/1e3),0<t&&"4001"==e.e&&(t=this._logs[t-1],"4001"==t.e&&t.__time__-e.__time__<5)||(this._logs.push(e),(this._logs.length>this._uploadCount||"4001"==e.e||"2002"==e.e)&&this._report())},n.prototype.dispose=function(){this._report(),this._disposed=!0},n.prototype._start=function(){this._disposed=!1,this._retry=0,this._report()},n.prototype._report=function(e){var t,r,n;this._tickHandler&&(clearTimeout(this._tickHandler),this._tickHandler=null),0<(e=e||this._logs.splice(0,this._uploadCount)).length?(n={"Content-Type":"application/json;charset=UTF-8","x-log-apiversion":"0.6.0","x-log-bodyrawsize":(t=JSON.stringify({__logs__:e,__source__:""})).length},i.postWithHeader((r=this)._logReportTo,t,n,(function(e){r._tick()}),(function(t){0==r._retry?(r._retry=1,r._report(e)):r._tick()}))):this._tick()},n.prototype._tick=function(){var e;this._disposed||(this._retry=0,(e=this)._logs.length>this._uploadCount?e._report():this._tickHandler=setTimeout((function(){e._report()}),1e3*this._uploadDuration))},t.exports=n},{"../lib/io":40,"../lib/storage":48}],64:[function(e,t,r){function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}var n,a=e("../lib/oo"),o=e("../lib/object"),s=e("../lib/data"),l=e("../lib/io"),u=e("../lib/ua"),c=e("../config"),d=e("../player/base/event/eventtype"),h=e("./util"),f=e("./log"),p=0,g={STARTFETCHDATA:1003,COMPLETEFETCHDATA:1004,PREPARE:1101,PREPAREEND:1102,STARTPLAY:2e3,PLAY:2001,STOP:2002,PAUSE:2003,SEEK:2004,FULLSREEM:2005,QUITFULLSCREEM:2006,RESOLUTION:2007,RESOLUTION_DONE:2008,RECOVER:2010,SEEK_END:2011,PLAYABORT:2012,SEEKED:2014,CANPLAY:2018,FETCHEDIP:2020,CDNDETECT:2021,DETECT:2022,HEVCINFO:2023,UNDERLOAD:3002,LOADED:3001,RETRY:3003,HEARTBEAT:9001,ERROR:4001,ERRORRETRY:4002,RTSFALLBACK:4003,LICENSE_RESULT:5004,SNAPSHOT:2027,ROTATE:2028,IMAGE:2029,THUMBNAILSTART:2031,THUMBNAILCOMPLETE:2032,CCSTART:2033,CCCOMPLETE:2034,AUDIOTRACKSTART:2033,AUDIOTRACKCOMPLETE:2034};e=a.extend({init:function(e,t,r){this.trackLog=r=void 0===r||r,this.player=e,this.requestId="",this.sessionId=s.guid(),this.playId=0,this.firstPlay=!0,this.osName=u.os.name,this.osVersion=u.os.version||"",this.exName=u.browser.name,this.exVersion=u.browser.version||"",this.lightSaasVideoId="",this._logService="",this._h265ProbeCost={},this.startPlayReported=!1,this.canplayReported=!1,this.seekingData={seekingStartTime:0},this.prevStats={timestamp:0,bytesReceived:0,framesDecoded:0,packetsLost:0,packetsReceived:0,rtt:0},t.logBatched&&(this._logService=new f(c));r=this.player.getOptions(),e=t.from||"",r.isLive,t=r.isLive?"live":"vod";var i="pc",n=(u.IS_IPAD?i="pad":u.os.phone&&(i="phone"),this.encodeURL(u.getReferer())),a=u.getHref(),o=this.encodeURL(a),l="",d=(a=(a&&(l=u.getHost(a)),c.h5Version),h.getUuid()),p=r.source?this.encodeURL(r.source):"",g=u.getHost(r.source),v=r.userId?r.userId+"":"0",y=this.sessionId,m=(new Date).getTime(),_=r.traceId||"";this._userNetInfo={cdnIp:"",localIp:""},this.opt={APIVersion:"0.6.0",t:m,ll:"info",lv:"1.0",pd:"player",md:"saas_player",ui:"saas_player",sm:"play",os:this.osName,ov:this.osVersion,et:this.exName,ev:this.exVersion,uat:u.USER_AGENT,hn:"0.0.0.0",bi:e,ri:y,e:"0",args:"0",li_ki:r.license.key||"",vt:t,tt:i,dm:"h5",av:a,uuid:d,vu:p,vd:g,ua:v,dn:"custom",cdn_ip:"0.0.0.0",app_n:l,r:n,pu:o,ti:_},this.bindEvent()},updateVideoInfo:function(e){e=e.from||"",this.opt.bi=e+"",this.updateSourceInfo()},updateSourceInfo:function(){var e,t=this.player.getOptions();t&&(e=t.source?this.encodeURL(t.source):"",t=u.getHost(t.source),this.opt.vu=e,this.opt.vd=t)},updateTraceId:function(e){this.opt.ti=e},updateLightSaasVideoId:function(e){this.lightSaasVideoId=e},replay:function(){this.reset(),this.player.trigger(d.Video.LoadStart),this.player.trigger(d.Video.LoadedMetadata),this.player.trigger(d.Video.LoadedData)},bindEvent:function(){var e=this;this.player.on(d.Player.Init,(function(){e._onPlayerInit()})),this.player.on(d.Video.LoadStart,(function(){e._onPlayerloadstart()})),this.player.on(d.Video.LoadedMetadata,(function(){e._onPlayerLoadMetadata()})),this.player.on(d.Video.LoadedData,(function(){e._onPlayerLoaddata()})),this.player.on(d.Player.H265PlayInfo,(function(t){e._onPlayerH265PlayInfo(t)})),this.player.on(d.Video.Play,(function(){e._onPlayerPlay()})),this.player.on(d.Video.Playing,(function(){e._onPlayerReady()})),this.player.on(d.Video.Ended,(function(){e._onPlayerFinish()})),this.player.on(d.Video.Pause,(function(){e._onPlayerPause()})),this.player.on("seeking",(function(){e._onPlayerSeeking()})),this.player.on("seeked",(function(){e._onPlayerSeeked()})),this.player.on(d.Private.LicenseHasResult,(function(t){e._onLicenseHasResult(t)})),this.player.on(d.Private.SeekStart,(function(t){e._onPlayerSeekStart(t)})),this.player.on(d.Private.EndStart,(function(t){e._seekEndData=t.paramData})),this.player.on(d.Player.Waiting,(function(){e._onPlayerLoaded()})),this.player.on(d.Video.CanPlayThrough,(function(){})),this.player.on(d.Video.CanPlay,(function(){e._waitingDelayLoadingShowHandle&&(clearTimeout(e._waitingDelayLoadingShowHandle),e._waitingDelayLoadingShowHandle=null),e._onPlayerUnderload(),e._onPlayerCanplay()})),this.player.on(d.Video.TimeUpdate,(function(){e._waitingDelayLoadingShowHandle&&(clearTimeout(e._waitingDelayLoadingShowHandle),e._waitingDelayLoadingShowHandle=null),e._seekEndData&&e.player._seeking&&e._onPlayerSeekEnd()})),this.player.on(d.Player.Error,(function(){e._onPlayerError()})),this.player.on(d.Player.RequestFullScreen,(function(){e._onFullscreenChange(1)})),this.player.on(d.Player.CancelFullScreen,(function(){e._onFullscreenChange(0)})),this.player.on(d.Private.PREPARE,(function(t){e._prepareTime=(new Date).getTime(),e._log("PREPARE",{dn:t.paramData})})),this.player.on(d.Player.Snapshoted,(function(){e._log("SNAPSHOT")})),this.player.on(d.Private.Retry,(function(t){t=t.paramData||{},e._log("RETRY",{type:t.type,source:t.source})})),this.player.on(d.Player.RtsFallback,(function(t){var r;t=t.paramData||{};e._log("RTSFALLBACK",{reason:null==(r=t.reason)?void 0:r.error_msg,url:t.fallbackUrl})})),this.startHeartBeat.call(this)},removeEvent:function(){this.player.off("init"),this.player.off("ready"),this.player.off("ended"),this.player.off("play"),this.player.off("pause"),this.player.off("seekStart"),this.player.off("seekEnd"),this.player.off("canplaythrough"),this.player.off("playing"),this.player.off("timeupdate"),this.player.off("error"),this.player.off("fullscreenchange"),this.player.off("seeking"),this.player.off("seeked"),this.player.off(d.Private.PREPARE),this.player.off(d.Player.RtsFallback),this._logService&&this._logService.dispose(),clearInterval(n)},reset:function(){this.stucking=!1,this.startTimePlay=0,this.buffer_flag=0,this.firstPlay=!1,this.playId=0,this._LoadedData=0,this._canPlay=0,this.seekingStartTime=0,this.prevStats={timestamp:0,bytesReceived:0,framesDecoded:0,packetsLost:0,packetsReceived:0,rtt:0},p=0,this.lightSaasVideoId=""},encodeURL:function(e){var t;return e?(t=this.player.getOptions())&&!t.logBatched?encodeURIComponent(e):e:""},startHeartBeat:function(){var e=this;n&&clearInterval(n),n=setInterval((function(){var t;e.player.getCurrentTime()&&(t=Math.floor(1e3*e.player.getCurrentTime()),e.player.paused()?e.prevStats.timestamp=0:++p>=e.player._options.heartHeatInterval&&e.updateStats.call(e,(function(r){var n=e._imageInfo()||{},a=e.player.tag.playbackRate,o=e.player.getVolume();n={vt:t,interval:1e3*p,imgLength:n.imgLength,playbackRate:a,volume:o};r&&(n=i({},n,{dls:Math.floor(r.downloadSpeedPerSec),dfps:Math.floor(r.decodedFramesPerSec),pkl:Number((r.packageLossRate||0).toFixed(2)),rtt:1e3*r.rtt})),e._log("HEARTBEAT",n),p=0})))}),1e3)},updateStats:function(e){e=e||function(){};var t=this;this.player.getStats().then((function(r){var i,n,a,o;r?(o=t.prevStats,r.bytesReceived=r.bytesReceived||0,r.framesDecoded=r.framesDecoded||0,r.packetsLost=r.packetsLost||0,r.packetsReceived=r.packetsReceived||0,i=((t.prevStats=r).timestamp-o.timestamp)/1e3,n=(r.bytesReceived-o.bytesReceived)/i,a=(r.framesDecoded-o.framesDecoded)/i,o=(r.packetsLost-o.packetsLost)/(r.packetsLost-o.packetsLost+(r.packetsReceived-o.packetsReceived)),r=r.rtt,e({downloadSpeedPerSec:n,decodedFramesPerSec:a,packageLossRate:o,rtt:r,timeGap:i})):e()})).catch((function(t){console.log("error in monitor getStats: ",t),e()}))},reportStartPlay:function(){this.startPlayReported||(this._log("STARTPLAY",{vt:(new Date).getTime()}),this.startPlayReported=!0)},reportCanplay:function(){this.canplayReported||(this._log("CANPLAY",{vt:(new Date).getTime()}),this.canplayReported=!0)},reportPlayAbort:function(){this._log("PLAYABORT",{vt:(new Date).getTime()})},resetStartPlayReportFlag:function(){this.startPlayReported=!1},resetCanplayReportFlag:function(){this.canplayReported=!1},resetSessionId:function(){this.sessionId=s.guid()},resetVV:function(){this.startPlayReported&&(this.resetStartPlayReportFlag(),this.resetCanplayReportFlag(),this.resetSessionId())},updateH265ProbeCost:function(e){this._h265ProbeCost=e||{}},_onFullscreenChange:function(e){e?this._log("FULLSREEM",{}):this._log("QUITFULLSCREEM",{})},_onPlayerloadstart:function(){this.loadstartTime=(new Date).getTime(),this.playId=s.guid()},_onPlayerLoadMetadata:function(){this.loadMetaDataCost=(new Date).getTime()-this.loadstartTime},_onPlayerLoaddata:function(){var e,t,r,i;this._LoadedData||this.buffer_flag||(t=e=0,this.player.tag&&(e=this.player.tag.videoWidth,t=this.player.tag.videoHeight),e={tc:(new Date).getTime()-this._prepareTime,cc:(new Date).getTime()-this.loadstartTime,md:this.loadMetaDataCost,mi:JSON.stringify({type:"video",definition:e+"*"+t})},null!=(t=this.player.tag)&&t.duration&&(e.vdur=1e3*(null==(t=this.player.tag)?void 0:t.duration)),(5<this._h265ProbeCost.codecCost||5<this._h265ProbeCost.decoderCost)&&(t=Math.floor(this._h265ProbeCost.codecCost)||0,r=Math.floor(this._h265ProbeCost.decoderCost)||0,e.tc+=i=t+r,e.cc+=i,e.pcc=t,e.pdc=r),this._log("PREPAREEND",e)),this._LoadedData=1},_onPlayerH265PlayInfo:function(e){e=e.paramData||{},this._log("HEVCINFO",{cd:e.codecTag,rd:e.renderType,si:e.simd,sio:e.simdOption,wt:e.wasmThreads,wto:e.wasmThreadsOption,sp:e.splayer})},_onPlayerCanplay:function(){this._canPlay=1,this.reportCanplay(),this._reportPlay(),this.prevStats.timestamp||this.updateStats.call(this)},_onPlayerInit:function(){this.stucking=!1,this.buffer_flag=0,this.pause_flag=0,this.startTimePlay=0,this._LoadedData=0,this._canPlay=0,this.seekingStartTime=0},_onPlayerReady:function(){this.startTimePlay||(this.startTimePlay=(new Date).getTime())},_onPlayerFinish:function(){this._log("STOP",{vt:Math.floor(1e3*this.player.getCurrentTime())}),this.reset()},_reportPlay:function(){var e;return!(this.buffer_flag||!this._LoadedData||!this.playstartTime||(this.first_play_time=(new Date).getTime(),e={dsm:"fix",tc:this.first_play_time-this.loadstartTime,fc:this.first_play_time-this.playstartTime},this._log("PLAY",e),this.buffer_flag=1,0))},_onPlayerPlay:function(){this.playstartTime=(new Date).getTime(),0==this.playId&&(this.playId=s.guid()),this.player._isPreload()||(this.loadstartTime=(new Date).getTime()),this._canPlay&&this._reportPlay()||this.buffer_flag&&this.pause_flag&&(this.pause_flag=0,this.pauseEndTime=(new Date).getTime(),this._log("RECOVER",{vt:Math.floor(1e3*this.player.getCurrentTime()),cost:this.pauseEndTime-this.pauseTime}))},_onPlayerPause:function(){!this.buffer_flag||this.startTimePlay&&!this.player._seeking&&(this.pause_flag=1,this.pauseTime=(new Date).getTime(),this._log("PAUSE",{vt:Math.floor(1e3*this.player.getCurrentTime())}))},_onLicenseHasResult:function(e){e=e.paramData||{},this._log("LICENSE_RESULT",{li_ri:e.result,li_ti:e.featureId||"sdk"})},_onPlayerSeekStart:function(e){this.seekStartTime=e.paramData.fromTime,this.startTimePlay=0,this.seekStartStamp=(new Date).getTime()},_onPlayerSeekEnd:function(){this.seekEndStamp=(new Date).getTime(),this._log("SEEK",{drag_from_timestamp:Math.floor(1e3*this.seekStartTime),drag_to_timestamp:Math.floor(1e3*this._seekEndData.toTime)}),this._log("SEEK_END",{vt:Math.floor(1e3*this.player.getCurrentTime()),cost:this.seekEndStamp-this.seekStartStamp}),this._seekEndData=null},_onPlayerLoaded:function(){var e,t=this;this.buffer_flag&&!this.stucking&&(this.player._seeking?(this.seekingStartTime=this.player.getCurrentTime(),setTimeout((function(){var e=t.player.readyState()<4;t.player.readyState()||(e=!0),t.player.getCurrentTime()===t.seekingStartTime&&e&&(e=t._getbwEstimator(),t._log("UNDERLOAD",{vt:Math.floor(1e3*t.player.getCurrentTime()),bw:e,cbs:t._getCbs()}),t.stucking=!0,t.stuckStartTime=(new Date).getTime())}),500)):(this.stuckStartTime=(new Date).getTime(),this.stuckStartTime-this.startTimePlay<=1e3||(this.stucking=!0,e=this._getbwEstimator(),this._log("UNDERLOAD",{vt:Math.floor(1e3*this.player.getCurrentTime()),bw:e,cbs:this._getCbs()}),this.stuckStartTime=(new Date).getTime())))},_onPlayerUnderload:function(){var e,t,r;!this.buffer_flag&&this.player._options&&this.player._options.autoplay||this.stucking&&(e=Math.floor(1e3*this.player.getCurrentTime()),t=this.stuckStartTime||(new Date).getTime(),0<(t=Math.floor((new Date).getTime()-t))&&t<(1e3*this.player._options.waitingTimeout||6e4)&&(r=this._getbwEstimator(),this._log("LOADED",{vt:e,cost:t,bw:r,cbs:this._getCbs()})),this.seekStart=!1,this.stucking=!1)},_onPlayerSeeking:function(){this.seekStart=!0,this.seekingData.seekingStartTime=performance.now()},_onPlayerSeeked:function(){var e=this;this.player._splayer?this.player.one("canplay",(function(){e._reportSeeked()})):this._reportSeeked()},_reportSeeked:function(){var e=performance.now();e=Math.floor(e-this.seekingData.seekingStartTime);this._log("SEEKED",{vt:Math.floor(1e3*this.player.getCurrentTime()),cost:e})},_onPlayerError:function(){this.playId=0,this._LoadedData=1,this.buffer_flag||this._reportPlay(),this.player.getOptions().autoplay&&this.reportStartPlay()},_getbwEstimator:function(){var e=NaN;try{e=this.player._getbwEstimator&&this.player._getbwEstimator()}catch(e){}return e},_getCbs:function(){return!this.player.getOptions().isLive&&this.seekStart?1:0},_log:function(e,t){if(this.trackLog){this.updateSourceInfo();var r,i=o.copy(this.opt),n=(this.requestId=s.guid(),c.logReportTo),a=(e=(i.e=g[e]+"",i.ri=this.sessionId,i.bi=i.bi&&String(i.bi),i.t=(new Date).getTime()+"",i.cdn_ip=this._userNetInfo.cdnIp,i.hn=this._userNetInfo.localIp,this.player.getCurrentQuality()),""!=e&&(i.definition=e.definition),[]);e=(o.each(t,(function(e,t){if("string"!=typeof t)try{t=JSON.stringify(t)}catch(e){}a.push(e+"="+t)})),""),t=this.player.getOptions(),e=((t&&t.vid||this.lightSaasVideoId)&&(e=t.vid||this.lightSaasVideoId),a.push("vid="+e),"");(e=t&&t.mediaAuth?t.mediaAuth:e)&&a.push("pauth="+e);try{Aliplayer&&Aliplayer.__logCallback__&&(i.args=a,Aliplayer.__logCallback__(i))}catch(e){console.log(e)}return""==(a=a.join("&"))&&(a="0"),i.args=this.encodeURL(a),this._logService?this._logService.add(i):(r=[],o.each(i,(function(e,t){r.push(e+"="+t)})),r=r.join("&"),l.jsonp(n+"?"+r,(function(){}),(function(){}))),this.sessionId}},_imageInfo:function(){try{var e,t,r,i,n,a,o;return/MSIE\s8\.0/.test(navigator.userAgent)?{}:(e=this.player.tag)?(t=document.createElement("canvas"),r=e.videoWidth,i=e.videoHeight,t.width=r,t.height=i,(n=t.getContext("2d")).save(),n.drawImage(e,0,0,r,i),n.restore(),a=t.toDataURL("image/jpeg",1),o="",{imgLength:(o=a?(o=a.substr(a.indexOf(",")+1))||"":o).length}):{}}catch(e){return{}}}});t.exports=e},{"../config":14,"../lib/data":30,"../lib/io":40,"../lib/object":42,"../lib/oo":43,"../lib/ua":49,"../player/base/event/eventtype":70,"./log":63,"./util":65}],65:[function(e,t,r){var i=e("../lib/cookie"),n=e("../lib/data"),a=e("../lib/ua");t.exports.getUuid=function(){var e=i.get("p_h5_u");return e||(e=n.guid(),i.set("p_h5_u",e,730)),e},t.exports.getTerminalType=function(){var e="pc";return a.IS_IPAD?e="pad":a.IS_ANDROID?e="android":a.IS_IOS&&(e="iphone"),e},t.exports.returnUTCDate=function(e){var t=e.getUTCFullYear(),r=e.getUTCMonth(),i=e.getUTCDate(),n=e.getUTCHours(),a=e.getUTCMinutes(),o=e.getUTCSeconds();e=e.getUTCMilliseconds();return Date.UTC(t,r,i,n,a,o,e)},t.exports.getRfc822=function(e){return e.toUTCString().replace("UTC","GMT")}},{"../lib/cookie":29,"../lib/data":30,"../lib/ua":49}],66:[function(e,t,r){var i=e("./base/player"),n=e("./flash/flashplayer"),a=e("./saas/mtsplayer"),o=e("./saas/vodplayer"),s=e("./saas/lightPlayer"),l=e("./audio/audioplayer"),u=e("./hls/hlsplayer"),c=e("./flv/flvplayer"),d=e("./rts/rtsplayer"),h=e("./drm/drmplayer"),f=e("./splayer/splayer"),p=e("../lib/ua"),g=e("../lib/playerutil"),v=(e("../lib/dom"),e("../lib/io"),e("../lang/index")),y=e("../lib/constants"),m=e("./base/event/eventtype");t.exports.create=function(e,t){navigator&&navigator.userAgent&&-1<navigator.userAgent.indexOf("Olympic_Android")&&(e.useNativeControls=!0),e.readyCallback=t="function"!=typeof t?function(){}:t,v.setCurrentLanguage(e.language,"h5",e.languageTexts);t=g.handleOption(e),e=t.source;var r,_=g.isAudio(e),b=(_&&(t.mediaType="audio"),g.createWrapper(t));if(b.player)return b.player;if(_)r=new l(b,t);else if(g.isRts(e))r=new d(b,t);else if((t.forceH265||t.enableH265)&&(g.isMp4(e)||g.isFlv(e)))r=new f(b,t);else if(!t.useFlashPrism&&g.isFlv(e)&&g.isSupportFlv())r=new c(b,t);else if(p.IS_MOBILE||!t.useFlashPrism&&!g.isRTMP(e))if(-1!==[null,void 0].indexOf(t.mediaAuth)||t.source)if(t.vid&&!t.source)if(t.authInfo)r=new a(b,t);else{if(!(t.playauth||t.accessKeyId&&t.accessKeySecret))throw _="vid="+t.vid+" playauth='', playauth property is required by VOD(视频点播) as new Aliplayer.",new Error(_);r=new o(b,t)}else g.isDash(e)&&g.isSupportMSE()?r=new h(b,t):g.isHls(e)?g.canPlayHls()?r=new(g.isSupportHls()&&(g.isUsedHlsPluginOnMobile()||g.isSafariUsedHlsPlugin(t.useHlsPluginForSafari))?t.isDrm?h:u:t.isDrm?h:i)(b,t):g.isSupportHls()?r=new(t.isDrm?h:u)(b,t):p.os.pc?t.userH5Prism||t.useH5Prism||(r=new n(b,t)):r=new i(b,t):(r=new i(b,t),t.source||(_={error_code:y.ErrorCode.InvalidSourceURL,error_msg:"InvalidSourceURL",display_msg:v.get("Error_Empty_Source")},r.trigger(m.Player.Error,_)));else r=new s(b,t);else r=new n(b,t);return r}},{"../lang/index":23,"../lib/constants":28,"../lib/dom":32,"../lib/io":40,"../lib/playerutil":46,"../lib/ua":49,"./audio/audioplayer":68,"./base/event/eventtype":70,"./base/player":91,"./drm/drmplayer":98,"./flash/flashplayer":99,"./flv/flvplayer":101,"./hls/hlsplayer":103,"./rts/rtsplayer":105,"./saas/lightPlayer":109,"./saas/mtsplayer":111,"./saas/vodplayer":117,"./splayer/splayer":126}],67:[function(e,t,r){var i=e("./base/player"),n=e("./flash/flashplayer"),a=e("./saas/mtsplayer"),o=e("./saas/vodplayer"),s=e("./saas/lightPlayer"),l=e("./audio/audioplayer"),u=e("./hls/hlsplayer"),c=e("./flv/flvplayer"),d=e("./rts/rtsplayer"),h=e("./drm/drmplayer"),f=e("./splayer/splayer"),p=e("../lib/ua"),g=e("../lib/playerutil"),v=(e("../lib/dom"),e("../lib/io"),e("../lang/index")),y=e("../lib/constants"),m=e("./base/event/eventtype");t.exports.create=function(e,t){navigator&&navigator.userAgent&&-1<navigator.userAgent.indexOf("Olympic_Android")&&(e.useNativeControls=!0),e.readyCallback=t="function"!=typeof t?function(){}:t,v.setCurrentLanguage(e.language,"h5",e.languageTexts);t=g.handleOption(e),e=t.source;var r,_=g.isAudio(e),b=(_&&(t.mediaType="audio"),g.createWrapper(t));if(b.player)return b.player;if(_)r=new l(b,t);else if(g.isRts(e))r=new d(b,t);else if((t.forceH265||t.enableH265)&&(g.isMp4(e)||g.isFlv(e)))r=new f(b,t);else if(!t.useFlashPrism&&g.isFlv(e)&&g.isSupportFlv())r=new c(b,t);else if(p.IS_MOBILE||!t.useFlashPrism&&!g.isRTMP(e))if(-1!==[null,void 0].indexOf(t.mediaAuth)||t.source)if(t.vid&&!t.source)if(t.authInfo)r=new a(b,t);else{if(!(t.playauth||t.accessKeyId&&t.accessKeySecret))throw _="vid="+t.vid+" playauth='', playauth property is required by VOD(视频点播) as new Aliplayer.",new Error(_);r=new o(b,t)}else g.isDash(e)&&g.isSupportMSE()?r=new h(b,t):g.isHls(e)?g.canPlayHls()?r=new(g.isSupportHls()&&(g.isUsedHlsPluginOnMobile()||g.isSafariUsedHlsPlugin(t.useHlsPluginForSafari))?t.isDrm?h:u:t.isDrm?h:i)(b,t):g.isSupportHls()?r=new(t.isDrm?h:u)(b,t):p.os.pc?t.userH5Prism||t.useH5Prism||(r=new n(b,t)):r=new i(b,t):(r=new i(b,t),t.source||(_={error_code:y.ErrorCode.InvalidSourceURL,error_msg:"InvalidSourceURL",display_msg:v.get("Error_Empty_Source")},r.trigger(m.Player.Error,_)));else r=new s(b,t);else r=new n(b,t);return r}},{"../lang/index":23,"../lib/constants":28,"../lib/dom":32,"../lib/io":40,"../lib/playerutil":46,"../lib/ua":49,"./audio/audioplayer":68,"./base/event/eventtype":70,"./base/player":91,"./drm/drmplayer":98,"./flash/flashplayer":99,"./flv/flvplayer":101,"./hls/hlsplayer":103,"./rts/rtsplayer":105,"./saas/lightPlayer":109,"./saas/mtsplayer":111,"./saas/vodplayer":117,"./splayer/splayer":126}],68:[function(e,t,r){var i=e("../base/player"),n=e("../../ui/component"),a=e("../../lib/dom"),o=e("../../lib/object"),s=e("../../lib/playerutil");e=i.extend({init:function(e,t){this._isAudio=!0,void 0===t.skinLayout&&(t.skinLayout=s.defaultAudioLayout),i.call(this,e,t)}});e.prototype.createEl=function(){"AUDIO"!==this.tag.tagName&&(this._el=this.tag,this.tag=n.prototype.createEl.call(this,"audio"));var e=this._el,t=this.tag,r=(t.player=this,a.getElementAttributes(t));return o.each(r,(function(t){e.setAttribute(t,r[t])})),this.setVideoAttrs(),t.parentNode&&t.parentNode.insertBefore(e,t),a.insertFirst(t,e),e},t.exports=e},{"../../lib/dom":32,"../../lib/object":42,"../../lib/playerutil":46,"../../ui/component":130,"../base/player":91}],69:[function(e,t,r){var i=e("../../../lib/event"),n=e("./eventtype"),a=e("../eventHandler/video/index"),o=e("../eventHandler/player/index");t.exports.offAll=function(e){var t,r,a,o=e.tag,s=e._el;for(t in n.Video)i.off(o,n.Video[t]);for(r in n.Player)i.off(s,n.Player[r]);for(a in n.Private)i.off(s,n.Private[a])},t.exports.offVideoAll=function(e){var t,r=e.tag;for(t in n.Video)i.off(r,n.Video[t])},t.exports.onAll=function(e){a.bind(e),o.bind(e)}},{"../../../lib/event":33,"../eventHandler/player/index":74,"../eventHandler/video/index":84,"./eventtype":70}],70:[function(e,t,r){t.exports={Video:{TimeUpdate:"timeupdate",Play:"play",Playing:"playing",Pause:"pause",CanPlay:"canplay",Waiting:"waiting",Ended:"ended",Error:"error",Suspend:"suspend",Stalled:"stalled",LoadStart:"loadstart",DurationChange:"durationchange",LoadedData:"loadeddata",LoadedMetadata:"loadedmetadata",Progress:"progress",CanPlayThrough:"canplaythrough",ContextMenu:"contextmenu",Seeking:"seeking",Seeked:"seeked",ManualEnded:"manualended",VolumeChange:"volumechange",RateChange:"ratechange"},Player:{TimeUpdate:"timeupdate",DurationChange:"durationchange",Init:"init",Ready:"ready",Play:"play",Playing:"playing",Pause:"pause",CanPlay:"canplay",Waiting:"waiting",Ended:"ended",Error:"error",RequestFullScreen:"requestFullScreen",CancelFullScreen:"cancelFullScreen",Snapshoted:"snapshoted",Snapshoting:"snapshoting",OnM3u8Retry:"onM3u8Retry",LiveStreamStop:"liveStreamStop",AutoPlayPrevented:"autoPlayPrevented",AutoPlay:"autoplay",StartSeek:"startSeek",CompleteSeek:"completeSeek",TextTrackReady:"textTrackReady",AudioTrackReady:"audioTrackReady",AudioTrackUpdated:"audioTrackUpdated",LevelsLoaded:"levelsLoaded",AudioTrackSwitch:"audioTrackSwitch",AudioTrackSwitched:"audioTrackSwitched",LevelSwitch:"levelSwitch",LevelSwitched:"levelSwitched",MarkerDotOver:"markerDotOver",MarkerDotOut:"markerDotOut",DefaultBandWidth:"defaultbandwidth",ResolutionChange:"resolutionChange",SeiFrame:"seiFrame",RtsFallback:"rtsFallback",H265PlayInfo:"h265PlayInfo",H265DecoderOverload:"h265DecoderOverload"},Private:{Play_Btn_Show:"play_btn_show",UiH5Ready:"uiH5Ready",Error_Hide:"error_hide",Error_Show:"error_show",Info_Show:"info_show",Info_Hide:"info_hide",H5_Loading_Show:"h5_loading_show",H5_Loading_Hide:"h5_loading_hide",HideProgress:"hideProgress",CancelHideProgress:"cancelHideProgress",UpdateProgress:"updateProgress",UpdateCursorPosition:"updateCursorPosition",Click:"click",MouseOver:"mouseover",MouseOut:"mouseout",MouseEnter:"mouseenter",MouseLeave:"mouseleave",TouchStart:"touchstart",TouchMove:"touchmove",TouchEnd:"touchend",HideBar:"hideBar",ShowBar:"showBar",ControlBarClick:"controlBarClick",ReadyState:"readyState",SourceLoaded:"sourceloaded",QualityChange:"qualitychange",Play_Btn_Hide:"play_btn_hide",Cover_Hide:"cover_hide",Cover_Show:"cover_show",SeekStart:"seekStart",EndStart:"endStart",UpdateProgressBar:"updateProgressBar",LifeCycleChanged:"lifeCycleChanged",Dispose:"dispose",Created:"created",Snapshot_Hide:"snapshot_hide",AutoStreamShow:"auto_stream_show",AutoStreamHide:"auto_stream_hide",VolumnChanged:"volumnchanged",LiveShiftQueryCompleted:"liveShiftQueryCompleted",LiveShiftSwitchToLive:"LiveShiftSwitchToLive",StreamSelectorHide:"streamSelectorHide",SpeedSelectorHide:"speedSelectorHide",SettingShow:"settingShow",SettingHide:"settingHide",SelectorShow:"selectorShow",SelectorHide:"selectorHide",SettingListShow:"settingListShow",SettingListHide:"settingListHide",ThumbnailHide:"thumbnailHide",ThumbnailShow:"thumbnailShow",ThumbnailLoaded:"thumbnailLoaded",TooltipShow:"tooltipShow",TooltipHide:"tooltipHide",SelectorUpdateList:"selectorUpdateList",SelectorValueChange:"selectorValueChange",SelectorGenerateList:"selectorGenerateList",VolumeVisibilityChange:"volumeVisibilityChange",VolumeUpdatePosition:"volumeUpdatePosition",ChangeURL:"changeURL",UpdateToSettingList:"updateToSettingList",CCChanged:"CCChanged",CCStateChanged:"CCStateChanged",CCReset:"ccReset",TextTrackFounded:"textTrackFounded",UserTrackReset:"userTrackReset",PlayClick:"click",ProgressMarkerLoaded:"progressMarkerLoaded",MarkerTextShow:"markerTextShow",MarkerTextHide:"markerTextHide",PREPARE:"prepare",ProgressMarkerChanged:"progressMarkerChanged",SeiFrame:"privateSeiFrame",PlayInfoLoaded:"playInfoLoaded",Retry:"retry",LicenseHasResult:"licenseHasResult",PatchWaiting:"patchWaiting",VttHide:"vttHide",VttSwitchTrack:"vttSwitchTrack",VttClearTracks:"vttClearTracks",SafariDrmLevelSwitch:"safariDrmLevelSwitch"}}},{}],71:[function(e,t,r){e("../../event/eventtype");var i=e("../../../../lib/dom"),n=e("../../../../lib/ua");t.exports.handle=function(){(!n.IS_IOS||n.IS_IOS&&this._splayer&&2===this._splayer.renderType)&&i.removeClass(this.el(),"prism-fullscreen")}},{"../../../../lib/dom":32,"../../../../lib/ua":49,"../../event/eventtype":70}],72:[function(e,t,r){var i=e("../../event/eventtype");t.exports.handle=function(e){var t=this;t.trigger(i.Player.CompleteSeek,e.paramData.toTime),t.one(i.Player.CanPlay,(function(){t._enteredProgressMarker&&t.pause()}))}},{"../../event/eventtype":70}],73:[function(e,t,r){var i=e("../../event/eventtype"),n=(e("../../../../lib/constants"),e("../../../../lang/index"),e("../../../../monitor/util"));t.exports.handle=function(e){var t=this;e=e.paramData;t.trigger(i.Private.H5_Loading_Hide),t.trigger(i.Private.Cover_Hide),t.trigger(i.Private.Play_Btn_Hide),t.trigger(i.Private.SettingListHide),t.trigger(i.Private.SelectorHide),t.trigger(i.Private.VolumeVisibilityChange,""),e=e||{},t._monitor&&(e.uuid=n.getUuid(),e.requestId=t._serverRequestId,e.cdnIp=t._monitor._userNetInfo.cdnIp,e.localIp=t._monitor._userNetInfo.localIp),t._isError=!0,t.trigger(i.Private.Error_Show,e),t.trigger(i.Private.LifeCycleChanged,{type:i.Player.Error,data:e})}},{"../../../../lang/index":23,"../../../../lib/constants":28,"../../../../monitor/util":65,"../../event/eventtype":70}],74:[function(e,t,r){var i=e("../../event/eventtype"),n=e("../../../../lib/event"),a=e("./lifecyclecommon"),o={endStart:e("./endstart"),seekStart:e("./seekstart"),requestFullScreen:e("./requestfullscreen"),cancelFullScreen:e("./cancelfullscreen"),error:e("./error"),privateSeiFrame:e("./seiframe"),patchWaiting:e("../video/waiting")},s=[i.Private.EndStart,i.Private.SeekStart,i.Player.RequestFullScreen,i.Player.CancelFullScreen,i.Player.Error,i.Player.Ready,i.Private.Dispose,i.Private.Created,i.Private.SeiFrame,i.Private.PatchWaiting];t.exports.bind=function(e){e.el();for(var t=0;t<s.length;t++){var r=s[t];"undefined"!=o[r]&&function(e,t,r){var i=e.el();n.on(i,t,(function(i){var n=(r&&r.handle?r:a).handle;n.call(e,i,t)}))}(e,r,o[r])}}},{"../../../../lib/event":33,"../../event/eventtype":70,"../video/waiting":90,"./cancelfullscreen":71,"./endstart":72,"./error":73,"./lifecyclecommon":75,"./requestfullscreen":76,"./seekstart":77,"./seiframe":78}],75:[function(e,t,r){var i=e("../../event/eventtype");t.exports.handle=function(e,t){this.trigger(i.Private.LifeCycleChanged,{type:t,data:e})}},{"../../event/eventtype":70}],76:[function(e,t,r){e("../../event/eventtype");var i=e("../../../../lib/dom"),n=e("../../../../lib/ua");t.exports.handle=function(){(!n.IS_IOS||n.IS_IOS&&this._splayer&&2===this._splayer.renderType)&&i.addClass(this.el(),"prism-fullscreen")}},{"../../../../lib/dom":32,"../../../../lib/ua":49,"../../event/eventtype":70}],77:[function(e,t,r){var i=e("../../event/eventtype");t.exports.handle=function(e){this._seeking=!0,this.trigger(i.Player.StartSeek,e.paramData.fromTime)}},{"../../event/eventtype":70}],78:[function(e,t,r){e("../../event/eventtype"),t.exports.handle=function(e){e=e.paramData;var t,r,i=e.pts;this._hls&&(t=e.pts,r=this._initPTS,i=parseInt((t-r)/90,10)),this._seis[i]=e.dataContent}},{"../../event/eventtype":70}],79:[function(e,t,r){var i=e("../../event/eventtype");t.exports.handle=function(e){var t=this,r=(t._retrySwitchUrlCount=0,t._liveRetryCount=0,t._clearLiveErrorHandle(),(new Date).getTime()-t.readyTime);t._options.autoplay||t._options._autoplay||!t.paused()||(t.trigger(i.Private.H5_Loading_Hide),t.trigger(i.Private.Play_Btn_Show)),t.trigger(i.Player.CanPlay,{loadtime:r})}},{"../../event/eventtype":70}],80:[function(e,t,r){var i=e("../../event/eventtype"),n=e("../../../../lib/dom"),a=e("../../../../lib/ua");t.exports.handle=function(e){this._seeking=!1;var t=this.tag;"none"===t.style.display&&a.IS_IOS&&setTimeout((function(){n.css(t,"display","block")}),100),this.trigger(i.Video.CanPlayThrough)}},{"../../../../lib/dom":32,"../../../../lib/ua":49,"../../event/eventtype":70}],81:[function(e,t,r){t.exports.handle=function(e,t){var r="";e&&e.paramData&&(r=e.paramData),this.trigger(t,r)}},{}],82:[function(e,t,r){var i=e("../../event/eventtype");e("../../../../lang/index"),e("../../../../lib/event"),t.exports.handle=function(e){var t=this;t.waiting=!1,t._ended=!0,t._monitor&&t._monitor._onPlayerInit(),t._options.rePlay?(t.seek(0),t.tag.play()):t._options.isLive&&t.trigger(i.Private.H5_Loading_Hide),t.trigger(i.Private.Play_Btn_Show),t.trigger(i.Player.Ended)}},{"../../../../lang/index":23,"../../../../lib/event":33,"../../event/eventtype":70}],83:[function(e,t,r){var i=e("../../event/eventtype"),n=e("../../../../lib/constants"),a=e("../../../../lang/index"),o=e("../../../../lib/event"),s=e("../../../../lib/ua"),l=(e("../../../../lib/io"),e("../../../../lib/playerutil"));function u(e,t,r){var i=e._options,o=i.source||"";4===(t=4!==t&&s.IS_IOS&&/qqbrowser/i.test(s.USER_AGENT)?4:t)&&l.isHls(o)?l.detectRegionBlock(o,(function(t){t?(t={mediaId:i.isLive?"ISLIVE":i.vid||"",error_code:n.ErrorCode.RegionBlock,error_msg:a.get("Error_Region_Block_Text")},e.logError(t),e.trigger("error",t)):r()})):r()}t.exports.handle=function(e){var t,r,l,c,d=this;d.waiting=!1,d._clearTimeout(),d.checkOnline()&&!d._splayer&&(l="",e=e.target||e.srcElement,t=e.error&&e.error.message,l="",e.error&&e.error.code&&(r=e.error.code,l=n.VideoErrorCode[e.error.code],t=r+" || "+t),d._options.isLive?u(d,r,(function(){d._options.liveRetry>d._liveRetryCount?d._reloadAndPlayForM3u8():(d._liveRetryCount=0,d.trigger(i.Player.LiveStreamStop),d._liveErrorHandle=setTimeout((function(){var e={mediaId:"ISLIVE",error_code:l,error_msg:a.get("Error_Play_Text")+"，"+a.get("Error_Retry_Text")};d.logError(e),d.trigger("error",e)})),s.IS_UC&&(d._liveErrorHandle=null))})):-1<t.indexOf("NS_ERROR_DOM_MEDIA_FATAL_ERR")?(e=d.getCurrentTime(),(c=d.getDuration())-e<.5&&(d.pause(),d._ended=!0,d.tag.currentTime=c,o.trigger(d.tag,i.Video.ManualEnded))):3==r?(e={mediaId:d._options.vid||"",error_code:l,error_msg:t},d.logError(e),e.display_msg=n.VideoErrorCodeText[r],d.trigger(i.Player.Error,e)):d._reloadForVod()||u(d,r,(function(){var e,o,s;e=a.get("Error_Play_Text"),o=!1,r<3?e=n.VideoErrorCodeText[r]:d._eventState==n.SUSPEND?(e=a.get("Error_Load_Abort_Text"),l=n.ErrorCode.RequestDataError):d._eventState==n.LOAD_START?(e=a.get("Error_Network_Text"),0<d._options.source.indexOf("auth_key")&&(e=e+"，"+a.get("Error_AuthKey_Text")),l=n.ErrorCode.StartLoadData):d._eventState==n.LOADED_METADATA&&(e=a.get("Error_Play_Text"),l=n.ErrorCode.PlayingError),e=e+"，"+a.get("Error_Retry_Text"),1<d._urls.length&&d._retrySwitchUrlCount<3&&-1==d._options.source.indexOf(".mpd")&&(d.switchUrl(),o=!0),s={mediaId:d._options.vid||"",error_code:l,error_msg:t},o||(d.logError(s),s.display_msg=e,d.trigger(i.Player.Error,s))})))}},{"../../../../lang/index":23,"../../../../lib/constants":28,"../../../../lib/event":33,"../../../../lib/io":40,"../../../../lib/playerutil":46,"../../../../lib/ua":49,"../../event/eventtype":70}],84:[function(e,t,r){var i=e("../../../../lib/event"),n=e("../../event/eventtype"),a={canplay:e("./canplay"),canplaythrough:e("./canplaythrough"),common:e("./common"),ended:e("./ended"),error:e("./error"),pause:e("./pause"),play:e("./play"),playing:e("./playing"),waiting:e("./waiting"),timeupdate:e("./timeupdate"),manualended:e("./ended"),loadedmetadata:e("./loadedmetadata")};t.exports.bind=function(e){for(var t in e.tag,n.Video)t=n.Video[t],function(e,t,r){var a=e.tag;i.on(a,t,(function(i){r.handle.call(e,i,t),t!=n.Video.Error&&(t==n.Video.ManualEnded&&(t=n.Video.Ended),e.trigger(n.Private.LifeCycleChanged,{type:t,data:i}))}))}(e,t,void 0!==a[t]?a[t]:a.common)}},{"../../../../lib/event":33,"../../event/eventtype":70,"./canplay":79,"./canplaythrough":80,"./common":81,"./ended":82,"./error":83,"./loadedmetadata":85,"./pause":86,"./play":87,"./playing":88,"./timeupdate":89,"./waiting":90}],85:[function(e,t,r){var i=e("../../event/eventtype");t.exports.handle=function(e){var t=this.tag;this._duration=t.duration<1?0:t.duration,this.trigger(i.Private.ReadyState),this._splayer&&this.trigger(i.Video.DurationChange),this.trigger(i.Video.LoadedMetadata)}},{"../../event/eventtype":70}],86:[function(e,t,r){var i=e("../../event/eventtype"),n=e("../../../../lib/ua");t.exports.handle=function(e){var t=this;t._seeking&&t._splayer||(t._hls&&t._options&&t._options.isLive&&n.IS_FIREFOX&&t.trigger(i.Private.Play_Btn_Show),t._clearTimeout(),t.trigger(i.Private.AutoStreamHide),t.trigger(i.Player.Pause),t._isManualPause&&(t.trigger(i.Private.Play_Btn_Show),t.trigger(i.Private.H5_Loading_Hide)),t.waiting=!1)}},{"../../../../lib/ua":49,"../../event/eventtype":70}],87:[function(e,t,r){var i=e("../../event/eventtype");t.exports.handle=function(e){this.trigger(i.Private.Error_Hide),this.trigger(i.Private.Cover_Hide),this.trigger(i.Private.AutoStreamHide),this.waiting=!1,this.trigger(i.Player.Play)}},{"../../event/eventtype":70}],88:[function(e,t,r){var i=e("../../event/eventtype");t.exports.handle=function(e){var t=this,r=(t.trigger(i.Private.H5_Loading_Hide),t.trigger(i.Private.Cover_Hide),t.trigger(i.Private.Info_Hide),t.waiting=!1,t._ended=!1,t._liveRetryCount=0,t._vodRetryCount=0,t._seeking=!1,t.getCurrentTime());t._waitingReloadTime!=r&&(t._waitingTimeoutCount=0),t._checkTimeoutHandle&&(clearTimeout(t._checkTimeoutHandle),t._checkTimeoutHandle=null),t._waitingLoadedHandle&&(clearTimeout(t._waitingLoadedHandle),t._waitingLoadedHandle=null),t._ucSourceHandle&&(clearTimeout(t._ucSourceHandle),t._ucSourceHandle=null),t._waitingDelayLoadingShowHandle&&(clearTimeout(t._waitingDelayLoadingShowHandle),t._waitingDelayLoadingShowHandle=null),t._waitingTimeoutHandle&&(clearTimeout(t._waitingTimeoutHandle),t._waitingTimeoutHandle=null,t._ccService)&&t._options.isLive&&(r=t._ccService.getCurrentSubtitle(),t._setDefaultCC=!0,r)&&t._ccService.switch(r),t.trigger(i.Private.AutoStreamHide),t.trigger(i.Player.Playing),t.trigger(i.Private.Error_Hide),t.tag.paused||t.trigger(i.Private.Play_Btn_Hide)}},{"../../event/eventtype":70}],89:[function(e,t,r){var i=e("../../event/eventtype"),n=e("../../../../lib/ua"),a=e("../../../../lib/event"),o=e("../../plugin/status");t.exports.handle=function(e){var t,r=this,s=(e=(r.trigger(i.Player.TimeUpdate,e.timeStamp),(n.IS_IOS||n.IS_MAC_SAFARI)&&(clearTimeout(r._waitingPatchTimer),r._waitingPatchTimer=setTimeout((function(){r.waiting||r._isError||r.paused()||r._disposed||(console.log("!!!!!!!manually waiting!!!!!!!"),r.trigger(i.Private.PatchWaiting))}),3e3)),r.getCurrentTime()),r.waiting&&!r._TimeUpdateStamp&&(r._TimeUpdateStamp=e),0!=r.waiting&&r._TimeUpdateStamp==e||(r.trigger(i.Private.H5_Loading_Hide),r.trigger(i.Private.AutoStreamHide),r._checkTimeoutHandle&&clearTimeout(r._checkTimeoutHandle),r._waitingTimeoutHandle&&clearTimeout(r._waitingTimeoutHandle),r._waitingLoadedHandle&&clearTimeout(r._waitingLoadedHandle),r._ucSourceHandle&&(clearTimeout(r._ucSourceHandle),r._ucSourceHandle=null),r.waiting=!1),n.IS_ANDROID&&n.IS_UC&&(r._timeNotUpdateCount=r._timeNotUpdateCount||0,r.waiting||e!==r._TimeUpdateStamp||(r._timeNotUpdateCount++,2<=r._timeNotUpdateCount&&(r._timeNotUpdateCount=0,r.trigger(i.Private.PatchWaiting)))),r._TimeUpdateStamp=e,r._options.isLive||(t=!1,(t=!!((s=r.getDuration())<e&&!r.paused()||s-e<.2&&0<=n.browser.version.indexOf("49.")&&!r.paused()||r.exceedPreviewTime(e))||t)&&!r._ended&&(r.pause(),a.trigger(r.tag,i.Video.ManualEnded))),r._player.tag),l=(s&&r._options.isLive&&(r._player.resolution&&0<s.videoWidth&&0<s.videoHeight&&(0<r._player.resolution.width||0<r._player.resolution.height)&&(r._player.resolution.width!==s.videoWidth||r._player.resolution.height!==s.videoHeight)&&(t={oldResolution:{width:r._player.resolution.width,height:r._player.resolution.height},newResolution:{width:s.videoWidth,height:s.videoHeight}},r.trigger(i.Player.ResolutionChange,t)),r._player.resolution.width=0==s.videoWidth?r._player.resolution.width:s.videoWidth,r._player.resolution.height=0==s.videoHeight?r._player.resolution.height:s.videoHeight),n.IS_CHROME&&Number(n.CHROME_VERSION)<50&&(r._playingSlientPause&&(clearTimeout(r._playingSlientPause),r._playingSlientPause=null),r._playingSlientPause=setTimeout((function(){var e,t;r._status!=o.playing||r.paused()||r._drm||r._urls.length||(e=r.getCurrentTime(),t=r._options.isLive?0:e,r._loadByUrlInner(r._options.source,t,e,!0))}),3e3)),r._seis||{}),u=Object.keys(l);if(0!==u.length){var c=parseInt(1e3*e,10);if(!(h=l[c]))for(var d=0;d<250;d++){var h,f=c+d;if(h=l[f]){for(var p=0;p<u.length&&u[p]<=f;p++)delete l[u[p]];break}}h&&r.trigger(i.Player.SeiFrame,h)}}},{"../../../../lib/event":33,"../../../../lib/ua":49,"../../event/eventtype":70,"../../plugin/status":95}],90:[function(e,t,r){var i=e("../../event/eventtype"),n=e("../../../../lib/constants"),a=e("../../../../lib/event"),o=e("../../../../lang/index"),s=e("../../../../lib/ua"),l=e("../../../../lib/playerutil");t.exports.handle=function(e){var t=this;if(!t._options.isLive){var r=this.getCurrentTime(),u=this.getDuration();if(!t._ended&&0<u&&(u-r<.5||u<r))return t.pause(),t._ended=!0,void a.trigger(this.tag,i.Video.ManualEnded)}function c(){t._checkTimeoutHandle&&(clearTimeout(t._checkTimeoutHandle),t._checkTimeoutHandle=null),t._waitingTimeoutHandle&&(clearTimeout(t._waitingTimeoutHandle),t._waitingTimeoutHandle=null),t._waitingLoadedHandle&&(clearTimeout(t._waitingLoadedHandle),t._waitingLoadedHandle=null),t._waitingDelayLoadingShowHandle&&(clearTimeout(t._waitingDelayLoadingShowHandle),t._waitingDelayLoadingShowHandle=null),t._ucSourceHandle&&(clearTimeout(t._ucSourceHandle),t._ucSourceHandle=null)}t.waiting=!0,c(),t._waitingDelayLoadingShowHandle=setTimeout((function(){t.trigger(i.Private.H5_Loading_Show)}),1e3*t._options.delayLoadingShow),t._TimeUpdateStamp=null,t._checkTimeoutHandle=setTimeout((function(){t.trigger(i.Private.AutoStreamShow)}),1e3*t._options.loadDataTimeout),t.trigger(i.Player.Waiting),t._waitingTimeoutHandle=setTimeout((function(){var e;t.tag&&t._options&&(t.pause(),e={mediaId:t._options.vid||"",error_code:n.ErrorCode.LoadingTimeout,error_msg:o.get("Error_Waiting_Timeout_Text")},t.logError(e),t.trigger("error",e))}),1e3*t._options.waitingTimeout),t._waitingLoadedHandle=setTimeout((function(){var e=t.getCurrentTime();0==t._waitingTimeoutCount&&e!=t._waitingReloadTime&&(t._waitingTimeoutCount=1,t._waitingReloadTime=e,e=t._options.isLive?0:e,t._loadByUrlInner(t._options.source,e,!0))}),t._options.waitingTimeout/2*1e3),s.IS_ANDROID&&s.IS_DINGTALK&&(t._ucSourceHandle=setTimeout((function(){l.detectRegionBlock(t._options.source,(function(e){e&&(e={mediaId:t._options.vid,error_code:n.ErrorCode.RegionBlock,error_msg:o.get("Error_Region_Block_Text")},t.logError(e),t.trigger("error",e))}))}),5e3)),t.on("error",(function(){c()}))}},{"../../../../lang/index":23,"../../../../lib/constants":28,"../../../../lib/event":33,"../../../../lib/playerutil":46,"../../../../lib/ua":49,"../../event/eventtype":70}],91:[function(e,t,r){var i="undefined"==typeof Promise?e("es6-promise").Promise:Promise,n=e("../../ui/component"),a=e("../../lib/object"),o=e("../../lib/dom"),s=e("../../lib/event"),l=e("../../ui/exports"),u=e("../../monitor/monitor"),c=e("../../lib/ua"),d=e("../../lib/constants"),h=e("../../lib/playerutil"),f=e("./x5play"),p=e("../../lib/cookie"),g=e("../../lang/index"),v=e("../../feature/autoPlayDelay"),y=e("./event/eventmanager"),m=e("../../ui/component/cover"),_=e("../../ui/component/license-watermark"),b=e("../../feature/license"),T=e("../../ui/component/text-track-display"),S=e("../../ui/component/play-animation"),E=e("../../commonui/autostreamselector"),k=e("./event/eventtype"),A=e("./plugin/lifecyclemanager"),w=e("../service/export"),x=e("../../ui/component/progressmarker"),R=e("../../feature/keyboardControl"),L=e("../../feature/AntiRecord"),I=e("./eventHandler/video/index"),C=e("../../lib/vttnext/index"),D=e("../../lib/codec-probe"),P=e("../splayer/splayerinjector"),O=(e=e("../../ui/component/util").throttle,n.extend({init:function(e,t){var r;this.tag=e,this.loaded=!1,this.played=!1,this.waiting=!1,this._urls=[],this._currentPlayIndex=0,this._retrySwitchUrlCount=0,this._isError=!1,this._isHls=!1,this._liveRetryCount=0,this._liveRetryTimer=null,this._vodRetryCount=0,this._seeking=!1,this._serverRequestId=0,this._waitingTimeoutCount=0,this._waitingReloadTime=0,this._created=!1,this._enteredProgressMarker=!1,this._liveShiftSeekStartTime=0,this._duration=0,this._seis={},this._initPTS=0,this.isMutiLevel=!1,this._antiRecord=null,this.__disposed=!1,this.resolution={width:0,height:0},void 0===t.skinLayout&&(t.skinLayout=h.defaultH5Layout),h.isRts(t.source)&&!t.autoplay&&(t.preload=!1),n.call(this,this,t),this.addClass("prism-player"),t.plugins&&a.each(t.plugins,(function(e,t){this[e](t)}),this),this._createService(),this.UI={},t.useNativeControls?this.tag.setAttribute("controls","controls"):(this.UI=l,0==t.errorDisplay&&(this.UI.errorDisplay=void 0)),this.initChildren(),this._options.trackLog&&(this._monitor=new u(this,{video_id:0,album_id:0,from:this._options.from,source:this._options.source,logBatched:this._options.logBatched},this._options.trackLog)),y.onAll(this),this._options.preventRecord&&(this._antiRecord=new L({player:this}),this._antiRecord.start()),this._lifeCycleManager=new A(this),this._overrideNativePlay(),this._liveshiftService&&!this._liveshiftService.validate()?(e={mediaId:this._options.vid||"",error_code:d.ErrorCode.InvalidParameter,error_msg:g.get("ShiftLiveTime_Error")},this.trigger(k.Player.Error,e)):(this._options.extraInfo&&(e=this._options.extraInfo).liveRetry&&(this._options.liveRetry=e.liveRetry),this.on(k.Private.ReadyState,(function(){this.trigger(k.Player.Ready)})),this.on(k.Player.H265PlayInfo,(function(e){var r=this;"native"!==e.paramData.renderType&&b.getLicense(t.license.domain,t.license.key).then((function(e){if(e=e.validate(d.PLAYER_SDK_CODE,d.FEATURE_ID_H265),console.log("license validate result => ",e),0===e)r.trigger(k.Private.LicenseHasResult,{result:d.LicenseResultCode.Success,featureId:d.FEATURE_ID_H265});else{if(1===e)return i.reject(d.LicenseResultCode.NotFound);if(2===e)return i.reject(d.LicenseResultCode.Expired);console.error("license validate unknown error")}})).catch((function(e){r.trigger(k.Private.LicenseHasResult,{result:e,featureId:d.FEATURE_ID_H265}),b.logError(e)}))})),this.on(k.Private.LicenseHasResult,(function(e){var t=d.LicenseResultCode;-1<[t.NotFound,t.Expired,t.CertInvalid,t.ResourceIncorrect,t.LicenseKeyInvalid,t.DomainInvalid].indexOf(e.paramData.result)&&(this.UI.licenseWatermark=_,this._licenseWatermark=this.addChild("licenseWatermark",this._options))})),this._thumbnailService&&this._options.thumbnailUrl&&this._thumbnailService.get(this._options.thumbnailUrl),0<this._options.progressMarkers.length&&this.trigger(k.Private.ProgressMarkerLoaded,this._options.progressMarkers),this._options.source&&this._options._native&&this._executeReadyCallback(),this._options.autoplay||this._options.preload?this.trigger(k.Private.H5_Loading_Show):this.trigger(k.Private.Play_Btn_Show),this._extraMultiSources(),this._options.source&&(this.trigger(k.Private.PREPARE,"custom"),this._options.autoPlayDelay?(this._autoPlayDelay=new v(this),(r=this)._autoPlayDelay.handle((function(){r.initPlay()}))):this.initPlay()),R.init.call(this),this._vttBroker=new C({player:this}),this._getUserTextTracks())}}));O.prototype.isSupportMSE=function(){return h.isSupportMSE()},O.prototype.initPlay=function(e){this._initPlayBehavior(e,this._options.source)},O.prototype.initChildren=function(){var e=this.options(),t=e.skinLayout;if(!1!==t&&!a.isArray(t))throw new Error("PrismPlayer Error: skinLayout should be false or type of array!");!1!==t&&0!==t.length&&(this.options({children:t}),n.prototype.initChildren.call(this)),this.UI.cover=m,e.className="",this.addChild("cover",e),this.UI.playanimation=S,this.addChild("playanimation",e),this.UI.autoStreamSelector=E,this.addChild("autoStreamSelector",e),this.UI.progressMarker=x,this.addChild("progressMarker",e),this.UI.textTrackDisplay=T,this.addChild("textTrackDisplay",e),this.trigger(k.Private.UiH5Ready)},O.prototype.createEl=function(){var e=!1,t=("VIDEO"!==this.tag.tagName?(this._el=this.tag,this.tag=n.prototype.createEl.call(this,"video"),this._options.playsinline&&(this.tag.setAttribute("webkit-playsinline",""),this.tag.setAttribute("playsinline",""),this.tag.setAttribute("x-webkit-airplay",""),this.tag.setAttribute("x5-playsinline",""))):(e=!0,this._el=this.tag.parentNode),this._el),r=this.tag,i=(this._options.enableSystemMenu||(r.addEventListener?r.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1):r.attachEvent("oncontextmenu",(function(){window.event.returnValue=!1}))),r.player=this,o.getElementAttributes(r));return a.each(i,(function(e){t.setAttribute(e,i[e])})),this.setVideoAttrs(),e||(r.parentNode&&r.parentNode.insertBefore(t,r),o.insertFirst(r,t)),t},O.prototype.setVideoAttrs=function(){var e=this._options.preload,t=this._options.autoplay;if(this.tag.style.width=this._options.videoWidth||"100%",this.tag.style.height=this._options.videoHeight||"100%",e&&this.tag.setAttribute("preload","preload"),t&&!this._isEnabledAILabel()&&"15"!==c.IOS_VERSION&&this.tag.setAttribute("autoplay","autoplay"),c.IS_IOS&&this.tag.setAttribute("poster","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAAAMZJREFUeAHt0DEBAAAAwqD1T20LL4hAYcCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMDAc2CcpAABaODCqQAAAABJRU5ErkJggg=="),(c.IS_UC||c.dingTalk())&&this.tag.setAttribute("renderer","standard"),this._options.extraInfo)for(var r in this._options.extraInfo)this.tag.setAttribute(r,this._options.extraInfo[r]);f.adaptX5Play(this)},O.prototype.checkOnline=function(){var e;return!(this._options&&!this._options.debug&&0==navigator.onLine&&((e={mediaId:this._options.vid||"",error_code:d.ErrorCode.NetworkUnavaiable,error_msg:g.get("Error_Offline_Text")}).display_msg=g.get("Error_Offline_Text"),this.trigger(k.Player.Error,e),1))},O.prototype.id=function(){return this.el().id},O.prototype.renderUI=function(){},O.prototype.switchUrl=function(){var e,t;0!=this._urls.length&&(this._currentPlayIndex=this._currentPlayIndex+1,this._urls.length<=this._currentPlayIndex&&(this._currentPlayIndex=0,this._retrySwitchUrlCount++),e=this._urls[this._currentPlayIndex],p.set(d.SelectedStreamLevel,e.definition,365),this.trigger(k.Private.QualityChange,g.get("Quality_Change_Fail_Switch_Text")),t=this.getCurrentTime(),this._vodRetryCount=0,this._originalSource="",this._loadByUrlInner(e.Url,t,!0))},O.prototype.setControls=function(){var e=this.options();e.useNativeControls?this.tag.setAttribute("controls","controls"):"object"==_typeof(e.controls)&&(e=this._initControlBar(e.controls),this.addChild(e))},O.prototype._initControlBar=function(e){return new ControlBar(this,e)},O.prototype.getMetaData=function(){},O.prototype.getReadyTime=function(){return this.readyTime},O.prototype.readyState=function(){return this.tag.readyState},O.prototype.getError=function(){return this.tag.error},O.prototype.getRecentOccuredEvent=function(){return this._eventState},O.prototype.getSourceUrl=function(){return this._options?this._options.source:""},O.prototype.getMonitorInfo=function(){return this._monitor?this._monitor.opt:{}},O.prototype.getCurrentQuality=function(){var e;return 0<this._urls.length?{width:(e=this._urls[this._currentPlayIndex]).width,url:e.Url,definition:e.definition}:""},O.prototype.getCurrentPDT=function(){var e;if((c.IS_SAFARI||c.IS_IOS)&&this.tag)return e=Date.parse(this.tag.getStartDate()),isNaN(e)?0:e+1e3*this.getCurrentTime()},O.prototype.setSpeed=function(e){this.tag&&(this._originalPlaybackRate=e,this.tag.playbackRate=e)},O.prototype.play=function(e){return this.tag&&(this.tag.ended||this._ended?this.replay():((this._options.preload||this.loaded)&&this.tag.src||this._initLoad(this._options.source),this.trigger(k.Private.Cover_Hide),this.tag.play())),this._isManualPlay=e||!1,this},O.prototype.replay=function(){return this._monitor&&this._monitor.replay(),this.seek(0),this.tag.play(),this},O.prototype.pause=function(e){return this.tag&&this.tag.pause(),this._isManualPause=e||!1,this},O.prototype.stop=function(){return this.tag.setAttribute("src",null),this},O.prototype.paused=function(){if(this.tag)return!1!==this.tag.paused},O.prototype.getDuration=function(){var e=0;return this.tag?this.isPreview()?this._vodDuration||this.tag.duration:this._duration&&this._duration!=1/0?this._duration:this.tag.duration:e},O.prototype.getDisplayDuration=function(){var e=0;return this.tag?this._vodDuration||this.getDuration():e},O.prototype.getCurrentTime=function(){return this.tag?this.tag.currentTime:0},O.prototype.seek=function(e){this._seeking=!0;var t=this.tag.duration;if(e=Math.floor(e),!Number.isNaN(e))return this._doSeek(this,e=t<=e?t:e),this},O.prototype._doSeek=e((function(e){var t=e[0];e=e[1];try{var r=t._originalPlaybackRate||t.tag.playbackRate;t.tag.currentTime=e,c.IS_IE11&&setTimeout((function(){t.tag&&(t.tag.playbackRate=r)}))}catch(e){console.log(e)}}),100),O.prototype.firstNewUrlloadByUrl=function(e,t){this._clearTimeout(),this._options.vid=0,this._options.source=e,this._monitor&&this._monitor.updateVideoInfo({video_id:0,album_id:0,source:e,from:this._options.from}),this.trigger(k.Private.ChangeURL),this.initPlay(),this._options.autoplay&&this.trigger(k.Private.Cover_Hide),this._options.autoplay?this.trigger(k.Player.Play):this.trigger(k.Player.Pause),!(t=t||0)&&0!=t||isNaN(t)||this.seek(t)},O.prototype._loadByUrlInner=function(e,t,r,i){var n=this,a=this.tag.volume;if(i&&c.IS_ANDROID_FIREFOX){for(var o in k.Video)s.off(this.tag,k.Video[o]);this.tag.remove(),this.tag=this._el,this.createEl()}this.loadByUrl(e,t,r,!0),this.tag.volume=a,i&&c.IS_ANDROID_FIREFOX&&this.tag.addEventListener(k.Video.LoadedData,(function e(){n._player.trigger(k.Player.DurationChange),I.bind(n),n.tag.removeEventListener(k.Video.LoadedData,e)}))},O.prototype.loadByUrl=function(e,t,r,i){var n=this,a=(this._monitor&&this._monitor._onPlayerUnderload(),this._monitor&&0===this._vodRetryCount&&0===this._liveRetryCount&&(this._monitor.reportPlayAbort(),this._monitor.resetVV()),/\.m3u8|\.flv|\.mp4|artc\:\/\/|rtmp\:\/\//gi),o=((this._options.source||"").match(a)||[])[0]!==((e||"").match(a)||[])[0];if(this._h265InfoReported=!1,this._probeInfo||(this._probeInfo={}),this._probeInfo.codecTag=void 0,!o&&(h.isMp4(e)||h.isFlv(e)))return!this._options.forceH265&&this._options.enableH265?void D(e,(function(t){t=h.getVideoTrack(t.tracks);var r=(t||{}).codecTag||(t||{}).codec.split(".")[0];n._probeInfo.codecTag=r,t&&h.isH265Codec(r)?h.isFlv(e)?(n._splayer||(o=!0),l.call(n)):h.shouldUseBasePlayer(r,(function(e){e?(n._splayer&&(o=!0),n._probeInfo.codecTag&&P.reportH265PlayInfo.call(n,{renderType:"native",codecTag:n._probeInfo.codecTag})):n._splayer||(o=!0),l.call(n)})):(n._splayer&&(o=!0),l.call(n))}),(function(e){l.call(n)})):void l.call(this);function l(){var n=this;o&&this._splayer&&this.removeChild(this._licenseWatermark),o&&window.Aliplayer?(console.log("!!!!! NEED RELOAD INSTANCE !!!!!"),this._options.source=e,window.Aliplayer.reloadInstance(this._options,(function(){}),this)):(i||(this._urls=[]),this._monitor&&!i&&this._monitor.reset(),this._isError=!1,this._duration=0,this._clearTimeout(),this.trigger(k.Private.Error_Hide),this._options.source=e,this._monitor&&this._monitor.updateVideoInfo({video_id:0,album_id:0,source:e,from:this._options.from}),i||(this.trigger(k.Private.ChangeURL),this._vodRetryCount=0),this._options._autoplay=r,this.initPlay(r),(this._options.autoplay||r)&&this.trigger(k.Private.Cover_Hide),this._options.autoplay||r?this.trigger(k.Player.Play):this.trigger(k.Player.Pause),this._options.isLive||!t&&0!=t||isNaN(t)||s.one(this.tag,k.Video.CanPlay,(function(e){var r=n.getDuration();n.seek(r<=t?r:t)})))}l.call(this)},O.prototype.dispose=function(){this.__disposed=!0,this.trigger(k.Private.Dispose),this.tag.pause(),y.offAll(this),R.dispose.call(this),this._antiRecord&&(this._antiRecord.dispose(),this._antiRecord=null),this._monitor&&(this._monitor.reportPlayAbort(),this._monitor.removeEvent(),this._monitor=null),this._autoPlayDelay&&this._autoPlayDelay.dispose(),this._checkTimeoutHandle&&(clearTimeout(this._checkTimeoutHandle),this._checkTimeoutHandle=null),this._waitingTimeoutHandle&&(clearTimeout(this._waitingTimeoutHandle),this._waitingTimeoutHandle=null),this._playingSlientPause&&(clearTimeout(this._playingSlientPause),this._playingSlientPause=null),this._waitingLoadedHandle&&(clearTimeout(this._waitingLoadedHandle),this._waitingLoadedHandle=null),this._ucSourceHandle&&(clearTimeout(this._ucSourceHandle),this._ucSourceHandle=null),this._readyStateTimer&&(clearInterval(this._readyStateTimer),this._readyStateTimer=null),this._vodRetryCountHandle&&(clearTimeout(this._vodRetryCountHandle),this._vodRetryCountHandle=null),this._waitingDelayLoadingShowHandle&&(clearTimeout(this._waitingDelayLoadingShowHandle),this._waitingDelayLoadingShowHandle=null),this._liveRetryTimer&&(clearTimeout(this._liveRetryTimer),this._liveRetryTimer=null),this._disposeService(),this._clearLiveErrorHandle(),this._el.innerHTML="",this.destroy(),this._releaseMediaElement(),this._options.recreatePlayer=null,this._options=null,this.isMutiLevel=!1,this._seis={},this._initPTS=0},O.prototype._releaseMediaElement=function(){this.tag.removeAttribute("src"),this.tag.load(),this.tag=null},O.prototype.mute=function(){this._muteInner(),this._originalVolumn=this.tag.volume;var e=g.get("Volume_Mute");return this._player.trigger(k.Private.Info_Show,{text:e,duration:1e3,align:"lb"}),this._setInnerVolume(0),this},O.prototype._muteInner=function(){this.tag.muted=!0,this.trigger(k.Private.VolumnChanged,-1)},O.prototype.unMute=function(){this._unMuteInner();var e=g.get("Volume_UnMute");return this._player.trigger(k.Private.Info_Show,{text:e,duration:1e3,align:"lb"}),this._setInnerVolume(this._originalVolumn||.5),this},O.prototype._unMuteInner=function(){this.tag.muted=!1,this.trigger(k.Private.VolumnChanged,-2)},O.prototype.muted=function(){return this.tag.muted},O.prototype.getVolume=function(){return this.tag.volume},O.prototype.getOptions=function(){return this._options},O.prototype.setVolume=function(e,t){0!=e?this._unMuteInner():0==e&&this._muteInner(),this._setInnerVolume(e),e=g.get("Curent_Volume")+"<span>"+(100*e).toFixed()+"%</span>",this._player.trigger(k.Private.Info_Show,{text:e,duration:1e3,align:"lb"})},O.prototype._setInnerVolume=function(e){this.tag.volume=e,this.trigger(k.Private.VolumnChanged,e)},O.prototype.hideProgress=function(){this.trigger(k.Private.HideProgress)},O.prototype.cancelHideProgress=function(){this.trigger(k.Private.CancelHideProgress)},O.prototype.setPlayerSize=function(e,t){this._el&&(this._el.style.width=e,this._el.style.height=t)},O.prototype.getBuffered=function(){return this.tag.buffered},O.prototype.setRotate=function(e){this.tag&&(this._rotate=e,this._setTransform(),this.log("ROTATE",{rotation:e}))},O.prototype.getRotate=function(e){return void 0===this._rotate?0:this._rotate},O.prototype.setImage=function(e){this.tag&&(this._image=e,this._setTransform(),this.log("IMAGE",{mirror:"horizon"==e?2:1,text:e}))},O.prototype.getImage=function(){return this._image},O.prototype.cancelImage=function(){this.tag&&(this._image="",this._setTransform(),this.log("IMAGE",{mirror:0}))},O.prototype.setCover=function(e){var t=document.querySelector("#"+this.id()+" .prism-cover");t&&e&&(t.style.backgroundImage="url("+e+")",this._options.cover=e,this.trigger(k.Private.Cover_Show))},O.prototype.setTextTracks=function(e){e=h.unqiueTextTracks(e||[]),this.trigger(k.Private.VttClearTracks),e&&e.length&&this.trigger(k.Private.TextTrackFounded,{from:"user",textTracks:e}),this.trigger(k.Private.CCReset)},O.prototype._setTransform=function(){this._transformProp||(this._transformProp=o.getTransformName(this.tag));var e=" translate(-50%, -50%)";this._rotate&&(e+=" rotate("+this._rotate+"deg)"),this._image&&("vertical"==this._image?e+=" scaleY(-1)":"horizon"==this._image&&(e+=" scaleX(-1)")),this.tag.style[this._transformProp]=e},O.prototype._startPlay=function(){this.tag.paused&&this.tag.play()},O.prototype._initPlayBehavior=function(e,t){return this._monitor&&0===this._vodRetryCount&&0===this._liveRetryCount&&this._monitor.resetVV(),!this._checkSupportVideoType()&&(h.validateSource(t)?(void 0===e&&(e=!1),this._created||(this._created=!0,this.trigger(k.Private.Created)),this.loaded||this.trigger(k.Player.Init),this._options.autoplay||this._options._autoplay||this._options.preload||e?(this._options._preload=!0,this._initLoad(t),(this._options.autoplay||this._options._autoplay)&&this._startPlay()):this.trigger(k.Private.Play_Btn_Show),!0):((e={mediaId:this._options.vid||"",error_code:d.ErrorCode.InvalidSourceURL,error_msg:"InvalidSourceURL"}).display_msg=g.get("Error_Invalidate_Source"),this.trigger(k.Player.Error,e),!1))},O.prototype._isPreload=function(){return this._options.autoplay||this._options.preload||this._options._preload},O.prototype._initLoad=function(e){e&&(this._isPreload()&&!c.IS_MOBILE?this.trigger(k.Private.H5_Loading_Show):(this.trigger(k.Private.H5_Loading_Hide),this.trigger(k.Private.Play_Btn_Show)),this.tag.setAttribute("src",e),this.loaded=!0)},O.prototype._clearLiveErrorHandle=function(){this._liveErrorHandle&&(clearTimeout(this._liveErrorHandle),this._liveErrorHandle=null)},O.prototype._reloadAndPlayForM3u8=function(){0==this._liveRetryCount&&this.trigger(k.Player.OnM3u8Retry);var e=this._options,t=e.liveRetryInterval+e.liveRetryStep*this._liveRetryCount,r=this;this._liveRetryTimer&&(clearTimeout(this._liveRetryTimer),this._liveRetryTimer=null),this._liveRetryTimer=setTimeout((function(){r._liveRetryCount++,r.tag.load(r._options.source),e.autoplay&&r.tag.play()}),1e3*t)},O.prototype._checkSupportVideoType=function(){var e,t;return this.tag.canPlayType&&this._options.source&&c.IS_MOBILE?(e="",0<(t=this._options.source).indexOf("m3u8")?""!=this.tag.canPlayType("application/x-mpegURL")||h.isSupportHls()||(e=g.get("Error_Not_Support_M3U8_Text")):0<t.indexOf("mp4")?""==this.tag.canPlayType("video/mp4")&&(e=g.get("Error_Not_Support_MP4_Text")):(h.isRTMP(t)||h.isFlv(t))&&c.IS_MOBILE&&(e=g.get("Error_Not_Support_Format_On_Mobile")),e&&(t={mediaId:this._options.vid||"",error_code:d.ErrorCode.FormatNotSupport,error_msg:e},this.logError(t),t.display_msg=e,this.trigger(k.Player.Error,t)),e):""},O.prototype.getComponent=function(e){return this._lifeCycleManager.getComponent(e)},O.prototype.logError=function(e,t){(e=e||{}).vt=this.getCurrentTime(),this.log(t?"ERRORRETRY":"ERROR",e)},O.prototype.log=function(e,t){var r=0,i=0;if(this._monitor)return this._options&&(r=this._options.vid||"0",i=this._options.from||"0"),this._monitor.updateVideoInfo({video_id:r,album_id:0,source:this._options.source,from:i}),this._monitor._log(e,t)},O.prototype.setSanpshotProperties=function(e,t,r){if(this._snapshotMatric||(this._snapshotMatric={}),this._snapshotMatric.width=e,this._snapshotMatric.height=t,1<r)throw new Error("rate doesn't allow more than 1");this._snapshotMatric.rate=r},O.prototype.getStatus=function(){return this._status||"init"},O.prototype.enterProgressMarker=function(){this._enteredProgressMarker=!0},O.prototype.isInProgressMarker=function(){return this._enteredProgressMarker},O.prototype.exitProgressMarker=function(){this._enteredProgressMarker=!1},O.prototype.setProgressMarkers=function(e){this.trigger(k.Private.ProgressMarkerChanged,e=e||[])},O.prototype.getProgressMarkers=function(){return this._progressMarkerService?this._progressMarkerService.progressMarkers:[]},O.prototype.setPreviewTime=function(e){this._options.playConfig||(this._options.playConfig={}),this._options.playConfig.PreviewTime=e},O.prototype.getPreviewTime=function(){var e=0;return this._options.playConfig?this._options.playConfig.PreviewTime:e},O.prototype.exceedPreviewTime=function(e){return this.isPreview()&&e>=this._options.playConfig.PreviewTime},O.prototype.isPreview=function(){var e=this._options.playConfig.PreviewTime,t=this._vodDuration||this.tag.duration;return 0<e&&e<t},O.prototype.getStats=function(){return new i((function(e){e()}))},O.prototype.setTraceId=function(e){this._monitor&&this._monitor.updateTraceId(e)},O.prototype._getSanpshotMatric=function(){return this._snapshotMatric||(this._snapshotMatric={}),this._snapshotMatric},O.prototype._autoplayFailedHandler=function(){this.trigger(k.Private.Play_Btn_Show),this.trigger(k.Private.H5_Loading_Hide),this.trigger(k.Player.AutoPlayPrevented),this.trigger(k.Player.AutoPlay,!1),this._options.cover&&this.trigger(k.Private.Cover_Show)},O.prototype._overrideNativePlay=function(){var e=this.tag.play,t=this;this.tag.play=function(){var r,i;t._monitor&&t._monitor.reportStartPlay(),t._options.source?(t.readyTime=(new Date).getTime(),r=e.apply(t.tag),void 0!==r&&r.then((function(){t.trigger(k.Player.AutoPlay,!0)})).catch((function(e){!t.tag||!t.tag.paused||t._isError||t._options._autoplay||t._switchedLevel||t._autoplayFailedHandler()})),i=t._originalPlaybackRate||t.tag.playbackRate,setTimeout((function(){t.tag&&(t.tag.playbackRate=i)}))):(r={mediaId:t._options.vid||"",error_code:d.ErrorCode.InvalidSourceURL,error_msg:"InvalidSourceURL"},t._options.vid?r.display_msg=g.get("Error_Vid_Empty_Source"):t._options.mediaAuth?r.display_msg=g.get("Error_Mediaauth_Empty_Source"):r.display_msg=g.get("Error_Empty_Source"),t.trigger(k.Player.Error,r))}},O.prototype._extraMultiSources=function(){var e=this._options.source;if(e&&-1<e.indexOf("{")&&-1<e.indexOf("}")){var t="";try{t=JSON.parse(e)}catch(e){console.error(e),console.error("地址json串格式不对")}var r,i=[];for(r in t){var n=d.QualityLevels[r];i.push({definition:r,Url:t[r],desc:n||r})}this._setupSourceList(i)}return i},O.prototype._setupSourceList=function(e){var t;(e=void 0===e?[]:e).length&&(this._currentPlayIndex=h.findSelectedStreamLevel(e),t=e[this._currentPlayIndex],this._urls=e,this._options.source=t.Url,this.trigger(k.Private.SourceLoaded,t))},O.prototype._isEnabledAILabel=function(){return this._options.ai&&this._options.ai.label},O.prototype._createService=function(){if(w)for(var e=w.length,t=0;t<e;t++){var r=w[t],i=r.condition;void 0===i?i=!0:"function"==typeof i&&(i=i.call(this)),i&&(this[r.name]=new r.service(this))}},O.prototype._disposeService=function(){if(w)for(var e=w.length,t=0;t<e;t++){var r=this[w[t].name];void 0!==r&&r.dispose&&r.dispose()}},O.prototype._executeReadyCallback=function(){this._options._readyCallbackCalled=!0;try{this._options.autoplay||this._options.preload||(this.trigger(k.Private.H5_Loading_Hide),this.trigger(k.Private.Play_Btn_Show)),this._options.readyCallback(this)}catch(e){console.log(e)}},O.prototype._clearTimeout=function(){this._checkTimeoutHandle&&(clearTimeout(this._checkTimeoutHandle),this._checkTimeoutHandle=null),this._waitingTimeoutHandle&&(clearTimeout(this._waitingTimeoutHandle),this._waitingTimeoutHandle=null),this._clearLiveErrorHandle()},O.prototype._reloadForVod=function(){var e,t,r;return this._originalSource||(this._originalSource=this._options.source),!!(this._vodRetryCount<this._options.vodRetry&&navigator.onLine)&&(e=this.getCurrentTime(),(t=this._originalSource).indexOf("auth_key=")<0&&(t=t&&0<t.indexOf("?")?t+"&_t="+(new Date).valueOf():t+"?_t="+(new Date).valueOf()),this._vodRetryCountHandle&&clearTimeout(this._vodRetryCountHandle),(r=this)._vodRetryCountHandle=setTimeout((function(){r._loadByUrlInner(t,e,r.getOptions().autoplay)}),100*this._vodRetryCount),this._vodRetryCount=this._vodRetryCount+1,!0)},O.prototype._getUserTextTracks=function(){var e=this._options.textTracks||[];(e=h.unqiueTextTracks(e)).length&&this.trigger(k.Private.TextTrackFounded,{from:"user",textTracks:e})},t.exports=O},{"../../commonui/autostreamselector":11,"../../feature/AntiRecord":16,"../../feature/autoPlayDelay":17,"../../feature/keyboardControl":18,"../../feature/license":19,"../../lang/index":23,"../../lib/codec-probe":26,"../../lib/constants":28,"../../lib/cookie":29,"../../lib/dom":32,"../../lib/event":33,"../../lib/object":42,"../../lib/playerutil":46,"../../lib/ua":49,"../../lib/vttnext/index":56,"../../monitor/monitor":64,"../../ui/component":130,"../../ui/component/cover":134,"../../ui/component/license-watermark":139,"../../ui/component/play-animation":141,"../../ui/component/progressmarker":144,"../../ui/component/text-track-display":155,"../../ui/component/util":159,"../../ui/exports":162,"../service/export":120,"../splayer/splayerinjector":127,"./event/eventmanager":69,"./event/eventtype":70,"./eventHandler/video/index":84,"./plugin/lifecyclemanager":94,"./x5play":96,"es6-promise":8}],92:[function(e,t,r){e=e("../../../lib/oo").extend({}),t.exports=e},{"../../../lib/oo":43}],93:[function(e,t,r){t.exports={createEl:"createEl",created:"created",ready:"ready",loading:"loading",play:"play",pause:"pause",playing:"playing",waiting:"waiting",timeUpdate:"timeupdate",error:"error",ended:"ended",dispose:"dispose",markerDotOver:"markerDotOver",markerDotOut:"markerDotOut"}},{}],94:[function(e,t,r){function i(e){(this._player=e)._status="init",this.components=[];var t=e.getOptions().components;if(t&&n.isArray(t)&&0<t.length)for(var r=0;r<t.length;r++){var i=t[r];if(!i)return void console.log("The "+r+" custome component is "+i);var s=void 0===i.type?i:i.type,u=void 0===i.args?[]:i.args;i=void 0===i.name?"":i.name;if(!s)return void console.log(i+" compenent is "+s);u=u&&0<u.length?[].concat.call([s],u):[],s=new(Function.prototype.bind.apply(s,u)),u=s[o.createEl],u&&"function"==typeof u&&u.call(s,e.el(),e),this.components.push({name:i,obj:s})}var c=this;e.on(a.Private.LifeCycleChanged,(function(t){var r=t.paramData,i=r.type;r=r.data;i===a.Video.CanPlayThrough&&c._player.trigger(a.Player.TimeUpdate,r.target.currentTime),i===a.Video.Ended&&c._player.trigger(a.Player.TimeUpdate,c._player.getDuration()),0!=c.components.length&&l.call(c,e,t)}))}var n=e("../../../lib/object"),a=e("../event/eventtype"),o=e("./lifecycle"),s=e("./status"),l=(i.prototype.getComponent=function(e){var t=null,r=this.components.length;if(e)for(var i=0;i<r;i++)if(this.components[i].name==e){t=this.components[i].obj;break}return t},function(e,t){if(t){t=t.paramData;for(var r=t.type,i=t.data,n=((t=r)!=a.Video.LoadStart&&t!=a.Video.LoadedData&&t!=a.Video.LoadedMetadata||(r=o.loading),u(e,r),this.components.length),s=0;s<n;s++){var l=this.components[s].obj,c=l[r];c&&"function"==typeof c&&c.call(l,e,i)}r==a.Private.Dispose&&(this.components=[])}}),u=function(e,t){void 0===s[t]||t==s.pause&&(e._status==s.error||e._status==s.ended)||t==s.ready&&e._status==s.playing||(e._status=t)};t.exports=i},{"../../../lib/object":42,"../event/eventtype":70,"./lifecycle":93,"./status":95}],95:[function(e,t,r){t.exports={init:"init",ready:"ready",loading:"loading",play:"play",pause:"pause",playing:"playing",waiting:"waiting",error:"error",ended:"ended"}},{}],96:[function(e,t,r){function i(e,t){var r=e.el().style.height,i=e.el().style.width,n=(e.originalLayout={container:{height:r,width:i},video:{width:e.tag.style.width,height:e.tag.style.height}},document.body.clientHeight*(window.devicePixelRatio||1)+"px"),a=document.body.clientWidth+"px";width=t?(height=n,a):(height=r.indexOf("%")?r:r+"px",i.indexOf("%")?i:i+"px"),e.tag.style.width=a,e.tag.style.height=n,e.el().style.height=t?n:height}var n=e("../../lib/ua"),a=e("../../lib/dom");t.exports.isAndroidX5=function(){return n.os.android&&n.is_X5||n.dingTalk()},t.exports.adaptX5Play=function(e){n.os.android&&n.is_X5&&("h5"==e._options.x5_type&&(e.tag.setAttribute("x5-video-player-type",e._options.x5_type),window.onresize=function(){var t,r;i(e,e._options.x5_fullscreen||"center"==e._options.x5_video_position),"landscape"==(t=e)._x5VideoOrientation&&(t._originalTagWidth=t.tag.style.width,t._originalTagHeight=t.tag.style.height,(r=document.querySelector("#"+t.id()+" .prism-controlbar"))&&parseFloat(r.offsetHeight),t.tag.style.height="100%",t.tag.style.width=window.screen.width+"px")},e.tag.addEventListener("x5videoenterfullscreen",(function(){i(e,e._options.x5_fullscreen||"center"==e._options.x5_video_position),e.trigger("x5requestFullScreen")})),e.tag.addEventListener("x5videoexitfullscreen",(function(){var t,r;(t=e).originalLayout&&(r=t.originalLayout,t.el().style.height=r.container.height,t.el().style.width=r.container.width,t.tag.style.width=r.video.width,t.tag.style.height=r.video.height),e.trigger("x5cancelFullScreen"),e.fullscreenService.getIsFullScreen()&&e.fullscreenService.cancelFullScreen()})),e.on("requestFullScreen",(function(){"top"==e._options.x5_video_position&&a.removeClass(e.tag,"x5-top-left"),n.os.android&&n.is_X5&&e._options.x5LandscapeAsFullScreen&&(e.tag.setAttribute("x5-video-orientation","landscape"),e._x5VideoOrientation="landscape")})),e.on("cancelFullScreen",(function(){"top"==e._options.x5_video_position&&a.addClass(e.tag,"x5-top-left"),n.os.android&&n.is_X5&&e._options.x5LandscapeAsFullScreen&&(e.tag.setAttribute("x5-video-orientation","portrait"),i(e,e._options.x5_fullscreen||"center"==e._options.x5_video_position),e._x5VideoOrientation="portrait")}))),void 0!==e._options.x5_fullscreen&&e._options.x5_fullscreen&&(e.tag.setAttribute("x5-video-player-fullscreen",e._options.x5_fullscreen),a.addClass(e.tag,"x5-full-screen")),"top"==e._options.x5_video_position&&a.addClass(e.tag,"x5-top-left"),void 0!==e._options.x5_orientation)&&e.tag.setAttribute("x5-video-orientation",e._options.x5_orientation)}},{"../../lib/dom":32,"../../lib/ua":49}],97:[function(e,t,r){var i=e("../../lib/io"),n=e("../../config"),a=e("../../lib/constants"),o=e("../../lib/util"),s=e("../../lib/playerutil"),l=(e("../../lib/dom"),e("../../lang/index")),u=e("../base/event/eventtype"),c=e("../saas/drm"),d=e("../../lib/ua"),h=function(){function e(){}var t=e.prototype;return t.destroy=function(){},t.append=function(e){},t.remove=function(e,t){},t.isTextVisible=function(){},t.setTextVisibility=function(e){},e}();t.exports.inject=function(e,t,r,f,p,g,v){var y,m=f.source;function _(e){var t=this;this._drm.load(this._options.source,e.startTime).then((function(){if(t.trigger(u.Private.H5_Loading_Hide),e.continuePlay&&(t.play(),e.prevVariant)&&0!==e.prevVariant){for(var r,i=t._drm.getVariantTracks(),n=0;n<i.length;n++)if(i[n].id===e.prevVariant){r=i[n];break}r&&t._drm.selectVariantTrack(r,!0)}})).catch((function(e){T.call(t,e)}))}function b(){var e=a.ErrorCode.DrmNotSupported,t=l.get("Error_Drm_Not_Supported");e={mediaId:this._options.vid||"",error_code:e,error_msg:t};this.logError(e),this.trigger(u.Player.Error,e)}function T(e){var t=a.ErrorCode.DrmLoadError,r=l.get("Error_Drm_Load");t={mediaId:this._options.vid||"",error_code:t,error_msg:r+"("+e.code+")"};this.logError(t),this.trigger(u.Player.Error,t)}function S(){this._sessionTimer&&(clearTimeout(this._sessionTimer),this._sessionTimer=null)}function E(e,t){t=t.getVariantTracks().find((function(e){return e.active})),console.log("activeTrack",t),e.trigger(u.Private.QualityChange,{levelSwitch:!0,bitrate:t.bandwidth,desc:t.height})}!g&&(f=m,e._drm||!s.isDash(f)&&!s.isHls(f))||(e._isDrm=!0,e._drm=null,e._isLoadedDrm=!1,e._sessionTimer=null,e._isFairPlay=d.IS_MAC_SAFARI||d.IS_IOS,e._fairPlayHandlers={},console.log("use FairPlay",e._isFairPlay),t.prototype._checkDrmReady=function(){if(null==e._drm&&!e._isFairPlay)throw new Error("please invoke this method after ready event")},t.prototype.play=function(e){return this._checkDrmReady(),this._isManualPlay=e||!1,this.trigger(u.Private.Cover_Hide),this.tag.ended?this.replay():(this.getCurrentTime(),this.tag.paused&&this.tag.play()),this},t.prototype.initPlay=function(e){var t;function r(e,t){var r,i;e._antiRecord&&(console.log("Manual check before load source"),e._antiRecord.check())||(!shaka.Player.isBrowserSupported()||function(){if(d.IS_ANDROID)return!(!d.IS_UC&&!d.IS_FIREFOX)}()?b.call(e):(r=!e._drm,i=function(){var i;e._drm=new shaka.Player(e.tag),y(e,e._drm),i=e._options.isLive?"https://"+s.getLiveHostByRegion(e._options.region):"https://vod."+e._options.region+".aliyuncs.com",e._drm.configure({drm:{servers:{"com.widevine.alpha":i,"com.microsoft.playready":i},retryParameters:{maxAttempts:1}},textDisplayFactory:function(){return new h}}),e._drm.getNetworkingEngine().registerRequestFilter((function(t,r){shaka.util.StringUtils;var i=shaka.util.Uint8ArrayUtils;t==shaka.net.NetworkingEngine.RequestType.LICENSE&&(t=i.toBase64(new Uint8Array(r.body)),i=e._options.isLive?c.getRequestUrl(t,e):c.postData(t,e),r.uris[0]=i.url,r.headers["content-type"]="application/x-www-form-urlencoded",r.body=i.data)})),e._drm.getNetworkingEngine().registerResponseFilter((function(t,r){var i=shaka.util.StringUtils,n=shaka.util.Uint8ArrayUtils;t==shaka.net.NetworkingEngine.RequestType.LICENSE&&(t=i.fromUTF8(r.data),i=JSON.parse(t),t=e._options.isLive?i.Response.B64License:JSON.parse(i.License).b64License,r.data=n.fromBase64(t))})),e._drm.addEventListener("error",(function(e){console.log("errorMessage"),console.log(e.detail.code),console.log(e.detail)})),e._drm.load(e._options.source).then((function(){e._initPlayBehavior(t)})).catch((function(t){T.call(e,t)})),S.call(e),e.one(u.Video.CanPlay,(function(){S.call(e)})),e._sessionTimer=setTimeout((function(){T.call(e,{code:"session timeout"}),e._drm&&e._drm.destroy()}),e._player.getOptions().drmSessionTimeout||5e3),p&&p(e._drm),r&&e._executeReadyCallback()},e.destroy((function(e){try{i()}catch(e){console.log(e)}}))))}o.contentProtocolMixed(m)?((t={mediaId:this._options.vid||"",error_code:a.ErrorCode.InvalidSourceURL,error_msg:"InvalidSourceURL"}).display_msg=l.get("Request_Block_Text"),this.trigger(u.Player.Error,t)):(this._waitingTimeoutCount=1,this._isFairPlay?(this.trigger(u.Private.H5_Loading_Show),function(e,t){var r;this._isFairPlay&&(function(){return d.IS_IOS?(e=parseInt(d.os.version),console.log("osVersion",e),12<=e):d.IS_MAC_SAFARI?(e=parseInt(d.browser.version),console.log("browserVersion",e),12<=e):void 0;var e}()?((r=this).destroy(),c.loadCertificate(this,(function(){e&&e(),r._initPlayBehavior(t,r._options.source),r._executeReadyCallback()}))):b.call(this))}.call(this,p,e)):this._isLoadedDrm&&"undefined"!=typeof shaka?r(this,e):(this.trigger(u.Private.H5_Loading_Show),function(e){var t="aliplayer-drm-min.js",r=n.domain?"https://"+n.domain+"/de/prismplayer/"+n.h5Version+"/drm/"+t:"/build/drm/"+t,a=this;i.loadJS(r,(function(){shaka.polyfill.installAll(),e.apply(a)}))}.call(this,(function(){this._isLoadedDrm=!0,r(this,e)}))))},t.prototype.destroy=function(e){var t;this._drm?(S.call(t=this),this._drm.destroy().then((function(){t._drm=null,"function"==typeof e&&e(t)}))):(this._isFairPlay&&this._destroyFairPlay(),"function"==typeof e&&e(this))},t.prototype._destroyFairPlay=function(){c.destroyFairPlay.call(this)},t.prototype.dispose=function(){r.dispose.call(this),this.destroy()},t.prototype._switchLevel=function(e,t){if(t=t||{},this.trigger(u.Player.LevelSwitch),this._switchedLevel=!0,this._isFairPlay){this._manuallySwitchDrmLevel=!t.isAuto;var r=this.autoplay||"pause"!=this._status;this._loadByUrlInner(e,this.getCurrentTime(),r,!0)}else if(t.isAuto)this._drm.configure({abr:{enabled:!0}}),E(this._player,this._drm);else{for(var i,n=this._drm.getVariantTracks(),a=0;a<n.length;a++){var o=n[a];if(Number(o.bandwidth)===Number(t.bitrate)&&Number(o.height)===Number(t.resolution.split("x")[1])){i=o;break}}console.log("find track",i),this._drm.configure({abr:{enabled:!1}}),this._drm.selectVariantTrack(i,!this._options.seamlessHandover)}var s=this;setTimeout((function(){s.trigger(u.Player.LevelSwitched),this._switchedLevel=!1}),1e3)},t.prototype._getDRMEncryptItem=function(){var e=this._urls;if(e&&0<e.length)for(var t=e.length,r=0;r<t;r++){var i=e[r];if(i.Url==this._options.source&&+i.encryption)return i}return""},t.prototype._getItemBySource=function(){var e=this._urls;if(e&&0<e.length)for(var t=e.length,r=0;r<t;r++){var i=e[r];if(i.Url==this._options.source)return i}return""},y=function(e,t){t.addEventListener("error",(function(t){var r,i=e,n=(t=t.detail,"Error code:"+t.code+"message:"+t.message),o=(console.log(n),a.ErrorCode.OtherError);n=l.get("Error_Play_Text");t.code==shaka.util.Error.Code.EXPIRED?function(){var e=this,t=(this.trigger(u.Private.H5_Loading_Show),null);this._options.isLive||(t=this.getCurrentTime());var r,i=!this.paused(),n=this._drm.getConfiguration().abr.enabled;if(!n)for(var a=this._drm.getVariantTracks(),o=0;o<a.length;o++)if(a[o].active){r=a[o].id;break}var s={startTime:t,continuePlay:i,prevVariant:r,isAdaptive:n};"function"==typeof this._options.refreshAccessInfo?this._options.refreshAccessInfo().then((function(t){(t=t||{}).accessKeyId&&(e._options.accessKeyId=t.accessKeyId),t.securityToken&&(e._options.securityToken=t.securityToken),t.accessKeySecret&&(e._options.accessKeySecret=t.accessKeySecret),_.call(e,s)})):_.call(e,s)}.call(i):(t.code==shaka.util.Error.Code.HTTP_ERROR?(o=a.ErrorCode.NetworkError,n=l.get("Http_Error")):t.code==shaka.util.Error.Code.TIMEOUT?(o=a.ErrorCode.LoadingTimeout,n=l.get("Error_Waiting_Timeout_Text")):t.code==shaka.util.Error.Code.LICENSE_REQUEST_FAILED?(o=a.ErrorCode.DrmLicenseRequestFailed,n=l.get("Error_Drm_License_Request_Failed")):t.Category==shaka.util.Error.NETWORK&&(o=a.ErrorCode.NetworkError,n=l.get("Error_Network_Text")),S.call(i),setTimeout((function(){i.trigger(u.Private.Play_Btn_Hide)})),i.checkOnline()&&(r=i._drm.drmInfo()||{},r={keyIds:Array.from(r.keyIds||[]),initData:String((null==(r=(r.initData||[])[0])?void 0:r.initData)||[])},r={mediaId:i._options.vid||"",error_code:o,error_msg:t.message,shaka_error:JSON.stringify(t.data||[]),drm_info:JSON.stringify(r)},i.logError(r),r.display_msg=t.code+"|"+n,i.trigger(u.Player.Error,r)))})),t.addEventListener("variantchanged",(function(e){console.log("DRM Event: variantchanged",e)})),t.addEventListener("abrstatuschanged",(function(e){console.log("DRM Event: abrstatuschanged",e)})),t.addEventListener("drmsessionupdate",(function(t){console.log("DRM Event: drmsessionupdate",t),S.call(e)})),t.addEventListener("expirationupdated",(function(e){console.log("DRM Event: expirationupdated",e),console.log("Exp:",this.getExpiration())})),t.addEventListener("adaptation",(function(r){console.log("adaptation",r),E(e,t)})),t.addEventListener("trackschanged",(function(r){console.log("DRM EVENT: trackschanged",t.getTextLanguages(),t.getTextTracks());var i=t.getTextLanguages();i&&i.length&&(i=function(e){var t={subtitle:"subtitles",caption:"captions"},r=(console.log("Building track config"),e.getManifest().textStreams||[]),i=(console.log("textStreams",r),e.getTextLanguages()),n=(console.log("languageList",i),[]);try{r.forEach((function(e){i.includes(e.language)&&n.push({kind:t[e.kind]||e.kind,label:e.label,srclang:e.language,src:Array.from(e.segmentIndex)[0].getUris()[0]})}))}catch(e){console.log("error in retrieving text track url: ",e)}return n}(t),e.trigger(u.Private.TextTrackFounded,{from:"drm",textTracks:i}),e.trigger(u.Private.CCReset))}))})}},{"../../config":14,"../../lang/index":23,"../../lib/constants":28,"../../lib/dom":32,"../../lib/io":40,"../../lib/playerutil":46,"../../lib/ua":49,"../../lib/util":51,"../base/event/eventtype":70,"../saas/drm":107}],98:[function(e,t,r){var i=e("../base/player"),n=e("./drminjector"),a=i.extend({init:function(e,t){n.inject(this,a,i.prototype,t,(function(e){})),t._native=!1,i.call(this,e,t)}});t.exports=a},{"../base/player":91,"./drminjector":97}],99:[function(e,t,r){var i=e("../../ui/component"),n=e("../../lib/data"),a=e("../../lib/ua"),o=e("../../lib/constants"),s=e("../../lib/dom"),l=e("../../lib/object"),u=e("../../config"),c=e("../../lang/index"),d=e("../../lib/playerutil"),h=e("../../lib/util"),f=e("../../ui/component/info-display"),p=e("../../ui/component/error-display"),g=e("../../feature/autoPlayDelay"),v=e("../../commonui/autostreamselector"),y=e("../base/event/eventtype"),m=e("../saas/ststoken");e=i.extend({init:function(e,t){var r;void 0===t.skinLayout&&(t.skinLayout=d.defaultFlashLayout),i.call(this,this,t),this._id="prism-player-"+n.guid(),this.tag=e,this._el=this.tag,this._childrenUI=[p],this.initChildren(),this.id=this._id,window[this.id]=this,c.setCurrentLanguage(this._options.language,"flash",this._options.languageTexts),h.openInFile()?(t={mediaId:this._options.vid||"",error_code:o.ErrorCode.FormatNotSupport,error_msg:c.get("Open_Html_By_File","flash")},this.trigger(y.Private.Error_Show,t)):a.IS_MOBILE?this.trigger(y.Private.Error_Show,{mediaId:this._options.vid||"",error_code:o.ErrorCode.FormatNotSupport,error_msg:c.get("Cant_Use_Flash_On_Mobile","flash")}):(this._options.vid&&this._options.accessKeyId&&this._options.securityToken&&this._options.accessKeySecret?m.getPlayAuth((r=this)._options,(function(e){r._options.playauth=e,r._createPlayer()}),(function(e){var t={mediaId:r._options.vid,error_code:e.Code,error_msg:e.Message};e.sri&&(t.sri=e.sri),t.display_msg=e.display_msg,r.trigger(y.Private.Error_Show,t)}),"flash"):this._createPlayer(),this._status="init")},_createPlayer:function(){var e,t;this._options.autoPlayDelay?(t=new g(this),e=this,t.handle((function(){e._options.autoplay=!0,e._initPlayer(),e._childrenUI=[f,v],e.initChildren()}))):(this._initPlayer(),this._childrenUI=[f,v],this.initChildren()),a.HAS_FLASH||(t=c.get("Flash_Not_Ready","flash"),this.trigger(y.Private.Info_Show,{text:t,align:"tc",isBlack:!1}))},_initPlayer:function(){var e="//"+u.domain+"/de/prismplayer-flash/"+u.flashVersion+"/PrismPlayer.swf",t=(this._options.playerSwfPath?e=this._options.playerSwfPath:u.domain?-1<u.domain.indexOf("localhost")&&(e="//"+u.domain+"/build/flash//PrismPlayer.swf"):e="de/prismplayer-flash/"+u.flashVersion+"/PrismPlayer.swf",this._comboFlashVars()),r=this._options.wmode||"opaque";this.tag.innerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=5,0,0,0" width="100%" height="100%" id="'+this.id+'"><param name=movie value="'+e+'"><param name=quality value=High><param name="FlashVars" value="'+t+'"><param name="WMode" value="'+r+'"><param name="AllowScriptAccess" value="always"><param name="AllowFullScreen" value="true"><param name="AllowFullScreenInteractive" value="true"><embed name="'+this.id+'" src="'+e+'" quality=high pluginspage="//www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash" type="application/x-shockwave-flash" width="100%" height="100%" AllowScriptAccess="always" AllowFullScreen="true" AllowFullScreenInteractive="true" WMode="'+r+'" FlashVars="'+t+'"></embed></object>'},_getPlayer:function(e){return-1!=navigator.appName.indexOf("Microsoft")?document.getElementById(e):document[e]},_getLowerQualityLevel:function(){var e,t=this._getVideoUrls();return t&&(e=t.Urls,t=t.index,!(e&&0==e.length||-1==t))&&0<t?{item:e[t-1],index:t-1}:""},_comboFlashVars:function(){var e=encodeURIComponent(a.getReferer()),t=a.getHref(),r=encodeURIComponent(t),i="",n=(t=(t&&(i=a.getHost(t)),this._options),e={autoPlay:t.autoplay?1:0,isInner:0,actRequest:1,vid:t.vid,diagnosisButtonVisible:t.diagnosisButtonVisible?1:0,domain:t.domain||"//tv.taobao.com",statisticService:t.statisticService||u.logReportTo,videoInfoService:t.videoInfoService||"/player/json/getBaseVideoInfo.do",disablePing:t.trackLog?0:1,namespace:this.id,barMode:0!=t.barMode?1:0,isLive:t.isLive?1:0,waterMark:t.waterMark,environment:t.environment,vurl:t.source?encodeURIComponent(t.source):"",plugins:t.plugins||"",snapShotShow:t.snapshot?1:0,accessId:t.accId||"",accessKey:t.accSecret||"",apiKey:t.apiKey||"",flashApiKey:t.flashApiKey||"",disableSeek:t.disableSeek?1:0,disableFullScreen:t.disableFullScreen?1:0,stsToken:t.stsToken||"",domainRegion:t.domainRegion||"",authInfo:t.authInfo?encodeURIComponent(t.authInfo):"",playDomain:t.playDomain||"",stretcherZoomType:t.stretcherZoomType||"",playauth:t.playauth?t.playauth.replace(/\+/g,"%2B"):"",prismType:t.prismType||0,formats:t.formats||"",notShowTips:t.notShowTips?1:0,showBarTime:t.showBarTime||0,showBuffer:0==t.showBuffer?0:1,rePlay:t.rePlay?1:0,encryp:t.encryp||"",secret:t.secret||"",mediaType:"video",logInfo:{ud:a.getHost(t.source),os:a.os.name,ov:a.os.version||"",et:a.browser.name,ev:a.browser.version||"",uat:a.USER_AGENT,r:e,pu:r,app_n:i}},[]);return void 0!==t.rtmpBufferTime&&(e.rtmpBufferTime=t.rtmpBufferTime),t.cover&&(e.cover=t.cover),t.extraInfo&&(e.extraInfo=encodeURIComponent(JSON.stringify(t.extraInfo))),e.logInfo&&(e.logInfo=encodeURIComponent(JSON.stringify(e.logInfo))),e.languageData=encodeURIComponent(JSON.stringify(c.getLanguageData("flash"))),e.language=c.getCurrentLanguage(),l.each(e,(function(e,t){n.push(e+"="+t)})),n.join("&")},initChildren:function(){for(var e=this._childrenUI.length,t=0;t<e;t++){var r=new this._childrenUI[t](this,this._options),i=r.el();i.id=r.id(),this.contentEl().appendChild(i),r.bindEvent()}var n=document.querySelector("#"+this._options.id+" .prism-info-display");s.css(n,"display","none")},flashReady:function(){this.flashPlayer=this._getPlayer(this.id),this._isReady=!0;var e=this._options.skinRes,t=this._options.skinLayout;if(!1!==t&&!l.isArray(t))throw new Error("PrismPlayer Error: skinLayout should be false or type of array!");if("string"!=typeof e)throw new Error("PrismPlayer Error: skinRes should be string!");e=0!=t&&0!==t.length&&{skinRes:e,skinLayout:t},this.flashPlayer.setPlayerSkin(e),this.trigger("ready");var r=this;window.addEventListener("beforeunload",(function(){try{r.flashPlayer.setPlayerCloseStatus()}catch(e){}}))},jsReady:function(){return!0},snapshoted:function(e){var t=h.toBinary(e);e="data:image/jpeg;base64,"+e;this.trigger("snapshoted",{time:this.getCurrentTime(),base64:e,binary:t})},uiReady:function(){this._status="ready",this.trigger("uiReady")},loadedmetadata:function(){"ended"!=this._status&&(this._status="loading",this.trigger("loadedmetadata"))},onPlay:function(){this._status="play",this.trigger("play"),this._clearTimeoutHandle(),this.trigger(y.Private.AutoStreamHide)},onEnded:function(){this._clearTimeoutHandle(),this._status="ended",this.trigger("ended")},onPause:function(){this._status="pause",this._clearTimeoutHandle(),this.trigger(y.Private.AutoStreamHide),this.trigger("pause")},onBulletScreenReady:function(){this.trigger("bSReady")},onBulletScreenMsgSend:function(e){this.trigger("bSSendMsg",e)},onVideoRender:function(e){this._clearTimeoutHandle(),this.trigger("videoRender"),this.trigger("canplay",{loadtime:e})},onVideoError:function(e){this._clearTimeoutHandle(),this._status="error",this.trigger("error",{errortype:e})},onM3u8Retry:function(){this.trigger("m3u8Retry")},hideBar:function(){this.trigger("hideBar")},showBar:function(){this.trigger("showBar")},liveStreamStop:function(){this.trigger("liveStreamStop")},stsTokenExpired:function(){this._status="error",this.trigger("stsTokenExpired")},onVideoBuffer:function(){var e;"pause"!=this._status&&(this._status="waiting",this.trigger("waiting"),this._clearTimeoutHandle(),(e=this)._checkTimeoutHandle=setTimeout((function(){e.trigger(y.Private.AutoStreamShow)}),1e3*this._options.loadDataTimeout),this._checkVideoStatus())},startSeek:function(e){this.trigger("startSeek",e)},completeSeek:function(e){this.trigger("completeSeek",e)},_invoke:function(){var e=arguments[0],t=arguments;if(Array.prototype.shift.call(t),!this.flashPlayer)throw new Error("PrismPlayer Error: flash player is not ready，please use api after ready event occured!");if("function"!=typeof this.flashPlayer[e])throw new Error("PrismPlayer Error: function "+e+" is not found!");return this.flashPlayer[e].apply(this.flashPlayer,t)},play:function(){this._invoke("playVideo")},replay:function(){this._invoke("replayVideo")},pause:function(){this._invoke("pauseVideo")},stop:function(){this._invoke("stopVideo")},seek:function(e){this._invoke("seekVideo",e)},getCurrentTime:function(){return this._invoke("getCurrentTime")},getDuration:function(){return this._invoke("getDuration")},getStatus:function(){return this._status},_getVideoUrls:function(){var e=this._invoke("getVideoUrls"),t=[];if(e&&e.Urls)for(var r=0;r<e.Urls.length;r++){var i=e.Urls[r].value,n=i.desc.indexOf("_"),a=c.get(i.definition,"flash");i.desc=0<n?a+"_"+i.height:a,t.push(i)}return{Urls:t,index:e.index}},_getVideoStatus:function(){return this._invoke("getVideoStatus")},_checkVideoStatus:function(){var e;this.flashPlayer&&!this._checkVideoStatusHandler&&(e=this,function t(){e._checkVideoStatusHandler=setTimeout((function(){var r=e._getVideoStatus();"playing"==r.videoStatus&&"bufferFull"==r.bufferStatus?(e._status="playing",e._clearTimeoutHandle()):"videoPlayOver"==r.videoStatus&&(e._status="ended",e._clearTimeoutHandle()),t()}),500)}())},_clearTimeoutHandle:function(){this._checkTimeoutHandle&&(clearTimeout(this._checkTimeoutHandle),this._checkTimeoutHandle=null)},_changeStream:function(e){return this._invoke("changeStream",e)},mute:function(){this.setVolume(0)},unMute:function(){this.setVolume(.5)},getVolume:function(){return this._invoke("getVolume")},setVolume:function(e){this._invoke("setVolume",e)},loadByVid:function(e){this._invoke("loadByVid",e,!1)},loadByUrl:function(e,t){this._invoke("loadByUrl",e,t)},dispose:function(){this._clearTimeoutHandle(),this._checkVideoStatusHandler&&(clearTimeout(this._checkVideoStatusHandler),this._checkVideoStatusHandler=null),this._invoke("pauseVideo");var e=this;setTimeout((function(){e.off("completeSeek"),e.off("startSeek"),e.off("stsTokenExpired"),e.off("liveStreamStop"),e.off("showBar"),e.off("hideBar"),e.off("m3u8Retry"),e.off("error"),e.off("canplay"),e.off("pause"),e.off("ended"),e.off("play"),e.off("loadedmetadata"),e.off("snapshoted"),e.off("uiReady"),e.off("ready"),e.flashPlayer=null,e._el&&(e._el.innerHTML="")}))},showBSMsg:function(e){this._invoke("showBSMsg",e)},setToastEnabled:function(e){this._invoke("setToastEnabled",e)},setLoadingInvisible:function(){this._invoke("setLoadingInvisible")},setPlayerSize:function(e,t){this._el.style.width=e,this._el.style.height=t}});t.exports=e},{"../../commonui/autostreamselector":11,"../../config":14,"../../feature/autoPlayDelay":17,"../../lang/index":23,"../../lib/constants":28,"../../lib/data":30,"../../lib/dom":32,"../../lib/object":42,"../../lib/playerutil":46,"../../lib/ua":49,"../../lib/util":51,"../../ui/component":130,"../../ui/component/error-display":135,"../../ui/component/info-display":138,"../base/event/eventtype":70,"../saas/ststoken":114}],100:[function(e,t,r){var i=e("../../lib/io"),n=e("../../config"),a=e("../../lib/constants"),o=e("../../lib/util"),s=e("../../lib/playerutil"),l=e("../../lib/ua"),u=e("../../lang/index"),c=e("../base/event/eventtype");t.exports.inject=function(e,t,r,d,h,f){var p,g=d.source;!f&&(d=g,e._flv||!s.isFlv(d))||(e._Type=t,e._superType=r,e._superPt=r.prototype,e._disposed=!1,t.prototype._checkFlvReady=function(){if(null==e._flv)throw new Error("please invoke this method after ready event")},e._isFlv=!0,e._flv=null,e._isLoadedFlv=!1,e._originalUrl="",t.prototype.play=function(e){return this._checkFlvReady(),this._isManualPlay=e||!1,this.trigger(c.Private.Cover_Hide),this._options.isLive&&e?this._loadByUrlInner(this._options.source,0,e):this.tag.ended||this._ended?this.replay():(0==this._seeking&&(e=0,this.tag.ended||this._ended||0==(e=this.getCurrentTime())&&(e=-1),-1!=e)&&this.seek(e),this.tag.paused&&(this._hasLoaded||this._flv.load(),this._flv.play())),this},t.prototype.seek=function(e){this._checkFlvReady(),this._seeking=!0;var t=this.getDuration();t<=(e=Math.floor(e))&&(e=t);try{this._flv.currentTime=e}catch(e){console.log(e)}return this},t.prototype.pause=function(e){return this._checkFlvReady(),this._isManualPause=e||!1,this._flv.pause(),this},t.prototype.getProgramDateTime=function(){var e;return this._checkFlvReady(),this._metadata?(e=(e=this._flv.getFirstSample())&&e.pts?e.pts:0,console.log("推流时间："+this._metadata.NtpTime),console.log("首帧PTS："+e),this._metadata.NtpTime+e):""},t.prototype.initPlay=function(e){var t;function r(e,t){var r,i=!e._flv,n=(e._destroyFlv(),e._options.isLive),a={isLive:n,enableWorker:e._options.enableWorker,stashInitialSize:2048},o=(l.IS_IE11&&(a.enableWorker=!1),{type:"flv",isLive:n,url:e._options.source});for(r in n?(a.enableStashBuffer=e._options.enableStashBufferForFlv,stashInitialSize=e._options.stashInitialSizeForFlv,a.autoCleanupSourceBuffer=!1):a.lazyLoadMaxDuration=600,e._options.isLive&&(e._options.flvFrameChasing&&(a.flvFrameChasing=e._options.flvFrameChasing),e._options.chasingFirstParagraph&&(a.chasingFirstParagraph=e._options.chasingFirstParagraph),e._options.chasingSecondParagraph&&(a.chasingSecondParagraph=e._options.chasingSecondParagraph),e._options.chasingFirstSpeed&&(a.chasingFirstSpeed=e._options.chasingFirstSpeed),e._options.chasingSecondSpeed)&&(a.chasingSecondSpeed=e._options.chasingSecondSpeed),e._options.flvOption)"cors"==r||"hasAudio"==r||"withCredentials"==r||"hasVideo"==r||"type"==r?o[r]=e._options.flvOption[r]:a[r]=e._options.flvOption[r];e._originalUrl=e._options.source,flvjs.LoggingControl.enableAll=e._options.debug,e._flv=flvjs.createPlayer(o,a),p(e,e._flv),e._flv.on(flvjs.Events.MEDIA_INFO,(function(t){e._metadata=t.metadata})),e._flv.on(flvjs.Events.METADATA_ARRIVED,(function(t){t&&t.dataContent&&t.dataContent.length&&e.trigger(c.Private.SeiFrame,{dataContent:t.dataContent,pts:t.pts})})),e._flv.attachMediaElement(e.tag),e._initPlayBehavior(t)&&((e._options.preload||e._options.autoplay)&&(e._hasLoaded=!0,e._flv.load()),e._options.autoplay&&!e.tag.paused&&e._flv.play(),h&&h(e._flv),i)&&(e._executeReadyCallback(),e._urls)&&0<e._urls.length&&!e._options.defaultDefinition&&(e._currentPlayIndex=s.findSelectedStreamLevel(e._urls),n=e._urls[e._currentPlayIndex],e._options.source=n.Url,e.trigger(c.Private.SourceLoaded,n))}l.browser.safari&&this.trigger(c.Private.Snapshot_Hide),o.contentProtocolMixed(g)?((t={mediaId:this._options.vid||"",error_code:a.ErrorCode.InvalidSourceURL,error_msg:"InvalidSourceURL"}).display_msg=u.get("Request_Block_Text"),this.trigger(c.Player.Error,t)):(that=this)._isLoadedFlv&&"undefined"!=typeof Hls?setTimeout((function(){r(that,e)}),1e3):(this.trigger(c.Private.H5_Loading_Show),function(e,t){var r="aliplayer-flv-min.js",a=n.domain?"https://"+n.domain+"/de/prismplayer/"+n.h5Version+"/flv/"+r:"/build/flv/"+r,o=this;i.loadJS(a,(function(){e.apply(o)}))}.call(that,(function(){this._isLoadedFlv=!0,r(this,e)}),this._options.debug))},t.prototype._destroyFlv=function(){try{this._flv&&(this._flv.pause(),this._flv.destroy())}catch(e){console.log(e)}this.loaded=!1,this._hasLoaded=!1,this._flv=null},t.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._superPt&&this._superPt.dispose.call(this),this._destroyFlv(),this._superPt&&(t.prototype.play=this._superPt.play,t.prototype.pause=this._superPt.pause,t.prototype.initPlay=this._superPt.initPlay,t.prototype.seek=this._superPt.seek,t.prototype.canSeekable=this._superPt.canSeekable))},t.prototype.canSeekable=function(e){var t=this._flv.mediaInfo;return!(!this._flv._isTimepointBuffered(e)&&t&&!t.hasKeyframesIndex)},p=function(e,t){var r=!1;t.on(flvjs.Events.ERROR,(function(t,i,o){var s,l,d=a.ErrorCode.OtherError,h=u.get("Error_Play_Text");t!==flvjs.ErrorTypes.BUFFER_FULL&&(i==flvjs.ErrorDetails.NETWORK_EXCEPTION?!(t=e.getOptions().source)||0!=t.toLowerCase().indexOf("http://")&&0!=t.toLowerCase().indexOf("https://")?(d=a.ErrorCode.InvalidSourceURL,h=u.get("Error_Invalidate_Source_Widthout_Protocal"),r=!0):h=navigator.onLine?(d=a.ErrorCode.RequestDataError,u.get("Maybe_Cors_Error")):(d=a.ErrorCode.NetworkError,u.get("Error_Network_Text")):i==flvjs.ErrorDetails.NETWORK_STATUS_CODE_INVALID?"404"==o.code?(d=a.ErrorCode.NotFoundSourceURL,h=u.get("Error_Not_Found")):"403"==o.code?(d=a.ErrorCode.AuthKeyExpired,h=u.get("Error_AuthKey_Text"),r=!0):(d=a.ErrorCode.NetworkError,h=u.get("Error_Network_Text")):i==flvjs.ErrorDetails.NETWORK_TIMEOUT?(d=a.ErrorCode.LoadingTimeout,h=u.get("Error_Waiting_Timeout_Text")):i!=flvjs.ErrorDetails.MEDIA_FORMAT_UNSUPPORTED&&i!=flvjs.ErrorDetails.MEDIA_CODEC_UNSUPPORTED||(d=a.ErrorCode.FormatNotSupport,h=u.get("Error_H5_Not_Support_Text"),r=!0),t=function(){var t;setTimeout((function(){e.trigger(c.Private.Play_Btn_Hide)})),e.checkOnline()&&(t={mediaId:e._options&&e._options.vid?e._options.vid:"",error_code:d,error_msg:o.msg},e.logError(t),t.display_msg=h,n.cityBrain&&(e.flv=null),e.trigger(c.Player.Error,t))},e._options&&e._options.isLive&&!r?(s=e._options).liveRetry>e._liveRetryCount?(0==e._liveRetryCount&&e.trigger(c.Player.OnM3u8Retry),l=s.liveRetryInterval+s.liveRetryStep*e._liveRetryCount,e._liveRetryCount++,setTimeout((function(){e._loadByUrlInner(s.source)}),1e3*l)):(e._liveErrorHandle&&clearTimeout(e._liveErrorHandle),e.trigger(c.Player.LiveStreamStop),e._liveErrorHandle=setTimeout(t,500)):i===flvjs.ErrorDetails.MEDIA_MSE_ERROR&&11===o.code&&e.getCurrentTime()<e.getDuration()?(e._flv.unload(),e._flv.load(),e._flv.detachMediaElement(),e._flv.attachMediaElement(e.tag)):r?(e._flv.unload(),t()):e._reloadForVod()||t())}))})}},{"../../config":14,"../../lang/index":23,"../../lib/constants":28,"../../lib/io":40,"../../lib/playerutil":46,"../../lib/ua":49,"../../lib/util":51,"../base/event/eventtype":70}],101:[function(e,t,r){var i=e("../base/player"),n=e("./flvinjector"),a=i.extend({init:function(e,t){n.inject(this,a,i,t,(function(e){})),t._native=!1,i.call(this,e,t)}});t.exports=a},{"../base/player":91,"./flvinjector":100}],102:[function(e,t,r){var i=e("../../lib/io"),n=e("../../config"),a=e("../../lib/constants"),o=e("../../lib/util"),s=e("../../lib/playerutil"),l=e("../../lib/ua"),u=e("../../lang/index"),c=e("../base/event/eventtype"),d=e("../../lib/hls/hlsparse");function h(){this&&this._hls&&(this._hls.stopLoad(),this._hls.destroy(),this._hls=null)}t.exports.inject=function(e,t,r,f,p,g){e._hls2=!1;var v,y,m=f.source,_=f.useHlsPluginForSafari;f=f.useHlsPlugOnMobile;(p||g||(v=m,_=_,f=f,!e._hls&&s.isHls(v)&&(!s.canPlayHls()||s.isSafariUsedHlsPlugin(_)||f&&s.isUsedHlsPluginOnMobile())))&&(e._Type=t,e._superType=r,e._superPt=r.prototype,e._disposed=!1,t.prototype._checkHlsReady=function(){if(null==e._hls)throw new Error("please invoke this method after ready event")},e._isHls=!0,e._hls=null,e._isLoadedHls=!1,e._stopLoadAsPaused=!0,e._sce_dlgtqred_saved=p,t.prototype.play=function(e){return this._checkHlsReady(),this._isManualPlay=e||!1,this.trigger(c.Private.Cover_Hide),this._options.autoplay||this._options.preload||this._loadSourced||(this._loadSourced=!0,this._options._autoplay=!0,this._hls.loadSource(this._options.source)),this.tag.ended||this._ended?this.replay():this.tag.paused&&(this.tag.play(),this._stopLoadAsPaused)&&(e=this.getCurrentTime(),this._hls.startLoad(e)),this},t.prototype.replay=function(){return this._monitor&&this._monitor.replay(),this._hls.startLoad(0),this.tag.play(),this},t.prototype.pause=function(e){return this.tag&&(this._checkHlsReady(),this.tag.pause(),this._stopLoadAsPaused)&&this._hls.stopLoad(),this._isManualPause=e||!1,this},t.prototype.stop=function(){return this._checkHlsReady(),this.tag.setAttribute("src",null),this._hls.stopLoad(),this},t.prototype.seek=function(e){this._checkHlsReady();try{this._superPt.seek.call(this,e),this.tag.paused&&this._stopLoadAsPaused&&this._hls.startLoad(e)}catch(e){console.log(e)}return this},t.prototype.getProgramDateTime=function(){if(this._checkHlsReady(),-1==this._hls.currentLevel)return"";var e=this._hls.currentLevel;e=this._hls.levels[e].details;return e&&(e=e.programDateTime,console.log("ProgramDateTime="+e),e)?new Date(e).valueOf():0},t.prototype.getCurrentPDT=function(){var e,t;return this._checkHlsReady(),-1==this._hls.currentLevel?"":(e=(t=this._hls.streamController.fragPlaying||{}).pdt)?(t=1e3*t.startPTS,e+(1e3*this.getCurrentTime()-t)):0},t.prototype._reloadAndPlayForM3u8=function(){0==this._liveRetryCount&&this.trigger(c.Player.OnM3u8Retry),this._liveRetryCount++},t.prototype._switchLevel=function(e){var t=this.getCurrentTime(),r=!this._qualityService.levels.length&&1<this._urls.length,i=(r&&(this.pause(),this._hls.stopLoad(),this._hls.detachMedia(),this._hls.destroy()),this.trigger(c.Player.LevelSwitch),this._hls.levels),n=!0;r&&this._loadByUrlInner(e,t,n,!0);for(var a=0;a<i.length;a++)if(i[a].url==e||i[a].url[0]==e){n=!1,this._hls2&&this._options.seamlessHandover?(this._hls.loadLevel=a,console.log("Seamlessly set nextLevel to",a)):(this._hls.currentLevel=a,console.log("Immediately set currentLevel to",a));break}n&&(this._hls.currentLevel=-1),this._switchedLevel=!0;var o=this;setTimeout((function(){o.trigger(c.Player.LevelSwitched),this._switchedLevel=!1}),1e3)},t.prototype._getHlsVersion=function(e){var t,r,i;function n(e,t){var r=this.getOptions()||{};r={mediaId:r.vid||"",mediaAuth:r.mediaAuth||"",error_code:a.ErrorCode.LoadedMetadata,error_msg:u.get("Error_Play_Text")},t=Number(t);404===t?(r.error_code=a.ErrorCode.NotFoundSourceURL,r.error_msg=u.get("Error_Not_Found")):403===t?e===d.ERROR_REGION_BLOCK?(r.error_code=a.ErrorCode.RegionBlock,r.error_msg=u.get("Error_Region_Block_Text")):(r.error_code=a.ErrorCode.AuthKeyExpired,r.error_msg=u.get("Error_AuthKey_Text")):0===t&&navigator.onLine?(r.error_code=a.ErrorCode.RequestDataError,r.error_msg=r.error_msg+"，"+u.get("Maybe_Cors_Error")):r.error_msg=u.get("Error_Load_M3U8_Failed_Text"),this.logError(r),r.display_msg=r.error_msg,this.trigger(c.Player.Error,r)}!0===this._options.useHls2?(this._hls2=!0,e()):!1===this._options.useHls2||!this._options.isLive||g?e():this._options.lowLatencyMode?(this._hls2=!0,e()):(t=this,r=new d,i=t._options.source,r.load(i,(function(a){var o,s;a.levels&&0!==a.levels.length?o=a.levels[0].url:(o=i,s=a.string),r.loadMediaPlaylist({url:o,string:s},(function(r){r&&(t._hls2="number"==typeof r.partTarget),e()}),n.bind(t))}),n.bind(t)))},t.prototype.initPlay=function(e){var t,r;function d(e,t){if(!e._antiRecord||(console.log("Manual check before load source"),!e._antiRecord.check())){var r,i=!e._hls,n=(e._destroyHls(),{xhrSetup:function(t,r){t.withCredentials=e._options.withCredentials||!1}}),a=e._options.loadingTimeOut||e._options.hlsLoadingTimeOut;for(r in a&&(n.manifestLoadingTimeOut=a,n.levelLoadingTimeOut=a,n.fragLoadingTimeOut=a),e._options.liveSyncDurationCount&&(n.liveSyncDurationCount=e._options.liveSyncDurationCount),e._options.defaultBandwidth&&(n.defaultBandwidth=e._options.defaultBandwidth),e._options.isLive&&(e._options.hlsFrameChasing&&(n.hlsFrameChasing=e._options.hlsFrameChasing),e._options.chasingFirstParagraph&&(n.chasingFirstParagraph=e._options.chasingFirstParagraph),e._options.chasingSecondParagraph&&(n.chasingSecondParagraph=e._options.chasingSecondParagraph),e._options.chasingFirstSpeed&&(n.chasingFirstSpeed=e._options.chasingFirstSpeed),e._options.chasingSecondSpeed)&&(n.chasingSecondSpeed=e._options.chasingSecondSpeed),!e._hls2||e._options.isLive&&!l.IS_IE11&&(n.backBufferLength=12,n.liveDurationInfinity=!0),e._options.nudgeMaxRetry&&(n.nudgeMaxRetry=e._options.nudgeMaxRetry),e._options.maxMaxBufferLength&&(n.maxMaxBufferLength=e._options.maxMaxBufferLength),e._options.maxBufferSize&&(n.maxBufferSize=e._options.maxBufferSize),e._options.fragLoadingRetryDelay&&(n.fragLoadingRetryDelay=e._options.fragLoadingRetryDelay),e._options.maxBufferLength&&(n.maxBufferLength=e._options.maxBufferLength),e._options.hlsBandWidthUpCacheTime&&(n.abrBandWidthUpCacheTime=e._options.hlsBandWidthUpCacheTime),e._options.seamlessHandover&&(n.seamlessHandover=e._options.seamlessHandover),e._options.accessKeyId&&(n.accessKeyId=e._options.accessKeyId),e._options.accessKeySecret&&(n.accessKeySecret=e._options.accessKeySecret),e._options.securityToken&&(n.securityToken=e._options.securityToken),e._options.app&&(n.app=e._options.app),e._options.stream&&(n.stream=e._options.stream),e._options.domain&&(n.domain=e._options.domain),e._options.regionId&&(n.regionId=e._options.regionId),e._sce_dlgtqred_saved&&(n._sce_dlgtqredxx=e._sce_dlgtqred_saved),n.enableWorker=e._options.enableWorker,n.debug=e._options.debug,e._stopLoadAsPaused=e._options.hlsOption.stopLoadAsPaused,e._options.hlsOption)n[r]=e._options.hlsOption[r];l.IS_IE11&&(n.enableWorker=!1),e._hls=new Hls(n),y(e,e._hls),e._loadSourced=!1,e._hls.attachMedia(e.tag),e._hls.on(Hls.Events.INIT_PTS_FOUND,(function(t,r){e._initPTS=r.initPTS})),e._hls.on(Hls.Events.FRAG_PARSING_USERDATA,(function(t,r){r&&r.dataContent&&r.dataContent.length&&e.trigger(c.Private.SeiFrame,{dataContent:r.dataContent,pts:r.pts})})),e._hls.on(Hls.Events.MEDIA_ATTACHED,(function(){var r;e._hls.on(Hls.Events.MANIFEST_PARSED,(function(){e._initPlayBehavior(t||e._loadSourced)})),e._hls.on(Hls.Events.AUDIO_TRACKS_UPDATED,(function(t,r){e.trigger(c.Player.AudioTrackUpdated,r)})),e._hls.on(Hls.Events.MANIFEST_LOADED,(function(t,r){e.trigger(c.Player.LevelsLoaded,r)})),e._hls.on(Hls.Events.LEVEL_SWITCHED,(function(t,r){if(e._qualityService){for(var i=e._hls.levels[r.level].url,n=e._qualityService.levels,a="",o="",s=0;s<n.length;s++)if(n[s].Url==i){o=n[s].desc,a=n[s].bitrate;break}(o||a)&&e.trigger(c.Private.QualityChange,{levelSwitch:!0,url:i,bitrate:a,desc:o})}})),e._hls.on(Hls.Events.AUDIO_TRACK_SWITCH,(function(t,r){e.trigger(c.Player.AudioTrackSwitch,r),setTimeout((function(){e.trigger(c.Player.AudioTrackSwitched,r)}),1e3)})),(e._options.autoplay||e._options.preload||t)&&(e._loadSourced=!0,e._levels&&1<e._levels.length?(e._hls.trigger(Hls.Events.MANIFEST_LOADING,{}),e._hls.trigger(Hls.Events.MANIFEST_LOADED,{levels:e._levels})):e._hls.loadSource(e._options.source||"__INVALID__")),i?(e._executeReadyCallback(),e._urls&&0<e._urls.length&&!e._options.defaultDefinition&&(e._currentPlayIndex=s.findSelectedStreamLevel(e._urls),r=e._urls[e._currentPlayIndex],e._options.source=r.Url,e.trigger(c.Private.SourceLoaded,r))):e.trigger(c.Private.H5_Loading_Show)}))}}this.trigger(c.Private.H5_Loading_Show),o.contentProtocolMixed(m)?((t={mediaId:(t=this.getOptions()||{}).vid||"",mediaAuth:t.mediaAuth||"",error_code:a.ErrorCode.InvalidSourceURL,error_msg:"InvalidSourceURL"}).display_msg=u.get("Request_Block_Text"),this.trigger(c.Player.Error,t)):(r=this)._isLoadedHls&&"undefined"!=typeof Hls?d(this,e):(this.trigger(c.Private.H5_Loading_Show),this._getHlsVersion((function(t){(function(e,t){var r="aliplayer-hls-min.js",a=(t=((t=t||{}).hls2&&(r="aliplayer-hls2-min.js"),""),t=n.domain?"https://"+n.domain+"/de/prismplayer/"+n.h5Version+"/hls/"+r:"/build/hls/"+r,this);i.loadJS(t,(function(){e.apply(a)}))}).call(r,(function(){r._isLoadedHls=!0,d(r,e)}),{debug:r._options.debug,hls2:r._hls2})})),this.on("error",h))},t.prototype._getbwEstimator=function(){var e,t=NaN;return this._hls?(e=this._hls.abrController._bwEstimator)?e.getEstimate():NaN:t},t.prototype._destroyHls=function(){this._hls&&this._hls.destroy(),this._hls=null},t.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._superPt&&this._superPt.dispose.call(this),this._destroyHls(),this._superPt&&(t.prototype.play=this._superPt.play,t.prototype.pause=this._superPt.pause,t.prototype.initPlay=this._superPt.initPlay,t.prototype.replay=this._superPt.replay,t.prototype.stop=this._superPt.stop,t.prototype.seek=this._superPt.seek))},y=function(e,t){t.on(Hls.Events.DEFAULT_BANDWIDTH,(function(t,r){e.trigger(c.Player.DefaultBandWidth,{width:r.width,height:r.height,bitrate:r.bitrate})})),t.on(Hls.Events.ERROR,(function(r,i){var n,o,l,d,h,f,p;!e._options||i.details==Hls.ErrorDetails.FRAG_LOOP_LOADING_ERROR||1==e._seeking||0==i.fatal&&i.type!=Hls.ErrorTypes.NETWORK_ERROR||(e._clearTimeout(),n=a.ErrorCode.LoadedMetadata,d=u.get("Error_Play_Text"),p=o=!1,i.details==Hls.ErrorDetails.MANIFEST_LOAD_ERROR||i.details==Hls.ErrorDetails.LEVEL_LOAD_ERROR?(o=!0,f=i.networkDetails,l=Number(f.status),e.liveShiftSerivce&&e.liveShiftSerivce.isLiveShiftPlaying()&&404===l?(n=a.ErrorCode.NotFoundSourceURL,d=u.get("Error_Liveshift_M3U8_Not_Found_Text"),p=!0):d=404===l?(n=a.ErrorCode.NotFoundSourceURL,u.get("Error_Not_Found")):403===l?(f=s.parseHttpHeaders(f)["x-tengine-error"])&&-1<a.RegionBlockMessages.indexOf(f)?(n=a.ErrorCode.RegionBlock,u.get("Error_Region_Block_Text")):(n=a.ErrorCode.AuthKeyExpired,u.get("Error_AuthKey_Text")):0===l&&navigator.onLine?(n=a.ErrorCode.RequestDataError,d+"，"+u.get("Maybe_Cors_Error")):u.get("Error_Load_M3U8_Failed_Text")):i.details==Hls.ErrorDetails.MANIFEST_LOAD_TIMEOUT||i.details==Hls.ErrorDetails.LEVEL_LOAD_TIMEOUT?(o=!0,d=u.get("Error_Load_M3U8_Timeout_Text")):i.details==Hls.ErrorDetails.MANIFEST_PARSING_ERROR||i.details==Hls.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR?(o=!0,d=u.get("Error_M3U8_Decode_Text")):i.type==Hls.ErrorTypes.NETWORK_ERROR?(n=a.ErrorCode.NetworkError,d=u.get("Error_Network_Text")):i.type!=Hls.ErrorTypes.MUX_ERROR&&i.type!=Hls.ErrorTypes.MEDIA_ERROR||(n=a.ErrorCode.PlayDataDecode,d=u.get("Error_TX_Decode_Text")),d=d+"("+i.details+")",h=function(){var t;setTimeout((function(){e.trigger(c.Private.Play_Btn_Hide)})),e.checkOnline()&&(t={mediaId:(t=e.getOptions()||{}).vid||"",mediaAuth:t.mediaAuth||"",error_code:n,error_msg:i.details},e.logError(t),t.display_msg=d,e.trigger(c.Player.Error,t))},f=function(){e._liveErrorHandle&&clearTimeout(e._liveErrorHandle),t.stopLoad(),e.trigger(c.Player.LiveStreamStop),e._liveErrorHandle=setTimeout(h,500)},e._options&&e._options.isLive?p?f():e._hls2?i.fatal&&f():(p=e._options).liveRetry>e._liveRetryCount?(0==e._liveRetryCount&&e.trigger(c.Player.OnM3u8Retry),p=p.liveRetryInterval+p.liveRetryStep*e._liveRetryCount,e._liveRetryCount++,e.trigger(c.Private.H5_Loading_Show),setTimeout((function(){o&&e._loadByUrlInner(e._options.source,0,!0)}),1e3*p)):f():(o&&-1<[403,404].indexOf(l)||!e._reloadForVod())&&h())}))})}},{"../../config":14,"../../lang/index":23,"../../lib/constants":28,"../../lib/hls/hlsparse":39,"../../lib/io":40,"../../lib/playerutil":46,"../../lib/ua":49,"../../lib/util":51,"../base/event/eventtype":70}],103:[function(e,t,r){var i=e("../base/player"),n=e("./hlsinjector"),a=i.extend({init:function(e,t){t._native=!1,n.inject(this,a,i,t),i.call(this,e,t)}});t.exports=a},{"../base/player":91,"./hlsinjector":102}],104:[function(e,t,r){var i="undefined"==typeof Promise?e("es6-promise").Promise:Promise,n=e("../../lib/io"),a=e("../../config"),o=e("../../lib/constants"),s=e("../../lang/index"),l=e("../base/event/eventtype"),u=e("../../lib/ua");function c(e){var t=this._options;t.rtsFallbackSource&&window.Aliplayer?(this.trigger(l.Player.RtsFallback,{reason:e,fallbackUrl:t.rtsFallbackSource}),this.loadByUrl(t.rtsFallbackSource)):(this.trigger(l.Player.Error,e),this.logError(e))}function d(e){var t=this,r=(this.trigger(l.Private.H5_Loading_Show),this.trigger(l.Private.Play_Btn_Hide),new f(t,e));return t._rts.subscribe(t._options.source,{mediaTimeout:t._options.rtsLoadDataTimeout}).then((function(e){return t._retryTimer&&(clearTimeout(t._retryTimer),t._retryTimer=null),r.preProcess(),t.tag.srcObject=null,e.play(t.tag),!0})).catch((function(e){var r=null,i=null;switch(Number(e.errorCode)){case 10101:r=o.ErrorCode.RtsSignalError,i=s.get("Rts_Err_Http_Signal_Error");break;case 10114:r=o.ErrorCode.RtsCreateOfferError,i=s.get("Rts_Err_Create_Offer_Error");break;case 10202:r=o.ErrorCode.RtsPlayUrlError,i=s.get("Rts_Err_Play_Url_Error");break;case 10203:r=o.ErrorCode.RtsSubscribeNonthing,i=s.get("Rts_Err_Subscribe_Nonthing");break;case 10205:var n=null==(n=e.extraInfo)?void 0:n.response;if(403===(null==n?void 0:n.status)&&(n=n.headers["x-tengine-error"],n&&-1<o.RegionBlockMessages.indexOf(n))){r=o.ErrorCode.RegionBlock,i=s.get("Error_Region_Block_Text");break}r=o.ErrorCode.RtsHttpRequestFaild,i=s.get("Rts_Err_Http_Request_Failed");break;case 10206:r=o.ErrorCode.RtsHttpAnswerFaild,i=s.get("Rts_Err_Http_Answer_Failed")}return c.call(t,{error_code:r,error_msg:i}),!1}))}function h(){this._noDataTimer&&(clearTimeout(this._noDataTimer),this._noDataTimer=null)}t.exports.inject=function(e,t,r,u,f,p){function g(e,t){var r,i,n;h.call(this),this._retryTimer||(e=e||o.ErrorCode.RtsPlayFailedError,t=t||s.get("Rts_Err_Play_Failed")+", "+this._options.rtsLoadDataTimeout*(this._options.liveRetry+1)+s.get("Rts_Err_No_Data_For"),(i=(r=this)._options)?i.liveRetry>r._liveRetryCount?(0==r._liveRetryCount&&r.trigger(l.Player.OnM3u8Retry),n=Number(i.liveRetryInterval||0)+Number(i.liveRetryStep*r._liveRetryCount||0),r._liveRetryCount++,r.stop(),setTimeout((function(){r.trigger(l.Private.H5_Loading_Show),r.trigger(l.Private.Play_Btn_Hide)}),50),r._retryTimer=setTimeout((function(){r.trigger(l.Private.Retry,{type:"rts",source:i.source}),d.call(r,!0)}),1e3*n)):(r._retryTimer&&clearTimeout(r._retryTimer),r._liveErrorHandle&&clearTimeout(r._liveErrorHandle),r.stop(),r._liveRetryCount=0,r.trigger(l.Player.LiveStreamStop),r._liveErrorHandle=setTimeout(v.call(this,e,t),500)):console.warn("no options!"))}function v(e,t){var r=this;r.pause(),setTimeout((function(){r.trigger(l.Private.Play_Btn_Hide)})),r.checkOnline()&&c.call(this,{error_code:e,error_msg:t})}e._Type=t,e._superType=r,e._superPt=r.prototype,e._disposed=!1,t.prototype._checkRtsReady=function(){if(null==e._rts)throw new Error("please invoke this method after ready event")},e._isRts=!0,e._rts=null,e._isLoadedRts=!1,e._liveErrorHandle=null,e._retryTimer=null,e._noDataTimer=null,e.bind_rtsPlayEventHandler=null,e.bind_rtsErrorEventHandler=null,t.prototype.play=function(e){this._checkRtsReady(),this._isManualPlay=e||!1;var t=this;return t.trigger(l.Private.Cover_Hide),t.trigger(l.Private.Play_Btn_Hide),d.call(t).then((function(e){e&&t._startPlay()})),this},t.prototype.seek=function(e){},t.prototype.setSpeed=function(e){},t.prototype.pause=function(e){return this._checkRtsReady(),this._superPt.pause.call(this,!0),this},t.prototype.stop=function(){return this._rts&&this._rts.unsubscribe(),this},t.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._superPt&&this._superPt.dispose.call(this),this._destroyRts(),this._superPt,this._liveErrorHandle&&(clearTimeout(this._liveErrorHandle),this._liveErrorHandle=null),this._retryTimer&&(clearTimeout(this._retryTimer),this._retryTimer=null),h.call(this))},t.prototype._destroyRts=function(){this._rts&&(this.stop(),this._rts.off("onError",this.bind_rtsErrorEventHandler),this._rts.off("onPlayEvent",this.bind_rtsPlayEventHandler)),this._rts=null},t.prototype.initPlay=function(e){function t(e,t){var r=!e._rts;e._destroyRts(),e._rts=new AliRTS.createClient({customReporter:function(t){if(126===Number(t.msgid)){var r={};try{r=JSON.parse(t.args)}catch(t){r={}}r.tcid&&e._rts&&(e._rts.traceid=r.tcid)}}}),e._checkRtsSupport((function(i){(function(e){var t=this._rtsPlayEventHandler.bind(this),r=this._rtsErrorEventHandler.bind(this);this.bind_rtsPlayEventHandler=t,this.bind_rtsErrorEventHandler=r,e.on("onError",r),e.on("onPlayEvent",t)}).call(e,e._rts),e._options.autoplay?d.call(e).then((function(r){r&&e._initPlayBehavior(t)})):e._initPlayBehavior(t),r&&e._executeReadyCallback()}),(function(t){console.log("[RTS isSupport error]",t);var r=null,i=null;switch(Number(t.errorCode)){case 10110:r=o.ErrorCode.RtsNotSupportWebRtc,i=s.get("Rts_Err_Not_Support_Webrtc");break;case 10111:r=o.ErrorCode.RtsBrowserNotSupport,i=s.get("Rts_Err_Browser_Not_Support");break;case 10112:r=o.ErrorCode.RtsBrowserVersionTooLow,i=s.get("Rts_Err_Browser_Version_Too_Low");break;case 10113:r=o.ErrorCode.RtsNotSupportH264,i=s.get("Rts_Err_Not_Support_H264");break;case 10114:r=o.ErrorCode.RtsCreateOfferError,i=s.get("Rts_Err_Create_Offer_Error")}return c.call(e,{error_code:r,error_msg:i}),!1}))}this._isLoadedRts?t(this,e):(this.trigger(l.Private.H5_Loading_Show),function(e,t){var r="",i=this._options,o=(r="https://g.alicdn.com/CodeBaseOne/H5RTSSdk/"+(i.rtsVersion||a.rtsVersion)+"/aliyun-rts-sdk.js",i.rtsSdkUrl&&(r=i.rtsSdkUrl),this);n.loadJS(r,(function(){e.apply(o)}))}.call(this,(function(){this._isLoadedRts=!0,t(this,e)}),this._options.debug))},t.prototype.getStats=function(){return this._rts&&this._rts.getTransportStats?i.all([this._rts.getTransportStats(),this._rts.getRemoteVideoStats(),this._rts.getRemoteAudioStats()]).then((function(e){var t=e[0],r=e[1];e=e[2];return{rtt:t.rtt,bytesReceived:t.bytesReceived,framesDecoded:r.framesDecoded,packetsLost:(r.packetsLost||0)+(e.packetsLost||0),packetsReceived:(r.packetsReceived||0)+(e.packetsReceived||0),timestamp:t.timestamp||Date.now()}})).catch((function(e){return console.log("ERR in RTS getstats: ",e),{}})):i.resolve()},t.prototype._rtsPlayEventHandler=function(e){"canplay"===e.event?h.call(this):"waiting"!==e.event&&("playing"===e.event?h.call(this):"timeout"!==e.event&&"ended"!==e.event||g.call(this))},t.prototype._checkRtsSupport=function(e,t){this._options.skipRtsSupportCheck?e():this._rts.isSupport({isReceiveVideo:!0}).then(e).catch(t)},t.prototype._rtsErrorEventHandler=function(e){var t,r;switch(console.log("RTS Error:",e),Number(e.errorCode)){case 10102:g.call(this);break;case 12e3:t=o.ErrorCode.RtsPeerConnectionUnknown,r=s.get("Rts_Err_PeerConnection_Unknown"),v.call(this,t,r)}}};var f=function(){function e(e,t){(this.isRetry=t)&&(this.isApple=u.IS_IOS||u.IS_SAFARI,this.player=e)}return e.prototype.preProcess=function(){var e,t,r;this.isRetry&&this.isApple&&(e=this.player.getVolume(),t=this.player.muted(),e)&&!t&&((r=this.player.tag).volume=0,this.player.one("canplay",(function(){r.volume=e})))},e}()},{"../../config":14,"../../lang/index":23,"../../lib/constants":28,"../../lib/io":40,"../../lib/ua":49,"../base/event/eventtype":70,"es6-promise":8}],105:[function(e,t,r){var i=e("../base/player"),n=e("./rtsinjector"),a=i.extend({init:function(e,t){t.isLive&&(t._native=!1,n.inject(this,a,i,t),i.call(this,e,t))}});t.exports=a},{"../base/player":91,"./rtsinjector":104}],106:[function(e,t,r){var i=e("../../lib/constants");e=e("../../lib/oo").extend({init:function(e){this.player=e,this.tickhandle=null}});e.prototype.tick=function(e,t){var r=this;this.tickhandle=setTimeout((function(){r.player&&r.player.trigger(i.AuthKeyExpiredEvent),t&&t()}),1e3*e)},e.prototype.clearTick=function(e){this.tickhandle&&clearTimeout(this.tickhandle)},t.exports=e},{"../../lib/constants":28,"../../lib/oo":43}],107:[function(e,t,r){function i(e,t,r){var i=s.randomUUID(),a="https://mts."+e.domainRegion+".aliyuncs.com/?";i={AccessKeyId:e.accessId,Action:"GetLicense",MediaId:e.vid,LicenseUrl:a,data:e.data,SecurityToken:e.stsToken,Format:"JSON",Type:e.encryptionType,Version:"2014-06-18",SignatureMethod:"HMAC-SHA1",SignatureVersion:"1.0",SignatureNonce:i};e.header&&(i.Header=e.header),a+="Signature="+s.AliyunEncodeURI(s.makeChangeSiga(i,e.accessSecret,"POST")),e=s.makeUTF8sort(i,"=","&"),n.post(a,e,(function(e){e?(e=JSON.parse(e),t&&(e=e.License,t(e))):r&&r(l.createError("MPS获取License失败"))}),(function(e){if(r){var t={Code:"",Message:d.get("Error_MTS_Fetch_Urls_Text")};try{t=JSON.parse(e)}catch(e){}r({Code:o.ErrorCode.ServerAPIError,Message:t.Code+"|"+t.Message,sri:t.RequestId||""})}}))}var n=e("../../lib/io"),a=(e("../../lib/ua"),e("../../lib/bufferbase64")),o=e("../../lib/constants"),s=e("./signature"),l=e("./util"),u=e("../../lib/url"),c=e("../../lib/playerutil"),d=e("../../lang/index"),h=e("../base/event/eventtype");function f(e){window.console.error("The license request failed.")}function p(e){window.console.error("A decryption key error was encountered"),window.console.error("A decryption key error was encountered",e)}function g(e){window.console.log("Decryption key was added to session.")}function v(e,t,r){r.addEventListener(e,(function(){t(arguments[0])}),!1)}t.exports.requestLicenseKey=function(e){var t=e;return t._options.vid&&(t.__vid=t._options.vid),function(e,r){var n,s,l=t._options,u=t._getDRMEncryptItem();u&&(n={vid:t.__vid,accessId:l.accId,accessSecret:l.accSecret,stsToken:l.stsToken,domainRegion:l.domainRegion,authInfo:l.authInfo,encryptionType:u.encryptionType},u.encryptionType==o.EncryptionType.Widevine?n.data=a.encode(e.message):u.encryptionType==o.EncryptionType.PlayReady&&(l=a.unpackPlayReady(e.message),n.data=l.changange,l.header)&&(n.header=JSON.stringify(l.header)),console.log(n.data),e=t.__licenseKeys,s=t.__vid+u.Url,e&&e[s],i(n,(function(e){t.__licenseKeys||(t.__licenseKeys={}),10<n.data.length&&(t.__licenseKeys[s]=e),e=a.decode(e),r(e)}),(function(e){e={mediaId:t.__vid,error_code:e.Code,error_msg:e.Message},t.logError(e),t.trigger("error",e)})))}},t.exports.loadCertificate=function(e,t){var r,i,n,a=new XMLHttpRequest,l=(a.addEventListener("load",function(e,t){var r;t=t.target;if(200!==t.status){var i=o.ErrorCode.DrmLicenseRequestFailed,n=d.get("Error_Drm_License_Request_Failed");i={mediaId:this._options.vid||"",error_code:i,error_msg:t.response};player.logError(i),i.display_msg=n,player.trigger(h.Player.Error,i)}else{try{r=this._options.isLive?JSON.parse(t.response).Response.B64ServCert:JSON.parse(JSON.parse(t.response).DRMCertInfo).b64ServCert}catch(e){console.log(e)}n=s.base64DecodeUint8Array(r),i=function(e,t){var r=t.target,i=(t=t.initData,s.arrayToString(t).split("skd://")[1].split("?")[0]),n=s.stringToArray(i);if(t=function(e,t,r){"string"==typeof t&&(t=stringToArray(t));var i=0,n=new ArrayBuffer(e.byteLength+4+t.byteLength+4+r.byteLength),a=new DataView(n);new Uint8Array(n,0,e.byteLength).set(e),i+=e.byteLength,a.setUint32(i,t.byteLength,!0),i+=4,e=new Uint16Array(n,i,t.length);return e.set(t),i+=e.byteLength,a.setUint32(i,r.byteLength,!0),i+=4,new Uint8Array(n,i,r.byteLength).set(r),new Uint8Array(n,0,n.byteLength)}(t,n,e),r.webkitKeys||(function(){if(!WebKitMediaKeys.isTypeSupported("com.apple.fps.1_0","video/mp4"))throw"Key System not supported";keySystem="com.apple.fps.1_0"}(),r.webkitSetMediaKeys(new WebKitMediaKeys(keySystem))),!r.webkitKeys)throw"Could not create MediaKeys";if(n=r.webkitKeys.createSession("video/mp4",t),!n)throw"Could not create key session";n.contentId=i,v("webkitkeymessage",function(e){var t=this,r=e.target,i=e.message,n=new XMLHttpRequest,a=(e=(e.sessionId,n.responseType="text",n.session=r,n.addEventListener("load",function(e){e=e.target,t=this._options.isLive?JSON.parse(e.response).Response.B64License:JSON.parse(JSON.parse(e.response).License).b64License;var t=s.base64DecodeUint8Array(t);t=s.Uint8ArrayToString(t);"<ckc>"===t.substr(0,5)&&"</ckc>"===t.substr(-6)&&(t=t.slice(5,-6)),t=s.base64DecodeUint8Array(t),e.session.update(t)}.bind(this),!1),n.addEventListener("error",f,!1),btoa("spc="+s.base64EncodeUint8Array(i)+"&assetId="+encodeURIComponent(r.contentId))),{Format:"JSON",SignatureMethod:"HMAC-SHA1",SignatureVersion:"1.0",Timestamp:s.ISODateString(new Date),SignatureNonce:s.randomUUID(),AccessKeyId:t._options.accessKeyId,SecurityToken:t._options.securityToken,CertId:t._options.certId});t._options.isLive?(a.RegionId=t._options.region,a.Action="DescribeDRMLicense",a.Version="2016-11-01",a.CdmData=e,a.Type="fairplay",a.Domain=u.parseUrl(t._options.source).hostname):(a.region=t._options.region,a.Action="GetDRMLicense",a.Version="2017-03-21",a.VideoId=t._options.vid,a.CDMData=e,a.DRMType="FairPlay");var o,l;i="Signature="+s.AliyunEncodeURI(s.makeChangeSiga(a,t._options.accessKeySecret,"POST"));for(l in r=t._options.isLive?"https://"+c.getLiveHostByRegion(t._options.region)+"/?"+i:"https://vod."+t._options.region+".aliyuncs.com/?"+i,n.open("POST",r,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a){var d;a.hasOwnProperty(l)&&(d=a[l],o=o?o+"&"+s.AliyunEncodeURI(l)+"="+s.AliyunEncodeURI(d):s.AliyunEncodeURI(l)+"="+s.AliyunEncodeURI(d))}n.send(o)}.bind(this),n),v("webkitkeyadded",g,n),v("webkitkeyerror",p,n)}.bind(this,n),this._fairPlayHandlers.onNeedKey=i,t=function(e){window.console.error("A video playback error occurred")}.bind(this),this._fairPlayHandlers.onError=t,this.tag.addEventListener("webkitneedkey",i,!1),this.tag.addEventListener("error",t,!1),this.tag.src=this._options.source}e&&e()}.bind(e,t),!1),a.addEventListener("error",function(e){window.console.error("Failed to retrieve the server certificate.")}.bind(e),!1),{Format:"JSON",SignatureMethod:"HMAC-SHA1",SignatureVersion:"1.0",Timestamp:s.ISODateString(new Date),SignatureNonce:s.randomUUID(),AccessKeyId:e._options.accessKeyId,SecurityToken:e._options.securityToken,CertId:e._options.certId});e._options.isLive?(l.RegionId=e._options.region,l.Action="DescribeDRMCertificate",l.Version="2016-11-01"):(l.region=e._options.region,l.Action="GetDRMCertInfo",l.Version="2017-03-21",l.VideoId=e._options.vid),t="Signature="+s.AliyunEncodeURI(s.makeChangeSiga(l,e._options.accessKeySecret,"POST")),e=e._options.isLive?"https://"+c.getLiveHostByRegion(e._options.region)+"/?"+t:"https://vod."+e._options.region+".aliyuncs.com/?"+t;for(r in a.open("POST",e,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l)l.hasOwnProperty(r)&&(i=l[r],n=n?n+"&"+s.AliyunEncodeURI(r)+"="+s.AliyunEncodeURI(i):s.AliyunEncodeURI(r)+"="+s.AliyunEncodeURI(i),console.log(i));a.send(n)},t.exports.getRequestUrl=function(e,t){e={AccessKeyId:t._options.accessKeyId,Format:"JSON",Version:"2016-11-01",SignatureMethod:"HMAC-SHA1",SignatureVersion:"1.0",Timestamp:s.ISODateString(new Date),SignatureNonce:s.randomUUID(),SecurityToken:t._options.securityToken,RegionId:t._options.region,Action:"DescribeDRMLicense",Type:"widevine",CdmData:e,Domain:u.parseUrl(t._options.source).hostname};var r=(t._options.widevineCertId&&(e.CertId=t._options.widevineCertId),"Signature="+s.AliyunEncodeURI(s.makeChangeSiga(e,t._options.accessKeySecret,"POST")));return{url:"https://"+c.getLiveHostByRegion(t._options.region)+"/?"+r,data:s.makeUTF8sort(e,"=","&"),jsonData:s.makeUTF8sort(e,"=","&","json")}},t.exports.postData=function(e,t){var r=s.randomUUID();r={AccessKeyId:t._options.accessKeyId,VideoId:t._options.vid,Format:"JSON",Version:"2017-03-21",SignatureMethod:"HMAC-SHA1",SignatureVersion:"1.0",SignatureNonce:r,SecurityToken:t._options.securityToken,region:t._options.region,Action:"GetDRMLicense",DRMType:"Widevine",CDMData:e},t._options.widevineCertId&&(r.CertId=t._options.widevineCertId),e="Signature="+s.AliyunEncodeURI(s.makeChangeSiga(r,t._options.accessKeySecret,"POST"));return{url:"https://vod."+t._options.region+".aliyuncs.com/?"+e,data:s.makeUTF8sort(r,"=","&"),jsonData:s.makeUTF8sort(r,"=","&","json")}},t.exports.destroyFairPlay=function(){this._fairPlayHandlers.onNeedKey&&this.tag.removeEventListener("webkitneedkey",this._fairPlayHandlers.onNeedKey),this._fairPlayHandlers.onError&&this.tag.removeEventListener("error",this._fairPlayHandlers.onError),this._fairPlayHandlers={}}},{"../../lang/index":23,"../../lib/bufferbase64":25,"../../lib/constants":28,"../../lib/io":40,"../../lib/playerutil":46,"../../lib/ua":49,"../../lib/url":50,"../base/event/eventtype":70,"./signature":113,"./util":115}],108:[function(e,t,r){var i=e("../../lib/io"),n=e("../../lib/constants"),a=e("../../lib/data"),o=e("./util");t.exports.getDataByAuthInfo=function(e,t,r,s){e={playAuth:e.playAuth,requestId:e.requestId},i.get("https://api.h5video.shop/api/page/getMediaPlayInfo"+function(e){return e.requestId=a.guid(),Object.keys(e).reduce((function(t,r){return t+(t?"&":"?")+r+"="+encodeURIComponent(e[r])}),"")}(e),(function(e){if(e)if(e=JSON.parse(e),200!==e.httpStatusCode)s&&s({Code:n.ErrorCode.ServerAPIError,Message:e.httpStatusCode+"|"+e.code,sri:e.requestId});else{for(var i=e.data.PlayInfoList,a=[],l=i.length-1;0<=l;--l)"AUTO"===i[l].Definition&&(a=[i.splice(l,1)[0]]);var u,c=null;(c=(c=0===a.length?o.objectPlayerMessageSort(i,t):o.objectPlayerMessageSort(a)).map((function(e){return"m3u8"===e.format&&(e.Url=e.Url+"&_ext=.m3u8"),e})))&&r&&(u=e.data.VideoBase||{},r({videoId:u.VideoId,userId:u.UserId,requestId:e.requestId,urls:c,encryptUrlArr:[],thumbnailUrl:"",coverUrl:u.CoverURL,playInfoAry:i,textTracks:e.data.SubtitlesList}))}else s&&s(o.createError("轻SaaS服务获取数据失败"))}),(function(e){e&&"string"==typeof e&&-1<e.indexOf("Invalid CORS request")?s&&s({Code:n.ErrorCode.ServerAPIError,Message:e}):s&&s(o.createError("轻SaaS服务获取数据失败"))}))}},{"../../lib/constants":28,"../../lib/data":30,"../../lib/io":40,"./util":115}],109:[function(e,t,r){var i=e("./saasplayer"),n=e("./light"),a=e("../base/event/eventtype");e=i.extend({init:function(e,t){i.call(this,e,t),this.service=n,this.loadByLightSaas()}});e.prototype.loadByLightSaas=function(e){var t=this._options,r={playAuth:t.mediaAuth,defaultDefinition:t.defaultDefinition};this.log("STARTFETCHDATA",{it:"lightSaasPlayAuth",pa:{playAuth:t.mediaAuth}}),this.loadData(r,e)},e.prototype.replayByMediaAuth=function(e){this.trigger(a.Private.Error_Hide),this.tag&&(this.tag.pause(),this.tag.removeAttribute("src"),this.tag.load()),this.setTextTracks([]),this.trigger(a.Private.UserTrackReset),this._options.source="",this._options.mediaAuth=e,this._isError=!1,this._duration=0,this._options.cover="",this._vodRetryCount=0,this._clearTimeout(),this.loadByLightSaas(!0)},t.exports=e},{"../base/event/eventtype":70,"./light":108,"./saasplayer":112}],110:[function(e,t,r){var i=e("../../lib/io"),n=e("../../lib/constants"),a=e("./signature"),o=e("./util"),s=e("../../lang/index"),l=e("../../lib/ua"),u=function(e,t){for(var r="",i=(e.sort((function(e,r){return e=parseInt(e.width),r=parseInt(r.width),"desc"==t?r<e?-1:e<r?1:void 0:e<r?-1:r<e?1:void 0})),e.length),a=0;a<i;a++){var o=e[a],s=n.QualityLevels[o.definition],l=void 0===s?"":r==s?s+o.height:s;o.desc=l,r=s}};t.exports.getDataByAuthInfo=function(e,t,r,c){a.returnUTCDate(),a.randomUUID();var d=a.randomUUID();d={AccessKeyId:e.accessId,Action:"PlayInfo",MediaId:e.vid,Formats:e.format,AuthInfo:e.authInfo,AuthTimeout:e.authTimeout||n.AuthKeyExpired,IncludeSnapshotList:e.includeSnapshotList,Rand:e.rand,SecurityToken:e.stsToken,Format:"JSON",Version:"2014-06-18",SignatureMethod:"HMAC-SHA1",SignatureVersion:"1.0",Terminal:l.IS_CHROME?"Chrome":l.IS_EDGE?"Edge":l.IS_IE11?"IE":l.IS_SAFARI?"Safari":l.IS_FIREFOX?"Firefox":"",SignatureNonce:d},e.hlsUriToken&&(e.MtsHlsUriToken=e.hlsUriToken),e.playConfig&&(d.PlayConfig=JSON.stringify(e.playConfig)),d=a.makeUTF8sort(d,"=","&")+"&Signature="+a.AliyunEncodeURI(a.makeChangeSiga(d,e.accessSecret)),e="https://mts."+e.domainRegion+".aliyuncs.com/?"+d;i.get(e,(function(e){var i,a,s;e?(i=(e=JSON.parse(e)).PlayInfoList.PlayInfo,a="",(s=e.SnapshotList?e.SnapshotList.Snapshot:[])&&0<s.length&&(a=s[0].Url),s=function(e,t){for(var r=[],i=[],a=[],o=[],s=e.length-1;0<=s;s--){var l=e[s];("mp4"==l.format?i:"mp3"==l.format?a:"m3u8"==l.format?r:o).push(l)}return 0<a.length?(function(e,t){for(var r="",i=(e.sort((function(e,r){return e=parseInt(e.bitrate),r=parseInt(r.bitrate),"desc"==t?r<e?-1:e<r?1:void 0:e<r?-1:r<e?1:void 0})),e.length),a=0;a<i;a++){var o=e[a],s=n.QualityLevels[o.definition],l=void 0===s?o.bitrate:r==s?s+o.bitrate:s;o.desc=l,r=s}}(a,t),a):0<i.length?(u(i,t),i):0<r.length?(u(r,t),r):(u(o,t),o)}(i,t),r&&r({requestId:e.RequestId,urls:s,thumbnailUrl:a})):c&&c(o.createError("MPS获取取数失败"))}),(function(e){if(c){var t={Code:"",Message:s.get("Error_MTS_Fetch_Urls_Text")};try{t=JSON.parse(e)}catch(e){}c({Code:n.ErrorCode.ServerAPIError,Message:t.Code+"|"+t.Message,sri:t.RequestId||""})}}))}},{"../../lang/index":23,"../../lib/constants":28,"../../lib/io":40,"../../lib/ua":49,"./signature":113,"./util":115}],111:[function(e,t,r){var i=e("./saasplayer"),n=(e("../../lib/constants"),e("./mts"));e=i.extend({init:function(e,t){i.call(this,e,t),this.service=n,this.loadByMts()}});e.prototype.loadByMts=function(e){var t={vid:this._options.vid,accessId:this._options.accId,accessSecret:this._options.accSecret,stsToken:this._options.stsToken,domainRegion:this._options.domainRegion,authInfo:this._options.authInfo,format:this._options.format,includeSnapshotList:this._options.includeSnapshotList||!1,defaultDefinition:this._options.defaultDefinition,authTimeout:this._options.authTimeout,hlsUriToken:this._options.hlsUriToken,playConfig:this._options.playConfig};this.loadData(t,e)},e.prototype.replayByVidAndAuthInfo=function(e,t,r,i,n,a){this.trigger("error_hide"),this._options.source="",this._isError=!1,this._duration=0,this._options.cover="",this._vodRetryCount=0,this._clearTimeout(),this.reloadNewVideoInfo(e,t,r,i,n,a)},e.prototype.reloadNewVideoInfo=function(e,t,r,i,n,a){if(this.trigger("error_hide"),this._options.source="",e&&(this._options.vid=e,this._options.accId=t,this._options.accessSecret=r,this._options.stsToken=i,this._options.domainRegion=a,this._options.authInfo=n),!(this._options.vid&&this._options.accId&&this._options.accessSecret&&this._options.stsToken&&this._options.domainRegion&&this._options.authInfo))throw new Error("需要提供vid、accId、accessSecret、stsToken、domainRegion和authInfo参数");this.log("STARTFETCHDATA",{it:"mps",pa:{vid:e}}),this.loadByMts(!0)},t.exports=e},{"../../lib/constants":28,"./mts":110,"./saasplayer":112}],112:[function(e,t,r){var i=e("../base/player"),n=e("../audio/audioplayer"),a=(e("../../lib/event"),e("../../lib/io")),o=e("../../lib/constants"),s=e("./signature"),l=e("./authkeyexpiredhandle"),u=e("../hls/hlsinjector"),c=e("../flv/flvinjector"),d=e("../drm/drminjector"),h=(e("../../lib/cookie"),e("../../lang/index")),f=e("../../lib/ua"),p=e("../../config"),g=e("../../lib/playerutil"),v=e("../base/event/eventtype"),y=e("../../protected/anti-injector-protected"),m=i.extend({init:function(e,t){y(t,this),this._authKeyExpiredHandle=new l(this),i.prototype._videoCreateEl||(i.prototype._videoCreateEl=i.prototype.createEl),"mp3"==t.format?(t.height="auto",t.mediaType="audio",i.prototype.createEl=n.prototype.createEl,n.call(this,e,t),m.prototype.play=i.prototype.play,m.prototype.pause=i.prototype.pause,m.prototype.initPlay=i.prototype.initPlay,m.prototype.replay=i.prototype.replay,m.prototype.stop=i.prototype.stop,m.prototype.seek=i.prototype.seek):(i.prototype.createEl=i.prototype._videoCreateEl,t._native=!1,i.call(this,e,t))}});m.prototype.loadData=function(e,t){var r,i,n;"undefined"!=typeof _sce_r_skjhfnck||""!=e.format&&"m3u8"!=e.format&&1!=this._options.encryptType?this._loadData(e,t):(r="aliplayer-vod-min.js","",i=p.domain?"https://"+p.domain+"/de/prismplayer/"+p.h5Version+"/hls/"+r:"/build/hls/"+r,n=this,a.loadJS(i,(function(){n._loadData(e,t)})))},m.prototype._loadData=function(e,t){var r,n=(new Date).getTime(),a=this;this._urls=[],this._currentPlayIndex=0,this._retrySwitchUrlCount=0,this._authKeyExpiredHandle.clearTick(),""!=e.format&&"m3u8"!=e.format||1!=this._options.encryptType?e.rand=s.randomUUID():(r=_sce_r_skjhfnck(),e.rand=_sce_lgtcaygl(r,a._vdnct6f)),this._options.thumbnailUrl&&(e.thumbnailUrl=this._options.thumbnailUrl),this.trigger(v.Private.H5_Loading_Show),this.service.getDataByAuthInfo(e,this._options.qualitySort,(function(s){if(a.trigger(v.Private.PlayInfoLoaded,s),s.userId&&(a._options.from=s.userId),s.videoId&&a._monitor&&a._monitor.updateLightSaasVideoId(s.videoId),s.textTracks&&s.textTracks.length&&(l=g.unqiueTextTracks(s.textTracks),a.trigger(v.Private.TextTrackFounded,{from:"saas",textTracks:l})),s.urls&&0==s.urls.length)a._mtsError_message(a,{Code:o.ErrorCode.URLsIsEmpty,Message:h.get("Error_Vod_URL_Is_Empty_Text")+(e.format?"(format:"+e.format+")":"")},"");else{a.log("COMPLETEFETCHDATA",{cost:(new Date).getTime()-n,mi:JSON.stringify(function(e){for(var t=[],r=0;r<e.length;r++)t.push({width:e[r].width,height:e[r].height,definition:e[r].definition,format:e[r].format,encryptionType:e[r].encryptionType,duration:e[r].duration});return t}(s.urls))}),a._urls=s.urls,a._currentPlayIndex=g.findSelectedStreamLevel(a._urls,e.defaultDefinition);var l=(p=s.urls[a._currentPlayIndex]).Url;if(a._vodDuration=p.duration||0,a._options.source=l,a.encType="",a.trigger(v.Private.PREPARE,p.definition),a.UI.cover&&s.coverUrl&&!a._options.cover&&a.setCover(s.coverUrl),g.isHls(l))if(s&&s.playInfoAry&&0<s.playInfoAry.length&&"Widevine-FairPlay"==s.playInfoAry[0].EncryptType)d.inject(a,m,i.prototype,a._options);else{if(s.encryptUrlArr&&0<s.encryptUrlArr.length)for(var p,y,_=[],b=0;b<s.encryptUrlArr.length;++b)(p=s.encryptUrlArr[b]).encryptionType===o.EncryptionType.Private&&(y=_sce_dlgtqred(r,p.rand,p.plaintext),_.push({url:p.Url,secData:y}));else if(ecData="",p.encryptionType==o.EncryptionType.Private){a.encType=p.encryptionType;var T=g.checkSecuritSupport();if(T)return void a._mtsError_message(a,{Code:o.ErrorCode.EncrptyVideoNotSupport,Message:T,display_msg:T},"");_=_sce_dlgtqred(r,p.rand,p.plaintext)}a._hls&&(a._hls.destroy(),a._hls=null),u.inject(a,m,i,a._options,_)}else g.isFlv(l)?c.inject(a,m,i,a._options):g.isDash(l)?(console.log("isDash"),d.inject(a,m,i,a._options)):a._player._executeReadyCallback();a._authKeyExpiredHandle.tick(o.AuthKeyRefreshExpired),a.trigger(v.Private.SourceLoaded,p),a.initPlay(t),a.trigger(v.Private.ChangeURL,{from:"saas"}),s.thumbnailUrl&&a._thumbnailService.get(s.thumbnailUrl),T=a._player._isFlv,l=-1<a._player.getOptions().source.indexOf("mp4"),1==a._player.encType||T||l||(f.IS_IOS||f.IS_MAC_SAFARI||f.IS_X5||f.IS_EDGE)&&(a._player._executeReadyCallback(),a._urls.length)&&a.trigger(v.Private.SourceLoaded,p)}}),(function(e){a._mtsError_message(a,e,"")}))},m.prototype._changeStream=function(e,t){this._urls.length>e&&(this._loadByUrlInner(this._urls[e].Url,this.getCurrentTime(),!0),this._currentPlayIndex=e,this.trigger(v.Private.QualityChange,t||h.get("Quality_Change_Fail_Switch_Text")))},m.prototype._getLowerQualityLevel=function(){if(0!=this._urls.length&&-1!=this._currentPlayIndex)if("asc"==this.options().qualitySort){if(0<this._currentPlayIndex)return{item:this._urls[this._currentPlayIndex-1],index:this._currentPlayIndex-1}}else if(this._currentPlayIndex<this._urls.length-1)return{item:this._urls[this._currentPlayIndex+1],index:this._currentPlayIndex+1};return""},m.prototype._mtsError_message=function(e,t,r){e._serverRequestId=t.sri,e.trigger(v.Private.H5_Loading_Hide);var i=t.Code||"OTHER_ERR_CODE",n=t.Message||"OTHER_ERR_MSG",a=(o.ErrorCode.ServerAPIError,t.display_msg||""),s=(-1<n.indexOf("InvalidParameter.Rand")||-1<n.indexOf('"Rand" is not valid.')?(o.ErrorCode.EncrptyVideoNotSupport,a=h.get("Error_Not_Support_encrypt_Text")):-1<n.indexOf("SecurityToken.Expired")?(o.ErrorCode.AuthKeyExpired,a=h.get("Error_Playauth_Expired_Text")):-1<n.indexOf("InvalidVideo.NoneStream")?(o.ErrorCode.URLsIsEmpty,a=h.get("Error_Fetch_NotStream")+"("+e._options.format+"|"+e._options.definition+")"):-1<n.indexOf("DataNotFound")&&(o.ErrorCode.MediaNotFound,a=h.get("Error_Fetch_Media_Not_Found")),e._options.vid||"");e._options.from,s={mediaId:s,mediaAuth:e._options.mediaAuth||"",error_code:i,error_msg:n};t.sri&&(s.sri=t.sri),e.logError(s),s.display_msg=(a||h.get("Error_Vod_Fetch_Urls_Text"))+"</br>"+n,e.trigger("error",s),console.log("PrismPlayer Error: "+r+"! error_msg :"+n+";")},t.exports=m},{"../../config":14,"../../lang/index":23,"../../lib/constants":28,"../../lib/cookie":29,"../../lib/event":33,"../../lib/io":40,"../../lib/playerutil":46,"../../lib/ua":49,"../../protected/anti-injector-protected":129,"../audio/audioplayer":68,"../base/event/eventtype":70,"../base/player":91,"../drm/drminjector":97,"../flv/flvinjector":100,"../hls/hlsinjector":102,"./authkeyexpiredhandle":106,"./signature":113}],113:[function(e,t,r){var n=e("crypto-js/hmac-sha1"),a=e("crypto-js/enc-base64"),o=e("crypto-js/enc-utf8");t.exports.randomUUID=function(){for(var e=[],t="0123456789abcdef",r=0;r<36;r++)e[r]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},t.exports.returnUTCDate=function(){var e=new Date,t=e.getUTCFullYear(),r=e.getUTCMonth(),i=e.getUTCDate(),n=e.getUTCHours(),a=e.getUTCMinutes(),o=e.getUTCSeconds();e=e.getUTCMilliseconds();return Date.UTC(t,r,i,n,a,o,e)},t.exports.AliyunEncodeURI=function(e){return e=encodeURIComponent(e),(e=(e=e.replace("+","%2B")).replace("*","%2A")).replace("%7E","~")},t.exports.makesort=function(e,t,r){if(!e)throw new Error("PrismPlayer Error: vid should not be null!");var i=[];for(s in e)i.push(s);for(var n=i.sort(),a="",o=n.length,s=0;s<o;s++)""==a?a=n[s]+t+e[n[s]]:a+=r+n[s]+t+e[n[s]];return a},t.exports.makeUTF8sort=function(e,r,i){if(!e)throw new Error("PrismPlayer Error: vid should not be null!");var n=[];for(l in e)n.push(l);for(var a=n.sort(),o="",s=a.length,l=0;l<s;l++){var u=t.exports.AliyunEncodeURI(a[l]),c=t.exports.AliyunEncodeURI(e[a[l]]);""==o?o=u+r+c:o+=i+u+r+c}return o},t.exports.makeChangeSiga=function(e,r,i){if(e)return a.stringify(n((i=i||"GET")+"&"+t.exports.AliyunEncodeURI("/")+"&"+t.exports.AliyunEncodeURI(t.exports.makeUTF8sort(e,"=","&")),r+"&"));throw new Error("PrismPlayer Error: vid should not be null!")},t.exports.ISODateString=function(e){function t(e){return e<10?"0"+e:e}return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"Z"},t.exports.encPlayAuth=function(e){if(e=o.stringify(a.parse(e)))return JSON.parse(e);throw new Error("playuth参数解析为空")},t.exports.encRsa=function(){},t.exports.stringToArray=function(e){for(var t=new ArrayBuffer(2*e.length),r=new Uint16Array(t),i=0,n=e.length;i<n;i++)r[i]=e.charCodeAt(i);return r},t.exports.Uint8ArrayToString=function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},t.exports.arrayToString=function(e){return e=new Uint16Array(e.buffer),String.fromCharCode.apply(null,e)},t.exports.base64DecodeUint8Array=function(e){var t=window.atob(e),r=t.length,n=new Uint8Array(new ArrayBuffer(r));for(i=0;i<r;i++)n[i]=t.charCodeAt(i);return n},t.exports.base64EncodeUint8Array=function(e){for(var t,r,i,n,a,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",u=0;u<e.length;)i=(t=e[u++])>>2,n=(3&t)<<4|(t=u<e.length?e[u++]:Number.NaN)>>4,a=(15&t)<<2|(r=u<e.length?e[u++]:Number.NaN)>>6,o=63&r,isNaN(t)?a=o=64:isNaN(r)&&(o=64),l+=s.charAt(i)+s.charAt(n)+s.charAt(a)+s.charAt(o);return l}},{"crypto-js/enc-base64":3,"crypto-js/enc-utf8":4,"crypto-js/hmac-sha1":5}],114:[function(e,t,r){var i=e("../../lib/io"),n=e("../../lib/constants"),a=e("./signature"),o=e("./util"),s=e("../../lang/index");t.exports.getPlayAuth=function(e,t,r,l){a.randomUUID();var u=a.randomUUID();u={AccessKeyId:e.accessKeyId,Action:"GetVideoPlayAuth",VideoId:e.vid,AuthTimeout:n.AuthInfoExpired,SecurityToken:e.securityToken,Format:"JSON",Version:"2017-03-21",SignatureMethod:"HMAC-SHA1",SignatureVersion:"1.0",SignatureNonce:u},u=a.makeUTF8sort(u,"=","&")+"&Signature="+a.AliyunEncodeURI(a.makeChangeSiga(u,e.accessKeySecret)),e="https://vod."+e.region+".aliyuncs.com/?"+u;i.get(e,(function(e){e?(e=JSON.parse(e),t&&t(e.PlayAuth)):r&&r(o.createError("获取视频播放凭证失败"))}),(function(e){if(r){var t={Code:"",Message:s.get("Fetch_Playauth_Error")};try{(t=JSON.parse(e)).Code}catch(e){}r({Code:n.ErrorCode.ServerAPIError,Message:t.Code+"|"+t.Message,sri:t.RequestId,display_msg:s.get("Fetch_Playauth_Error",l)})}}))}},{"../../lang/index":23,"../../lib/constants":28,"../../lib/io":40,"./signature":113,"./util":115}],115:[function(e,t,r){var i=e("../../lib/constants");t.exports.createError=function(e,t){return{requestId:"",code:t||"",message:e}},t.exports.getItem=function(e){var t={};return t.width=e.Width,t.height=e.Height,t.definition=e.Definition,t.Url=e.PlayURL,t.format=e.Format,t.desc=i.QualityLevels[t.definition],t.encryptionType=i.VodEncryptionType[e.EncryptType],t.plaintext=e.Plaintext,t.rand=e.Rand,t.encrypt=e.Encrypt,t.duration=e.Duration,t.bitrate=e.Bitrate,t},t.exports.objectPlayerMessageSort=function(e,r){for(var i=[],n=[],a=[],o=[],s=e.length-1;0<=s;s--){var l=e[s];l=t.exports.getItem(l);("mp4"==l.format?n:"mp3"==l.format?a:"m3u8"==l.format?i:o).push(l)}var u=[];u=0<a.length?a:0<n.length?n:0<i.length?i:o;return"asc"==r&&u.reverse(),u}},{"../../lib/constants":28}],116:[function(e,t,r){var i=e("../../lib/io"),n=e("../../lib/constants"),a=e("./signature"),o=e("./util"),s=e("../../config"),l=e("../../lang/index");t.exports.getDataByAuthInfo=function(e,t,r,u){a.randomUUID();var c=a.randomUUID();c={AccessKeyId:e.accessId,Action:"GetPlayInfo",VideoId:e.vid,Formats:e.format,AuthTimeout:e.authTimeout||n.AuthKeyExpired,Rand:e.rand,SecurityToken:e.stsToken,StreamType:e.mediaType,Format:"JSON",Version:"2017-03-21",SignatureMethod:"HMAC-SHA1",SignatureVersion:"1.0",SignatureNonce:c,PlayerVersion:s.h5Version,Channel:"HTML5"},"AUTO"===e.definition?c.ResultType="Multiple":e.definition&&(c.Definition=e.definition),e.authInfo&&(c.AuthInfo=e.authInfo),e.outputType&&(c.OutputType=e.outputType),e.playConfig&&(c.PlayConfig=JSON.stringify(e.playConfig)),e.reAuthInfo&&(c.ReAuthInfo=JSON.stringify(e.reAuthInfo)),c=a.makeUTF8sort(c,"=","&")+"&Signature="+a.AliyunEncodeURI(a.makeChangeSiga(c,e.accessSecret)),c="https://vod."+e.domainRegion+".aliyuncs.com/?"+c;i.get(c,(function(i){if(i){i=JSON.parse(i);for(var n="",a=i.VideoBase.ThumbnailList,s=(a&&a.Thumbnail&&0<a.Thumbnail.length?n=a.Thumbnail[0].URL:e.thumbnailUrl&&(n=String(e.thumbnailUrl)),i.PlayInfoList.PlayInfo),l=[],c=[],d=s.length-1;0<=d;--d)"AUTO"===s[d].Definition?l=[s.splice(d,1)[0]]:1===s[d].Encrypt&&c.push(s[d]);a=null,c=0===l.length?(a=o.objectPlayerMessageSort(s,t),[]):(a=o.objectPlayerMessageSort(l),o.objectPlayerMessageSort(c)),a&&r&&r({requestId:i.RequestId,urls:a,encryptUrlArr:c,thumbnailUrl:n,coverUrl:i.VideoBase.CoverURL,playInfoAry:s})}else u&&u(o.createError("点播服务获取数据失败"))}),(function(e){if(u){var t={Code:"",Message:l.get("Error_Vod_Fetch_Urls_Text")};try{t=JSON.parse(e)}catch(e){}u({Code:n.ErrorCode.ServerAPIError,Message:t.Code+"|"+t.Message,sri:t.RequestId||""})}}))}},{"../../config":14,"../../lang/index":23,"../../lib/constants":28,"../../lib/io":40,"./signature":113,"./util":115}],117:[function(e,t,r){var i=e("./saasplayer"),n=e("../../lib/constants"),a=e("./vod"),o=e("./signature"),s=(e("./authkeyexpiredhandle"),e("./ststoken"),e("../../lib/io")),l=e("../../config");e=i.extend({init:function(e,t){i.call(this,e,t),this.service=a,this.loadByVod()}});e.prototype.loadByVod=function(e){var t,r,i;"undefined"!=typeof _pa_n4lto7xi?this._loadByVod(e):(t="aliplayer-vod-p-min.js","",r=l.domain?"https://"+l.domain+"/de/prismplayer/"+l.h5Version+"/hls/"+t:"/build/hls/"+t,i=this,s.loadJS(r,(function(){i._loadByVod(e)})))},e.prototype._loadByVod=function(e){var t="",r="",i="",a="",s="";if(this._options.accessKeyId&&this._options.accessKeySecret)t=this._options.accessKeyId,r=this._options.accessKeySecret,i=this._options.securityToken,a=this._options.region,this.log("STARTFETCHDATA",{it:"sts",pa:{vid:this._options.vid}});else{try{var l=_pa_n4lto7xi(this._options.playauth),u=(this._options.playauth!==l&&(this._vdnct6f=!0),o.encPlayAuth(l));t=u.AccessKeyId,r=u.AccessKeySecret,i=u.SecurityToken,a=u.Region,s=u.AuthInfo}catch(e){console.log("e",e);var c={Code:n.ErrorCode.PlayauthDecode,Message:"playauth decoded failed.",displayMessage:"playauth解析错误"};return void this._mtsError_message(this,c,l)}this._options.from=u.CustomerId||"",this.log("STARTFETCHDATA",{it:"playAuth",pa:{vid:this._options.vid}})}this._loadByVodBySTS(t,r,i,a,s,e)},e.prototype.replayByVidAndPlayAuth=function(e,t){this.trigger("error_hide"),this._options.source="",this._options.vid=e,this._options.playauth=t,this._isError=!1,this._duration=0,this._options.cover="",this._vodRetryCount=0,this._clearTimeout(),this.loadByVod(!0)},e.prototype.updateSourcesByVidAndPlayAuth=function(e,t){var r,i,n;"undefined"!=typeof _pa_n4lto7xi?this._updateSourcesByVidAndPlayAuth(e,t):(r="aliplayer-vod-p-min.js","",i=l.domain?"https://"+l.domain+"/de/prismplayer/"+l.h5Version+"/hls/"+r:"/build/hls/"+r,n=this,s.loadJS(i,(function(){n._updateSourcesByVidAndPlayAuth(e,t)})))},e.prototype._updateSourcesByVidAndPlayAuth=function(e,t){if(e!=this._options.vid)console.log("不能更新地址，vid和播放中的不一致");else{this._options.vid=e,this._options.playauth=t;try{var r=_pa_n4lto7xi(this._options.playauth),i=(this._options.playauth!==r&&(this._vdnct6f=!0),o.encPlayAuth(r))}catch(e){return void console.log("playauth解析错误")}t={vid:e,accessId:i.AccessKeyId,accessSecret:i.AccessKeySecret,stsToken:i.SecurityToken,domainRegion:i.Region,authInfo:i.AuthInfo,playDomain:i.PlayDomain,format:this._options.format,mediaType:this._options.mediaType};var a=(this._authKeyExpiredHandle.clearTick(),this);this.service.loadData(t,this._options.qualitySort,(function(e){a._serverRequestId=e.requestId,0!=e.urls.length&&(a._urls=e.urls),a._authKeyExpiredHandle.tick(n.AuthKeyRefreshExpired)}),(function(e){console.log(e)}))}},e.prototype.reloaduserPlayInfoAndVidRequestMts=function(e,t){this.replayByVidAndPlayAuth(e,t,accessSecret)},e.prototype._loadByVodBySTS=function(e,t,r,i,n,a){e={vid:this._options.vid,accessId:e,accessSecret:t,stsToken:r,authInfo:n,domainRegion:i,format:this._options.format,mediaType:this._options.mediaType,definition:this._options.definition,defaultDefinition:this._options.defaultDefinition,authTimeout:this._options.authTimeout,outputType:this._options.outputType,playConfig:this._options.playConfig,reAuthInfo:this._options.reAuthInfo},this.loadData(e,a)},t.exports=e},{"../../config":14,"../../lib/constants":28,"../../lib/io":40,"./authkeyexpiredhandle":106,"./saasplayer":112,"./signature":113,"./ststoken":114,"./vod":116}],118:[function(e,t,r){function i(e){this._player=e,this._video=e.tag;var t=this;this._isCreated=!1,this._canPlayTriggered=!1,this._defaultTrack="",e.on(n.Private.ChangeURL,(function(){t._isCreated=!1,t._canPlayTriggered=!1,t._defaultTrack=""})),e.on(n.Player.CanPlay,(function(){var r;t._player._drm||t._canPlayTriggered||((r=t._getTracks())&&(t._isCreated=!0,t._player._options.isVBR||t._hls||(e.trigger(n.Player.AudioTrackReady,r),t._notifyDefaultValue(r))),t._canPlayTriggered=!0)})),e.on(n.Player.AudioTrackUpdated,(function(r){t._isCreated||(r=t._getTracks(r.paramData.audioTracks))&&(t._isCreated=!0,e.trigger(n.Player.AudioTrackReady,r),t._notifyDefaultValue(r))}))}var n=e("../base/event/eventtype");i.prototype._notifyDefaultValue=function(e){!this._defaultTrack&&0<e.length&&(this._defaultTrack=e[0]),this._defaultTrack&&this._player.trigger(n.Private.SelectorUpdateList,{type:"audio",text:this._defaultTrack.text})},i.prototype.support=function(){return!!this._video.audioTracks},i.prototype._getTracks=function(e){if(!this.support()&&!e)return null;for(var t=[],r=(e=!this._video||!this._video.audioTracks||e&&0!=e.length?e:this._video.audioTracks)?e.length:0,i=0;i<r;i++){var n=e[i],a={value:n.id,text:n.label||n.name||n.language};(n.default||n.enabled)&&(this._defaultTrack=a),t.push(a)}return t},i.prototype.switch=function(e){if(this._player._hls)this._player._hls.audioTrack=+e;else for(var t=this._video.audioTracks?this._video.audioTracks.length:0,r=0;r<t;r++){var i=this._video.audioTracks[r];i.id==e?i.enabled=!0:i.enabled=!1}},i.prototype.dispose=function(){this._player=null},t.exports=i},{"../base/event/eventtype":70}],119:[function(e,t,r){function i(e){this._video=e.tag,this._player=e,this._isCreated=!1,this._backupCC="",this.tracks=[],this._defaultTrack="",this._currentValue="",this._switchTimer=null,this._storedTracks=[];var t=this,r=(e.on(n.Player.LevelsLoaded,(function(e){if(o.IS_MAC_SAFARI||o.IS_IOS)if(e&&e.paramData&&e.paramData.subtitles&&e.paramData.subtitles.length){for(var r=e.paramData.subtitles||[],i=[],n=0;n<r.length;n++){var a=r[n];a.vttUrl=a.url&&a.url.replace(".m3u8",".vtt"),i.push(a)}t._storedTracks=i}else t._resotreTracks()})),e.on(n.Private.SafariDrmLevelSwitch,(function(){t._resotreTracks()})),e.on(n.Private.ChangeURL,(function(e){e&&e.paramData&&"saas"===e.paramData.from||(t._disabledTracks(),t._isCreated=!1,t._defaultTrack="",t._backupCC="")})),e.on(n.Private.VttClearTracks,(function(){t.switch("off"),t._disabledTracks(),t._isCreated=!1,t._defaultTrack={value:"off",text:"Off"},t.tracks=[t._defaultTrack],e.trigger(n.Private.SelectorGenerateList,{type:"cc"}),e.trigger(n.Private.CCStateChanged,{value:"off",lang:""})})),e.on(n.Player.CanPlay,(function(){t._isCreated||(t.tracks=t._getTracks(),e.trigger(n.Player.TextTrackReady,t.tracks),e.trigger(n.Private.CCReset)),t._isCreated&&!t._player._setDefaultCC||!t._defaultTrack||(e.trigger(n.Private.SelectorUpdateList,{type:"cc",text:t._defaultTrack.text}),t.switch(t._defaultTrack.value),t._player._setDefaultCC=!1,t._isCreated=!0)})),o.os.ios&&parseFloat(o.os.version)<=15.1&&a.addCssByStyle("video::-webkit-media-text-track-container{position: relative; top: -44px !important;}"),"always"===e.getOptions().controlBarVisibility&&a.addCssByStyle("video::-webkit-media-text-track-container{transform: translateY(-44px);}"),u.throttle((function(){e._vttBroker&&e._vttBroker.enabled||a.addCssByStyle("video::-webkit-media-text-track-container{transform: translateY(-44px);}")}),100));e.on(n.Private.ShowBar,r),r=u.throttle((function(){e._vttBroker&&e._vttBroker.enabled||a.addCssByStyle("video::-webkit-media-text-track-container{transform: none;}")}),100);e.on(n.Private.HideBar,r),e.on(n.Private.CCReset,(function(){t._updateSelectorList()}))}var n=e("../base/event/eventtype"),a=(e("../../lib/event"),e("../../lib/dom")),o=e("../../lib/ua"),s=e("../../lib/cookie"),l=e("../../lib/constants"),u=e("../../ui/component/util");i.prototype._adaptiveCueStype=function(){var e,t=-10;o.IS_SAFARI?(t=-65,(e=this._player.fullscreenService)&&e.getIsFullScreen()&&(t=-95)):o.IS_MOBILE&&(t=-30),a.addCssByStyle("video::-webkit-media-text-track-container{transform: translateY("+t+"px) !important;}")},i.prototype.close=function(){for(var e=this.getTextTracks(),t=e.length,r=0;r<t;r++){var i=e[r];"expired"!=i.mode&&("showing"==i.mode&&(this._backupCC=i),i.mode="disabled")}this._player.trigger(n.Private.VttHide)},i.prototype.open=function(){var e,t,r;return!this.tracks||this.tracks.length<2||(t=this._backupCC?this._backupCC.language:"",r=this._backupCC?this._backupCC.label:"",this.tracks.forEach((function(r){t===r.value&&(e=!0)})),(t=e?t:r="")||(t=this.tracks[1].value,r=this.tracks[1].text),this.switch(t)),{label:r,language:t}},i.prototype.getCurrentSubtitle=function(){return this._currentValue},i.prototype._getTracks=function(){for(var e=this.getTextTracks(),t=e.length,r=(this._defaultTrack={value:"off",text:"Off"},[this._defaultTrack]),i=s.get(l.SelectedCC),n="",a=!1,o=0;o<t;o++){var u,c=e[o];"expired"==c.mode||"subtitles"!=c.kind&&"captions"!=c.kind||(u={value:c.language,text:c.label},c.default&&(this._defaultTrack=u,a=!0),u.value==i&&(n=u),r.push(u))}return!a&&n&&(this._defaultTrack=n),r},i.prototype._disabledTracks=function(){for(var e=this.getTextTracks(),t=e.length,r=0;r<t;r++)e[r].mode="expired"},i.prototype.switch=function(e){var t=this._player;if(this.close(),"off"!=e)for(var r=this.getTextTracks(),i=r.length,a=0;a<i;a++){var o=r[a];o.language===e&&"expired"!=o.mode&&(r[a].mode="showing",t.trigger(n.Private.VttSwitchTrack,o.language))}else this.close();this._currentValue=e,t.trigger(n.Private.CCChanged,e)},i.prototype.updateUI=function(e){var t,r="on";t=e?(this.tracks.find((function(t){return t.value===e}))||{}).text||"":(r="off","Off"),player.trigger(n.Private.CCChanged,r),player.trigger(n.Private.CCStateChanged,{value:r,lang:t})},i.prototype.dispose=function(){this._player=null,this._switchTimer&&(clearTimeout(this._switchTimer),this._switchTimer=null)},i.prototype._patchSafariTracks=function(){var e=this;if(o.IS_MAC_SAFARI||o.IS_IOS){if(!(this._video&&this._video.textTracks&&this._video.textTracks.length)){var t=!1;if(t=!(!this._video.textTracks||!this._video.textTracks.length)||t)return;for(var r=0;r<this._storedTracks.length;r++){var i=this._storedTracks[r],n=i.vttUrl,a=document.createElement("track");a.src=n,a.kind="subtitles",a.label=i.name,a.srclang=i.lang,this._video.appendChild(a)}}this._switchTimer&&clearTimeout(this._switchTimer),this._switchTimer=setTimeout((function(){var t=e.getCurrentSubtitle();t&&"off"!==t&&e.switch(t)}),1e3)}},i.prototype.getTextTracks=function(){var e=this._player,t=e.tag;return e._vttBroker&&e._vttBroker.enabled&&e.getTextTracks?e.getTextTracks()||[]:t&&t.textTracks||[]},i.prototype._updateSelectorList=function(){var e=this._player;this.tracks=this._getTracks(),e.trigger(n.Private.SelectorGenerateList,{type:"cc",value:"Off"})},i.prototype._resotreTracks=function(){this._patchSafariTracks(),this.tracks=this._getTracks(),this._player.trigger(n.Player.TextTrackReady,this.tracks)},t.exports=i},{"../../lib/constants":28,"../../lib/cookie":29,"../../lib/dom":32,"../../lib/event":33,"../../lib/ua":49,"../../ui/component/util":159,"../base/event/eventtype":70}],120:[function(e,t,r){var i=e("../../lib/playerutil");t.exports=[{service:e("./ccservice"),name:"_ccService",condition:!0},{service:e("./audiotrackservice"),name:"_audioTrackService"},{service:e("./qualityservice"),name:"_qualityService"},{service:e("./fullscreenservice"),name:"fullscreenService",condition:function(){return!0}},{service:e("./liveshiftservice"),name:"_liveshiftService",condition:function(){var e=this.options();return i.isLiveShift(e)}},{service:e("./thumbnailservice"),name:"_thumbnailService",condition:function(){return!0}},{service:e("./progressmarkerservice"),name:"_progressMarkerService",condition:function(){return!0}}]},{"../../lib/playerutil":46,"./audiotrackservice":118,"./ccservice":119,"./fullscreenservice":121,"./liveshiftservice":122,"./progressmarkerservice":123,"./qualityservice":124,"./thumbnailservice":125}],121:[function(e,t,r){function i(e){this.isFullWindow=!1,this.isFullScreen=!1,this.isFullScreenChanged=!1,this._requestFullScreenTimer=null,this._cancelFullScreenTimer=null,this._player=e;var t=this,r=l;this._fullscreenChanged=function(e){var i;null!=t._player&&(e.target||e.srcElement)===(e=t._player.el())&&(i=document[r.fullscreenElement],t.isFullScreen=i===e,(t.isFullScreenChanged=!0)===t.isFullScreen?t._player.trigger(s.Player.RequestFullScreen):t._player.trigger(s.Player.CancelFullScreen))},r&&o.on(document,r.eventName,this._fullscreenChanged)}var n=e("../../lib/ua"),a=e("../../lib/dom"),o=e("../../lib/event"),s=e("../base/event/eventtype"),l=(e("../base/x5play"),e("../../lang/index"),function(){a.createEl("div");var e={},t=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullScreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","webkitfullScreen"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","webkitIsFullScreen"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror","mozFullScreen"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError","MSFullScreen"]],r=!1;if(!(r=!(!n.IS_IOS||(e.requestFn="webkitEnterFullscreen",e.cancelFn="webkitExitFullscreen",e.fullscreenElement="webkitFullscreenElement",e.eventName="webkitfullscreenchange",e.isFullScreen="webkitDisplayingFullscreen",!document[e.requestFn]))||r)){for(var i=0;i<5;i++)if(t[i][1]in document){e.requestFn=t[i][0],e.cancelFn=t[i][1],e.fullscreenElement=t[i][2],e.eventName=t[i][4],e.isFullScreen=t[i][6];break}"requestFullscreen"in document?e.requestFn="requestFullscreen":"webkitRequestFullscreen"in document?e.requestFn="webkitRequestFullscreen":"webkitRequestFullScreen"in document?e.requestFn="webkitRequestFullScreen":"webkitEnterFullscreen"in document?e.requestFn="webkitEnterFullscreen":"mozRequestFullScreen"in document?e.requestFn="mozRequestFullScreen":"msRequestFullscreen"in document&&(e.requestFn="msRequestFullscreen"),"fullscreenchange"in document?e.eventName="fullscreenchange":"webkitfullscreenchange"in document||"webkitfullscreenchange"in document||"webkitfullscreenchange"in document?e.eventName="webkitfullscreenchange":"mozfullscreenchange"in document?e.eventName="mozfullscreenchange":"MSFullscreenChange"in document&&(e.eventName="MSFullscreenChange"),"fullScreen"in document?e.isFullScreen="fullScreen":"webkitfullScreen"in document?e.isFullScreen="webkitfullScreen":"webkitIsFullScreen"in document?e.isFullScreen="webkitIsFullScreen":"webkitDisplayingFullscreen"in document?e.isFullScreen="webkitDisplayingFullscreen":"mozFullScreen"in document?e.isFullScreen="mozFullScreen":"mozfullScreen"in document?e.isFullScreen="mozfullScreen":"MSFullScreen"in document&&(e.isFullScreen="MSFullScreen"),"fullscreenElement"in document?e.fullscreenElement="fullscreenElement":"webkitFullscreenElement"in document?e.fullscreenElement="webkitFullscreenElement":"webkitFullScreenElement"in document?e.fullscreenElement="webkitFullScreenElement":"mozFullScreenElement"in document?e.fullscreenElement="mozFullScreenElement":"msFullscreenElement"in document?e.fullscreenElement="msFullscreenElement":"MSFullscreenElement"in document&&(e.fullscreenElement="MSFullscreenElement")}return e.requestFn?e:null}()),u=(i.prototype.requestFullScreen=function(){var e=l,t=this._player.el(),r=this;if(n.IS_IOS){var i=this._player._splayer;if(!i||2!==i.renderType){t=this._player.tag;try{var a=t[e.requestFn]();a&&"function"==typeof a.catch&&a.catch((function(e){console.log(e)})),r._player.trigger(s.Player.RequestFullScreen)}catch(e){console.log(e)}return this}this._player._options.enableMockFullscreen=!0}if(this.isFullScreen=!0,this.isFullScreenChanged=!1,this._requestFullScreenTimer=null,this._cancelFullScreenTimer||clearTimeout(this._cancelFullScreenTimer),r=this,e&&!this._player._options.enableMockFullscreen)try{var o=t[e.requestFn]();o&&"function"==typeof o.catch&&o.catch((function(e){console.log(e)})),this._requestFullScreenTimer=setTimeout((function(){r.isFullScreenChanged||(u.apply(r),r._player.trigger(s.Player.RequestFullScreen)),r._requestFullScreenTimer=null}),1e3)}catch(e){console.log(e)}else u.apply(r),this._player.trigger(s.Player.RequestFullScreen);return this._player},i.prototype.cancelFullScreen=function(){var e=l,t=(this.isFullScreen=!1,this.isFullScreenChanged=!1,this._cancelFullScreenTimer=null,this._requestFullScreenTimer||clearTimeout(this._requestFullScreenTimer),this);if(e&&!this._player._options.enableMockFullscreen){try{var r=document[e.cancelFn]();r&&"function"==typeof r.catch&&r.catch((function(e){console.log(e)}))}catch(e){console.log(e)}t._cancelFullScreenTimer=setTimeout((function(){t.isFullScreenChanged||(c.apply(t),t._player.trigger(s.Player.CancelFullScreen)),t._cancelFullScreenTimer=null}),500)}else c.apply(t),this._player.trigger(s.Player.CancelFullScreen);return this._player.tag.paused||this._player.trigger(s.Player.Play),this._player},i.prototype.getIsFullScreen=function(){return this.isFullScreen},i.prototype.dispose=function(){this._player=null,l&&o.off(document,l.eventName,this._fullscreenChanged)},function(){this.isFullWindow=!0,this.docOrigOverflow=document.documentElement.style.overflow,document.documentElement.style.overflow="hidden",a.addClass(document.getElementsByTagName("body")[0],"prism-full-window")}),c=function(){this.isFullWindow=!1,document.documentElement.style.overflow=this.docOrigOverflow,a.removeClass(document.getElementsByTagName("body")[0],"prism-full-window")};t.exports=i},{"../../lang/index":23,"../../lib/dom":32,"../../lib/event":33,"../../lib/ua":49,"../base/event/eventtype":70,"../base/x5play":96}],122:[function(e,t,r){function i(e,t){var r;if(e)return e=new Date(e),r=(t=new Date(t)).valueOf()/1e3-e.valueOf()/1e3,{start:e,end:t,endDisplay:s.extractTime(t),totalTime:r}}function n(e,t){t&&(e.currentTimestamp=t,e.currentTime=s.convertToDate(t),e.currentTimeDisplay=s.extractTime(e.currentTime),e.liveShiftStart=e.liveTimeRange.start,e.liveShiftEnd=e.liveTimeRange.end,e.liveShiftStartDisplay=s.extractTime(e.liveShiftStart),e.liveShiftEndDisplay=s.extractTime(e.liveShiftEnd),e.availableLiveShiftTime=t-e.liveShiftStart.valueOf()/1e3,e.timestampStart=s.convertToTimestamp(e.liveShiftStart),e.timestampEnd,s.convertToTimestamp(e.liveShiftEnd))}function a(e){function t(){var t=e._options.source;this._originalPlayUrl=t,this._liveShiftUrl=e._options.liveTimeShiftUrl,this.liveTimeRange=i(e._options.liveStartTime,e._options.liveOverTime),this.availableLiveShiftTime=0,this.seekTime=-1}this._player=e,this._isLiveShiftPlaying=!1;var r=this;t.call(this),e.liveShiftSerivce={setLiveTimeRange:function(e,t){r.setLiveTimeRange(e,t)},queryLiveShift:function(e,t,i){r.queryLiveShift(e,t,i)},isLiveShiftPlaying:function(){return r._isLiveShiftPlaying}},e.on(f.Private.ChangeURL,(function(){t.call(r)}))}var o=e("../../lib/io"),s=e("../../lib/util"),l=e("../../lib/playerUtil"),u=e("../../lang/index"),c=e("../flv/flvinjector"),d=e("../hls/hlsinjector"),h=e("../../lib/constants"),f=e("../base/event/eventtype");e("../../lib/url"),a.prototype.validate=function(){return!(this.liveTimeRange.start>=this.liveTimeRange.end)},a.prototype.switchToLive=function(){this.seekTime=-1;var e=this._originalPlayUrl,t=this._player._options.liveShiftSource,r=this._player._options.source;l.isHls(r)&&l.isFlv(e)&&t&&l.isHls(t)&&(this._player._hls&&this._player._destroyHls(),r=this._player._superType,t=this._player._Type,this._player._options._autoplay=!0,c.inject(this._player,t,r,this._player._options,"",!0)),this._player._loadByUrlInner(e,null,!0),this._isLiveShiftPlaying=!1,this._player.trigger(f.Private.LiveShiftSwitchToLive)},a.prototype.getBaseTime=function(){return this.liveShiftStartDisplay,-1==this.seekTime?s.parseTime(this.currentTimeDisplay):s.parseTime(this.liveShiftStartDisplay)+this.seekTime},a.prototype.getSourceUrl=function(e,t){var r=this._originalPlayUrl;return this.availableLiveShiftTime<e||(this._isLiveShiftPlaying=!0,e=parseInt(e),r=(r=this._switchLiveShiftPlayer(t))&&this._cleanUrl(r),t=parseInt(this.currentTimestamp)-e,-1===(r=-1==r.indexOf("?")?r+"?lhs_start_unix_s_0="+t:r+"&lhs_start_unix_s_0="+t).indexOf("aliyunols=on")&&(r+="&aliyunols=on"),-1===r.indexOf("continue=on")&&(r+="&continue=on")),r},a.prototype._cleanUrl=function(e){var t;return-1===e.indexOf("?")?e:(e=(e=(t=e.split("?"))[1])&&(0===(e=e.replace(/&?lhs_start_unix_s_0=[0-9]*/g,"")).indexOf("&")?e.replace("&",""):e))?t[0]+"?"+e:t[0]},a.prototype._switchLiveShiftPlayer=function(e){var t,r=this._originalPlayUrl,i=this._player._options.liveShiftSource,n=this._player._options.source;if(l.isHls(n))r=n;else if(l.isFlv(r)&&i&&l.isHls(i))return this._player._flv&&this._player._destroyFlv(),n=this._player._superType,t=this._player._Type,this._player._options._autoplay=!0,d.inject(this._player,t,n,this._player._options,"",!0),i;return r},a.prototype.getTimeline=function(e,t){var r;this._player.trigger(f.Private.LiveShiftQueryCompleted),this._liveShiftUrl?(r=this).queryLiveShift(this._liveShiftUrl,(function(i){i?0==(i=i).retCode?(n(r,i.content.current),e&&e()):t({Code:h.ErrorCode.ServerAPIError,Message:i.retCode+"|"+i.description+"|"+i.content}):console.log("获取直播时移数据失败")}),(function(e){if(t&&e){var r={};if(e){if("string"==typeof e&&-1<e.indexOf("403 Forbidden"))r.Code=h.ErrorCode.AuthKeyExpired,r.Message="Query liveshift failed:"+u.get("Error_AuthKey_Text");else{var i;r=e;try{i=JSON.parse(e)}catch(e){}i&&(r.Code=h.ErrorCode.ServerAPIError,r.Message=i.retCode+"|"+i.description+"|"+i.content)}t(r)}}})):(n(this,(new Date).valueOf()/1e3),e&&e())},a.prototype.start=function(e,t){var r=this;r.getTimeline((function(e){r._localLiveTimeHandler||r.tickLocalLiveTime()}),t),function i(){r._loopHandler&&clearTimeout(r._loopHandler),r._loopHandler=setTimeout((function(){r.getTimeline((function(){}),t),i()}),e)}()},a.prototype.tickLocalLiveTime=function(){var e=this;(function t(){e._localLiveTimeHandler=setTimeout((function(){e.currentTimestamp++,n(e,e.currentTimestamp),e._player.trigger(f.Private.LiveShiftQueryCompleted),t()}),1e3)})()},a.prototype.setLiveTimeRange=function(e,t){e=e||this._player._options.liveStartTime,t=t||this._player._options.liveOverTime,this.liveTimeRange=i(e,t),n(this,this.currentTimestamp),this._player.trigger(f.Private.LiveShiftQueryCompleted)},a.prototype.queryLiveShift=function(e,t,r){o.get(e,(function(e){var i;e?0==(i=JSON.parse(e)).retCode?t&&t(i):r&&r(i):r&&r(e)}),(function(e){r&&r(e)}))},a.prototype.stop=function(e){this._loopHandler&&(clearTimeout(this._loopHandler),this._loopHandler=null)},a.prototype.dispose=function(){this.stop(),this._localLiveTimeHandler&&(clearTimeout(this._localLiveTimeHandler),this._localLiveTimeHandler=null),this._loopHandler&&(clearTimeout(this._loopHandler),this._loopHandler=null),this._player=null},t.exports=a},{"../../lang/index":23,"../../lib/constants":28,"../../lib/io":40,"../../lib/playerUtil":45,"../../lib/url":50,"../../lib/util":51,"../base/event/eventtype":70,"../flv/flvinjector":100,"../hls/hlsinjector":102}],123:[function(e,t,r){function i(e){function t(){var t=document.querySelector("#"+e.id()+" .prism-progress-marker");if(t){t.innerHTML="";var i=r._player.getDuration();if(0<i){for(var s=0;s<r.progressMarkers.length;s++){var l,u=r.progressMarkers[s];void 0!==u.offset&&""!==u.offset&&(u=document.createElement("div"),a.addClass(u,"prism-marker-dot"),l=r.progressMarkers[s].offset/i,u.style.left=100*l+"%",t.appendChild(u),l=function(e,t){return function(){r._player.trigger(n.Private.MarkerTextShow,{left:e,progressMarker:t})}}(l,r.progressMarkers[s]),o.on(u,"mouseover",l),o.on(u,"mouseout",(function(e){r._player.trigger(n.Private.MarkerTextHide)})),o.on(u,"touchstart",l),o.on(u,"mousemove",(function(e){e.preventDefault()})),o.on(u,"touchmove",(function(e){e.preventDefault()})))}var c=document.querySelector("#"+r._player.id()+" .prism-progress-cursor");r._player.on(c,"click",(function(e){for(var t=r._player.getCurrentTime(),a=0;a<r.progressMarkers.length;a++){var o,s=r.progressMarkers[a];s&&t-1<s.offset&&s.offset<t+1&&(o=s.offset/i*100+"%",r._player.trigger(n.Private.MarkerTextShow,{left:o,progressMarker:s}))}}))}}}this.progressMarkers=[],this._player=e;var r=this;e.on(n.Private.ProgressMarkerLoaded,(function(e){e=e.paramData,e&&0<e.length&&(r.progressMarkers=e)})),e.on(n.Private.ProgressMarkerChanged,(function(e){e=e.paramData,e&&0<e.length&&(r.progressMarkers=e,t())})),e.on(n.Video.LoadedMetadata,t)}var n=e("../base/event/eventtype"),a=(e("../../lang/index"),e("../../lib/hls/hlsparse"),e("../../lib/object"),e("../../lib/dom")),o=e("../../lib/event");e("../../lib/playerutil"),i.prototype.dispose=function(){this._player=null,this.progressMarkers=[]},t.exports=i},{"../../lang/index":23,"../../lib/dom":32,"../../lib/event":33,"../../lib/hls/hlsparse":39,"../../lib/object":42,"../../lib/playerutil":46,"../base/event/eventtype":70}],124:[function(e,t,r){function i(e){this.levels=[],this.drmUrl={},this._player=e;var t=this;e.on(n.Private.PlayInfoLoaded,(function(e){for(var r=e.paramData.encryptUrlArr||[],i=[],n=0;n<r.length;n++){var a=r[n];a.encryptionType===u.VodEncryptionType["Widevine-FairPlay"]&&i.push(a)}t.drmUrl=i})),e.on(n.Player.LevelsLoaded,(function(r){if(0<t.levels.length&&(t.levels=[]),(r=r.paramData)&&r.levels){for(var i,o=r.levels.length-1;-1<o;o--){var l,u=r.levels[o];u.url&&0<u.url.length&&u.attrs&&u.attrs.BANDWIDTH&&(l=u.url,s.isArray(l)&&(l=l[0]),l={Url:l=!e._hls&&e._options.isVBR&&e._options.isDrm?c.call(t,u):l,desc:u.height||u.width,bitrate:u.bitrate,resolution:u.attrs.RESOLUTION,bandwidth:u.attrs.BANDWIDTH},t.levels.push(l))}"AUTO"===e._options.definition&&(e._urls=[],Object.assign(e._urls,this.levels)),t.levels.sort((function(e,t){return e.desc-t.desc})),0<t.levels.length&&(i="",this._player._options.isVBR&&(i=a.get("Auto")),t.levels.push({Url:r.url,desc:i}),e.trigger(n.Private.SelectorUpdateList,{type:"quality",text:i}))}})),e.on(n.Video.LoadStart,(function(){var r;e._options&&(r=e._options.source,!e._hls)&&r&&l.isHls(r)&&(e._manuallySwitchDrmLevel?(e._manuallySwitchDrmLevel=!1,e.trigger(n.Private.SafariDrmLevelSwitch)):t.loadLevels(r))}))}var n=e("../base/event/eventtype"),a=e("../../lang/index"),o=e("../../lib/hls/hlsparse"),s=e("../../lib/object"),l=e("../../lib/playerutil"),u=e("../../lib/constants");function c(e){for(var t,r=this.drmUrl,i=0;i<this.drmUrl.length;i++)if(Number(e.height)===Number(r[i].height)){t=r[i].Url;break}return t}(i.prototype={loadLevels:function(e){var t=new o,r=this;t.load(e,(function(e){r._player.trigger(n.Player.LevelsLoaded,e)}))}}).dispose=function(){this._player=null},t.exports=i},{"../../lang/index":23,"../../lib/constants":28,"../../lib/hls/hlsparse":39,"../../lib/object":42,"../../lib/playerutil":46,"../base/event/eventtype":70}],125:[function(e,t,r){function i(e){this._player=e,this.cues=[],this.baseUrl="";var t=this;e.on(s.Private.ChangeURL,(function(){t.cues=[],t.baseUrl=""}))}var n=e("../../lib/io"),a=e("../../lib/url"),o=e("../../lib/vtt/thumbnailvtt"),s=e("../base/event/eventtype");(i.prototype={get:function(e){var t,r,i=this;this.baseUrl=(t=e,(r=a.parseUrl(t))&&(r=r.segments)&&0<r.length&&(r=r[r.length-1],baseUrl=t.replace(r,"")),baseUrl),n.get(e,(function(e){e&&o.parse(e,(function(e){i.cues=e,i._player.trigger(s.Private.ThumbnailLoaded,e)}))}),(function(e){console.log(e)}))},findAvailableCue:function(e){for(var t=this.cues.length,r=0;r<t;r++){var i=this.cues[r];if(i.startTime<=e&&e<i.endTime)return i}return null},makeUrl:function(e){return-1==e.indexOf("://")?this.baseUrl+e:e}}).dispose=function(){this._player=null},t.exports=i},{"../../lib/io":40,"../../lib/url":50,"../../lib/vtt/thumbnailvtt":53,"../base/event/eventtype":70}],126:[function(e,t,r){var i=e("../base/player"),n=e("./splayerinjector"),a=e("../flv/flvinjector"),o=e("../../lib/playerutil"),s=e("../base/event/eventtype"),l=e("../../lib/constants"),u=e("../../lib/codec-probe"),c=l.USER_EVENT_NAME,d=o.isH265Codec,h=o.getVideoTrack,f={},p={codecCost:0,decoderCost:0},g=i.extend({init:function(e,t){var r,l=this,v=(this._options=t,o.isFlv(t.source)),y=this._extraMultiSources(),m={};function _(){v&&(a.inject(this,g,i,t),t._native=!1),i.call(this,e,t),this._monitor&&this._monitor.updateH265ProbeCost(p),T.call(this),f.codecTag&&n.reportH265PlayInfo.call(this,{renderType:"native",codecTag:f.codecTag})}function b(){t._native=!1,n.inject(this,g,i,t,f),i.call(this,e,t),this._monitor&&this._monitor.updateH265ProbeCost(p),T.call(this)}function T(){var e,t,r=this,n=m,a=this[c];a&&(n=Object.assign({},m,a),e=Object.keys(m),t=Object.keys(a),e.forEach((function(e){-1<t.indexOf(e)&&(n[e]=m[e].concat(a[e]))}))),Object.keys(n).forEach((function(e){n[e].forEach((function(t){t.binded||i.prototype.on.call(r,e,t)}))}))}m[s.Player.Ready]=[function(){l._setupSourceList(y),l.trigger(s.Private.SelectorGenerateList,{type:"quality"})}],"zhihu"===t.from||t.forceH265?b.call(this):(r=performance.now(),u(t.source,(function(e){p.codecCost+=performance.now()-r;e=h(e.tracks);var t,i=(e||{}).codecTag||(e||{}).codec.split(".")[0];f.codecTag=i,e&&d(i)?(t=performance.now(),v?(p.decoderCost+=performance.now()-t,b.call(l)):o.shouldUseBasePlayer(i,(function(e){p.decoderCost+=performance.now()-t,(e?_:b).call(l)}))):_.call(l)}),(function(e){console.log("error in demuxer, fallback to basePlayer",e),p.codecCost+=performance.now()-r,_.call(l)})))}});t.exports=g},{"../../lib/codec-probe":26,"../../lib/constants":28,"../../lib/playerutil":46,"../base/event/eventtype":70,"../base/player":91,"../flv/flvinjector":100,"./splayerinjector":127}],127:[function(e,t,r){function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}var n=e("../../lib/io"),a=e("../base/event/eventtype"),o=e("../base/event/eventmanager"),s=(e("../../lib/event"),e("../../lib/util")),l=e("../../lib/dom"),u=e("../../lib/playerutil"),c=e("../../lib/constants"),d=e("../../lang/index");function h(e){var t=this._options,r=(p.call(this),function(){u.isVideoTag(this.tag)&&(o.offVideoAll(this),this.tag.parentNode.removeChild(this.tag),this.tag=null)}.call(this),Videox.Videox),n=new r(i({container:this._el,wasmDomain:t.splayerWasmDomain,progressive:!0,skipFrame:r.DiscardType.NONE,loop:t.rePlay,controls:!1,muted:!1,threads:t.h265Threads,simd:t.h265Simd,autoplay:t.autoplay,live:t.isLive,poster:t.cover||void 0,src:t.source,trackOptions:{disable:!0},preload:t.preload?"auto":"none",timeout:1e3*t.waitingTimeout},t.splayerOptions||{})),s=(t.debug&&(n.setLogLevel(r.LogLevel.LOG),n.setLogPrintLevel(r.LogLevel.LOG)),this._splayer=n,(this.tag=n).play),l=this;this.tag.play=function(){l._monitor&&l._monitor.reportStartPlay(),s.call(this)},function(){var e,t=this,r=document.createElement("video");for(e in r)!function(e){t.tag[e]||0===e.indexOf("on")||"function"!=typeof r[e]||(t.tag[e]=function(){console.warn("Function ["+e+"] is called on splayer, which should be a mistake."),r[e].apply(r,arguments)})}(e)}.call(this),function(e){var t=this,r=(o.onAll(this),this._splayer);r.addEventListener("error",function(e){console.log("Splayer error",(e||{}).detail);var t,r,i=Videox.Videox,n=(e||{}).detail;e=Number((n||{}).code),i=i.ErrorCode;switch(e){case i.WASM_NOT_SUPPORTED:case i.CANVAS_NOT_SUPPORTED:case i.AUDIOCONTEXT_NOT_SUPPORTED:case i.WORKER_NOT_SUPPORTED:case i.WEBGL_NOT_SUPPORTED:t=c.ErrorCode.SplayerEnvCheckError,r=d.get("Splayer_Err_Env_Check")+" | "+f(n);break;case i.DECODE:t=c.ErrorCode.SplayerDecodeError,r=d.get("Splayer_Err_Decode")+" | "+f(n);break;case i.NETWORK:t=c.ErrorCode.NetworkError,r=d.get("Error_Network_Text")+" | "+f(n);var o=(n.origin||{}).response;o?404===(o=o.status)?(t=c.ErrorCode.NotFoundSourceURL,r=d.get("Error_Not_Found")+" | "+f(n)):403===o&&(t=c.ErrorCode.AuthKeyExpired,r=d.get("Error_AuthKey_Text")+" | "+f(n)):navigator.onLine&&(t=c.ErrorCode.RequestDataError,r=r+"，"+d.get("Maybe_Cors_Error"));break;case i.PARSER:t=c.ErrorCode.SplayerParserNotFound,r=d.get("Splayer_Err_Parser_Not_Found")+" | "+f(n);break;default:t=c.ErrorCode.OtherError,r="(SP)"+d.get("Error_Play_Text")+" | "+f(n)}t===c.ErrorCode.NetworkError&&this._reloadForVod()||(e={error_code:t,error_msg:r},null!==e.error_code&&null!==e.error_msg&&(this.logError(e),this.trigger(a.Player.Error,e)),g.call(this,{splayer:!0}))}.bind(this)),r.addEventListener("decoderoverload",(function(e){e=e.detail,delete e.shouldWarn,t.trigger(a.Player.H265DecoderOverload,e)})),r.addEventListener("loadedsupportinfo",(function(e){e=e.detail||{};var i=e.detail||{},n=r.controller.options||{};r.renderType=e.renderer,g.call(t,{renderer:e.renderer,wasmThreads:i.wasmThreads&&n.threads,wasmThreadsOption:n.threads,simd:i.simd&&n.simd,simdOption:n.simd,codecTag:r.controller.videoTrack&&r.controller.videoTrack.codecTag||r.controller.videoTrack.codec.split(".")[0],splayer:!0})})),this._options.autoplay&&(r.once("canplay",(function(){r.paused&&t._autoplayFailedHandler()})),r.once("timeupdate",(function(){t.trigger(a.Player.Play)})),this._monitor)&&this._monitor.reportStartPlay()}.call(this,e)}function f(e){e=e=void 0===e?{}:e;var t=e.code,r=(e=e.message,Videox.Videox.ErrorCode),i="";return t?i+t+": "+(e||r[t]):i}function p(){this._splayer&&(this._splayer.destroy(),this._splayer=null)}function g(e){var t;void 0===e&&(e={}),this._h265InfoReported||(this._h265InfoReported=!0,t={0:"native",1:"mse",2:"wasm"},delete(e=i({codecTag:(this._probeInfo||{}).codecTag||e.codecTag,renderType:e.renderType||t[e.renderer]},e)).renderer,e.renderType!==t[2]&&(delete e.simd,delete e.simdOption,delete e.wasmThreads,delete e.wasmThreadsOption),e.codecTag&&u.isH265Codec(e.codecTag)&&this.trigger(a.Player.H265PlayInfo,e))}t.exports.reportH265PlayInfo=g,t.exports.inject=function(e,t,r,i,o){e._Type=t,e._superType=r,e._superPt=r.prototype,e._disposed=!1,e._splayer=null,e._splayerLoaded=!1,e._probeInfo=o,t.prototype.initPlay=function(e){var t=this;this.trigger(a.Private.H5_Loading_Show),function(e){return!s.contentProtocolMixed(e,"alwaysCheck")||((e={mediaId:this._options.vid||"",error_code:c.ErrorCode.InvalidSourceURL,error_msg:"InvalidSourceURL"}).display_msg=d.get("Request_Block_Text"),this.logError(e),this.trigger(a.Player.Error,e),!1)}.call(this,this._options.source)&&(this._splayerLoaded?h.call(this,e):function(e){var t=this._options.splayerUrl||"https://g.alicdn.com/splayer/splayer/0.6.6/dist/index.js";n.loadJS(t,e.bind(this))}.call(this,(function(){this._splayerLoaded=!0,h.call(this,e),t._executeReadyCallback()})))},t.prototype.replay=function(){return this._monitor&&this._monitor.replay(),this._splayer.load(),this._splayer.play(),this},t.prototype.setPlayerSize=function(e,t){this._superPt.setPlayerSize.call(this,e,t),e=this._el.querySelector("canvas"),e&&(t=this._el.offsetWidth/this._el.offsetHeight,e.offsetWidth/e.offsetHeight<t?(e.style.height="100%",e.style.width="initial"):(e.style.width="100%",e.style.height="initial"))},t.prototype._setTransform=function(){var e=this._player._el.querySelector("canvas"),t=(this._transformProp||(this._transformProp=l.getTransformName(e)),"");this._rotate&&(t+=" rotate("+this._rotate+"deg)"),this._image&&("vertical"==this._image?t+=" scaleY(-1)":"horizon"==this._image&&(t+=" scaleX(-1)")),e.style[this._transformProp]=t},t.prototype.dispose=function(){this._disposed||(this._superPt&&(this._superPt.dispose.call(this),t.prototype.replay=this._superPt.replay,t.prototype.setPlayerSize=this._superPt.setPlayerSize,t.prototype._setTransform=this._superPt._setTransform,t.prototype.initPlay=this._superPt.initPlay,t.prototype.dispose=this._superPt.dispose),p.call(this),this._Type=null,this._superType=null,this._superPt=null,this._disposed=!0,this._splayerLoaded=!1,this._h265InfoReported=!1)}}},{"../../lang/index":23,"../../lib/constants":28,"../../lib/dom":32,"../../lib/event":33,"../../lib/io":40,"../../lib/playerutil":46,"../../lib/util":51,"../base/event/eventmanager":69,"../base/event/eventtype":70}],128:[function(require,module,exports){(function _SkeinEnclosedFunction($jsskein_array_37,$jsskein_array_38,$jsskein_array_39,$jsskein_array_40,$jsskein_array_41,$jsskein_array_42,$jsskein_array_43,$jsskein_array_44){function kl5f8(){function e(e){var t=(t=$jsskein_array_37[3]).split($jsskein_array_42[0]).reverse().join($jsskein_array_43[3]);t=window[t];return $jsskein_array_39[2],$jsskein_array_39[2],t[e]=function(){}}for(var t=1;void 0!==t;){var r=1&t>>1;switch(1&t){case 0:switch(r){case 0:t=void 0;continue;case 1:var i=[],n=(n=$jsskein_array_44[1]).split($jsskein_array_38[1]).reverse().join($jsskein_array_44[2]),a=$jsskein_array_43[2];a+=$jsskein_array_39[1];var o=(o=$jsskein_array_37[2]).split($jsskein_array_43[3]).reverse().join($jsskein_array_43[3]);i.push($jsskein_array_44[3],$jsskein_array_40[0],n,a,$jsskein_array_44[4],$jsskein_array_44[5],o,$jsskein_array_38[2]),i.forEach(e),t=0;continue}continue;case 1:0==r&&($jsskein_array_37[0],t=window?2:0)}}}function gas4s8(){for(var NEXTBB12=0;void 0!==NEXTBB12;){var $jsskein_indexLevel46_0=1&NEXTBB12,$jsskein_indexLevel46_1_Base=NEXTBB12>>1,$jsskein_indexLevel46_1=1&$jsskein_indexLevel46_1_Base;switch($jsskein_indexLevel46_0){case 0:switch($jsskein_indexLevel46_1){case 0:NEXTBB12=2;continue;case 1:NEXTBB12=$jsskein_array_40[1]?1:3;continue}continue;case 1:switch($jsskein_indexLevel46_1){case 0:eval(fs56j57),NEXTBB12=2;continue;case 1:NEXTBB12=void 0;continue}continue}}}function n5fg6f(player){function _SkeinIIFE19(){function cl48s87(isOpen){for(var NEXTBB22=5;void 0!==NEXTBB22;){var $jsskein_indexLevel47_0=3&NEXTBB22,$jsskein_indexLevel47_1_Base=NEXTBB22>>2,$jsskein_indexLevel47_1=3&$jsskein_indexLevel47_1_Base;switch($jsskein_indexLevel47_0){case 0:switch($jsskein_indexLevel47_1){case 0:NEXTBB22=void 0;continue;case 1:$jsskein_simplify_tmp24=$jsskein_cl48s87_var14,NEXTBB22=$jsskein_simplify_tmp24?9:0;continue;case 2:$jsskein_simplify_tmp24=Aliplayer.__unable2Anti9Debugger13Key,$jsskein_cl48s87_var14=$jsskein_array_40[2]!==$jsskein_simplify_tmp24,NEXTBB22=4;continue}continue;case 1:switch($jsskein_indexLevel47_1){case 0:devtoolsDetector.removeListener(cl48s87),devtoolsDetector.setDetectDelay($jsskein_array_44[6]),devtoolsDetector.stop(),NEXTBB22=0;continue;case 1:var $jsskein_simplify_tmp24=$jsskein_array_41[0],$jsskein_cl48s87_var14=isOpen,NEXTBB22=$jsskein_cl48s87_var14?8:4;continue;case 2:eval(fs56j57),$jsskein_simplify_tmp24=Aliplayer.__unable2Anti9Debugger13Key,$jsskein_simplify_tmp24=$jsskein_array_42[1]===$jsskein_simplify_tmp24,NEXTBB22=$jsskein_simplify_tmp24?1:2;continue}continue;case 2:0===$jsskein_indexLevel47_1&&(kl5f8(),player.dispose(),gas4s8(),NEXTBB22=0)}}}devtoolsDetector.addListener(cl48s87),devtoolsDetector.launch()}for(var NEXTBB17=0;void 0!==NEXTBB17;){var $jsskein_indexLevel48_0=1&NEXTBB17,$jsskein_indexLevel48_1_Base=NEXTBB17>>1,$jsskein_indexLevel48_1=1&$jsskein_indexLevel48_1_Base;switch($jsskein_indexLevel48_0){case 0:switch($jsskein_indexLevel48_1){case 0:var $jsskein_simplify_tmp25=_SkeinIIFE19,$jsskein_simplify_tmp26=$jsskein_array_37[0],$jsskein_n5fg6f_var16=document.body,NEXTBB17=$jsskein_n5fg6f_var16?2:3;continue;case 1:$jsskein_n5fg6f_var16=$jsskein_array_42[2],NEXTBB17=1;continue}continue;case 1:switch($jsskein_indexLevel48_1){case 0:$jsskein_simplify_tmp26=$jsskein_n5fg6f_var16,setTimeout($jsskein_simplify_tmp25,$jsskein_simplify_tmp26),NEXTBB17=void 0;continue;case 1:var $jsskein__rand36=parseInt($jsskein_array_44[7],$jsskein_array_44[8]),$jsskein_n5fg6f_var16=$jsskein__rand36-$jsskein_array_43[4];NEXTBB17=1;continue}continue}}}function _SkeinIIFE34(e){n5fg6f(e)}var $jsskein_global_string_encryption_stack27=[],$jsskein_simplify_tmp18=($jsskein_global_string_encryption_stack27.unshift([]),window),$jsskein_simplify_tmp19=$jsskein_array_37[0],$jsskein_simplify_tmp19=require("../lib/devtools-detector"),devtoolsDetector=($jsskein_simplify_tmp18.__devtoolsDetector=$jsskein_simplify_tmp19,$jsskein_simplify_tmp19),$jsskein_fs56j57_string_plus28=$jsskein_array_44[0],fs56j57=($jsskein_fs56j57_string_plus28+=$jsskein_array_43[0],$jsskein_fs56j57_string_plus28+=$jsskein_array_38[0],$jsskein_fs56j57_string_plus28+=$jsskein_array_43[1],$jsskein_fs56j57_string_plus28=$jsskein_fs56j57_string_plus28.split($jsskein_array_39[0]).reverse().join($jsskein_array_37[1]),$jsskein_fs56j57_string_plus28),$jsskein_simplify_tmp18=module;$jsskein_simplify_tmp18.exports=_SkeinIIFE34}).call(this,[0,"","lmxrid","elosnoc"],["gu","","table"],["","rn",0],["log",!0,"error"],[0],["","error",0],["g","bed","wa","",147],["re","gubed","","info","error","dir",0,"11110111",2])},{"../lib/devtools-detector":31}],129:[function(e,t,r){(function(r,i,n,a,o,s,l,u){[].unshift([]),r[0];var c=e("./anti-debugging-protected");t.exports=function(e,t){for(var r=3;void 0!==r;){var a=1&r>>1;switch(1&r){case 0:switch(a){case 0:r=void 0;continue;case 1:var o=Aliplayer.__unable2Anti9Debugger13Key,s=l[0];r=(o=(s+=i[0])+l[1]+n[0]!==o)?1:0;continue}continue;case 1:switch(a){case 0:c(t),r=0;continue;case 1:o=e.encryptType;r=(o=u[0]==o)?2:0;continue}continue}}}}).call(this,[0],["rr"],["r"],[],[],[],["e","o"],[1])},{"./anti-debugging-protected":128}],130:[function(e,t,r){var i=e("../lib/oo"),n=e("../lib/data"),a=e("../lib/object"),o=e("../lib/dom"),s=e("../lib/event"),l=e("../lib/function"),u=e("../lib/layout"),c=(e("../lib/constants"),e("../lib/util"),e("../player/base/event/eventtype"));e=e("./component/util"),i=i.extend({init:function(e,t){var r=this,i=(this._player=e,this._eventState="",this._options=a.copy(t),this._el=this.createEl(),e.id);"function"==typeof e.id&&(i=e.id()),this._id=i+"_component_"+n.guid(),this._children=[],this._childIndex={},t.className&&this.addClass(t.className),this._player.on(c.Private.UiH5Ready,(function(){r.renderUI(),r.syncUI(),r.bindEvent()}))}});i.prototype.renderUI=function(){u.render(this.el(),this.options()),this.el().id=this.id()},i.prototype.syncUI=function(){},i.prototype.bindEvent=function(){},i.prototype.createEl=function(e,t){return o.createEl(e,t)},i.prototype.options=function(e){return void 0===e?this._options:this._options=a.merge(this._options,e)},i.prototype.el=function(){return this._el},i.prototype._contentEl,i.prototype.player=function(){return this._player},i.prototype.contentEl=function(){return this._contentEl||this._el},i.prototype._id,i.prototype.id=function(){return this._id},i.prototype.getId=function(){return this._id},i.prototype.addChild=function(e,t){var r;if("string"==typeof e){if(!this._player.UI[e])return;r=new this._player.UI[e](this._player,t)}else r=e;return this._children.push(r),"function"==typeof r.id&&(this._childIndex[r.id()]=r),"function"==typeof r.el&&r.el()&&((t=r.el()).id=r.id(),this.contentEl().appendChild(t)),r},i.prototype.removeChild=function(e){if(e&&this._children){for(var t,r=!1,i=this._children.length-1;0<=i;i--)if(this._children[i]===e){r=!0,this._children.splice(i,1);break}r&&(this._childIndex[e.id]=null,t=e.el())&&t.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}},i.prototype.initChildren=function(){var e,t,r=this,i=this.options().children;if(i)if(a.isArray(i))for(var n=0;n<i.length;n++)t="string"==typeof(t=i[n])?(e=t,{}):(e=t.name,t),r.addChild(e,t);else a.each(i,(function(e,t){!1!==t&&r.addChild(e,t)}))},i.prototype.on=function(e,t){return s.on(this._el,e,l.bind(this,t)),this},i.prototype.offListener=function(e,t){return s.off(this._el,e,t),this},i.prototype.one=function(e,t){return s.one(this._el,e,l.bind(this,t)),this},i.prototype.trigger=function(e,t){if(this._el)return!t&&0!=t||(this._el.paramData=t),this._eventState=e,s.trigger(this._el,e),this},i.prototype.off=function(e){return s.off(this._el,e),this},i.prototype.addClass=function(e){return o.addClass(this._el,e),this},i.prototype.removeClass=function(e){return o.removeClass(this._el,e),this},i.prototype.show=function(){return this._el&&(this._el.style.display="block"),this},i.prototype.hide=function(){return this._el&&(this._el.style.display="none"),this},i.prototype.destroy=function(){if(this.trigger({type:"destroy",bubbles:!1}),this._children)for(var e=this._children.length-1;0<=e;e--)this._children[e].destroy&&this._children[e].destroy();"function"==typeof this.disposeUI&&this.disposeUI(),this.children_=null,this.childIndex_=null,this.off(),this._el.parentNode&&this._el.id!=this._player.id()&&this._el.parentNode.removeChild(this._el),n.removeData(this._el),this._el=null},i.prototype.registerControlBarTooltip=e.registerTooltipEvent,t.exports=i},{"../lib/constants":28,"../lib/data":30,"../lib/dom":32,"../lib/event":33,"../lib/function":35,"../lib/layout":41,"../lib/object":42,"../lib/oo":43,"../lib/util":51,"../player/base/event/eventtype":70,"./component/util":159}],131:[function(e,t,r){var i=e("../component"),n=e("../../lib/dom"),a=e("../../lib/event"),o=e("../../player/base/event/eventtype"),s=e("../../player/base/plugin/status");e=i.extend({init:function(e,t){i.call(this,e,t),this.addClass("prism-big-play-btn")},createEl:function(){var e=i.prototype.createEl.call(this,"div");return e.innerHTML='<div class="outter"></div>',e},bindEvent:function(){var e=this,t=(this._player.on(o.Player.Play,(function(){e.addClass("playing"),e.removeClass("pause"),e._hide()})),this._player.on(o.Player.Pause,(function(){var t,r;e._player._switchSourcing||(e.removeClass("playing"),e.addClass("pause"),t=e._player._status,r=e._player._seeking,t==s.ended)||t==s.error||t==s.playing||r||e._show()})),document.querySelector("#"+e.id()+" .outter"));a.on(this.el(),"mouseover",(function(){n.addClass(t,"big-playbtn-hover-animation")})),a.on(this.el(),"mouseout",(function(){n.removeClass(t,"big-playbtn-hover-animation")})),this.on(o.Private.PlayClick,(function(){var t;e._player.paused()?(t=e._player.getCurrentTime(),(e._player.getDuration()<=t||e._player._ended||e._player.exceedPreviewTime(t))&&e._player.seek(0),e._player.play(!0)):e._player.pause(!0)})),this._player.on(o.Private.Play_Btn_Show,(function(){e._show()})),this._player.on(o.Private.Play_Btn_Hide,(function(){e._hide()}))},_show:function(){n.css(this.el(),"display","block")},_hide:function(){n.css(this.el(),"display","none")}});t.exports=e},{"../../lib/dom":32,"../../lib/event":33,"../../player/base/event/eventtype":70,"../../player/base/plugin/status":95,"../component":130}],132:[function(e,t,r){var i=e("../component"),n=e("../../lib/dom"),a=e("./util"),o=e("../../lang/index"),s=e("../../player/base/event/eventtype");e=i.extend({init:function(e,t){this.isOpened=!1,i.call(this,e,t),this.addClass("prism-cc-btn")},createEl:function(){return i.prototype.createEl.call(this,"div")},bindEvent:function(){var e=this;this.on("click",(function(){n.addClass(e._el,"disabled");var t="on",r="";e.isOpened?(e._player._ccService.close(),t="off"):r=e._player._ccService.open().label,e._player.trigger(s.Private.CCChanged,t),e._player.trigger(s.Private.CCStateChanged,{value:t,lang:r}),e.disabledHandler&&clearTimeout(e.disabledHandler),e.disabledHandler=setTimeout((function(){n.removeClass(e._el,"disabled")}),1e3),e._player.trigger(s.Private.MarkerTextHide)})),this._player.on(s.Private.CCChanged,(function(t){t=t.paramData,e.isOpened="off"!=t})),a.registerTooltipEvent.call(this,this.el(),(function(){return e.isOpened?o.get("CloseSubtitle"):o.get("OpenSubtitle")}))},disposeUI:function(){this.disabledHandler&&(clearTimeout(this.disabledHandler),this.disabledHandler=null)}});t.exports=e},{"../../lang/index":23,"../../lib/dom":32,"../../player/base/event/eventtype":70,"../component":130,"./util":159}],133:[function(e,t,r){var i=e("../component"),n=e("../../player/base/event/eventtype"),a=e("../../lib/event"),o=e("../../lib/dom"),s=e("../../lib/ua");e=i.extend({init:function(e,t){i.call(this,e,t),this.addClass("prism-controlbar"),this.initChildren(),this.onEvent()},createEl:function(){var e=i.prototype.createEl.call(this);return e.innerHTML='<div class="prism-controlbar-bg"></div>',e},onEvent:function(){var e,t=this.player(),r=t.options(),i=this,l=(a.on(this._el,"mouseover",(function(){var e=document.querySelector("#"+i.id()+" .prism-progress-cursor");o.css(e,"display","block")})),a.on(this._el,"mouseout",(function(e){var r=document.querySelector("#"+i.id()+" .prism-progress-cursor");o.css(r,"display","none"),t.trigger(n.Private.ThumbnailHide)})),a.on(this._el,"click",(function(e){t.trigger(n.Private.ControlBarClick,e)})),s.IS_IOS&&(a.on(this._el,"touchstart",(function(){var e=document.querySelector("#"+i.id()+" .prism-progress-cursor");o.css(e,"display","block")})),a.on(this._player.tag,"touchstart",(function(){var e=document.querySelector("#"+i.id()+" .prism-progress-cursor");o.css(e,"display","none"),t.trigger(n.Private.ThumbnailHide)}))),this.timer=null,r.controlBarVisibility);"hover"==(l=1==r.controlBarForOver?"hover":l)?(i.hide(),e=function(){i._hideHandler&&clearTimeout(i._hideHandler),i._show(),t.fullscreenService.getIsFullScreen()&&i._hide()},t.on(n.Private.MouseOver,(function(){e()})),a.on(this._player.tag,"click",(function(t){t&&t.target==t.currentTarget&&e()})),a.on(this._player.tag,"touchstart",(function(t){t&&t.target==t.currentTarget&&e()})),t.on(n.Private.MouseOut,(function(){i._hideHandler=setTimeout((function(){i.hide(),t.trigger(n.Private.HideBar),t.trigger(n.Private.ThumbnailHide),t.trigger(n.Private.VolumeVisibilityChange,""),t.trigger(n.Private.SettingListHide)}))}))):"click"==l?(t.on(n.Private.Click,(function(e){t._isError||(e.preventDefault(),e.stopPropagation(),i._show(),i._hide())})),t.on(n.Player.Ready,(function(){i._hide()})),t.on(n.Private.TouchStart,(function(){i._show()})),t.on(n.Private.TouchMove,(function(){i._show()})),t.on(n.Private.TouchEnd,(function(){i._hide()}))):"never"==l?i._hide():i._show()},_show:function(){this.show(),this._player.trigger(n.Private.ShowBar),this.timer&&(clearTimeout(this.timer),this.timer=null)},_hide:function(){var e=this,t=this.player().options();t="never"==t.controlBarVisibility?0:t.showBarTime;this.timer=setTimeout((function(){e.hide(),e._player.trigger(n.Private.HideBar),e._player.trigger(n.Private.ThumbnailHide),e._player.trigger(n.Private.VolumeVisibilityChange,""),e._player.trigger(n.Private.SettingListHide)}),t)},disposeUI:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._hideHandler&&(clearTimeout(this._hideHandler),this._hideHandler=null)}});t.exports=e},{"../../lib/dom":32,"../../lib/event":33,"../../lib/ua":49,"../../player/base/event/eventtype":70,"../component":130}],134:[function(e,t,r){var i=e("../component"),n=e("../../lib/dom"),a=e("../../player/base/event/eventtype");e=i.extend({init:function(e,t){i.call(this,e,t),this.addClass("prism-cover")},createEl:function(){var e=i.prototype.createEl.call(this,"div"),t=this.options().cover;return t?e.style.backgroundImage="url("+t+")":n.css(e,"display","none"),e},_hide:function(e){var t=document.querySelector("#"+this.id()+" .prism-cover");t&&n.css(t,"display","none")},_show:function(e){var t=document.querySelector("#"+this.id()+" .prism-cover");t&&n.css(t,"display","block")},bindEvent:function(){this._player.on(a.Private.Cover_Show,this._show),this._player.on(a.Private.Cover_Hide,this._hide)}});t.exports=e},{"../../lib/dom":32,"../../player/base/event/eventtype":70,"../component":130}],135:[function(e,t,r){var i=e("../component"),n=e("../../lib/util"),a=e("../../lib/dom"),o=e("../../lib/event"),s=e("../../lib/ua"),l=e("../../lang/index"),u=e("../../player/base/event/eventtype");e=i.extend({init:function(e,t){i.call(this,e,t),this.addClass("prism-ErrorMessage")},createEl:function(){var e=i.prototype.createEl.call(this,"div");return e.innerHTML="<div class='prism-error-content'><p></p></div><div class='prism-error-operation'><a class='prism-button prism-button-refresh'>"+l.get("Refresh_Text")+"</a><a class='prism-button prism-button-retry'  target='_blank'>"+l.get("Retry")+"</a><a class='prism-button prism-button-orange'  target='_blank'>"+l.get("Detection_Text")+"</a></div><div class='prism-detect-info prism-center'><p class='errorCode'><span class='info-label'>code:&nbsp;</span><span class='info-content'></span></p><p class='vid'><span class='info-label'>vid:&nbsp;</span><span class='info-content'></span></p><p class='mediaAuth'><span class='info-label'>mediaAuth:&nbsp;</span><span class='info-content'></span></p><p class='uuid'><span class='info-label'>uuid:&nbsp;</span><span class='info-content'></span></p><p class='requestId'><span class='info-label'>requestId:&nbsp;</span><span class='info-content'></span></p><p class='dateTime'><span class='info-label'>"+l.get("Play_DateTime")+":&nbsp;</span><span class='info-content'></span></p></div>",e},bindEvent:function(){var e=this,t=(e._player.on(u.Private.Error_Show,(function(t){var r=null;e._player.getMonitorInfo&&(r=e._player.getMonitorInfo()),e._show(t,r)})),e._player.on(u.Private.Error_Hide,(function(){e._hide()})),document.querySelector("#"+e.id()+" .prism-button-refresh"));o.on(t,"click",(function(){location.reload(!0)})),s.IS_MOBILE&&(t=document.querySelector("#"+e.id()+" .prism-detect-info"),a.addClass(t,"prism-width90")),t=document.querySelector("#"+e.id()+" .prism-button-retry");o.on(t,"click",(function(){var t=e._player.getCurrentTime(),r=e._player._options.source;e._player._setDefaultCC=!0,e._player._loadByUrlInner(r,t,!0)}))},_show:function(e,t){e=e.paramData;var r,i="",o="",s=(e.mediaId&&(i=e.mediaId),e.mediaAuth&&e.mediaAuth,document.querySelector("#"+this.id()+" .prism-button-orange"));s&&(t&&this._player._options.diagnosisButtonVisible?(t.vu?o=decodeURIComponent(t.vu):a.css(s,"display","none"),i="//player.alicdn.com/detection.html?from=h5&vid="+i+"&source="+(o?encodeURIComponent(o):"")+"&uuid="+t.uuid+"&lang="+l.getCurrentLanguage(),s&&(s.href=i)):a.css(s,"display","none"),o=e.display_msg||e.error_msg,document.querySelector("#"+this.id()+" .prism-error-content p").innerHTML=o,document.querySelector("#"+this.id()+" .errorCode .info-content").innerText=e.error_code,t=document.querySelector("#"+this.id()+" .vid"),e.mediaId?(a.css(t,"display","block"),document.querySelector("#"+this.id()+" .vid .info-content").innerText=e.mediaId):a.css(t,"display","none"),i=document.querySelector("#"+this.id()+" .mediaAuth"),e.mediaAuth?(a.css(i,"display","block"),document.querySelector("#"+this.id()+" .mediaAuth .info-content").innerText=e.mediaAuth):a.css(i,"display","none"),e.uuid?document.querySelector("#"+this.id()+" .uuid .info-content").innerText=e.uuid:(s=document.querySelector("#"+this.id()+" .uuid"),a.css(s,"display","none")),e.requestId?document.querySelector("#"+this.id()+" .requestId .info-content").innerText=e.requestId:(o=document.querySelector("#"+this.id()+" .requestId"),a.css(o,"display","none")),document.querySelector("#"+this.id()+" .dateTime .info-content").innerText=n.formatDate(new Date,"yyyy-MM-dd HH:mm:ss"),t=document.querySelector("#"+this.id()),a.css(t,"display","block"),(r=this).playHideHandler&&clearTimeout(r.playHideHandler),r.playHideHandler=setTimeout((function(){r._player.trigger("play_btn_hide")})))},_hide:function(){var e=document.querySelector("#"+this.id());a.css(e,"display","none")},disposeUI:function(){this.playHideHandler&&(clearTimeout(this.playHideHandler),this.playHideHandler=null)}});t.exports=e},{"../../lang/index":23,"../../lib/dom":32,"../../lib/event":33,"../../lib/ua":49,"../../lib/util":51,"../../player/base/event/eventtype":70,"../component":130}],136:[function(e,t,r){var i=e("../component"),n=e("../../player/base/event/eventtype"),a=(e("../../lib/event"),e("../../lib/ua")),o=e("../../lang/index"),s=e("./util");e=i.extend({init:function(e,t){i.call(this,e,t),this.addClass("prism-fullscreen-btn")},bindEvent:function(){var e=this;this._player.on(n.Player.RequestFullScreen,(function(){a.IS_IOS||e.addClass("fullscreen")})),this._player.on(n.Player.CancelFullScreen,(function(){e.removeClass("fullscreen")})),s.registerTooltipEvent.call(this,this.el(),(function(){return e._player.fullscreenService.getIsFullScreen()?o.get("ExistFullScreen"):o.get("Fullscreen")})),this.on("click",(function(){e._player.fullscreenService.getIsFullScreen()?e._player.fullscreenService.cancelFullScreen():e._player.fullscreenService.requestFullScreen(),e._player.trigger(n.Private.MarkerTextHide)}))}});t.exports=e},{"../../lang/index":23,"../../lib/event":33,"../../lib/ua":49,"../../player/base/event/eventtype":70,"../component":130,"./util":159}],137:[function(e,t,r){"use strict";var i=e("../component"),n=e("../../lib/dom"),a=e("../../player/base/event/eventtype"),o=e("../../lib/ua.js");e=i.extend({init:function(e,t){i.call(this,e,t),this.addClass("prism-hide")},createEl:function(){var e=i.prototype.createEl.call(this,"div");return e.innerHTML=o.IS_ANDROID_FIREFOX?'<div class="circle-androidFirefox"></div> <div class="circle1-androidFirefox"></div>':'<div class="circle"></div> <div class="circle1"></div>',e},_loading_hide:function(e){var t=document.querySelector("#"+this.id()+" .prism-loading");t&&(n.removeClass(t,"prism-loading"),n.addClass(t,"prism-hide"))},_loading_show:function(e){var t=document.querySelector("#"+this.id()+" .prism-hide");t&&(n.removeClass(t,"prism-hide"),n.addClass(t,"prism-loading"))},bindEvent:function(){this._player.on(a.Private.H5_Loading_Show,this._loading_show),this._player.on(a.Private.H5_Loading_Hide,this._loading_hide)}});t.exports=e},{"../../lib/dom":32,"../../lib/ua.js":49,"../../player/base/event/eventtype":70,"../component":130}],138:[function(e,t,r){var i=e("../component"),n=(e("../../lib/util"),e("../../lib/dom")),a=(e("../../lib/event"),e("../../lib/ua"),e("../../lang/index"),e("../../player/base/event/eventtype"));e=i.extend({init:function(e,t){i.call(this,e,t),this.addClass("prism-info-display")},createEl:function(){return i.prototype.createEl.call(this,"p")},bindEvent:function(){var e=this;e._player.on(a.Private.Info_Show,(function(t){var r=document.querySelector("#"+e.id());t=t.paramData;t&&(void 0!==t.text&&t.text?(r.innerHTML=t.text,void 0!==t.duration&&t.duration&&(e.handler&&clearTimeout(e.handler),e.handler=setTimeout((function(){n.css(r,"display","none")}),t.duration)),"lb"==t.align?(n.addClass(r,"prism-info-left-bottom"),n.removeClass(r,"prism-info-top-center")):"tc"==t.align?(n.addClass(r,"prism-info-top-center"),n.removeClass(r,"prism-info-left-bottom")):(n.removeClass(r,"prism-info-left-bottom"),n.removeClass(r,"prism-info-top-center")),t.isBlack?n.addClass(r,"prism-info-black"):n.removeClass(r,"prism-info-black")):r.innerHTML=t,n.css(r,"display","block"))})),e._player.on(a.Private.Info_Hide,(function(t){var r=document.querySelector("#"+e.id());n.css(r,"display","none")}))},disposeUI:function(){this.handler&&(clearTimeout(this.handler),this.handler=null)}});t.exports=e},{"../../lang/index":23,"../../lib/dom":32,"../../lib/event":33,"../../lib/ua":49,"../../lib/util":51,"../../player/base/event/eventtype":70,"../component":130}],139:[function(e,t,r){var i=e("../component"),n=e("../../lang/index");e=i.extend({init:function(e,t){i.call(this,e,t),this.addClass("prism-license-watermark")},createEl:function(){var e=i.prototype.createEl.call(this,"div");return e.innerHTML='<div class="no-authorization">'+n.get("License_No_Authorization")+'</div><a class="apply-button" target="_blank" href="https://help.aliyun.com/document_detail/434250.html">'+n.get("License_Click_To_Apply")+"</a>",e}});t.exports=e},{"../../lang/index":23,"../component":130}],140:[function(e,t,r){var i=e("../component"),n=e("./util"),a=(e("../../lib/util"),e("../../lib/dom")),o=e("../../lib/event"),s=e("../../lib/playerUtil"),l=e("../../lang/index");e=i.extend({init:function(e,t){i.call(this,e,t),this.addClass("prism-live-display")},createEl:function(){var e=i.prototype.createEl.call(this,"p");return e.innerText="LIVE",s.isLiveShift(this._player._options)&&a.addClass(e,"live-shift-display"),e},bindEvent:function(){var e=document.querySelector("#"+this.id()),t=this;s.isLiveShift(this._player._options)&&(o.on(e,"click",(function(){t._player._liveshiftService.switchToLive()})),n.registerTooltipEvent.call(this,this.el(),l.get("SwitchToLive")))}});t.exports=e},{"../../lang/index":23,"../../lib/dom":32,"../../lib/event":33,"../../lib/playerUtil":45,"../../lib/util":51,"../component":130,"./util":159}],141:[function(e,t,r){var i=e("../component"),n=(e("../../lib/dom"),e("../../lib/event"),e("../../player/base/event/eventtype")),a=e("../../player/base/plugin/status"),o=e("../../lib/ua.js");e=i.extend({init:function(e,t){i.call(this,e,t),this.addClass("prism-animation")},bindEvent:function(){var e=this;this._player.on(n.Player.Play,(function(){e._player._isManualPlay&&(e.removeClass("prism-pause-animation"),e.addClass("prism-play-animation"),o.IS_ANDROID_FIREFOX||e.removeClass("play-apply-animation"),e.playHandler&&clearTimeout(e.playHandler),e.playHandler=setTimeout((function(){o.IS_ANDROID_FIREFOX||e.addClass("play-apply-animation")})))})),this._player.on(n.Player.Pause,(function(){var t=e._player._status;t!=a.ended&&t!=a.error&&e._player._isManualPause&&(e.removeClass("prism-play-animation"),e.addClass("prism-pause-animation"),o.IS_ANDROID_FIREFOX||e.removeClass("play-apply-animation"),e.pauseHandler&&clearTimeout(e.pauseHandler),e.pauseHandler=setTimeout((function(){o.IS_ANDROID_FIREFOX||e.addClass("play-apply-animation")})))}))},disposeUI:function(){this.playHandler&&(clearTimeout(this.playHandler),this.playHandler=null),this.pauseHandler&&(clearTimeout(this.pauseHandler),this.pauseHandler=null)}});t.exports=e},{"../../lib/dom":32,"../../lib/event":33,"../../lib/ua.js":49,"../../player/base/event/eventtype":70,"../../player/base/plugin/status":95,"../component":130}],142:[function(e,t,r){var i=e("../component"),n=e("../../player/base/event/eventtype"),a=e("./util"),o=e("../../lang/index");e=i.extend({init:function(e,t){i.call(this,e,t),this.addClass("prism-play-btn")},bindEvent:function(){var e=this;this._player.on(n.Player.Play,(function(){e.addClass("playing")})),this._player.on(n.Player.Pause,(function(){e.removeClass("playing")})),this.on(n.Private.PlayClick,(function(){var t;e._player.paused()?(t=e._player.getCurrentTime(),(e._player.getDuration()<=t||e._player._ended||e._player.exceedPreviewTime(t))&&e._player.seek(0),e._player.play(!0),e.addClass("playing")):(e._player.pause(!0),e.removeClass("playing")),e._player.trigger(n.Private.MarkerTextHide)})),a.registerTooltipEvent.call(this,this.el(),(function(){return e._player.paused()?o.get("Play"):o.get("Pause")}))}});t.exports=e},{"../../lang/index":23,"../../player/base/event/eventtype":70,"../component":130,"./util":159}],143:[function(e,t,r){var i=e("../component"),n=e("../../lib/dom"),a=(e("../../lib/constants"),e("../../lib/event")),o=e("../../lib/ua"),s=e("../../lib/function"),l=e("../../lang/index"),u=e("../../config"),c=e("../../lib/util"),d=e("../../player/base/event/eventtype"),h=e("./util").debounce;e=i.extend({init:function(e,t){i.call(this,e,t),this._seekTime=-1,this._lastSeekTime=0,this._moving=!1,this._thumbnailHideTimer=null,this.addClass("prism-progress")},createEl:function(){var e=i.prototype.createEl.call(this);return e.innerHTML='<div class="prism-progress-loaded"></div><div class="prism-progress-played"></div><div class="prism-progress-marker"></div><div class="prism-progress-cursor"><img></img></div><p class="prism-progress-time"></p>',e},bindEvent:function(){function e(e){t._progressDown=e}var t=this,r=(this.loadedNode=document.querySelector("#"+this.id()+" .prism-progress-loaded"),this.playedNode=document.querySelector("#"+this.id()+" .prism-progress-played"),this.cursorNode=document.querySelector("#"+this.id()+" .prism-progress-cursor"),this.timeNode=document.querySelector("#"+this._player._options.id+" .prism-progress-time"),this.thumbnailNode=document.querySelector(".prism-thumbnail"),this.controlNode=document.querySelector("#"+this._player._options.id+" .prism-controlbar"),document.querySelector("#"+this.id())),i=document.querySelector("#"+this.id()+" .prism-progress-cursor img"),l="";l=this._player._options.skinsDomain?this._player._options.skinsDomain+"/skins/default/img/dragcursor.png":u.domain?"https://"+u.domain+"/de/prismplayer/"+u.h5Version+"/skins/default/img/dragcursor.png":"/build/skins/default/img/dragcursor.png";i.src=l,a.on(this.cursorNode,"mousedown",(function(e){t._onMouseDown(e)})),a.on(this.cursorNode,"touchstart",(function(e){t._onMouseDown(e)})),a.on(r,"mousemove",(function(e){t._progressMove(e)})),a.on(r,"touchmove",(function(e){t._progressMove(e)})),a.on(r,"mousedown",(function(t){e(!0)})),a.on(r,"touchstart",(function(t){e(!0)})),a.on(r,"mouseup",(function(t){e(!1)})),a.on(r,"touchend",(function(r){e(!1),t._moving&&o.IS_MOBILE&&(t._player.trigger(d.Private.EndStart,{toTime:t._lastSeekTime}),t._moving=!1)})),a.on(this._el,"click",(function(e){t._onMouseClick(e)})),this._player.on(d.Private.HideProgress,(function(e){t._hideProgress(e)})),this._player.on(d.Private.CancelHideProgress,(function(e){t._cancelHideProgress(e)})),this._player.on(d.Private.HideBar,(function(e){t._player._seeking=!1})),a.on(r,d.Private.MouseOver,(function(e){t._onMouseOver(e)})),a.on(r,d.Private.MouseOut,(function(e){t._onMouseOut(e)})),a.on(this.controlNode,d.Private.MouseLeave,(function(e){t._offMouseUp()})),o.IS_PC?(i=h((function(){n.addClass(r,"prism-progress-hover"),n.addClass(t.cursorNode,"cursor-hover")}),100),a.on(r,"mouseover",i),l=h((function(){n.removeClass(r,"prism-progress-hover"),n.removeClass(t.cursorNode,"cursor-hover"),t._progressDown=!1}),100),a.on(r,"mouseout",l)):(n.addClass(r,"prism-progress-hover"),n.addClass(t.cursorNode,"cursor-hover")),this.bindTimeupdate=s.bind(this,this._onTimeupdate),this._player.on(d.Player.TimeUpdate,this.bindTimeupdate),o.IS_IPAD?this.interval=setInterval((function(){t._onProgress()}),500):this._player.on(d.Video.Progress,(function(){t._onProgress()})),this._player.on(d.Private.UpdateProgress,(function(e){t._updateProgressBar(t.playedNode,e.paramData.targetTime)})),this._player.on(d.Private.UpdateCursorPosition,(function(e){t._updateCursorPosition(e.paramData.targetTime)}))},_progressMove:function(e){e.preventDefault();var t,r,i=this._getSeconds(e);i!=1/0&&(t=c.formatTime(i),r=this._getDistance(e),this.cursorNode)&&(this._player.trigger(d.Private.ThumbnailShow,{time:i,formatTime:t,left:r,progressWidth:this.el().offsetWidth}),this._autoHideThumbnail(),this._progressDown)&&this._onMouseMove(e)},_hideProgress:function(e){a.off(this.cursorNode,"mousedown"),a.off(this.cursorNode,"touchstart")},_cancelHideProgress:function(e){var t=this;a.on(this.cursorNode,"mousedown",(function(e){t._onMouseDown(e)})),a.on(this.cursorNode,"touchstart",(function(e){t._onMouseDown(e)}))},_canSeekable:function(e){var t=!0;return"function"==typeof this._player.canSeekable?this._player.canSeekable(e):t},_onMouseOver:function(e){this._cursorHideHandler&&(clearTimeout(this._cursorHideHandler),this._cursorHideHandler=null),this._mouseInProgress||this._updateCursorPosition(this._player.getCurrentTime()),this._mouseInProgress=!0},_onMouseOut:function(e){var t=this;this._cursorHideHandler&&clearTimeout(this._cursorHideHandler),this._cursorHideHandler=setTimeout((function(){t._player.trigger(d.Private.ThumbnailHide),t._mouseInProgress=!1}))},_getSeconds:function(e){e=this._getDistance(e);var t=this.el().offsetWidth;e=this._player.getDuration()?e/t*this._player.getDuration():0;return(e=e<0?0:e)>this._player.getDuration()?this._player.getDuration():e},_getDistance:function(e){for(var t=this.el().offsetLeft,r=this.el();r=r.offsetParent;){var i=n.getTranslateX(r);t+=r.offsetLeft+i}return e=(e.touches?e.touches[0]:e).pageX-t,e<0?0:e},_onMouseClick:function(e){var t=this,r=t._getSeconds(e);t._canSeekable(r)?(t._player.exceedPreviewTime(r)&&(r=t._player.getPreviewTime()),this._seekTime=r,t._updateProgressBar(this.playedNode,r),t._updateCursorPosition(r),this._mouseClickTimeHandle&&clearTimeout(this._mouseClickTimeHandle),this._mouseClickTimeHandle=setTimeout((function(){t._player._seeking=!0,t._mouseDown&&!o.IS_MOBILE||(t._player.trigger(d.Private.SeekStart,{fromTime:t._player.getCurrentTime()}),t._player.trigger(d.Private.EndStart,{toTime:r})),t._player.seek(r),t._mouseDown=!1,t._mouseClickTimeHandle=null,t._inWaitingSeek=!1}),0),this._inWaitingSeek=!0):t._player.trigger(d.Private.Info_Show,{text:l.get("Can_Not_Seekable"),duration:2e3})},_onMouseDown:function(e){var t=this;e.preventDefault(),this._mouseDown=!0,o.IS_PC&&this._player.trigger(d.Private.SeekStart,{fromTime:this._player.getCurrentTime()}),a.on(this.controlNode,"mousemove",(function(e){t._onMouseMove(e)})),a.on(this.controlNode,"touchmove",(function(e){t._onMouseMove(e)})),a.on(this.controlNode,"mouseup",(function(e){t._onControlBarMouseUp(e)})),a.on(this.controlNode,"touchend",(function(e){t._onControlBarMouseUp(e)})),e=t._getSeconds(e);t._canSeekable(e)?t._player.exceedPreviewTime(e)&&t._player.getPreviewTime():t._player.trigger(d.Private.Info_Show,{text:l.get("Can_Not_Seekable"),duration:2e3})},_onMouseUp:function(e){this._onMouseUpIntern(e)},_onControlBarMouseUp:function(e){this._onMouseUpIntern(e)},_onPlayerMouseUp:function(e){this._onMouseUpIntern(e)},_offMouseUp:function(){a.off(this.controlNode,"mousemove"),a.off(this.controlNode,"touchmove"),a.off(this.controlNode,"mouseup"),a.off(this.controlNode,"touchend")},_onMouseUpIntern:function(e){e.preventDefault(),this._offMouseUp(),e=this.playedNode.offsetWidth/this.el().offsetWidth*this._player.getDuration(),this._player.getDuration(),isNaN(e)||this._player.seek(e),o.IS_PC&&this._player.trigger(d.Private.EndStart,{toTime:e}),this._autoHideThumbnail()},_onMouseMove:function(e){e.preventDefault(),!this._moving&&o.IS_MOBILE&&(this._player.trigger(d.Private.SeekStart,{fromTime:this._player.getCurrentTime()}),this._moving=!0),e=this._getSeconds(e),this._player.exceedPreviewTime(e)&&(e=this._player.getPreviewTime()),this._player.seek(e),this._updateProgressBar(this.playedNode,e),this._updateCursorPosition(e),this._lastSeekTime=e},_onTimeupdate:function(e){var t=this._player._options.source,r=(t=this._getUrlSuffix(t),!1);"mp4"===t&&(o.IS_MAC_SAFARI&&(r=!0),o.IS_IOS&&(r=!0),o.IS_IE11)&&(r=!0),"m3u8"===t&&o.IS_IE11&&(r=!0),"audio"==this._player._options.mediaType&&o.IS_IOS&&(this._player._seeking=!1),(this._inWaitingSeek||this._player._seeking&&!o.IS_EDGE||this._progressDown)&&!r||(this._updateProgressBar(this.playedNode,this._player.getCurrentTime()),this._updateCursorPosition(this._player.getCurrentTime()),this._player.trigger(d.Private.UpdateProgressBar,{time:this._player.getCurrentTime()}))},_onProgress:function(e){this._player.getDuration()&&1<=this._player.getBuffered().length&&this._updateProgressBar(this.loadedNode,this._player.getBuffered().end(this._player.getBuffered().length-1))},_updateProgressBar:function(e,t){var r=this._player.getDuration();1!=this._player._switchSourcing&&r&&(-1!=this._seekTime&&(this._player.getCurrentTime()>=this._seekTime||!this._player._seeking?this._seekTime=-1:t=this._seekTime),1<(t=t/r+.005)&&(t=1),e)&&n.css(e,"width",100*t+"%")},_updateCursorPosition:function(e){var t,r,i,a=this._player.getDuration();1!=this._player._switchSourcing&&a&&(t=1,r=10/(i=this._player.el().clientWidth),0!=i&&(t=1-r),i=(i=e/a-r)<0?0:i,this.cursorNode)&&(t<i?(n.css(this.cursorNode,"right","0px"),n.css(this.cursorNode,"left","auto")):(n.css(this.cursorNode,"right","auto"),n.css(this.cursorNode,"left",100*i+"%")))},_getUrlSuffix:function(e){return e&&"string"==typeof e?((e=(e.split("?")[0]||"").split("."))[e.length-1]||"").toLowerCase():""},_autoHideThumbnail:function(){var e=this;o.IS_MOBILE&&(this._thumbnailHideTimer&&clearTimeout(this._thumbnailHideTimer),this._thumbnailHideTimer=setTimeout((function(){e._moving||e._player.trigger(d.Private.ThumbnailHide)}),2e3))},disposeUI:function(){this._seekTime=-1,this._lastSeekTime=0,this._moving=!1,this.cursorNodeHandler&&(clearTimeout(this.cursorNodeHandler),this.cursorNodeHandler=null),this._cursorHideHandler&&(clearTimeout(this._cursorHideHandler),this._cursorHideHandler=null),this._mouseClickTimeHandle&&(clearTimeout(this._mouseClickTimeHandle),this._mouseClickTimeHandle=null)}});t.exports=e},{"../../config":14,"../../lang/index":23,"../../lib/constants":28,"../../lib/dom":32,"../../lib/event":33,"../../lib/function":35,"../../lib/ua":49,"../../lib/util":51,"../../player/base/event/eventtype":70,"../component":130,"./util":159}],144:[function(e,t,r){var i=e("../component"),n=(e("../../lib/util"),e("../../lib/dom")),a=e("../../lib/event"),o=e("../../player/base/event/eventtype");e=i.extend({init:function(e,t){i.call(this,e,t),this.addClass("prism-marker-text")},createEl:function(){var e=i.prototype.createEl.call(this,"div");return e.innerHTML="<p></p>",e},bindEvent:function(){var e=this;e._player.on(o.Private.MarkerTextShow,(function(t){var r=t.paramData,i=o.Player.MarkerDotOver;e._player.trigger(i,t.paramData),r.progressMarker.isCustomized?e._player.trigger(o.Private.LifeCycleChanged,{type:i,data:t.paramData}):(e._thumbnailShowHanlde&&(n.css(e.el(),"display","none"),clearTimeout(e._thumbnailShowHanlde)),e._thumbnailShowHanlde=setTimeout((function(){var t;document.querySelector("#"+e.id()+" p").innerText=r.progressMarker.text||"",r&&(n.css(e.el(),"display","block"),t=e._player.el().offsetWidth,left=t*r.left,width=e.el().offsetWidth,left+width>t?(n.css(e.el(),"right","0px"),n.css(e.el(),"left","auto")):(left=(left-=width/2)<0?0:left,n.css(e.el(),"right","auto"),n.css(e.el(),"left",left+"px")))}),30))})),e._player.on(o.Private.MarkerTextHide,(function(t){e._player.trigger(o.Player.MarkerDotOut),e._player.trigger(o.Private.LifeCycleChanged,{type:o.Player.MarkerDotOut,data:""}),e._thumbnailShowHanlde&&clearTimeout(e._thumbnailShowHanlde),n.css(e.el(),"display","none")})),a.on(e._player.tag,"click",(function(t){t&&t.target==t.currentTarget&&e._player.trigger(o.Private.MarkerTextHide)})),a.on(e._player.tag,"touchstart",(function(t){t&&t.target==t.currentTarget&&e._player.trigger(o.Private.MarkerTextHide)}))},disposeUI:function(){this._thumbnailShowHanlde&&(clearTimeout(this._thumbnailShowHanlde),this._thumbnailShowHanlde=null)}});t.exports=e},{"../../lib/dom":32,"../../lib/event":33,"../../lib/util":51,"../../player/base/event/eventtype":70,"../component":130}],145:[function(e,t,r){var i=e("./selector"),n=e("../../../lib/object"),a=(e("../../../lib/util"),e("../../../lib/cookie")),o=e("../../../lib/dom"),s=(e("../../../lib/event"),e("../../../lib/constants")),l=e("../../../lang/index"),u=e("../../../player/base/event/eventtype");e=i.extend({init:function(e,t){this.Name=l.get("Quality"),this.Type="quality",this.Tooltip=l.get("Quality_Switch_To"),i.call(this,e,t),this._isMasterLevel=!1},showTip:function(e,t){this._player.trigger(u.Private.Info_Show,{text:e,duration:t,align:"lb"})},bindEvent:function(){this.bindCommonEvent();var e=this,t=(this._player.on(u.Private.QualityChange,(function(t){var r,i,n=0<e._player._urls.length?e._player._urls:e._player._qualityService.levels;(data=t.paramData).levelSwitch?(r=data.desc||data.bitrate,e._autoSWitchDesc=r,e._updateText(r)):0<e._player._currentPlayIndex&&(e._autoSWitchDesc="",i=n[(r=e._player._currentPlayIndex)-1].desc,n=n[r].desc,e.showTip(i+t.paramData+n,1e3),e._player.trigger(u.Private.SelectorValueChange,{type:e.Type,text:n}))})),document.querySelector("#"+e.id()+" .selector-list"));this._player.on(u.Player.LevelSwitch,(function(){o.addClass(t,"disabled")})),this._player.on(u.Player.LevelSwitched,(function(){o.removeClass(t,"disabled")}))},generateList:function(e){var t,r=this._player._urls,i=this._player._currentPlayIndex,a=this._player._qualityService.levels,s=(0<a.length&&(this._isMasterLevel=!0,this._player._options.isVBR)&&(i=(r=a).length-1),document.querySelector("#"+this.id()+" .selector-list"));0<r.length&&(t=this,n.each(r,(function(e,r){var n,a;(e.desc||e.bitrate)&&(n=o.createEl.call(this,"li",{key:e.Url,index:r,text:e.desc||e.bitrate}),a=o.createEl.call(this,"span",{key:e.Url,index:r,text:e.desc||e.bitrate}),r==i&&(o.addClass(n,"current"),t._previousSelection=n),a.innerText=e.desc||e.bitrate,n.appendChild(a),s.appendChild(n))}))),this._autoSWitchDesc&&this._updateText(this._autoSWitchDesc)},execute:function(e){if(this._player._switchSourcing=!0,this._isMasterLevel){for(var t,r=this._player._qualityService.levels,i=0;i<r.length;i++)r[i].Url==e&&r[i].desc!=l.get("Auto")&&(t=r[i],this._resetAutoText());this._player._switchLevel?this._player._switchLevel(e,t||{isAuto:!0}):(n=this._player.autoplay||"pause"!=this._player._status,this._player._loadByUrlInner(e,this._player.getCurrentTime(),n))}else{var n,o=this._player._urls.length,u=this._player._currentPlayIndex,c=-1;for(i=0;i<o;i++)if(this._player._urls[i].Url==e){c=this._player._currentPlayIndex=i,a.set(s.SelectedStreamLevel,this._player._urls[i].definition,365);break}u!=c&&-1<c&&(u=this._player.getCurrentTime(),n=this._player.autoplay||"pause"!=this._player._status,this._player.autoplay||0!=u||(n=!1),this._player._switchLevel&&!this._player._options.isLive?this._player._switchLevel(e):this._player._loadByUrlInner(e,u,n,!0))}var d=this;setTimeout((function(){d._player._switchSourcing=!1}))},_updateText:function(e){var t=document.querySelector("#"+this.id()+" .selector-list .current"),r=document.querySelector("#"+this.id()+" .selector-list .current span"),i=l.get("Auto");r&&r.innerText&&-1<r.innerText.indexOf(i)&&(r.innerText=i+=e?"("+e+")":"",t)&&(t.text=i)},_resetAutoText:function(){for(var e=l.get("Auto"),t=document.querySelectorAll("#"+this.id()+" .selector-list li"),r=0;r<=t.length;r++){var i=t[r],n=i.querySelector("span");if(-1<n.innerText.indexOf(e)){n.innerText=e,i.text=e;break}}}});t.exports=e},{"../../../lang/index":23,"../../../lib/constants":28,"../../../lib/cookie":29,"../../../lib/dom":32,"../../../lib/event":33,"../../../lib/object":42,"../../../lib/util":51,"../../../player/base/event/eventtype":70,"./selector":151}],146:[function(e,t,r){var i=e("./selector"),n=e("../../../lib/object"),a=(e("../../../lib/util"),e("../../../lib/cookie"),e("../../../lib/dom")),o=(e("../../../lib/event"),e("./util"),e("../../../lang/index")),s=e("../../../player/base/event/eventtype");e=i.extend({init:function(e,t){this.Name=o.get("AudioTrack"),this.Type="audio",this.Tooltip=o.get("AudioTrack_Switch_To"),i.call(this,e,t)},bindEvent:function(){this.bindCommonEvent();var e=this,t=document.querySelector("#"+e.id()+" .selector-list");document.querySelector("#"+e.id()+" .header"),e._player.on(s.Private.ChangeURL,(function(){e._hasGeneratedList=!1})),this._player.on(s.Player.AudioTrackSwitch,(function(){a.addClass(t,"disabled")})),this._player.on(s.Player.AudioTrackSwitched,(function(){a.removeClass(t,"disabled")})),e._player.on(s.Player.AudioTrackReady,(function(r){!e._hasGeneratedList&&(e._clear(),r=r.paramData)&&(n.each(r,(function(r,i){var n=a.createEl.call(e,"li",{key:r.value,text:r.text}),o=a.createEl.call(e,"span",{key:r.value,text:r.text});o.innerText=r.text,n.appendChild(o),t.appendChild(n)})),e._hasGeneratedList=!0)}))},execute:function(e){this._player._audioTrackService.switch(e)}});t.exports=e},{"../../../lang/index":23,"../../../lib/cookie":29,"../../../lib/dom":32,"../../../lib/event":33,"../../../lib/object":42,"../../../lib/util":51,"../../../player/base/event/eventtype":70,"./selector":151,"./util":153}],147:[function(e,t,r){var i=e("../../component"),n=(e("../../../lib/dom"),e("../../../player/base/event/eventtype")),a=e("./list"),o=e("../../../lang/index"),s=e("../util");e=i.extend({init:function(e,t){i.call(this,e,t),this.addClass(t.className||"prism-setting-btn"),this._settingList=new a(e,t),e.addChild(this._settingList,t)},createEl:function(){return i.prototype.createEl.call(this,"div")},bindEvent:function(){var e=this;this.on("click",(function(){e._settingList.isOpened?e._player.trigger(n.Private.SettingListHide):e._player.trigger(n.Private.SettingListShow),e._player.trigger(n.Private.SelectorHide),e._player.trigger(n.Private.MarkerTextHide),e._player.trigger(n.Private.VolumeVisibilityChange,"")})),s.registerTooltipEvent.call(this,this.el(),o.get("Setting"))}});t.exports=e},{"../../../lang/index":23,"../../../lib/dom":32,"../../../player/base/event/eventtype":70,"../../component":130,"../util":159,"./list":150}],148:[function(e,t,r){var i=e("./selector"),n=e("../../../lib/object"),a=e("../../../lib/dom"),o=(e("../../../lib/event"),e("./util"),e("../../../lib/cookie")),s=e("../../../lib/constants"),l=e("../../../lang/index"),u=e("../../../player/base/event/eventtype");e=i.extend({init:function(e,t){this.Name=l.get("Subtitle"),this.Type="cc",this.Tooltip=l.get("CC_Switch_To"),i.call(this,e,t)},bindEvent:function(){this.bindCommonEvent();var e=this;this._player.on(u.Private.CCStateChanged,(function(t){var r=t.paramData.value;t=t.paramData.lang,"on"==r&&t?e._backCCText=t:"off"==r&&""==e._backCCText&&(e._backCCText=e._previousSelection.text),t="Off";"on"==r&&(t=e._backCCText),e._player.trigger(u.Private.SelectorUpdateList,{type:"cc",text:t})}))},generateList:function(e){var t=document.querySelector("#"+this.id()+" .selector-list"),r=this._player._ccService.tracks,i=this;n.each(r,(function(r,n){var o=a.createEl.call(this,"li",{key:r.value,text:r.text}),s=a.createEl.call(this,"span",{key:r.value,text:r.text});r.text==e&&(a.addClass(o,"current"),i._previousSelection=o),s.innerText=r.text,o.appendChild(s),t.appendChild(o)}))},execute:function(e){this._backCCText="",o.set(s.SelectedCC,e,365),this._player._ccService.switch(e)}});t.exports=e},{"../../../lang/index":23,"../../../lib/constants":28,"../../../lib/cookie":29,"../../../lib/dom":32,"../../../lib/event":33,"../../../lib/object":42,"../../../player/base/event/eventtype":70,"./selector":151,"./util":153}],149:[function(e,t,r){t.exports={CC:e("./cc"),Speed:e("./speed"),Quality:e("./Quality"),Audio:e("./audio")}},{"./Quality":145,"./audio":146,"./cc":148,"./speed":152}],150:[function(e,t,r){var i=e("../../component"),n=e("../../../lib/dom"),a=e("../../../lib/ua"),o=e("../../../lib/event"),s=e("../../../player/base/event/eventtype"),l=e("./export"),u=e("./util"),c=e("../../../lang/index");e=i.extend({init:function(e,t){for(var r in this.isOpened=!1,i.call(this,e,t),this.addClass(t.className||"prism-setting-list"),l)r=new l[r](e,t),e.addChild(r,t)},createEl:function(){var e=i.prototype.createEl.call(this,"div"),t="<div class='prism-setting-item prism-setting-{type}' type={type}><div class='setting-content'><span class='setting-title'>{value}</span><span class='array'></span><span class='current-setting'></span></div></div>",r=t.replace(/{type}/g,"speed").replace("{value}",c.get("Speed")),n=t.replace(/{type}/g,"cc").replace("{value}",c.get("Subtitle")),a=t.replace(/{type}/g,"audio").replace("{value}",c.get("AudioTrack"));t=t.replace(/{type}/g,"quality").replace("{value}",c.get("Quality"));return e.innerHTML=r+n+a+t,e},bindEvent:function(){function e(){r._player.trigger(s.Private.SettingListHide),r.isOpened=!1}function t(e){e&&e.text&&(document.querySelector("#"+r.id()+" .prism-setting-"+e.type+" .current-setting").innerText=e.text)}var r=this,i=(this._player.on(s.Private.SettingListShow,(function(e){r.isOpened=!0,e=e.paramData,t(e),n.css(r.el(),"display","block")})),this._player.on(s.Private.UpdateToSettingList,(function(e){e=e.paramData,t(e)})),this._player.on(s.Private.SelectorUpdateList,(function(e){e=e.paramData,t(e),r._player.trigger(s.Private.SelectorValueChange,e)})),this._player.on(s.Private.SettingListHide,(function(){r.isOpened=!1,n.css(r.el(),"display","none")})),o.on(this.el(),"click",(function(e){r._player.trigger(s.Private.SettingListHide);e=e.srcElement||e.target;(e=u.findItemElementForList(e))&&(e=e.getAttribute("type"),r._player.trigger(s.Private.SelectorShow,{type:e}))})),a.IS_MOBILE?"touchleave":"mouseleave");o.on(this.el(),i,(function(){e()})),o.on(this._player.tag,"click",(function(t){t&&t.target==t.currentTarget&&e()})),o.on(this._player.tag,"touchstart",(function(t){t&&t.target==t.currentTarget&&e()})),this._player.on(s.Private.QualityChange,(function(e){var t,i;e=e.paramData;e.levelSwitch&&(t=document.querySelector("#"+r.id()+" .prism-setting-quality .current-setting"),i=c.get("Auto"),-1<t.innerText.indexOf(i))&&(t.innerText=i+(e.desc?"("+e.desc+")":""))}))}});t.exports=e},{"../../../lang/index":23,"../../../lib/dom":32,"../../../lib/event":33,"../../../lib/ua":49,"../../../player/base/event/eventtype":70,"../../component":130,"./export":149,"./util":153}],151:[function(e,t,r){var i=e("../../component"),n=(e("../../../lib/object"),e("../../../lib/util"),e("../../../lib/ua")),a=(e("../../../lib/cookie"),e("../../../lib/dom")),o=e("../../../lib/event"),s=e("./util"),l=(e("../../../lang/index"),e("../../../player/base/event/eventtype"));e=i.extend({init:function(e,t){this._hasGeneratedList=!1,this._previousSelection=null,this._backupSelector="",i.call(this,e,t),this.className=t.className||"prism-"+this.Type+"-selector prism-setting-selector",this.addClass(this.className)},createEl:function(){var e=i.prototype.createEl.call(this,"div");return e.innerHTML='<div class="header"><div class="left-array"></div><span>'+this.Name+'</span></div><ul class="selector-list"></ul>',e},bindEvent:function(){this.bindCommonEvent()},bindCommonEvent:function(){var e=this,t=document.querySelector("#"+e.id()+" .selector-list"),r=document.querySelector("#"+e.id()+" .header");function i(){e._hasGeneratedList||(e._clear(),e.generateList(e._backupSelector),e._backupSelector="",e._hasGeneratedList=!0)}this._player.on(l.Private.ChangeURL,(function(){e._hasGeneratedList=!1})),o.on(r,"click",(function(){e._player.trigger(l.Private.SelectorHide),e._player.trigger(l.Private.SettingListShow,{type:e.Type,text:e._previousSelection?e._previousSelection.text:""})})),o.on(t,"click",(function(t){t=t.srcElement||t.target;var r=t.key,i=t.text;void 0!==i&&(e._previousSelection&&a.removeClass(e._previousSelection,"current"),e._previousSelection=s.findliElementForSelector(t),a.addClass(e._previousSelection,"current"),e.execute&&e.execute(r),t=e.Tooltip+"<span>"+i+"</span>",e._player.trigger(l.Private.Info_Show,{text:t,duration:1e3,align:"lb"}))})),e._player.on(l.Private.SelectorHide,(function(){u()})),e._player.on(l.Private.SelectorValueChange,(function(t){var r=t.paramData;if(r&&r.type==e.Type){var i=document.querySelectorAll("#"+e.id()+" .selector-list li");if(i){var n=i.length;0==n&&(e._backupSelector=r.text);for(var o=0;o<n;o++)if(i[o].text==r.text){e._previousSelection&&a.removeClass(e._previousSelection,"current"),a.addClass(i[o],"current"),e._previousSelection=i[o];break}}}})),e._player.on(l.Private.SettingListShow,(function(){i()})),e._player.on(l.Private.SelectorGenerateList,(function(t){var r=t.paramData&&t.paramData.type;t=t.paramData&&t.paramData.value;r===e.Type&&(e._hasGeneratedList=!1,t&&(e._backupSelector=t),i())})),e._player.on(l.Private.SelectorShow,(function(t){(t=t.paramData).type==e.Type&&(t=document.querySelector("#"+e._player.id()+" .prism-"+t.type+"-selector"),e._hasGeneratedList||i(),a.css(t,"display","block"))}));var u=function(){a.css(e.el(),"display","none"),e._player.trigger(l.Private.UpdateToSettingList,{type:e.Type,text:e._previousSelection?e._previousSelection.text:""})};r=n.IS_MOBILE?"touchleave":"mouseleave";o.on(this.el(),r,(function(){u()})),o.on(this._player.tag,"click",(function(e){e&&e.target==e.currentTarget&&u()})),o.on(this._player.tag,"touchstart",(function(e){e&&e.target==e.currentTarget&&u()}))},setSelected:function(e){},generateList:function(){},_clear:function(){document.querySelector("#"+this.id()+" .selector-list").innerHTML=""}});t.exports=e},{"../../../lang/index":23,"../../../lib/cookie":29,"../../../lib/dom":32,"../../../lib/event":33,"../../../lib/object":42,"../../../lib/ua":49,"../../../lib/util":51,"../../../player/base/event/eventtype":70,"../../component":130,"./util":153}],152:[function(e,t,r){var i=e("./selector"),n=e("../../../lib/object"),a=(e("../../../lib/util"),e("../../../lib/cookie"),e("../../../lib/dom")),o=(e("../../../lib/event"),e("./util"),e("../../../lib/constants")),s=e("../../../lang/index");e("../../../player/base/event/eventtype"),e=i.extend({init:function(e,t){this.Name=s.get("Speed"),this.Type="speed",this.Tooltip=s.get("Speed_Switch_To"),i.call(this,e,t)},generateList:function(){var e=document.querySelector("#"+this.id()+" .selector-list"),t=o.SpeedLevels,r=this;n.each(t,(function(t,i){var n=a.createEl.call(this,"li",{key:t.key,text:t.text}),o=a.createEl.call(this,"span",{key:t.key,text:t.text});o.innerText=t.text,t.text==s.get("Speed_1X_Text")&&(a.addClass(n,"current"),r._previousSelection=n),n.appendChild(o),e.appendChild(n)}))},execute:function(e){this._player.setSpeed(e)}});t.exports=e},{"../../../lang/index":23,"../../../lib/constants":28,"../../../lib/cookie":29,"../../../lib/dom":32,"../../../lib/event":33,"../../../lib/object":42,"../../../lib/util":51,"../../../player/base/event/eventtype":70,"./selector":151,"./util":153}],153:[function(e,t,r){t.exports.findliElementForSelector=function(e){var t;return e&&"li"!=e.tagName.toLowerCase()?(t=e.parentElement)&&"li"==t.tagName.toLowerCase()?t:null:e},t.exports.findliElementByKey=function(e,t){return document.querySelectors(e),null},t.exports.findItemElementForList=function(e){var r;return!e||-1<e.className.indexOf("prism-setting-item")||(r=e.parentElement)&&(e=t.exports.findItemElementForList(r)),e}},{}],154:[function(e,t,r){var i=e("../component"),n=e("../../lib/dom"),a=e("../../lib/util"),o=e("../../lang/index"),s=e("../../player/base/event/eventtype"),l=e("./util"),u=(e=i.extend({init:function(e,t){i.call(this,e,t),this.addClass("prism-snapshot-btn")},createEl:function(){return i.prototype.createEl.call(this,"div")},bindEvent:function(){var e=this,t=this._player;t.on(s.Private.Snapshot_Hide,(function(){n.css(e._el,"display","none")})),l.registerTooltipEvent.call(this,this.el(),o.get("Snapshot")),this.on("click",(function(){e.trigger(s.Player.Snapshoting);var r=document.createElement("canvas"),i=t.tag,n=i.videoWidth,o=i.videoHeight,l=t._getSanpshotMatric(),c=(r.width=l.width||n,r.height=l.height||o,t.getCurrentTime()),d=r.getContext("2d"),h=(d.save(),t.getImage());"vertical"==h?(d.translate(0,r.height),d.scale(1,-1)):"horizon"==h&&(d.translate(r.width,0),d.scale(-1,1)),h=i,t._splayer&&(h=t._el.querySelector("canvas")),d.drawImage(h,0,0,n,o),d.restore(),u(d,t.getOptions()),i="",h="";try{i=r.toDataURL("image/jpeg",l.rate||1)}catch(r){h=r}n="",o="",i&&(d=(n=i).substr(n.indexOf(",")+1),o=a.toBinary(d)),e.trigger(s.Player.Snapshoted,{time:c,base64:n,binary:o,error:h})}))}}),function(e,t){t=t.snapshotWatermark,t&&t.text&&(e.font=t.font,t.fillColor&&(e.fillStyle=t.fillColor,e.fillText(t.text,t.left,t.top)),t.strokeColor&&(e.strokeStyle=t.strokeColor,e.strokeText(t.text,t.left,t.top)),e.stroke())});t.exports=e},{"../../lang/index":23,"../../lib/dom":32,"../../lib/util":51,"../../player/base/event/eventtype":70,"../component":130,"./util":159}],155:[function(e,t,r){var i=e("../component");e("../../lib/dom"),e("../../player/base/event/eventtype"),e=i.extend({init:function(e,t){i.call(this,e,t),this.addClass("prism-text-overlay")},createEl:function(){return i.prototype.createEl.call(this,"div")},_hide:function(e){},_show:function(e){},bindEvent:function(){}});t.exports=e},{"../../lib/dom":32,"../../player/base/event/eventtype":70,"../component":130}],156:[function(e,t,r){var i=e("../component"),n=(e("../../lib/util"),e("../../lib/dom")),a=e("../../lib/event"),o=(e("../../lib/ua"),e("../../lang/index"),e("../../player/base/event/eventtype")),s=e("./util");e=i.extend({init:function(e,t){i.call(this,e,t),this.addClass("prism-thumbnail")},createEl:function(){var e=i.prototype.createEl.call(this,"div");return e.innerHTML="<img></img><span></span>",e},bindEvent:function(){var e=this,t=(a.on(this._el,"mousemove",(function(e){e.preventDefault()})),a.on(this._el,"touchmove",(function(e){e.preventDefault()})),e._player.on(o.Private.ThumbnailLoaded,(function(t){var r,i,a;t=t.paramData;t&&0<t.length&&(r=e._player._thumbnailService.makeUrl(t[0].text),e._player.log("THUMBNAILSTART",{tu:encodeURIComponent(r)}),i=(new Date).getTime(),t[0].isBig?(n.css(e.el(),"background","url("+r+")"),n.css(e.el(),"width",t[0].w+"px"),n.css(e.el(),"height",t[0].h+"px"),e._player.log("THUMBNAILCOMPLETE",{ftt:(new Date).getTime()-i})):((a=document.querySelector("#"+e.id()+" img")).onload=function(){var t=a.width,r=a.height;n.css(e.el(),"width",t+"px"),n.css(e.el(),"height",r+"px"),e._player.log("THUMBNAILCOMPLETE",{ftt:(new Date).getTime()-i})},a.src=r))})),s.throttle((function(t){t=t[0];var r,i,a,o=document.querySelector("#"+e.id()+" span");t=t.paramData;o.innerText=t.formatTime,t&&((r=e._player._thumbnailService.findAvailableCue(t.time))?r.isBig?(i=e._player._thumbnailService.makeUrl(r.text),n.css(e.el(),"background","url("+i+")"),r.w,r.h,a=-1*r.x+"px "+-1*r.y+"px",n.css(e.el(),"background-position",a)):(a=document.querySelector("#"+e.id()+" img"),i=e._player._thumbnailService.makeUrl(r.text),a.src!=i&&(a.src=i)):(n.css(e.el(),"border","none"),n.css(o,"left","0px")),n.css(e.el(),"display","block"),a=0,i=(r?e.el():o).offsetWidth,a=t.left+i>t.progressWidth?t.left-i:(a=t.left-i/2)<0?0:a,n.css(e.el(),"left",a+"px"))}),30));e._player.on(o.Private.ThumbnailShow,t),e._player.on(o.Private.ThumbnailHide,(function(t){n.css(e.el(),"display","none")}))},_createSamllThumbnail:function(){},disposeUI:function(){}});t.exports=e},{"../../lang/index":23,"../../lib/dom":32,"../../lib/event":33,"../../lib/ua":49,"../../lib/util":51,"../../player/base/event/eventtype":70,"../component":130,"./util":159}],157:[function(e,t,r){var i=e("../component"),n=e("../../lib/util"),a=e("../../player/base/event/eventtype");e=i.extend({init:function(e,t){i.call(this,e,t),this.addClass("prism-time-display")},createEl:function(){var e=i.prototype.createEl.call(this,"div");return e.innerHTML='<span class="current-time">00:00</span> <span class="time-bound">/</span> <span class="duration">00:00</span>',e},bindEvent:function(){var e=this;this._player.on(a.Video.DurationChange,(function(){var t=n.formatTime(e._player.getDisplayDuration());t?(document.querySelector("#"+e.id()+" .time-bound").style.display="inline",document.querySelector("#"+e.id()+" .duration").style.display="inline",document.querySelector("#"+e.id()+" .duration").innerText=t):(document.querySelector("#"+e.id()+" .duration").style.display="none",document.querySelector("#"+e.id()+" .time-bound").style.display="none")})),this._player.on(a.Video.TimeUpdate,(function(){var t=e._player.getCurrentTime();t=n.formatTime(t);document.querySelector("#"+e.id()+" .current-time")&&(t?(document.querySelector("#"+e.id()+" .current-time").style.display="inline",document.querySelector("#"+e.id()+" .current-time").innerText=t):document.querySelector("#"+e.id()+" .current-time").style.display="none")}))}});t.exports=e},{"../../lib/util":51,"../../player/base/event/eventtype":70,"../component":130}],158:[function(e,t,r){var i=e("../component"),n=e("../../lib/dom"),a=e("../../player/base/event/eventtype");e=i.extend({init:function(e,t){i.call(this,e,t),this.addClass("prism-tooltip")},createEl:function(){var e=i.prototype.createEl.call(this,"p");return e.innerText="提示信息",e},bindEvent:function(){var e=this;e._player.on(a.Private.TooltipShow,(function(t){var r=document.querySelector("#"+e.id()),i=(t=t.paramData,r.innerText=t.text,n.css(r,"display","block"),r.offsetWidth),a=document.querySelector("#"+e._player.id()+" .prism-controlbar");a&&(a=a.offsetWidth,t.left+i>a?n.css(r,"left",a-i+"px"):n.css(r,"left",t.left-(i-t.width)/2+"px"))})),e._player.on(a.Private.TooltipHide,(function(t){var r=document.querySelector("#"+e.id());n.css(r,"display","none")}))}});t.exports=e},{"../../lib/dom":32,"../../player/base/event/eventtype":70,"../component":130}],159:[function(e,t,r){var i=e("../../lib/event"),n=e("../../player/base/event/eventtype");t.exports.registerTooltipEvent=function(e,t){function r(){a._controlbarTooltipHandler&&(clearTimeout(a._controlbarTooltipHandler),a._controlbarTooltipHandler=null)}var a=this;i.on(this.el(),"mouseover",(function(e){r(),a._controlbarTooltipHandler=setTimeout((function(){a._player.trigger(n.Private.TooltipHide)}),4e3);var i=a.el().offsetLeft,o=a.el().offsetWidth,s=t;"function"==typeof t&&(s=t.call(this)),a._player.trigger(n.Private.TooltipShow,{left:i,width:o,text:s})})),i.on(this.el(),"mouseout",(function(){r(),a._player.trigger(n.Private.TooltipHide)}))},t.exports.throttle=function(e,t){var r=Date.now();return function(){var i=arguments,n=Date.now();t<=n-r&&(e(i),r=n)}},t.exports.debounce=function(e,t){var r;return function(){var i=this,n=arguments;clearTimeout(r),r=setTimeout((function(){e.apply(i,n)}),t)}}},{"../../lib/event":33,"../../player/base/event/eventtype":70}],160:[function(e,t,r){var i=e("../component"),n=e("../../lib/dom"),a=e("../../lib/event"),o=e("../../player/base/event/eventtype"),s=e("./util"),l=e("../../lang/index"),u=e("./volumecontrol");e=i.extend({init:function(e,t){i.call(this,e,t),this.addClass("prism-volume");var r=new u(e,t);e.addChild(r,t),this.volumeControl=r},createEl:function(){var e=i.prototype.createEl.call(this,"div");return e.innerHTML='<div class="volume-icon"><div class="short-horizontal"></div><div class="long-horizontal"></div></div>',e},bindEvent:function(){var e=this,t=e._player,r=(this.icon=document.querySelector("#"+e.id()+"  .volume-icon"),s.registerTooltipEvent.call(this,this.el(),(function(){return e._player.muted()||0==e._player.getVolume()?l.get("Muted"):l.get("Volume")})),a.on(this.icon,"click",(function(r){var i;e.volumeControl._shown?t.muted()?t.unMute():t.mute():(i=e.el().offsetLeft,e._player.trigger(o.Private.SettingListHide),e._player.trigger(o.Private.SelectorHide),e._player.trigger(o.Private.VolumeVisibilityChange,i),e._player.trigger(o.Private.MarkerTextHide))})),document.querySelector("#"+e.id()+"  .long-horizontal")),i=document.querySelector("#"+e.id()+"  .short-horizontal");a.on(this.el(),"mouseover",(function(){n.removeClass(r,"volume-hover-animation"),setTimeout((function(){n.addClass(r,"volume-hover-animation")})),setTimeout((function(){n.removeClass(r,"volume-hover-animation"),n.addClass(i,"volume-hover-animation"),setTimeout((function(){n.removeClass(i,"volume-hover-animation"),n.addClass(r,"volume-hover-animation")}),300)}),300)})),a.on(window,"resize",(function(){var t;e.volumeControl._shown&&(t=e.el().offsetLeft,e._player.trigger(o.Private.VolumeUpdatePosition,t))}))}});t.exports=e},{"../../lang/index":23,"../../lib/dom":32,"../../lib/event":33,"../../player/base/event/eventtype":70,"../component":130,"./util":159,"./volumecontrol":161}],161:[function(e,t,r){var i=e("../component"),n=e("../../lib/dom"),a=e("../../lib/event"),o=e("../../player/base/event/eventtype");e("./util"),e("../../lang/index"),e=i.extend({init:function(e,t){i.call(this,e,t),this.addClass("prism-volume-control"),this._shown=!1},createEl:function(){var e=i.prototype.createEl.call(this,"div");return e.innerHTML='<div class="volume-range"><div class="volume-value"></div><div class="volume-cursor"></div></div>',e},bindEvent:function(){var e=this;this.icon=document.querySelector("#"+e._player.id()+"  .volume-icon"),this.control=document.querySelector("#"+e.id()),this.volumnValue=document.querySelector("#"+e.id()+"  .volume-value"),this.volumnRange=document.querySelector("#"+e.id()+"  .volume-range"),this.volumnCursor=document.querySelector("#"+e.id()+"  .volume-cursor"),this._player.on(o.Private.VolumeVisibilityChange,(function(t){var r;t=t.paramData;!e._shown&&t?(r=e._player.getVolume(),e._setVolumnUI(r),n.css(e.control,"display","block"),t&&e._updatePosition(t),e._shown=!0):e._hide()})),this._player.on(o.Private.VolumeUpdatePosition,(function(t){t=t.paramData,e._shown&&e._updatePosition(t)})),this._player.on(o.Private.ControlBarClick,(function(t){n.hasClass(t.paramData.target,"prism-controlbar-bg")&&e._hide()})),a.on(this.volumnRange,"click",(function(t){t=n.getPointerPosition(e.volumnRange,t).y,t<0||1<t||(e._setVolumnUI(t=1<(t=t<0?0:t)?1:t),e._setMuteUI(t),e._player.setVolume(t))})),a.on(this._player.tag,"click",(function(t){t&&t.target==t.currentTarget&&e._hide()})),a.on(this._player.tag,"touchstart",(function(t){t&&t.target==t.currentTarget&&e._hide()})),a.on(this.volumnCursor,"mousedown",(function(t){e._onMouseDown(t)})),a.on(this.volumnCursor,"touchstart",(function(t){e._onMouseDown(t)})),this._player.on(o.Private.VolumnChanged,(function(t){t=t.paramData,-1<t&&e._setVolumnUI(t),e._setMuteUI(t)})),a.on(this.control,"mouseleave",(function(){e._offEvent(),e._hide()})),a.on(this.control,"mouseover",(function(){n.addClass(e.control,"hover")})),e._rangeBottom=e._getBottom()},_getBottom:function(){var e;return window.getComputedStyle?(e=window.getComputedStyle(this.volumnRange,null).getPropertyValue("bottom"),parseFloat(e)):26},_onMouseDown:function(e){var t=this;e.preventDefault(),a.on(this.control,"mousemove",(function(e){t._onMouseMove(e)})),a.on(this.control,"touchmove",(function(e){t._onMouseMove(e)})),a.on(this._player.tag,"mouseup",(function(e){t._onMouseUp(e)})),a.on(this._player.tag,"touchend",(function(e){t._onMouseUp(e)})),a.on(this.control,"mouseup",(function(e){t._onMouseUp(e)})),a.on(this.control,"touchend",(function(e){t._onMouseUp(e)}))},_onMouseUp:function(e){e.preventDefault(),this._offEvent(),this.volumnRange.offsetHeight&&(e=(this.volumnValue.offsetHeight/this.volumnRange.offsetHeight).toFixed(2),this._player.setVolume(e),this._setMuteUI(e))},_onMouseMove:function(e){e.preventDefault(),e=n.getPointerPosition(this.volumnRange,e).y,e<0||1<e||this._setVolumnUI(e=1<(e=e<0?0:e)?1:e)},_getPosition:function(e){for(var t=this.volumnRange,r=0;t=t.offsetParent;)r+=t.offsetTop;var i=this.volumnRange.offsetHeight,n=this.volumnCursor.offsetHeight,a=(e.touches?e.touches[0]:e).pageY;return(i-((a=i<a-r?e.clientY:a)-r)+n)/this.volumnRange.offsetHeight},_offEvent:function(){a.off(this._player.tag,"mouseup"),a.off(this._player.tag,"touchend"),a.off(this.control,"mousemove"),a.off(this.control,"touchmove"),a.off(this.control,"mouseup"),a.off(this.control,"touchend")},_setMuteUI:function(e){isNaN(e)||(0==e||-1==e?n.addClass(this.icon,"mute"):n.removeClass(this.icon,"mute"))},_setVolumnUI:function(e){isNaN(e)||(n.css(this.volumnValue,"height",100*e+"%"),n.css(this.volumnCursor,"bottom",100*(e=1==e?.99:e)+"%"))},_hide:function(){n.css(this.control,"display","none"),this._shown=!1},_updatePosition:function(e){n.css(this.control,"left",e-5+"px")}});t.exports=e},{"../../lang/index":23,"../../lib/dom":32,"../../lib/event":33,"../../player/base/event/eventtype":70,"../component":130,"./util":159}],162:[function(e,t,r){t.exports={H5Loading:e("./component/h5-loading"),bigPlayButton:e("./component/big-play-button"),controlBar:e("./component/controlbar"),progress:e("./component/progress"),playButton:e("./component/play-button"),liveDisplay:e("./component/live-display"),timeDisplay:e("./component/time-display"),fullScreenButton:e("./component/fullscreen-button"),volume:e("./component/volume"),snapshot:e("./component/snapshot"),errorDisplay:e("./component/error-display"),infoDisplay:e("./component/info-display"),liveShiftProgress:e("../commonui/liveshiftprogress"),liveShiftTimeDisplay:e("../commonui/livetimedisplay"),setting:e("./component/setting/button"),subtitle:e("./component/cc-button"),thumbnail:e("./component/thumbnail"),tooltip:e("./component/tooltip")}},{"../commonui/liveshiftprogress":12,"../commonui/livetimedisplay":13,"./component/big-play-button":131,"./component/cc-button":132,"./component/controlbar":133,"./component/error-display":135,"./component/fullscreen-button":136,"./component/h5-loading":137,"./component/info-display":138,"./component/live-display":140,"./component/play-button":142,"./component/progress":143,"./component/setting/button":147,"./component/snapshot":154,"./component/thumbnail":156,"./component/time-display":157,"./component/tooltip":158,"./component/volume":160}]},{},[15])(15)}))}).call(this,__webpack_require__("c8ba"))},8475:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAA8JJREFUeAHtmktoE0EYxzPZpA001M1mRVFQUETBixcP3r148SYIgngRm7ZQKSgqUlAQUdCD9VBE0INY8HHw4gMfIB5EraBIsRX0pijdTZqa2qZ5jP+tNp2mSbvZ7mOmnYWw385jM//ffDP7zeyGQvKQBCQBSUASkAQkAUmgQQKGYTxIp9MbGqzGXfGw0xbRUGhvqVz+bKTTxymlUaf3CboecdqAEcMAg38HIWQwTEhK07RXM2minB17ACsQHrC9TOlLwzRvjI2N6Wwe77YrACyRgEDwOzRVKAybpnnYuuZdvNU+x41kh0AtoRgWr5VwOJVIJD7WyuclzTUPqBYED9iFSXJgxDQvwY5X5/Ny7ZkHsALhDd/xR13JZPI+m86D7ZkHsOLgAesxSd6DNzwcHR3dxOYFbfsCoCKS0j2FYnEQQdRpQGmqpAdo+DIEaunDHw+HIpF2XVVf1Mr3K81fD2BUIYraSovF5/CGW7lcbg2T5asZGIAZlQBxYDKfH0ZI3Y5h4Xt7AhsCMwDYMxrzjkYiqdWq+p5N99L2nfhCYuANO0mp9Bbe0IuV5qqFyrqVxxUAS5Q1DGi53IkgaggQ9rsltN59uAPANHQtIPRjgfU0m81uYdJdNXkGMC0UHrEbC6xPCKLOwI65qh4342oStCHuK/YdOhBSP7FR1lYR7j2gSsVmhNSPMSzujIyPr6vKc3QpGoBpkRgK+8jExBD2HbpgK46U/68k2hCYr5WQD9iJadN1/c38zMVThPSAObIo3RHC5gu8oQ8rzcScPBsX4gOASAwDgrnhCFaaQ1hbHLShu1JkWQCoqHHwVIswlYU1seNk7cBeUxTlpKqqmUaEiA8AkyDGQFvS4SQoLAD0+G/0fA9exvTiXGqk19myQgKA4Ls0Fjuqt7T8YMU4sUUD4HooLAqAPJ71F3RNO4/en3TS0/XqcA8Agp81RaMdra2tX+qJWEo6zwB+4tVaNya5/qUIXKwud4EQerxMwuGrEL/Na/EWHK48AI+2AaoobX5uinIBAL2exSR3KplI9FkesJjbupkfOAD0+u1Yc3N3PB7/5aYwu/cKDACEc/FqLAgAkxB/Dvt6F+HuU3Z7yqty/gIg5FFUUTqxYvvmlaBG7+sLAPQ0tx9IeAoAwkt43XUlqWk9sHON9o4f5T0DAMFCfCTlOgAIT2OSO4Eo7jpsOADfh6sAIPgmFi7HsHAx+JY92zpXAEC4sJ/KLhXAHyxcziKEvQwIhVmuK8CyPpfPZDIbV4BUKVESkAQkAUlAEpAElimBv8g7O0lnTWYLAAAAAElFTkSuQmCC"},"84c3":function(e,t,r){var i=r("74e8");i("Uint16",(function(e){return function(t,r,i){return e(this,t,r,i)}}))},"8aaf":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAAHdbkFIAAAAAXNSR0IArs4c6QAAA/1JREFUeAHtWrtuFDEUTRBSKsoNP0GFSMN3kNR8B20QEh1/gbTU4SeQaKKlo6GDSCEFBQ8hOGfW17pzxx57NvYwrGxpYvs+zj33zOxkMpuDg+LjD4YGvSsb66CdtjsSYGc6DzF6dho5eka7SQbYhMJ71F9ZyE4HQ+yQe2kxqAOdJmmr2sBo6/2n+/7ZVk3ohkUy5fbLnoxMkuEj1AK+R+LHfKRc26Vy9pYS6IxHmE+4Fntwhv+UQRzBgGacUQGchMGHVJf3Ny5tlLU6hdErtnclqsSVShbz+MyE2GAmfE9wnLv1BuuuNU+NybES8mFyMVeIW4kt2EIMCPYPTMbxfBBD9NhgMHyk3bF0cc8GIC7Qf4hcYLQ1xnsNLJpU64LQsPXLPqqBE+lMAtvcFFiwArje1/qan4WqFGVhGdULo1DXqRS0syUA/wNr4x720d8QXY4Fz9nrYojXjyD6Hi5Qw8cSAyCB2bPOl7UhQqxB4ei9UEB2nVFsg9x3Lv+xm7/D3ikyikuqU4cFdPm9jmHjqbm2sdl7JH9xwIMpG6RUoCVTCncnHJLZKbElNQWaAk2BvVEAd8L1P2kGhbu/RDGP/gFVhRy7ZmEZVYqEQFHQdy3FOYdic2yTnohQh+d6/t98KBzsmp3LyOkWsfdz4roXuwKcO2tg5PxinrEdO6xLbZ90CnRiYv2NfiGB+Rjbzy7nk5vjk2M6abJoSP4aALiwccF9IDFpCgEh6UYlBosHX54wKQQ4ZpMXTxIDCC17Z7YxNFa5Bkzxt6hzw2LZjTFw6mABDuTdU7ledtj8NbGNHPmpALKXGg5JL3H44uKDjSQeyp5z8BrQAVwjiXe/lbXrfej8an9snXUNAJwX1FkMZFY71cAxGHOTmPRCtRo5yODVqFYkBQwSnRqpuOZvCjQFmgJNgaZAU6Ap0BRYqALuga57slwoxfK0dNNY+1G+0oIQ0SUf3f3fEL5rtVgQ3TJUcppW/U9+IVOGZWGUqU3vhQC3aTpXAFeDr16TX7sjhq9jNzgucYy+0sk6/wCZZYTIoDDftl0FCAyEQIw0bsNfhbCzbRat1n6MEGryfx78K0bF4RzrWOMX8PX+d2KsRtSnilVdRgkoBwjEhNDcyjQudTVyzbXUS83gwDP+McLlRSp/sj9SqLg5RQwFY5f6zwCZwT0ihR/1B8CrmGIERhr3lzpiYh+N2wtRpdsA6IgA/MpDD9+4zUGQFeIatt7XIpKT9fUIg1lZkmrOqa9ZQOMp6r9G3I8UD8SeIOY3Yt+nYov4UXCF4w2OnUcRIksAgQI7ibEE7sU5TBGjePGlATox1rHPyNL4VuUTEqNqwSWDixhL5ti4NQWaAk2BpsC+KfAXS1yUfN3MiJgAAAAASUVORK5CYII="},"8b09":function(e,t,r){var i=r("74e8");i("Int16",(function(e){return function(t,r,i){return e(this,t,r,i)}}))},"8b90":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD8AAAA/CAYAAAEgWCBJAAAAAXNSR0IArs4c6QAACARJREFUaAXlWn1oVlUY31oObSmrqanBaENogqWRGQ1KaBbIyKKgQoYg2WBKCq36w5xdHc0+hjT8Y+AKAr9KdFQaoriQSTPbzJiCLkVr0lRwMWebOdvW73fbc3fe89773nPfe/f6sQee9zznOc95Ps73OfdNS4uFqciuUlnpSsZSaCEtEXArtIXuwi/V2jA4OPgBUfJMKbBEZZBWhe5GvgpoAW1IT09fKzRTXx9EgMIWfzSwMjTGW8jnAM8IXzRYwlDSDtCbGIWlMFVyGjMUcEANb4hpxQiQSaH29vY3pRbbIQbc2uEeSLwXIzWcscO8gXw/MH+Yb1MWfyVMmzP0Y6kZF/oT8HqFryqwhGmYNkDukCiIq8zW0AN2UdzHVmL3uYLa7p2dnX9NnDhxoyaYyX5w+l0rjMm6VLbLPUPIzs7O6OrqYusnglpRQKFSoD1+EtVQyizSqgKlzJ7amSpjiK5FeknleymgzALgY8CrwJ3AC8A40BUkGpZS2RKCqaogSBs4SmQ6PQ1lgRuQHoiCImYCgkV5KohZTMnkCGxubn6FtB9QgVt3pc2ZM2cmFS1atOjBBEqmshEtXUCdA1LmMbE6pQ1EzjN1Uwrh8UYKioqKNnp4cCxu0VNdaGho+Hn+/Pl7VZ5G76UCju8yteA6YOzYsR+pPC9aRqLlJZCAb6+N0gZBFXRAsb2wigdiyESRvZhKBV0B+Q8AY9pkSLgPadUQ7SRuCpxChaDSN4Cuo1aRE5LGvgDGLD5SqKaJHOAMT2aSqvqFjmk2YTJ1c6AU/CBLi6rPj2bnb1KFVAdMVlO1bhja2d5lGLOPvU4YjiFsrp6bsCNkRtAWbToLstuojVN1P4CLkmBdXd2TcULmDNsmu2AB0EiRx4pom+zv7/83Pz+/Gqe76+Y+pB2hA6uARtMrkQO6UexIJ+bOnbtL52t5+3DFfT9HK0g6i3X4n8mTJ1d3d3f3Gyi5ykHIQ0coWL9+fT33GyJ2gY8NjdPmTm4nPPFw5TLqBsilnT9/viM3N7eOdAigzQvqOmCFUJZMVdue6gCVRLn8ejkVsyzrDkilkViO45ZhGvNyQByJYnl2ll1RqqZ+DqiyQvMOPhs4HTh+iMmpzKvOr0DXY/yQXFwS1AFO28eBDwOnALOAPcCLwDbgUeAA0AhMjb8IbbyomMIxCH7rJ+xn/AUoYKTJAltit1flRMYtr0pJ8F11uRmfAOVvJ2HAr8oGCHSrQnL4EN4YECNhmPqpl/od0I2/75SMDBGjXzXue+yKyB/HjhifBsVc1VIBtEN7afIoV+5nta+vbxVkLjc2Nl72kzUo5/Q9yMiN9vcxgHXr1r3K41ZhYWG2gQE/kUxOtdeAM/wk9TPeNQCepap7e3uNl1PNxklG7mtYq2RnxwF6enoqzp49u8St3IA3Qwacgay7SF5eXi5bZc+ePc+5S3hzQxsX1cXFxYV0YvXq1QXC80vZ55afEMv1PvepM4hBWXP48OErieQii1wzkl5QUMA9IiHwSB0pbN68+cDixYt/NFEamfHW1tZTs2bN+trEqMiENo7X5Cs5OTmfDQwEn+40fhIYeK7D2AD6tfr06dPXJJKAqb3I1AeslFZaWvplRkZGZQjDNFnPyG+YGGek27dv/6GkpMRoMBnovCHHKG5xvLGkCjbBUIfMc15relNkmXZoz3m/Ic3rTSrAsSORi9EPhRihNEa/nGTEFifrL8CnhBFhyqNzzLSUAedmw3JjJslz1ZXIOO3ctOuSGuRLyPBqbAq8Ln/jJ+wXuV6fA5Qnz5RekXUnEuXHoJB7BfEh4DhgssAB+juQ+w/RaDWGnBEEbXk3pVydnwEaH9/clATknYJ8I9BeLAPWdcSTDZ6BLgSm6pbnOOxCcMf4DsgGCQRBgudwZsCPBLKQWuHjMMeGMJoeJsFPgLKlQKa3C3TD0c+BTD3BL/hXUPNW7mnPwIYKOBJ2eQl5Bc85/bpXpduQ/xV8jlsT9LMV4+Kp4nkSdxDMRCzjgb+pMenBs7cfVQWSoefNm3cfvt/iVa1vMJn6I1SHW/IU4AnRrw77oEc40RGXqq8r586da1+zZs3+LVu2/BkneHMYztFTgmdvvxyVL2rwqk58r+7ft2/fkbKyssaA36xVNVHQ9VDSyuB5Xn4XGOYYiurD4BX8sMT/FP83WFNTc6CyspJH11QCj82fMvgngMVRWjYNXrfZ0tJyYuXKlQ1NTU1detkI5L9n8CXA6VEqTzZ41Qc8vPdu3bq1EY3RHOL1XVWp02cY/DvAe/WSMPkogtft4wtAe0VFxf5t27ZFtXD+zeD5v3GmkcFIBK86h5HQM2nSpA0hR8QgFzt+L7/lAQ/SXVVVVbvwTLs2KysrzIcoibWHz7UXgZHOedEeJuXzMP6C2rJ8+fKDId+kvdy4yOD5D4lbInj+jwnb3n78me4PL48j5Lcx+KPAZ4GR7fOmDvI/wjt27Di0YsWKnwz+tW+q1kSO+/xRBs+H4r3AyE540OUJ/IJVXl5+ANDpKTTyBYx3gMETWoH5wNnMRAn8clZbW9uAT7THMY2jVJ2sLv7/iPHGbXG81fEuHwqWLVuWh8XqUltbW6q+/Jj6yzs97/Y2uO3vvM/zbfxOA65tu9Wg9Ps8y3jh5/bHB4A7BdjbTXowbj2vyozKNzy1AfhquxTI9HaBbjga+vVWDXZUvturDSA0d4SFwFHzxUYC19NR961ObwA1n4kMR0bUX2m5R/ephsLS/wH1d06gIbPkLwAAAABJRU5ErkJggg=="},"8bbe":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAPVJREFUeAHtmVEKgzAQBW3pEez9D1jvYL+EJc0SArINzPjTZFGzb95Tqm6bmwQkIAEJSEACVAKPu4V/juPsnfO971Nr3XWeXi+x9owT4lgARNejZhMQaRDHJoDoetRsAiIN4tgEEF2Pml9x0htn/8l7+1bUZvsZPYN4CVS4tvIaJmBldyp6wyegArJrSEACEpCABCQgAQlIQALrERh+sZ19A5NJHL2ZaY+rWhf/NCiANnq0uQmgOd7qHX4X+Nfdu230ms/2cx2X/XoJZGQodRNAcTrTaQIyMpS6CaA4nek0ARkZSh2fAIrR6pSABCQgAQlI4JfAF63mHEuwxA6mAAAAAElFTkSuQmCC"},9072:function(e,t,r){"use strict";r("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=l,r("4ec9"),r("d3b7"),r("3ca3"),r("ddb0"),r("d9e2"),r("d401");var i=s(r("7e84")),n=s(r("b380")),a=s(r("fa95")),o=s(r("4478"));function s(e){return e&&e.__esModule?e:{default:e}}function l(e){var r="function"===typeof Map?new Map:void 0;return t.default=l=function(e){if(null===e||!(0,a.default)(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return(0,o.default)(e,arguments,(0,i.default)(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),(0,n.default)(t,e)},l(e)}},"99de":function(e,t,r){"use strict";r("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(t&&("object"===(0,i.default)(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return(0,n.default)(e)},r("d9e2"),r("d401");var i=a(r("53ca")),n=a(r("257e"));function a(e){return e&&e.__esModule?e:{default:e}}},"9ace":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAAHdbkFIAAAAAXNSR0IArs4c6QAAAtJJREFUeAHtWu1x2zAMVXJdIR0gg7RLNNmsHSJbxN3Df3uXBfwviiAF1BMN0gBFfaXwnU2QxMfDE0mRkpum/uf13KLT+1ChDuz8lEeFoNkJoDgq/Hy8Czooh0YWwJqbVi1P/x7ieN/6BgbWXqg6ZtNVxjR7zeufQSGb97XR0VomlEzAM3XUmCFhSiMZ8XfirauwQy4/+6cOYiNFPZ3C3/NT89689D4yKShiuMp8BoRJik6HCYstKNOgESYxqsgOKGp7eUPFlDw6wCE6RJVtSA8Gln4oYwBwrXcARihWdEB50fe+ecYIQYa8Q1snpGcj5pwwJkfpFHJoEILLzsAOGDidX8I9rwDOuBpZjClo2zz1JpN9ocXJoKsHUBqUV4TEaiADYCNMSJsp2yYCokuS00tRrLlQfXMA8iWYk62Seg6Rvp2wBpan81s3+q/OAr2KMTC7tQFgKypjMIUA0GW5TGD84ww4A87A/80AbVYKP/PuhnwS1W5WBJDl+4F+i6Y7BgtxQ5OdgQpZh+idYGOgUtYIQMfAnKxvbFJlAGzEUHNPLVinsLRdAk0QAh8nkLGrDyATTOpyAM6APA2l0aJtM54PZACxk/gQogWj0NOfjPA5vOQ4Bi3pCG16AGycYqMQgH0W/Hj8nnygyiANpZ0BdI5srMYAAqjMBrp22RlwBpwBZ8AZcAacAWdgLQZos087S8OBvhY0+UhUy3vODyXdNr/7l0/vOcVl+9YlYCdJI6XLE7DDpJcnYOdJL0PAVknHC6fxaK6fAnEgpJHkDReyGIqlrifA4rWmbky88QrfgmJ/LHXL48H6nYCDXbDqcH0EVKf0YA73fxeovOrH10dPgAYIvdBuLn+6A86vONBe6/NejuSyKiVDQ3QurrFvOQIQiIWML0nANRn0HGD4Czb2kfzlCcCEh5ExJWNlAhDOtjKRMeOvZ9uC9+jOgDPgDDgDx2TgAweZ71+epUwnAAAAAElFTkSuQmCC"},a073:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAALpJREFUaAXtmEsOgCAMRNF4BLz/AeUOGneEBIYmFiR5rtQ2U3hTPxACBwQgAIGZBDZV/ErpVjl5/IxRar75X+nuefEVz5nAbNcO6wB6e1zpKp3eZ4QWUqS94zjgTVjp44Ai5B1f3gFvQOhDAAIQgAAEINAiIHcQypWRWkm1illivXWX/xdiApa28MjFAQ+qFk0csNDyyDXvzJXv53JQvd8JpVPq1q5poRqZUfeXd2AUKOpAAAIQgMA/CTwQGxwzWdpTwQAAAABJRU5ErkJggg=="},ab53:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAAHdbkFIAAAAAXNSR0IArs4c6QAAAydJREFUeAHtWjty1EAQ3QXKAbljuYozcAo4BoW5BLk5ATknIDcxVRyBCxhiExKY10It3nzVkkbeZbenamp6ul9/9NTaHcu7260dew3wgKGyrnuMJ7qRVRQyWBcAEORWgQzqZU4hsowEdCBFf0m5goLLZQDkOy42iRB4KjKK0JOltiNYgzvLtdZq4wt9lgMyILbHSYJ2YjCA97w3yRJdBoP/av4Fi+2rOeBkLi9kYPVdKDaStaCklee0sSQxVRB3H1eXDQCHNwyqVcW43dD3vAQPlBrYKVfBa8koA8Bv4sQOVbkEHjLfD2sQcHUfVCtyozPwOAwEfcwpSw8FY+bIw5OZuCQfZwkCipJzDss6y0XkPks4hllGsgvMO8wbs1MNKNXrqOHUBuxNjNe9rIozr7Ez9j9ZB/ntVDDGT2ETOzsP8ncFYd9F9mwxjFFf82p1Bq5jLORrTcJ61cXrwR/DZk9BfGW+dwacAWfAGbAy4N8FB/8yOp1DqbXpYlyzW4DTjxxK5VR8ESdZtLccpzgw4ccXo6QrnoqbMUDFfCJ5uZirHrpfmNkTcC5TLkYOl9WxM+RX0T54fZMNACX7lDBFPTuT/JVkEccjeC4QY3P2qo6dB/mlOmD/hexFNghTbEKNmaxTzrB3jIGc9AbbkwRTCqszcLeEDdggfXsG+AKQqONkkPveYB3jWfav4y0+CZlhl50BZ8AZcAacAWfAGXAGnIEKA8UDeclHTvkl2zHo5/538+zP42dPgOn9pKW157aeJWYN0+pRPPsOODoCcGfHHx/IXR5Gm19C1FrKatOK4tXqP4VDXHnJHY/xnbP6xwDdq926btoBKOoFZmctZsBdYf2A+WOYIl9hHsdQpuNVq4P+EvNzbMdeXmHOJUPDJmsmfq9KgK0VpcTQf6zYYtNqMuKAum99vUk8TTSx/ob9PeZTCYD1Heb4K1DIPBaRwQFYTgpureBkGVm64HkpJ2x7zGvM1WQgRnaUcjfTZ7NCuSQB3BaT0bKOWbVvlXguGVvVMUnGYyS2kNGqDv9zePKWnzhg05PgiXPnl+cMOAPOgDPgDDgD/zkDfwDyUp0YrB7CmAAAAABJRU5ErkJggg=="},b317:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADYAAAA2CAYAAACMRWrdAAAAAXNSR0IArs4c6QAAA3BJREFUaAXtmjtv1EAQx732XSpOupOPBoQQSJHoKKmA4j4AJQ1SIvEo+BB8EYhCm5IWKQWPJiWijEQKoECx7y46lCJ3jpm/pbUcZ73e9XpXF2RL0T5md2Z++/J4L57n4EnT1D+O43dRFG07MOfGBKCiON49jqKU0sQVHLOJB6h4Ot2hNJ8pxti5l6bPx+Pxe5u2rYGJoDiICzgrYDIoV3Ctg6lAuYBrFUwHyjacFIwc7Z2cnNziTtSlqyR5Q32269qV5dhzKWOv+77/sSwTlZMkWYZh+Esk43VSsPl8fme5Wv3gjdcmZezoehjelfnjy4RXWdaBXbXZ62asm7E1GYFuKa7JRCi70c2Y8lAVGlJYs+8z9srb2Lg3DsMB/pBHHWSFpq1nK0OqJgFtwbvDXhC8HI1Gnwp1l7Kz2ewxxZdvSbB5SSipUPmeE4IZQTH2pR8ET4bD4UziWy6ieHS0TJIP9FX9MK9UyNTBXQIzgvK8w36v90AVivufwa1WB1RubeYuHB6GUB6Wny4U4NAHfTmoagp/PcZ2RBdEOZgpFE39ft2ekjmMvtAhayOSVcFlYKZQMEhrfk9kWKeuqQ4RnN8GFJw/7/c/60CI2proKMMx3NDink9kSKcO7yga8b86fcptyblrdKm6KNfrlLPTkrEtn6Xp16yg09tS24hWdAuqZwFj333cyJK2F6Zw0WJx09ipxeKGiQ5iiAPfn9BB9C07POjGZxfL0QTOXy4fmTiFviY6ilCZLu5MdpduAEf74ynX1TRtqqMMdQEMBRO41PMmiP2aQqEvdOj2F0FBh3CzZm9yeqNnR6ieJdchVb6nym7mkUdRYDBzmwhoEfsV9cnyeRCsHydWQsGeEAwCwOHaGXmth6J0uj0+UFmWaIO2upE9+XPKT78q34RLkTem0TS64ibl+7QH9hBRjAeD39CL1wJOPxwUTfZU5pvCFXePQ9hI4TgBTLyzM48iitzEeZ6zl6lcivZMutHcgbkZ5/asdDPW3li60dTNmJtxbs/Kfztj0hc0fp2nW5oj1XGkSON2g8CZqz8lW394oSb9WSMXR/d1narkTb8Kqj49quyo1EtjRRUF5Ta6cDag4FPrYFCqCmcLyhqYCpxNKKtgMjjbUNbBRHAuoGDXyYM9l/3bbBxH9NV834lRV0ai6fSZS6h/YKUM+mPI10YAAAAASUVORK5CYII="},b380:function(e,t,r){"use strict";function i(e,r){return t.default=i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,r)}r("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=i,r("131a")},b479:function(e,t,r){"use strict";var i=r("c0ae"),n=r.n(i);n.a},b85c:function(e,t,r){"use strict";r("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=(0,i.default)(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r["return"]||r["return"]()}finally{if(l)throw o}}}},r("a4d3"),r("e01a"),r("d3b7"),r("d28b"),r("3ca3"),r("ddb0"),r("d9e2"),r("d401");var i=function(e){return e&&e.__esModule?e:{default:e}}(r("06c5"))},baa5:function(e,t,r){var i=r("23e7"),n=r("e58c");i({target:"Array",proto:!0,forced:n!==[].lastIndexOf},{lastIndexOf:n})},bc5d:function(e,t,r){var i=r("6f31");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var n=r("4f06").default;n("fa29ff32",i,!0,{sourceMap:!1,shadowMode:!1})},bf19:function(e,t,r){"use strict";var i=r("23e7"),n=r("c65b");i({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return n(URL.prototype.toString,this)}})},c0ae:function(e,t,r){var i=r("2349");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var n=r("4f06").default;n("49d32383",i,!0,{sourceMap:!1,shadowMode:!1})},cee1:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAk1JREFUeAHtmkFuwjAQReM0ldgRkrDnDLCkByiCW8A92t6BZbvrll0reoHuCmdgTxJgh1Qad0ZKpEqA5BjHOO5EQgmO8cx//qMRURyHDiJABIgAESACRIAIaCbAOW+sk+RZc1gzwm02m846jr/gw6+dkas7gSRJ7n+ybAFxe7pjn4qnDQBYnoH4B9jyd7gOTiVzjTFPR9DdbhfEafrqcD7QEa9MjMoBbLfb7vfhMAPxnTKJ6ZpbaQmA5ccg/hMsb6R4hFyJA7DFgeWnGedjXTspG0c5AGxxcZLMIKGubFI6f6e0BNI0HeQtrhbiEbQSAGB5F1scWP7NpBYn4qSLS8DkFlc5ANNbnAgA6RKoQ4sTAXBUAqJ/UKDeRdY3fo60A4xXJpggARAEZe00coC1WysojBwgCMraaeQAa7dWUBg5QBCUtdPIAdZuraAwcoAgKGunkQOs3VpBYUxw3tE0fCQGT4WmcKNxdLPEQDuKpHMoEebsVOkSCMPwxfG8O8bY6uzqNbghDQC1tX1/cet5PYexjxpoPZniRQBwxWazmUZBMAQIT+CG2j0pvRgAQgDhWTsMH13GhnCd4lhdDiUACrFBEMxvXBdffVkWY6aflQJAsa1WaxWFYR9s8WK6eMxPOQBcFMpgDyUxgZKYwNc9jpl6VAKgEIutErpEH4CsijHTzpUCQLG+7y/zVjk3TTzmUzkADJK3ylHeKjMcM+XQAgDF/mmVI5NapTYAxY7XsVUWuSs945tk//ZlaaUkaTEiQASIABEgAkSACBABOQK/1oavhXGGGjYAAAAASUVORK5CYII="},d22a:function(e,t,r){"use strict";r("7a82");var i=r("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r("4b4d")),a=i(r("5cd5"));r("82de"),r("bc5d");var o={components:{Wnavbar:n.default},data:function(){return{query:null,dp:null,searchData:{chapterPath:"",title:""}}},onLoad:function(e){this.searchData.chapterPath=e.chapterPath,this.searchData.title=e.title},created:function(){},methods:{initH5Video:function(){this.dp=new DPlayer({element:this.$refs.player,loop:!1,video:{pic:"",url:this.searchData.chapterPath,type:"customHls",customType:{customHls:function(e,t){var r=new a.default;r.loadSource(e.src),r.attachMedia(e)}}}}),document.querySelector("#dplayer").oncontextmenu=function(){return document.querySelector(".dplayer-menu").style.display="none",document.querySelector(".dplayer-mask").style.display="none",!1},this.dp.play()},videoErrorCallback:function(e){uni.showModal({content:e.target.errMsg,showCancel:!1})},initAliVideo:function(){this.dp=new Aliplayer({id:"dplayer",source:this.searchData.chapterPath,autoplay:!0,isLive:!1,rePlay:!1,playsinline:!0,preload:!0,controlBarVisibility:"hover",useH5Prism:!0},(function(e){e.play()}))}},mounted:function(){this.initAliVideo()}};t.default=o},d967:function(e,t,r){"use strict";r("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},r("d3b7"),r("f8c9"),r("4ae1")},e58e:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAAHdbkFIAAAAAXNSR0IArs4c6QAAAotJREFUeAHtWgtSxSAMfDpeQW/mO+TTk+khNFsbZtuSDr/Sj2FGoZBkNwu0tHq7NS8/Ujjos15gAIWv0Q4GOoCaDYPBkxQ14rb2hZq9Q2fHhuC/zuFe0DEjFrLBWEgTF7EyGKzmHfM6Wd9EEubO0q2JMJERTlo4GNro51rHJwG0s0ktgO8WmyYAHiRDAZmJxSZl92HDcge3MY3jtbliowsJqOTMMRftwCDVAXa8N6IMFjDSYQEkB4gFRV+7AMgLRYLeY2jj2GLInB7O2XJGNDOFNTYLGt7hCuyrgKz3B6/5LmwUFMBaNgcWoCFTBZzXFgG1s8bD/ZgN4MTXOW31Xbv9cDzzVsRGW7Z3JxCdgpqMU6UvwpD5/cIcx0pRwBonITEhUxOr2hdkqoN4AFfAFXAFTq2A3AkfuyQgwMObqNTFB5hi4sgawFqKA+U6CmDIWsFR58ZR+6wTkeBgrps++ZJORAKMbx1FwKqOdVKKElAnlWnLOmsKUoiAPEqKLWyaE0gFVjsn4ApEt6EukJLa2u9WrOgUIAgXcf62AnTrl60dvsMPG332qyeRySuZ8uhGAEAxNboSUDAhEtTQvu61qtEd2AFdAVfAFXAFXAFXwBVwBdooMB7ohpNlm4gniMJJSzuUE1AvpyhZ4rUuvEOErKlRHv2gnilJU/7J37QOmu4frdykLyFATdI1ArAv2rkrI/nDVEnwXDJ72CcLsAc5YM6Fxwe7llyiXwZbAhw9lgtw9Bnamp+vgK0VPnr8wz8FWt/15xOSvAX470VWW4K/yc/nHORfXsvzG//T8IHneE65pFgiQLIYlxSAkxrFeFirgm0v346JcfmkrQRVDGvc+10BV8AVcAVcgfYK/AJWbzC3Dqid9AAAAABJRU5ErkJggg=="},ef46:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAAAXNSR0IArs4c6QAABE5JREFUWAnNmM9vG0UUx9+8mdm1s3YKTtPWVkJMUCtqVJUm/IqAJj1U4lIOnPhvoP8N4gASuSAh0bQXWtoEqkCoQApOHeyINAHF3tq7szvDPBdHrhMhx95ErGTZM573/X78PDO7bxj0XMYY1um6CcBgCTC/ACwAwN1aja9XMumNXT7dDFVRRfEoMuHFsclQDOesoU3kS8H30o4sT+Xi9enJRjOXz8cugK4tgYEF0J+Aff/3Yoztf6aufXNqdGAIpGRff1mIWrnMvXSaL664F+otuAIaJyzyc3EUe9hlrQyg3sym4IcbM8GvfrMZ54vF+EULt2btOmDdUPvC3TCUldIC4FoNxN2HTyb/bMqr2rDCYab99iEz1TNpdeedy6crpTxEa0ugu7PVgWoDdcPM26zcLpfF0yAjb/3mLqjQzPRr2s846bCVa+eDpRG3oeaLxei2zVZ3plg3TH55mdfGZvl2C7zvHtVvaG2m+jE56hhEtjH3anZxPAV+fmc5rs3OxvtQBHTTzpdnmQFR3alnVirm40jD2FGNjjJeIOzMTLLPCmPZxnwR9jPFPjUGac5AsSxgdNT56o786Lgy0wtMmfrwqvoC9vZCKBcjmlPsc2O4HcjXtredr++lrrUSnjO9EL3tlJ1TH7zdulUaHw/tdzHS0qbVdP8hTp40DMGRJ3kTA7G095mcuytqDfF+L/1Jtcm7zWD3PKRN78sHqfNas/xJAfT6kDcxEAu6UvK/W/Hl3kEn3SYGYsFHW+4IKDNx0gAH/CwDseDPj/XL/d6bDogk2EEMxIJBoF9KUHcoKWJBFcfZoVQSDCYWBBRegprDSVkW7DxcDaeUTDSxoH3UMsnIJaBiWZAj8xOQSkSCWGyGzP8GiFgwxaGeyM9LQIRYMJ3CPxLQSkRixHM28bVC9LhdHSQiObgIMZTOtip41pFNFKw6uFQykcTQZglTOj7jmZ+SkR1chRiIBXMjUfTeK/x3wc3W4HLDRZI3MRALBkrFzNHRxClzbzjZwaPJmxiIBam8zaSVeveiqHpCrw4uO1gkeZI3MRALUq29G+SiKIjV9SvRXVewymDSR48iL/Ikb2IgFqTCn2rtIB0qB91g7oL8ljOwBcDxXuRBXuRJ3sRALEinEO3C3/cj7mbDF06pxlzJLDpoNo8LibTJg7zIE6w3MRBLu7bvLqUh2nXAkw5olfrmR+ctP9CXkgTzXFy9/nr4PaBsga9CELnwuVL6sMOGdOaJjAPXMRF37q+rQnUP3ghjdm4YMMcu7cIoPHhzWlaZiEPuBmGzcVodOGwgk26oZ4cOts73POE2HSlcLv166KxU5NSWDxdVYAr9FgV0O5Auq57z4JeZSbXhZZ2QJjDNGfqbDj2O6fzqbqjuAyuqKBtNKU2IwkgUO3sqvVrVE34o81EYZmPNR7Qx7cdgZMznGD8VjlP3HFW7VMDNsVHZZEpHtM/Q0qbV9F8HVv8Ab1VE7GXnBiUAAAAASUVORK5CYII="},f21b:function(e,t,r){"use strict";r.r(t);var i=r("532a"),n=r("6c20");for(var a in n)["default"].indexOf(a)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(a);r("b479");var o=r("f0c5"),s=Object(o["a"])(n["default"],i["b"],i["c"],!1,null,"c7cf92a8",null,!1,i["a"],void 0);t["default"]=s.exports},f4b3:function(e,t,r){"use strict";var i=r("23e7"),n=r("d039"),a=r("7b0b"),o=r("c04e"),s=n((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}));i({target:"Date",proto:!0,arity:1,forced:s},{toJSON:function(e){var t=a(this),r=o(t,"number");return"number"!=typeof r||isFinite(r)?t.toISOString():null}})},fa95:function(e,t,r){"use strict";r("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},r("c975"),r("d401"),r("d3b7"),r("25f0")},fb2c:function(e,t,r){var i=r("74e8");i("Uint32",(function(e){return function(t,r,i){return e(this,t,r,i)}}))},fd87:function(e,t,r){var i=r("74e8");i("Int8",(function(e){return function(t,r,i){return e(this,t,r,i)}}))}}]);